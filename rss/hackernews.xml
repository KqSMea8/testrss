<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=hnrss.org%2Fnewest%3Fpoints%3D200&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://hnrss.org/newest?points=200" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>Hacker News: Newest</title>
<link>https://news.ycombinator.com/newest</link>
<description>Hacker News RSS</description>
<item>
<title>Ask HN: Ex-FAANG developers, where are you now and why?</title>
<link>https://news.ycombinator.com/item?id=18192534</link>
<guid isPermaLink="true" >https://news.ycombinator.com/item?id=18192534</guid>
<description>&lt;tr class=&quot;athing comtr&quot; id=&quot;18193235&quot; readability=&quot;7.1214285714286&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.5607142857143&quot;&gt;&lt;tr readability=&quot;7.1214285714286&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;10.237053571429&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193990&quot; readability=&quot;13.739204064352&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;6.8696020321761&quot;&gt;&lt;tr readability=&quot;13.739204064352&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;13.248518204911&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194158&quot; readability=&quot;14.409984871407&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;7.2049924357035&quot;&gt;&lt;tr readability=&quot;14.409984871407&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;12.008320726172&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194217&quot; readability=&quot;7.1111111111111&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.5555555555556&quot;&gt;&lt;tr readability=&quot;7.1111111111111&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.3333333333333&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194378&quot; readability=&quot;9.6358543417367&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.8179271708683&quot;&gt;&lt;tr readability=&quot;9.6358543417367&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.7450980392157&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193415&quot; readability=&quot;6.3522388059701&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.1761194029851&quot;&gt;&lt;tr readability=&quot;6.3522388059701&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193640&quot; readability=&quot;1.5531914893617&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193871&quot; readability=&quot;14.562334217507&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;7.2811671087533&quot;&gt;&lt;tr readability=&quot;14.562334217507&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;12.135278514589&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194025&quot; readability=&quot;2.7727272727273&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194126&quot; readability=&quot;9.3240628778718&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.6620314389359&quot;&gt;&lt;tr readability=&quot;9.3240628778718&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;200&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;11.443168077388&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193823&quot; readability=&quot;19.5756718529&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;9.7878359264498&quot;&gt;&lt;tr readability=&quot;19.5756718529&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;16.149929278642&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193894&quot; readability=&quot;5.6148148148148&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8074074074074&quot;&gt;&lt;tr readability=&quot;5.6148148148148&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;160&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.1469135802469&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193999&quot; readability=&quot;5.5646687697161&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.782334384858&quot;&gt;&lt;tr readability=&quot;5.5646687697161&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;200&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194239&quot; readability=&quot;9.7321428571429&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.8660714285714&quot;&gt;&lt;tr readability=&quot;9.7321428571429&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;240&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;11.678571428571&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193932&quot; readability=&quot;6.5424836601307&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.2712418300654&quot;&gt;&lt;tr readability=&quot;6.5424836601307&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;200&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193798&quot; readability=&quot;5.4045801526718&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.7022900763359&quot;&gt;&lt;tr readability=&quot;5.4045801526718&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.9541984732824&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193499&quot; readability=&quot;1.3866666666667&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194292&quot; readability=&quot;12.515527950311&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;6.2577639751553&quot;&gt;&lt;tr readability=&quot;12.515527950311&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.776397515528&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193633&quot; readability=&quot;5.7364016736402&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8682008368201&quot;&gt;&lt;tr readability=&quot;5.7364016736402&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.3023012552301&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194045&quot; readability=&quot;10.646529562982&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.323264781491&quot;&gt;&lt;tr readability=&quot;10.646529562982&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.8071979434447&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193715&quot; readability=&quot;6.0725388601036&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193820&quot; readability=&quot;4.125&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.0625&quot;&gt;&lt;tr readability=&quot;4.125&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193805&quot; readability=&quot;2.4901960784314&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2450980392157&quot;&gt;&lt;tr readability=&quot;2.4901960784314&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193902&quot; readability=&quot;3.2666666666667&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.6333333333333&quot;&gt;&lt;tr readability=&quot;3.2666666666667&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194049&quot; readability=&quot;4.6997690531178&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.3498845265589&quot;&gt;&lt;tr readability=&quot;4.6997690531178&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.1096997690531&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194226&quot; readability=&quot;9.5938628158845&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.7969314079422&quot;&gt;&lt;tr readability=&quot;9.5938628158845&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;13.431407942238&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193443&quot; readability=&quot;1.4105263157895&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193488&quot; readability=&quot;7.4917127071823&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.7458563535912&quot;&gt;&lt;tr readability=&quot;7.4917127071823&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.1505524861878&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193780&quot; readability=&quot;1.0204081632653&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193888&quot; readability=&quot;2.319587628866&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193944&quot; readability=&quot;3.5036496350365&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7518248175182&quot;&gt;&lt;tr readability=&quot;3.5036496350365&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;200&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194598&quot; readability=&quot;5.7455357142857&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8727678571429&quot;&gt;&lt;tr readability=&quot;5.7455357142857&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;240&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.3091517857143&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193374&quot; readability=&quot;2.3769230769231&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193515&quot; readability=&quot;2.4152542372881&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2076271186441&quot;&gt;&lt;tr readability=&quot;2.4152542372881&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193616&quot; readability=&quot;23.663694267516&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;11.831847133758&quot;&gt;&lt;tr readability=&quot;23.663694267516&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;20.705732484076&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193312&quot; readability=&quot;20.708955223881&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;10.35447761194&quot;&gt;&lt;tr readability=&quot;20.708955223881&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;7.8891257995736&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193074&quot; readability=&quot;11.627081021088&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.8135405105438&quot;&gt;&lt;tr readability=&quot;11.627081021088&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;9.2047724750277&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194040&quot; readability=&quot;10.600315955766&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.3001579778831&quot;&gt;&lt;tr readability=&quot;10.600315955766&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193093&quot; readability=&quot;2.4705882352941&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2352941176471&quot;&gt;&lt;tr readability=&quot;2.4705882352941&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.2941176470588&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193148&quot; readability=&quot;8.4948979591837&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.2474489795918&quot;&gt;&lt;tr readability=&quot;8.4948979591837&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193771&quot; readability=&quot;9.5862068965517&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.7931034482759&quot;&gt;&lt;tr readability=&quot;9.5862068965517&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193224&quot; readability=&quot;2.214953271028&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193180&quot; readability=&quot;3.5333333333333&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7666666666667&quot;&gt;&lt;tr readability=&quot;3.5333333333333&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.4166666666667&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193631&quot; readability=&quot;4.5378151260504&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.2689075630252&quot;&gt;&lt;tr readability=&quot;4.5378151260504&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193206&quot; readability=&quot;4.2134831460674&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.1067415730337&quot;&gt;&lt;tr readability=&quot;4.2134831460674&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193629&quot; readability=&quot;3.5918367346939&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7959183673469&quot;&gt;&lt;tr readability=&quot;3.5918367346939&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193201&quot; readability=&quot;11.711159737418&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.855579868709&quot;&gt;&lt;tr readability=&quot;11.711159737418&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;14.150984682713&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193411&quot; readability=&quot;3.2248062015504&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.6124031007752&quot;&gt;&lt;tr readability=&quot;3.2248062015504&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193700&quot; readability=&quot;5.2903225806452&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.6451612903226&quot;&gt;&lt;tr readability=&quot;5.2903225806452&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193845&quot; readability=&quot;4.7442455242967&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.3721227621483&quot;&gt;&lt;tr readability=&quot;4.7442455242967&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;160&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.2186700767263&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193929&quot; readability=&quot;10.520792079208&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.260396039604&quot;&gt;&lt;tr readability=&quot;10.520792079208&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.6950495049505&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193670&quot; readability=&quot;17.26582278481&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;8.6329113924051&quot;&gt;&lt;tr readability=&quot;17.26582278481&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;16.306610407876&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194554&quot; readability=&quot;1.3958333333333&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193935&quot; readability=&quot;3.4810810810811&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7405405405405&quot;&gt;&lt;tr readability=&quot;3.4810810810811&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.4810810810811&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193923&quot; readability=&quot;5.1133004926108&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.5566502463054&quot;&gt;&lt;tr readability=&quot;5.1133004926108&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.4088669950739&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193013&quot; readability=&quot;5.6358267716535&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8179133858268&quot;&gt;&lt;tr readability=&quot;5.6358267716535&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.6358267716535&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193886&quot; readability=&quot;5.7234468937876&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8617234468938&quot;&gt;&lt;tr readability=&quot;5.7234468937876&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.7234468937876&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194134&quot; readability=&quot;2.4905660377358&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2452830188679&quot;&gt;&lt;tr readability=&quot;2.4905660377358&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194284&quot; readability=&quot;2.6065573770492&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.3032786885246&quot;&gt;&lt;tr readability=&quot;2.6065573770492&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193847&quot; readability=&quot;11.227505486467&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.6137527432334&quot;&gt;&lt;tr readability=&quot;11.227505486467&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;13.566569129481&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193869&quot; readability=&quot;5.7971014492754&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8985507246377&quot;&gt;&lt;tr readability=&quot;5.7971014492754&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.8309178743961&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194140&quot; readability=&quot;1.5157894736842&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193697&quot; readability=&quot;18.649491094148&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;9.3247455470738&quot;&gt;&lt;tr readability=&quot;18.649491094148&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;17.667938931298&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194505&quot; readability=&quot;4.7980613893376&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.3990306946688&quot;&gt;&lt;tr readability=&quot;4.7980613893376&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;7.6768982229402&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193358&quot; readability=&quot;5.19375&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.596875&quot;&gt;&lt;tr readability=&quot;5.19375&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.328125&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193732&quot; readability=&quot;3.0909090909091&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194074&quot; readability=&quot;1.8834080717489&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194027&quot; readability=&quot;1.8440366972477&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193455&quot; readability=&quot;3.4162162162162&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7081081081081&quot;&gt;&lt;tr readability=&quot;3.4162162162162&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193590&quot; readability=&quot;1.531914893617&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193635&quot; readability=&quot;3.258064516129&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.6290322580645&quot;&gt;&lt;tr readability=&quot;3.258064516129&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193790&quot; readability=&quot;1.0588235294118&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193204&quot; readability=&quot;3.5497835497835&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7748917748918&quot;&gt;&lt;tr readability=&quot;3.5497835497835&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.9935064935065&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193882&quot; readability=&quot;8.4659340659341&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.232967032967&quot;&gt;&lt;tr readability=&quot;8.4659340659341&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;7.9956043956044&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193895&quot; readability=&quot;5.7931034482759&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8965517241379&quot;&gt;&lt;tr readability=&quot;5.7931034482759&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.7586206896552&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193832&quot; readability=&quot;0.8&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18192981&quot; readability=&quot;6.5445205479452&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.2722602739726&quot;&gt;&lt;tr readability=&quot;6.5445205479452&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;5.1421232876712&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194146&quot; readability=&quot;3.1940298507463&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193032&quot; readability=&quot;2.4915254237288&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2457627118644&quot;&gt;&lt;tr readability=&quot;2.4915254237288&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193076&quot; readability=&quot;9.5467889908257&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.7733944954128&quot;&gt;&lt;tr readability=&quot;9.5467889908257&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;8.6788990825688&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193232&quot; readability=&quot;5.5991379310345&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.7995689655172&quot;&gt;&lt;tr readability=&quot;5.5991379310345&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.5323275862069&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194365&quot; readability=&quot;10.111420612813&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.0557103064067&quot;&gt;&lt;tr readability=&quot;10.111420612813&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;160&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.8941504178273&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194420&quot; readability=&quot;4.2796610169492&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.1398305084746&quot;&gt;&lt;tr readability=&quot;4.2796610169492&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;200&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.8516949152542&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193177&quot; readability=&quot;11.452380952381&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.7261904761905&quot;&gt;&lt;tr readability=&quot;11.452380952381&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;9.0664682539683&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193240&quot; readability=&quot;7.0307414104882&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.5153707052441&quot;&gt;&lt;tr readability=&quot;7.0307414104882&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.8336347197107&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194228&quot; readability=&quot;4.3571428571429&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.1785714285714&quot;&gt;&lt;tr readability=&quot;4.3571428571429&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;160&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193727&quot; readability=&quot;5.702479338843&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.8512396694215&quot;&gt;&lt;tr readability=&quot;5.702479338843&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.2768595041322&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193044&quot; readability=&quot;3.3613445378151&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.6806722689076&quot;&gt;&lt;tr readability=&quot;3.3613445378151&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193082&quot; readability=&quot;2.301724137931&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193105&quot; readability=&quot;3.4198473282443&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7099236641221&quot;&gt;&lt;tr readability=&quot;3.4198473282443&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;160&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193298&quot; readability=&quot;3.2452830188679&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.622641509434&quot;&gt;&lt;tr readability=&quot;3.2452830188679&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193402&quot; readability=&quot;6.5196078431373&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.2598039215686&quot;&gt;&lt;tr readability=&quot;6.5196078431373&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.7254901960784&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193444&quot; readability=&quot;2.4303797468354&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2151898734177&quot;&gt;&lt;tr readability=&quot;2.4303797468354&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193483&quot; readability=&quot;1.5348837209302&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193680&quot; readability=&quot;6.4597315436242&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.2298657718121&quot;&gt;&lt;tr readability=&quot;6.4597315436242&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.6912751677852&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193916&quot; readability=&quot;7.4958904109589&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.7479452054795&quot;&gt;&lt;tr readability=&quot;7.4958904109589&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;12.180821917808&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193452&quot; readability=&quot;4.5634920634921&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.281746031746&quot;&gt;&lt;tr readability=&quot;4.5634920634921&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.5634920634921&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194323&quot; readability=&quot;13.313725490196&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;6.656862745098&quot;&gt;&lt;tr readability=&quot;13.313725490196&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;10.936274509804&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193225&quot; readability=&quot;7.6213017751479&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.810650887574&quot;&gt;&lt;tr readability=&quot;7.6213017751479&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;7.6213017751479&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193721&quot; readability=&quot;2.558282208589&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2791411042945&quot;&gt;&lt;tr readability=&quot;2.558282208589&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194178&quot; readability=&quot;7.5805825242718&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;3.7902912621359&quot;&gt;&lt;tr readability=&quot;7.5805825242718&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;8.0543689320388&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193429&quot; readability=&quot;25.458474355637&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;12.729237177818&quot;&gt;&lt;tr readability=&quot;25.458474355637&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;37.208539442853&quot;&gt;

&lt;br/&gt;&lt;div class=&quot;comment&quot; readability=&quot;49.214454045562&quot;&gt;&lt;span class=&quot;commtext c00&quot;&gt;Another ex-Googler. I worked there as an SRE for six years, then left due to lack of career advancement opportunities[0]. Currently I work at Stripe, which is less capable on some narrow technical metrics but a far more pleasant environment.&lt;/span&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;Stripe is hiring. Email me at jmillikin@stripe.com and I'll forward to a recruiter and/or hiring manager relevant to your interests.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;---&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;Good differences:&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* It's about 70x smaller than Google (100x smaller when I joined a year ago). My CEO knows engineers by name, knows generally what we're working on, and occasionally DMs us congratulations on especially interesting blog posts (hello Patrick!). The effects of your work (good and bad) are obvious, and people know who's doing what. I'm not sure if there's a &quot;monkeysphere&quot; equivalent for engineers, but in Infra at least we've not yet reached the limit.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* More transparent. Private companies have fewer restrictions on what business metrics they're allowed to share with non-executive employees, and people here are enthusiastic about sharing both (1) what's going well and (2) what could be done better.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* A general feeling of optimism and cheer that is absent at Google. We don't end up in the news for easily avoided own-goals that employees protested for months before they hit the public.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* The business model (supporting business growth across the globe, and scraping a bit off the top) is directly coupled to the success of our customers. At Google there's always a thought in the back of your mind that the people using the product are in conflict with the people generating revenue. At Stripe we're in partnership with our customers, working against people who are not customers (i.e. fraudsters).&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* Much more support for remote work. I live in the Bay Area and am planning to go remote some time in the next six months. I don't think this would have been possible at Google, which is focused on offices and especially focused on &quot;main campus&quot; (Mountain View).&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;---&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;Bad differences:&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* We use third-party open-source code more than Google does, and the average quality of open-source code is &lt;em&gt;far&lt;/em&gt; lower than internal Google code[1]. I've reported critical crashing bugs upstream and gotten nothing but [tumbleweed noises]. At Google I once reported a bug in the getopt() equivalent, and it was personally fixed by Sanjay.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* Fewer engineers mean non-critical bugs in internal tools sometimes don't get fixed. We just don't have time. I've seen more JS stack traces on .corp pages in the last &lt;em&gt;three months&lt;/em&gt; then during my entire Google tenure.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;* Hiring engineers away from different companies (instead of entire cohorts fresh out of school) can lead to cultural conflict around dev velocity vs reliability. Obviously as an ex-Googler and an SRE I'm double-biased toward reliability, but folks with other backgrounds feel differently and there can be some difficult conversations there.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;---&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;Overall I'm very happy with the outcome of leaving Google. I attribute most of this to Stripe itself. It turns out I got lucky, and things could have gone much worse (company full of ex-startup engineers = campfire horror stories all day long).&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;---&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;[0] During my last perf cycle, my manager's manager told me &quot;senior engineers don't implement, they write design docs. Implementation is just code writing&quot;. Either he was wrong (and I was now stuck under someone who believed my chosen career was low-skill + not valuable), or correct (and I was in a &lt;em&gt;comapany&lt;/em&gt; that believed same). Either way, the situation was clearly undesirable.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;commtext c00&quot;&gt;[1] External Google code is also lower-quality than internal Google code, which shocked me. I've found memory errors in protobuf (&lt;a href=&quot;https://github.com/protocolbuffers/protobuf/issues/3752&quot; rel=&quot;nofollow&quot;&gt;https://github.com/protocolbuffers/protobuf/issues/3752&lt;/a&gt;), all sorts of wacky stuff in Bazel, and every day I wonder why go-protobuf doesn't have DynamicMessage yet.&lt;/span&gt;&lt;/p&gt;

&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194559&quot; readability=&quot;3.4761904761905&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7380952380952&quot;&gt;&lt;tr readability=&quot;3.4761904761905&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.9107142857143&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194062&quot; readability=&quot;9.3176470588235&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.6588235294118&quot;&gt;&lt;tr readability=&quot;9.3176470588235&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;7.4541176470588&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194020&quot; readability=&quot;5.597667638484&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.798833819242&quot;&gt;&lt;tr readability=&quot;5.597667638484&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;6.997084548105&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194127&quot; readability=&quot;2.1944444444444&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193209&quot; readability=&quot;4.0227272727273&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.0113636363636&quot;&gt;&lt;tr readability=&quot;4.0227272727273&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.0227272727273&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193764&quot; readability=&quot;3.6059113300493&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.8029556650246&quot;&gt;&lt;tr readability=&quot;3.6059113300493&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194403&quot; readability=&quot;2.4635761589404&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193993&quot; readability=&quot;2.16&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194388&quot; readability=&quot;1&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194257&quot; readability=&quot;3.0153846153846&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194185&quot; readability=&quot;4.1032608695652&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.0516304347826&quot;&gt;&lt;tr readability=&quot;4.1032608695652&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193682&quot; readability=&quot;2.9230769230769&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194240&quot; readability=&quot;10.47619047619&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;5.2380952380952&quot;&gt;&lt;tr readability=&quot;10.47619047619&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;40&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;4.7619047619048&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193751&quot; readability=&quot;5.1587677725118&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193414&quot; readability=&quot;2.411214953271&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2056074766355&quot;&gt;&lt;tr readability=&quot;2.411214953271&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;0&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193875&quot; readability=&quot;1.4473684210526&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18193899&quot; readability=&quot;2.5714285714286&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.2857142857143&quot;&gt;&lt;tr readability=&quot;2.5714285714286&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;80&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194258&quot; readability=&quot;4.6883116883117&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;2.3441558441558&quot;&gt;&lt;tr readability=&quot;4.6883116883117&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;120&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194174&quot; readability=&quot;1.3414634146341&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194476&quot; readability=&quot;8.6236933797909&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;4.3118466898955&quot;&gt;&lt;tr readability=&quot;8.6236933797909&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;160&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot; readability=&quot;3.8327526132404&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194404&quot; readability=&quot;0.064516129032258&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194462&quot; readability=&quot;3.5862068965517&quot;&gt;&lt;td&gt;
&lt;table border=&quot;0&quot; readability=&quot;1.7931034482759&quot;&gt;&lt;tr readability=&quot;3.5862068965517&quot;&gt;&lt;td class=&quot;ind&quot;&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;1&quot; width=&quot;200&quot;/&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;default&quot;&gt;

&lt;br/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;athing comtr&quot; id=&quot;18194487&quot; readability=&quot;3.0503597122302&quot;&gt;&lt;td&gt;
&lt;/td&gt;
&lt;/tr&gt;</description>
<pubDate>Thu, 11 Oct 2018 11:24:35 +0000</pubDate>
<dc:creator>macca321</dc:creator>
<dc:format>text/html</dc:format>
<dc:identifier>https://news.ycombinator.com/item?id=18192534</dc:identifier>
</item>
<item>
<title>Astronauts escape malfunctioning Soyuz rocket</title>
<link>https://www.bbc.com/news/world-europe-45822845</link>
<guid isPermaLink="true" >https://www.bbc.com/news/world-europe-45822845</guid>
<description>&lt;figure class=&quot;media-with-caption&quot; readability=&quot;-24&quot;&gt;&lt;div class=&quot;player-with-placeholder&quot; readability=&quot;7&quot;&gt;
            &lt;img class=&quot;media-placeholder player-with-placeholder__image lead-video-placeholder&quot; src=&quot;https://ichef.bbci.co.uk/images/ic/720x405/p06nk9f9.jpg&quot;/&gt;&lt;p&gt;Media playback is unsupported on your device&lt;/p&gt;
      
    &lt;/div&gt;    &lt;figcaption class=&quot;media-with-caption__caption&quot;&gt;&lt;span class=&quot;off-screen&quot;&gt;Media caption&lt;/span&gt;The malfunction became apparent about 90 seconds into the flight&lt;/figcaption&gt;&lt;/figure&gt;&lt;p class=&quot;story-body__introduction&quot;&gt;A US astronaut and a Russian cosmonaut were forced to make an emergency landing after their Russian Soyuz rocket malfunctioned en route to the International Space Station (ISS).&lt;/p&gt;&lt;p&gt;Shortly after taking off from Baikonur Cosmodrome in Kazakhstan, Nick Hague and Alexey Ovchinin reported a problem with the rocket's booster.&lt;/p&gt;&lt;p&gt;The men were forced into a &quot;ballistic descent&quot;, with their capsule landing a few hundred miles north of Baikonur.&lt;/p&gt;&lt;p&gt;They have been picked up by rescuers.&lt;/p&gt;&lt;p&gt;&quot;The search and recovery teams have reached the Soyuz spacecraft landing site and report that the two crew members... are in good condition and are out of the capsule,&quot; US space agency Nasa said.&lt;/p&gt;&lt;p&gt;Russia said it was suspending any further manned flights, and an investigation into what went wrong had begun.  &lt;/p&gt;&lt;h2 class=&quot;story-body__crosshead&quot;&gt;What happened to the rocket?&lt;/h2&gt;&lt;p&gt;The launch appeared to be going smoothly, but some 90 seconds later Nasa, on its livestream, reported that a problem seemed to have occurred with the booster rocket between the first and second stages of separation.&lt;/p&gt;&lt;p&gt;Footage from inside the capsule showed the two men being shaken around at the moment that the fault happened.&lt;/p&gt;&lt;figure class=&quot;media-portrait no-caption full-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;figure class=&quot;media-landscape no-caption full-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;p&gt;Shortly afterwards, Nasa said they were making a &quot;ballistic descent&quot; meaning their capsule descended at a much sharper angle than normal and would have been subjected to greater G-force - the force imposed on a body by rapid acceleration.&lt;/p&gt;&lt;p&gt;The capsule separated from the failing rocket and later deployed parachutes to slow its descent. &lt;/p&gt;&lt;figure class=&quot;media-landscape no-caption body-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;h2 class=&quot;story-body__crosshead&quot;&gt;Analysis: An uncomfortable ride back to Earth&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;By Jonathan Amos, BBC science correspondent&lt;/strong&gt;&lt;/p&gt;&lt;figure class=&quot;media-landscape no-caption full-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
                 &lt;span class=&quot;off-screen&quot;&gt;Image copyright&lt;/span&gt;
                 &lt;span class=&quot;story-image-copyright&quot;&gt;AFP&lt;/span&gt;
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;p&gt;Soyuz is one of the oldest rocket designs but also one of the safest. The malfunction appeared to occur around what is termed &quot;staging&quot;, where the ascending vehicle goes through the process of discarding its empty fuel segments. &lt;/p&gt;&lt;p&gt;The onboard astronauts were certainly aware that something was not right because they reported feeling weightless when they should have felt pushed back in their seats. The escape systems are tested and ready for exactly this sort of eventuality. It would have been an uncomfortable ride back to Earth, however. The crew would have experienced very sharp deceleration on the return.&lt;/p&gt;&lt;p&gt;There is already much discussion about the current state of Russian industry and its ability to maintain the standards of yesteryear. Whatever the outcome of the inquiry, this event will only heighten those concerns and will underline to the US in particular the need to bring online new rocket systems. These vehicles, produced by the Boeing and SpaceX companies, are set to make their debut next year.&lt;/p&gt;&lt;figure class=&quot;media-landscape no-caption body-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;h2 class=&quot;story-body__crosshead&quot;&gt;How are the crew?&lt;/h2&gt;&lt;figure class=&quot;media-landscape no-caption full-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
                 &lt;span class=&quot;off-screen&quot;&gt;Image copyright&lt;/span&gt;
                 &lt;span class=&quot;story-image-copyright&quot;&gt;AFP&lt;/span&gt;
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;p&gt;They seem to have been unharmed by the experience.&lt;/p&gt;&lt;p&gt;Search and rescue teams were quickly on the scene, 500km (310 miles) north-east of Baikonur, near the Kazakh city of Dzhezkazgan.&lt;/p&gt;&lt;p&gt;They reported that Mr Hague and Mr Ovchinin were alive and well and the Russian space agency, Roscosmos, later issued photos of them having their hearts and blood pressure monitored. &lt;/p&gt;&lt;figure class=&quot;media-landscape no-caption full-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;p&gt;&quot;The emergency rescue system worked, the vessel was able to land in Kazakhstan... the crew are alive,&quot; Roscosmos tweeted. Nasa described them as being in good condition. They reportedly did not need medical treatment.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://twitter.com/JimBridenstine/status/1050337299542753280&quot; class=&quot;story-body__link-external&quot;&gt;Nasa added that the two men were being taken to the Gagarin Cosmonaut Training Centre outside Moscow&lt;/a&gt;, and it was &quot;monitoring the situation carefully&quot;.&lt;/p&gt;&lt;h2 class=&quot;story-body__crosshead&quot;&gt;What happens now?&lt;/h2&gt;&lt;p&gt;Russia's Deputy Prime Minister Yuri Borisov said no further manned missions would take place &quot;until we believe that the entire situation guarantees safety&quot;.&lt;/p&gt;&lt;p&gt;He rejected suggestions it could harm US relations, saying they recognised it was a &quot;hi-tech industry linked to risk&quot;, but he added: &quot;We certainly won't conceal the reasons, it is uncommon for such situations&quot;.&lt;/p&gt;&lt;p&gt;Space co-operation is an area which has survived otherwise tense relations between Russia and the US. Nasa has been paying for seats on Soyuz rockets to ferry its astronauts to the International Space Station since the Space Shuttle programme ended in 2011. &lt;/p&gt;&lt;p&gt;The crew already on the ISS will not be affected by Thursday's aborted mission, Russia's Tass news agency reported, quoting an unnamed source as saying they have enough supplies.&lt;/p&gt;&lt;figure class=&quot;media-landscape no-caption body-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;h2 class=&quot;story-body__crosshead&quot;&gt;Have there been similar incidents in the past?&lt;/h2&gt;&lt;p&gt;Thursday's incident is thought to be the first launch mishap for a Russian Soyuz booster since a Soyuz mission was aborted in 1983. A rocket malfunctioned shortly after launch, and the crew vehicle was ejected to safety.&lt;/p&gt;&lt;p&gt;In recent years, Russia's space programme has faced a number of technical failures - 13 since 2010. &lt;/p&gt;&lt;p&gt;Last year, contact was lost with a Soyuz rocket's Fregat upper stage, which was carrying a new weather satellite and 18 secondary satellites. &lt;/p&gt;&lt;p&gt;Earlier in 2017, at least nine of a payload of 73 satellites were reported &quot;dead on arrival or severely degraded&quot; after separation from their Soyuz-2.1 launch vehicle.&lt;/p&gt;&lt;p&gt;In August, a hole appeared in a Soyuz capsule already docked to the ISS which caused a brief loss of air pressure and had to be patched. In this instance, &lt;a href=&quot;https://www.bbc.co.uk/news/science-environment-45423225&quot; class=&quot;story-body__link&quot;&gt;Russia said the hole may have been drilled &quot;deliberately&quot;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;One of the most serious but non-fatal US incidents involved Apollo 13 - a mission to the Moon in 1970. An oxygen tank exploded two days after launch causing a loss of power and leading to the mission being aborted. The crew were able to carry out repairs and return to Earth six days later. &lt;/p&gt;&lt;p&gt;While space missions may often encounter technical difficulties, fatalities have been relatively rare:&lt;/p&gt;&lt;ul class=&quot;story-body__unordered-list&quot;&gt;&lt;li class=&quot;story-body__list-item&quot;&gt;2003: Seven astronauts died when the &lt;strong&gt;Columbia &lt;/strong&gt;Space Shuttle broke up up on re-entry into the Earth's atmosphere due to a damaged heat shield&lt;/li&gt;
&lt;li class=&quot;story-body__list-item&quot;&gt;1986: Seven astronauts died when the &lt;strong&gt;Challenger &lt;/strong&gt;Space Shuttle broke apart after lift off because of faulty seals on the booster rockets&lt;/li&gt;
&lt;li class=&quot;story-body__list-item&quot;&gt;1971: The three-men crew aboard &lt;strong&gt;Soyuz 11&lt;/strong&gt; suffocated as the result of an air leak after undocking from the Salyut 1 space station. They were found dead inside the capsule after landing&lt;/li&gt;
&lt;li class=&quot;story-body__list-item&quot;&gt;1967: Crash of &lt;strong&gt;Soyuz 1&lt;/strong&gt;, with one cosmonaut killed as the spacecraft's parachute, intended to slow down descent, became tangled on re-entry&lt;/li&gt;
&lt;li class=&quot;story-body__list-item&quot;&gt;1967: Three-man crew of &lt;strong&gt;Apollo 1&lt;/strong&gt; died as their rocket caught fire on the launch pad&lt;/li&gt;
&lt;/ul&gt;&lt;figure class=&quot;media-landscape no-caption body-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;&lt;p&gt;You might also like to read:&lt;/p&gt;&lt;ul class=&quot;story-body__unordered-list&quot;&gt;&lt;li class=&quot;story-body__list-item&quot;&gt;&lt;a href=&quot;http://www.bbc.co.uk/news/resources/idt-c1dffc35-fe53-492d-a4bf-752a22bd1ebc&quot; class=&quot;story-body__link&quot;&gt;What's it like to live on the ISS?&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;story-body__list-item&quot;&gt;&lt;a href=&quot;https://www.bbc.co.uk/programmes/p0327fp0&quot; class=&quot;story-body__link&quot;&gt;Tim Peake special: How to be an astronaut&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;figure class=&quot;media-landscape no-caption body-width&quot;&gt;&lt;span class=&quot;image-and-copyright-container&quot;&gt;
                
                
                
                
                
            &lt;/span&gt;
            
        &lt;/figure&gt;</description>
<pubDate>Thu, 11 Oct 2018 09:12:57 +0000</pubDate>
<dc:creator>farseer</dc:creator>
<og:title>Astronauts escape malfunctioning rocket</og:title>
<og:type>article</og:type>
<og:description>US astronaut Nick Hague and Russian Cosmonaut Alexey Ovchinin landed safely, say space officials.</og:description>
<og:url>https://www.bbc.com/news/world-europe-45822845</og:url>
<og:image>https://ichef.bbci.co.uk/images/ic/1024x576/p06nk9f9.jpg</og:image>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.bbc.com/news/world-europe-45822845</dc:identifier>
</item>
<item>
<title>Self-healing material can build itself from carbon in the air</title>
<link>http://news.mit.edu/2018/self-healing-material-carbon-air-1011</link>
<guid isPermaLink="true" >http://news.mit.edu/2018/self-healing-material-carbon-air-1011</guid>
<description>&lt;div class=&quot;region region-content&quot;&gt;
&lt;div id=&quot;block-system-main&quot; class=&quot;block block-system&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;div class=&quot;field field-name-field-article-content field-type-text-long field-label-hidden&quot;&gt;
&lt;div class=&quot;field-items&quot;&gt;
&lt;div class=&quot;field-item even&quot;&gt;
&lt;p&gt;A material designed by MIT chemical engineers can react with carbon dioxide from the air, to grow, strengthen, and even repair itself. The polymer, which might someday be used as construction or repair material or for protective coatings, continuously converts the greenhouse gas into a carbon-based material that reinforces itself.&lt;/p&gt;
&lt;p&gt;The current version of the new material is a synthetic gel-like substance that performs a chemical process similar to the way plants incorporate carbon dioxide from the air into their growing tissues. The material might, for example, be made into panels of a lightweight matrix that could be shipped to a construction site, where they would harden and solidify just from exposure to air and sunlight, thereby saving on the energy and cost of transportation.&lt;/p&gt;
&lt;p&gt;The finding is described in a paper in the journal &lt;em&gt;Advanced Materials&lt;/em&gt;, by Professor Michael Strano, postdoc Seon-Yeong Kwak, and eight others at MIT and at the University of California at Riverside&lt;/p&gt;
&lt;p&gt;“This is a completely new concept in materials science,” says Strano, the Carbon C. Dubbs Professor of Chemical Engineering. “What we call carbon-fixing materials don’t exist yet today” outside of the biological realm, he says, describing materials that can transform carbon dioxide in the ambient air into a solid, stable form, using only the power of sunlight, just as plants do.&lt;/p&gt;
&lt;p&gt;Developing a synthetic material that not only avoids the use of fossil fuels for its creation, but actually consumes carbon dioxide from the air, has obvious benefits for the environment and climate, the researchers point out. “Imagine a synthetic material that could grow like trees, taking the carbon from the carbon dioxide and incorporating it into the material’s backbone,” Strano says.&lt;/p&gt;
&lt;p&gt;The material the team used in these initial proof-of-concept experiments did make use of one biological component — chloroplasts, the light-harnessing components within plant cells, which the researchers obtained from spinach leaves. The chloroplasts are not alive but catalyze the reaction of carbon dioxide to glucose. Isolated chloroplasts are quite unstable, meaning that they tend to stop functioning after a few hours when removed from the plant. In their paper, Strano and his co-workers demonstrate methods to significantly increase the catalytic lifetime of extracted chloroplasts. In ongoing and future work, the chloroplast is being replaced by catalysts that are nonbiological in origin, Strano explains.&lt;/p&gt;
&lt;p&gt;The material the researchers used, a gel matrix composed of a polymer made from aminopropyl methacrylamide (APMA) and glucose, an enzyme called glucose oxidase, and the chloroplasts, becomes stronger as it incorporates the carbon. It is not yet strong enough to be used as a building material, though it might function as a crack filling or coating material, the researchers say.&lt;/p&gt;
&lt;p&gt;The team has worked out methods to produce materials of this type by the ton, and is now focusing on optimizing the material’s properties. Commercial applications such as self-healing coatings and crack filling are realizable in the near term, they say, whereas additional advances in backbone chemistry and materials science are needed before construction materials and composites can be developed.&lt;/p&gt;
&lt;p&gt;One key advantage of such materials is they would be self-repairing upon exposure to sunlight or some indoor lighting, Strano says. If the surface is scratched or cracked, the affected area grows to fill in the gaps and repair the damage, without requiring any external action.&lt;/p&gt;
&lt;p&gt;While there has been widespread effort to develop self-healing materials that could mimic this ability of biological organisms, the researchers say, these have all required an active outside input to function. Heating, UV light, mechanical stress, or chemical treatment were needed to activate the process. By contrast, these materials need nothing but ambient light, and they incorporate mass from carbon in the atmosphere, which is ubiquitous.&lt;/p&gt;
&lt;p&gt;The material starts out as a liquid, Kwak says, adding, “it is exciting to watch it as it starts to grow and cluster” into a solid form.&lt;/p&gt;
&lt;p&gt;“Materials science has never produced anything like this,” Strano says. “These materials mimic some aspects of something living, even though it’s not reproducing.” Because the finding opens up a wide array of possible follow-up research, the U.S. Department of Energy is sponsoring a new program directed by Strano to develop it further.&lt;/p&gt;
&lt;p&gt;“Our work shows that carbon dioxide need not be purely a burden and a cost,” Strano says. “It is also an opportunity in this respect. There’s carbon everywhere. We build the world with carbon. Humans are made of carbon. Making a material that can access the abundant carbon all around us is a significant opportunity for materials science. In this way, our work is about making materials that are not just carbon neutral, but carbon negative.”&lt;/p&gt;
&lt;p&gt;The research team included Juan Pablo Giraldo at UC Riverside, and Tedrick Lew, Min Hao Wong, Pingwei Liu, Yun Jung Yang, Volodomyr Koman, Melissa McGee and Bradley Olsen at MIT. The work was supported by the U.S. Department of Energy.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr id=&quot;separator-comments&quot;/&gt;&lt;section&gt;&lt;div id=&quot;article-tags&quot;&gt;
&lt;p&gt;&lt;strong class=&quot;label&quot;&gt;Topics:&lt;/strong&gt; &lt;span class=&quot;tags&quot;&gt;&lt;a href=&quot;http://news.mit.edu/topic/research&quot;&gt;Research&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/school-engineering&quot;&gt;School of Engineering&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/chemical-engineering&quot;&gt;Chemical engineering&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/nanotech&quot;&gt;Nanoscience and nanotechnology&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/doe&quot;&gt;Department of Energy (DoE)&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/greenhouse-gases&quot;&gt;Greenhouse gases&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/carbon-dioxide&quot;&gt;Carbon dioxide&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/emissions&quot;&gt;Emissions&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/globalwarming&quot;&gt;Global Warming&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/climate-change&quot;&gt;Climate change&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/dmse&quot;&gt;DMSE&lt;/a&gt;&lt;span class=&quot;comma&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://news.mit.edu/topic/carbon&quot;&gt;Carbon&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/section&gt;&lt;section&gt;
&lt;/section&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
<pubDate>Thu, 11 Oct 2018 04:03:07 +0000</pubDate>
<dc:creator>extraterra</dc:creator>
<og:image>http://news.mit.edu/sites/mit.edu.newsoffice/files/styles/og/public/images/2018/MIT-Carbon-Absorbers.jpg</og:image>
<og:title>Self-healing material can build itself from carbon in the air</og:title>
<og:description>Taking a page from green plants, new polymer “grows” through a chemical reaction with carbon dioxide.</og:description>
<og:type>article</og:type>
<og:url>http://news.mit.edu/2018/self-healing-material-carbon-air-1011</og:url>
<dc:format>text/html</dc:format>
<dc:identifier>http://news.mit.edu/2018/self-healing-material-carbon-air-1011</dc:identifier>
</item>
<item>
<title>Walt: JavaScript-like syntax for WebAssembly</title>
<link>https://github.com/ballercat/walt</link>
<guid isPermaLink="true" >https://github.com/ballercat/walt</guid>
<description>&lt;div class=&quot;Box-body p-6&quot;&gt;
&lt;article class=&quot;markdown-body entry-content&quot; itemprop=&quot;text&quot;&gt;&lt;p align=&quot;center&quot;&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/ballercat/walt/blob/master/walt.png&quot;&gt;&lt;img src=&quot;https://github.com/ballercat/walt/raw/master/walt.png&quot; width=&quot;117&quot; height=&quot;74&quot;/&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Walt&lt;/strong&gt; | &lt;em&gt;Alternative Syntax for WebAssembly&lt;/em&gt; | &lt;a href=&quot;https://ballercat.github.io/walt/&quot; rel=&quot;nofollow&quot;&gt;Demo&lt;/a&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;a href=&quot;https://travis-ci.org/ballercat/walt&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/92330afd58ef71ab064fab479aa2eb446d733c08/68747470733a2f2f7472617669732d63692e6f72672f62616c6c65726361742f77616c742e7376673f6272616e63683d6d6173746572&quot; alt=&quot;Build Status&quot; data-canonical-src=&quot;https://travis-ci.org/ballercat/walt.svg?branch=master&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/ballercat/walt/issues&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/926d8ca67df15de5bd1abac234c0603d94f66c00/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f6e747269627574696f6e732d77656c636f6d652d627269676874677265656e2e7376673f7374796c653d666c6174&quot; alt=&quot;contributions welcome&quot; data-canonical-src=&quot;https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://coveralls.io/github/ballercat/walt?branch=master&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/2c431811ce9003caae407ed4b217ff0f7e073ec3/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f62616c6c65726361742f77616c742f62616467652e7376673f6272616e63683d6d6173746572&quot; alt=&quot;Coverage Status&quot; data-canonical-src=&quot;https://coveralls.io/repos/github/ballercat/walt/badge.svg?branch=master&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/prettier/prettier&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/687a8ae8d15f9409617d2cc5a30292a884f6813a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f64655f7374796c652d70726574746965722d6666363962342e7376673f7374796c653d666c61742d737175617265&quot; alt=&quot;code style: prettier&quot; data-canonical-src=&quot;https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://gitter.im/walt-js-wasm/Lobby&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/20d7543bc8280bf8134b686c46c7b7e2c0a467fd/68747470733a2f2f6261646765732e6769747465722e696d2f67697474657248512f6769747465722e706e67&quot; alt=&quot;Gitter chat&quot; data-canonical-src=&quot;https://badges.gitter.im/gitterHQ/gitter.png&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;⚡️ &lt;strong&gt;Walt&lt;/strong&gt; is an alternative syntax for WebAssembly text format. It's an experiment for using JavaScript syntax to write to as 'close to the metal' as possible. &lt;em&gt;It's JavaScript with rules.&lt;/em&gt; &lt;code&gt;.walt&lt;/code&gt; files compile directly to WebAssembly binary format.&lt;/p&gt;
&lt;p&gt;Highlights:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Write &lt;em&gt;&quot;close to the metal&quot;&lt;/em&gt; JavaScript!&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;No C/C++ or Rust required&lt;/strong&gt;, just &lt;em&gt;typed&lt;/em&gt; JavaScript.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NO LLVM/binary toolkits required&lt;/strong&gt;, zero dependencies 100% written in JS.&lt;/li&gt;
&lt;li&gt;Fast compilation, integrates into webpack!&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;📖 Read the &lt;a href=&quot;https://github.com/ballercat/walt/wiki/Walt-In-5-Minutes&quot;&gt;Quick Start Guide&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;🚀 Try it out in the &lt;a href=&quot;https://ballercat.github.io/walt/&quot; rel=&quot;nofollow&quot;&gt;Walt Explorer&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;🙏 Contributions are welcomed! &lt;a href=&quot;https://github.com/ballercat/walt/blob/master/CONTRIBUTING.md&quot;&gt;Contributing guide&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;🐥 Current status: &lt;strong&gt;Alpha&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;https://github.com/ballercat/walt/wiki/Roadmap&quot;&gt;Roadmap&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Writing zero-overhead, optimized WebAssembly is pretty tough to do. The syntax for &lt;code&gt;.wat&lt;/code&gt; files is terse and difficult to work with directly. If you do not wish to use a systems language like C or Rust, then you're kind of out of luck. Your best bet (currently) is to write very plain C code, compile that to .wast and then optimize that result. Then you're ready to compile that into the final WebAssembly binary. This is an attempt to take C/Rust out of the equation and write 'as close to the metal' as possible without losing readability.&lt;/p&gt;
&lt;p&gt;I feel like this is currently a problem. Most Web engineers are not familiar with the C family languages or Rust. It's a barrier for wide spread adoption of WebAssembly. A competent Front-end engineer should be able to edit WebAssembly as easily as any other systems programmer.&lt;/p&gt;

&lt;p&gt;Provide a &lt;strong&gt;thin layer&lt;/strong&gt; of syntax sugar on top of &lt;code&gt;.wat&lt;/code&gt; text format. Preferably porting as much of JavaScript syntax to WebAssembly as possible. This improved syntax should give direct control over the WebAssembly output. Meaning there should be minimal to none post optimization to be done to the wast code generated. The re-use of JavaScript semantics is intentional as I do not wish to create a brand new language.&lt;/p&gt;
&lt;p&gt;Here is what an example of a &lt;code&gt;.walt&lt;/code&gt; module which exports a recursive Fibonacci function looks like:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-js&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;fibonacci&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;i32&lt;/span&gt;): i32 {
  &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (n &lt;span class=&quot;pl-k&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;;

  &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (n &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;;

  &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;fibonacci&lt;/span&gt;(n &lt;span class=&quot;pl-k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;fibonacci&lt;/span&gt;(n &lt;span class=&quot;pl-k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;2&lt;/span&gt;);
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When this code is ran through the walt compiler you end up with a buffer which can be used to create a WebAssembly module with a &lt;code&gt;fibonacci&lt;/code&gt; export just as you would expect. All done with familiar JS syntax and without any external binary toolkits! A working demo of this exists in the &lt;code&gt;fibonacci-spec.js&lt;/code&gt; &lt;a href=&quot;https://github.com/ballercat/walt/blob/master/packages/walt-compiler/src/__tests__/fibonacci-spec.js&quot;&gt;unit test file&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The ultimate goal of Walt is to make WebAssembly accessible to average JavaScript engineer by providing a subset of JavaScript syntax which compiles to WebAssembly bytecode directly. That WebAssembly should be easy to make use of and simple to integrate into an existing project with the current build tools.&lt;/p&gt;
&lt;h2&gt;Use cases&lt;/h2&gt;
&lt;p&gt;Pretty much everyone who wants a quick-start into wasm can use Walt to get there. The use-cases are not specific to this project alone but more to WebAssembly in general. The fact that Walt does not require a stand-alone compiler and can integrate into any(almost?) build tool still makes certain projects better candidates over others.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Web/Node libraries, looking to improve performance.&lt;/li&gt;
&lt;li&gt;Games&lt;/li&gt;
&lt;li&gt;Projects depending on heavy real-time computation from complex UIs to 3D visualizations&lt;/li&gt;
&lt;li&gt;Web VR/AR&lt;/li&gt;
&lt;li&gt;Anyone interested in WebAssembly who is not familiar with system languages.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;See &lt;a href=&quot;https://github.com/ballercat/walt/wiki&quot;&gt;Wiki&lt;/a&gt; for detailed design decisions etc.&lt;/p&gt;
&lt;h2&gt;Prior Art&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/tmcw/wah&quot;&gt;wah&lt;/a&gt; - A slightly higher level syntax on top of the wasm text format&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/maierfelix/mini-c&quot;&gt;mini-c&lt;/a&gt; - Experimental C to WebAssembly compiler&lt;/li&gt;
&lt;/ul&gt;&lt;h2&gt;Contributors&lt;/h2&gt;
&lt;/article&gt;&lt;/div&gt;
</description>
<pubDate>Wed, 10 Oct 2018 22:30:38 +0000</pubDate>
<dc:creator>jedisct1</dc:creator>
<og:image>https://avatars0.githubusercontent.com/u/743990?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>ballercat/walt</og:title>
<og:url>https://github.com/ballercat/walt</og:url>
<og:description>:zap: Walt is a JavaScript-like syntax for WebAssembly text format :zap: - ballercat/walt</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/ballercat/walt</dc:identifier>
</item>
<item>
<title>Arguing against using protobuffers</title>
<link>http://reasonablypolymorphic.com/blog/protos-are-wrong/</link>
<guid isPermaLink="true" >http://reasonablypolymorphic.com/blog/protos-are-wrong/</guid>
<description>&lt;p&gt;I've spent a good deal of my professional life arguing against using protobuffers. They're clearly written by amateurs, unbelievably ad-hoc, mired in gotchas, tricky to compile, and solve a problem that nobody but Google really has. If these problems of protobuffers remained quarantined in serialization abstractions, my complaints would end there. But unfortunately, the bad design of protobuffers is so persuasive that these problems manage to leak their way into your code as well.&lt;/p&gt;
&lt;h2 id=&quot;ad-hoc-and-built-by-amateurs&quot;&gt;Ad-Hoc and Built By Amateurs&lt;/h2&gt;
&lt;p&gt;Stop. Put away your email client that is half-way through writing me about how &quot;Google is filled with the world's best engineers,&quot; and that &quot;anything they build is, by definition, not built by amateurs.&quot; I don't want to hear it.&lt;/p&gt;
&lt;p&gt;Let's just get this out of the way. Full disclosure: I used to work at Google. It was the first (but unfortunately, not the last) place I ever used protobuffers. All of the problems I want to talk about today exist inside of Google's codebase; it's not just a matter of &quot;using protobuffers wrong&quot; or some such nonsense like that.&lt;/p&gt;
&lt;p&gt;By far, the biggest problem with protobuffers is their terrible type-system. Fans of Java should feel right at home with protobuffers, but unfortunately, literally nobody considers Java to have a well-designed type-system. The dynamic typing guys complain about it being too stifling, while the static typing guys like me complain about it being too stifling without giving you any of the things you actually want in a type-system. Lose lose.&lt;/p&gt;
&lt;p&gt;The ad-hoc-ness and the built-by-amateurs-itude go hand-in-hand. So much of the protobuffer spec feels bolted on as an afterthought that it clearly &lt;em&gt;was&lt;/em&gt; bolted on as an afterthought. Many of its restrictions will make you stop, scratch your head and ask &quot;wat?&quot; But these are just symptoms of the deeper answer, which is this:&lt;/p&gt;
&lt;p&gt;Protobuffers were obviously built by amateurs because they offer &lt;em&gt;bad solutions to widely-known and already-solved problems.&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&quot;no-compositionality&quot;&gt;No Compositionality&lt;/h3&gt;
&lt;p&gt;Protobuffers offer several &quot;features&quot;, but none of them see to work with one another. For example, look at the list of orthogonal-yet-constrained typing features that I found by skimming the &lt;a href=&quot;https://developers.google.com/protocol-buffers/docs/proto3&quot;&gt;documentation&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;oneof&lt;/code&gt; fields can't be &lt;code&gt;repeated&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map&amp;lt;k,v&amp;gt;&lt;/code&gt; fields have dedicated syntax for their keys and values, but this isn't used for any other types.&lt;/li&gt;
&lt;li&gt;Despite &lt;code&gt;map&lt;/code&gt; fields being able to be parameterized, no user-defined types can be. This means you'll be stuck hand-rolling your own specializations of common data structures.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map&lt;/code&gt; fields cannot be &lt;code&gt;repeated&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map&lt;/code&gt; keys &lt;em&gt;can&lt;/em&gt; be &lt;code&gt;string&lt;/code&gt;s, but &lt;em&gt;can not&lt;/em&gt; be &lt;code&gt;bytes&lt;/code&gt;. They also can't be &lt;code&gt;enum&lt;/code&gt;s, even though &lt;code&gt;enum&lt;/code&gt;s are considered to be equivalent to integers everywhere else in the protobuffer spec.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map&lt;/code&gt; values cannot be other &lt;code&gt;map&lt;/code&gt;s.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;This insane list of restrictions is the result of unprincipled design choices and bolting on features after the fact. For example, &lt;code&gt;oneof&lt;/code&gt; fields can't be &lt;code&gt;repeated&lt;/code&gt; because rather than resulting in a coproduct type, instead the code generator will give you a product of mutually-exclusive optional fields. Such a transformation is only valid for a singular field (and, as we'll see later, not even then.)&lt;/p&gt;
&lt;p&gt;The restriction behind &lt;code&gt;map&lt;/code&gt; fields being unable to be &lt;code&gt;repeated&lt;/code&gt; is related, but shows off a different limitation of the type-system. Behind the scenes, a &lt;code&gt;map&amp;lt;k,v&amp;gt;&lt;/code&gt; is desugared into something spiritually similar to &lt;code&gt;repeated Pair&amp;lt;k,v&amp;gt;&lt;/code&gt;. And because &lt;code&gt;repeated&lt;/code&gt; is a magical language keyword rather than a type in its own right, it doesn't compose with itself.&lt;/p&gt;
&lt;p&gt;Your guess is as good as mine for why an &lt;code&gt;enum&lt;/code&gt; can't be used as a &lt;code&gt;map&lt;/code&gt; key.&lt;/p&gt;
&lt;p&gt;What's so frustrating about all of this is a little understanding of how modern type-systems work would be enough to &lt;em&gt;drastically simplify&lt;/em&gt; the protobuffer spec and simultaneously &lt;em&gt;remove all of the arbitrary restrictions.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The solution is as follows:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Make all fields in a message &lt;code&gt;required&lt;/code&gt;. This makes messages &lt;em&gt;product types&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Promote &lt;code&gt;oneof&lt;/code&gt; fields to instead be standalone data types. These are &lt;em&gt;coproduct types&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Give the ability to parameterize product and coproduct types by other types.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;That's it! These three features are all you need in order to define any possible piece of data. With these simpler pieces, we can re-implement the rest of the protobuffer spec in terms of them.&lt;/p&gt;
&lt;p&gt;For example, we can rebuild &lt;code&gt;optional&lt;/code&gt; fields:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode cpp&quot;&gt;
&lt;code class=&quot;sourceCode cpp&quot;&gt;product Unit {
  &lt;span class=&quot;co&quot;&gt;// no fields&lt;/span&gt;
}

coproduct Optional&amp;lt;t&amp;gt; {
  t    value = &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;;
  Unit unset = &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;;
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Building &lt;code&gt;repeated&lt;/code&gt; fields is simple too:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;8&quot;&gt;
&lt;pre class=&quot;sourceCode cpp&quot;&gt;
&lt;code class=&quot;sourceCode cpp&quot;&gt;coproduct List&amp;lt;t&amp;gt; {
  Unit empty = &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;;
  Pair&amp;lt;t, List&amp;lt;t&amp;gt;&amp;gt; cons = &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;;
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Of course, the actual serialization logic is allowed to do something smarter than pushing linked-lists across the network---after all, &lt;a href=&quot;http://reasonablypolymorphic.com/blog/follow-the-denotation/&quot;&gt;implementations and semantics don't need to align one-to-one&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;questionable-choices&quot;&gt;Questionable Choices&lt;/h3&gt;
&lt;p&gt;In the vein of Java, protobuffers make the distinction between &lt;em&gt;scalar&lt;/em&gt; types and &lt;em&gt;message&lt;/em&gt; types. Scalars correspond more-or-less to machine primitives---things like &lt;code&gt;int32&lt;/code&gt;, &lt;code&gt;bool&lt;/code&gt; and &lt;code&gt;string&lt;/code&gt;. Messages, on the other hand, are everything else. All library- and user-defined types are messages.&lt;/p&gt;
&lt;p&gt;The two varieties of types have completely different semantics, of course.&lt;/p&gt;
&lt;p&gt;Fields with scalar types are always present. Even if you don't set them. Did I mention that (at least in proto3) all protobuffers can be zero-initialized with absolutely no data in them? Scalar fields get false-y values---&lt;code&gt;uint32&lt;/code&gt; is initialized to &lt;code&gt;0&lt;/code&gt; for example, and &lt;code&gt;string&lt;/code&gt; is initialized as &lt;code&gt;&quot;&quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;It's impossible to differentiate a field that was missing in a protobuffer from one that was assigned to the default value. Presumably this decision is in place in order to allow for an optimization of not needing to send default scalar values over the wire. Presumably, though the &lt;a href=&quot;https://developers.google.com/protocol-buffers/docs/encoding&quot;&gt;encoding guide&lt;/a&gt; makes no mention of this optimization being performed, so your guess is as good as mine.&lt;/p&gt;
&lt;p&gt;As we'll see when we discuss protobuffers' claim to being god's gift to backwards- and forwards-compatible APIs, this inability to distinguish between unset and default values is a nightmare. Especially if indeed it's a design decision made in order to save one bit (set or not) per field.&lt;/p&gt;
&lt;p&gt;Contrast this behavior against message types. While scalar fields are dumb, the behavior for message fields is outright &lt;em&gt;insane.&lt;/em&gt; Internally, message fields are either there or they're not---but their behavior is crazy. Some pseudocode for their accessor is worth a thousand words. Pretend this is Java or something similar:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;9&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; Foo m_foo;

&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; Foo foo {
  &lt;span class=&quot;co&quot;&gt;// only if `foo` is used as an expression&lt;/span&gt;
  get {
    &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (m_foo != &lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt;)
      &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; m_foo;
    &lt;span class=&quot;kw&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;Foo&lt;/span&gt;();
  }

  &lt;span class=&quot;co&quot;&gt;// instead if `foo` is used as an lvalue&lt;/span&gt;
  mutable get {
    &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (m_foo = &lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt;)
      m_foo = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;Foo&lt;/span&gt;();
    &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; m_foo;
  }
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The idea is that if the &lt;code&gt;foo&lt;/code&gt; field is unset, you'll see a default-initialized copy whenever you ask for it, but won't actually modify its container. But if you modify &lt;code&gt;foo&lt;/code&gt;, it will modify its parent as well! All of this just to avoid using a &lt;code&gt;Maybe Foo&lt;/code&gt; type and the associated &quot;headaches&quot; of the nuance behind needing to figure out what an unset value should mean.&lt;/p&gt;
&lt;p&gt;This behavior is especially egregious, because it breaks a law! We'd expect the assignment &lt;code&gt;msg.foo = msg.foo;&lt;/code&gt; to be a no-op. Instead the implementation will actually silently change &lt;code&gt;msg&lt;/code&gt; to have a zero-initialized copy of &lt;code&gt;foo&lt;/code&gt; if it previously didn't have one.&lt;/p&gt;
&lt;p&gt;Unlike scalar fields, at least it's possible to detect if a message field is unset. Language bindings for protobuffers offer something along the lines of a generated &lt;code&gt;bool has_foo()&lt;/code&gt; method. In the frequent case of copying a message field from one proto to another, iff it was present, you'll need to write the following code:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode cpp&quot;&gt;
&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (src.has_foo(src)) {
  dst.set_foo(src.foo());
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice that, at least in statically-typed languages, this pattern &lt;em&gt;cannot be abstracted&lt;/em&gt; due to the nominal relationship between the methods &lt;code&gt;foo()&lt;/code&gt;, &lt;code&gt;set_foo()&lt;/code&gt; and &lt;code&gt;has_foo()&lt;/code&gt;. Because all of these functions are their own &lt;em&gt;identifiers&lt;/em&gt;, we have no means of programmatically generating them, save for a preprocessor macro:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode cpp&quot;&gt;
&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span class=&quot;pp&quot;&gt;#define COPY_IFF_SET(src, dst, field) &lt;/span&gt;\
&lt;span class=&quot;pp&quot;&gt;if (src.has_##field(src)) { &lt;/span&gt;\
&lt;span class=&quot;pp&quot;&gt;  dst.set_##field(src.field()); &lt;/span&gt;\
&lt;span class=&quot;pp&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(but preprocessor macros are verboten by the &lt;a href=&quot;https://google.github.io/styleguide/cppguide.html#Preprocessor_Macros&quot;&gt;Google style guide&lt;/a&gt;.)&lt;/p&gt;
&lt;p&gt;If instead all optional fields were implemented as &lt;code&gt;Maybe&lt;/code&gt;s, you'd get abstract-able, referentially transparent call-sites for free.&lt;/p&gt;
&lt;p&gt;To change tack, let's talk about another questionable decision. While you can define &lt;code&gt;oneof&lt;/code&gt; fields in protobuffers, their semantics are &lt;em&gt;not&lt;/em&gt; of coproduct types! Rookie mistake my dudes! What you get instead is an optional field for each case of the &lt;code&gt;oneof&lt;/code&gt;, and magic code in the setters that will just unset any other case if this one is set.&lt;/p&gt;
&lt;p&gt;At first glance, this seems like it should be semantically equivalent to having a proper union type. But instead it is an accursed, unutterable source of bugs! When this behavior teams up with the law-breaking implementation of &lt;code&gt;msg.foo = msg.foo;&lt;/code&gt;, it allows this benign-looking assignment to silently delete arbitrary amounts of data!&lt;/p&gt;
&lt;p&gt;What this means at the end of the day is that &lt;code&gt;oneof&lt;/code&gt; fields do not form law-abiding &lt;code&gt;Prism&lt;/code&gt;s, nor do messages form law-abiding &lt;code&gt;Lens&lt;/code&gt;es. Which is to say good luck trying to write bug-free, non-trivial manipulations of protobuffers. It is &lt;em&gt;literally impossible to write generic, bug-free, polymorphic code over protobuffers.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;That's not the sort of thing anybody likes to hear, let alone those of us who have grown to love parametric polymorphism---which gives us the &lt;em&gt;exact opposite promise.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;the-lie-of-backwards--and-forwards-compatibility&quot;&gt;The Lie of Backwards- and Forwards-Compatibility&lt;/h2&gt;
&lt;p&gt;One of the frequently cited killer features of protobuffers is their &quot;hassle-free ability to write backwards- and forwards-compatible APIs.&quot; This is the claim that has been pulled over your eyes to blind you from the truth.&lt;/p&gt;
&lt;p&gt;What protobuffers are is &lt;em&gt;permissive.&lt;/em&gt; They manage to not shit the bed when receiving messages from the past or from the future because they make absolutely no promises about what your data will look like. Everything is optional! But if you need it anyway, protobuffers will happily cook up and serve you something that typechecks, regardless of whether or not it's meaningful.&lt;/p&gt;
&lt;p&gt;This means that protobuffers achieve their promised time-traveling compatibility guarantees by &lt;em&gt;silently doing the wrong thing by default.&lt;/em&gt; Of course, the cautious programmer can (and should) write code that performs sanity checks on received protobuffers. But if at every use-site you need to write defensive checks ensuring your data is sane, maybe that just means your deserialization step was too permissive. All you've managed to do is decentralize sanity-checking logic from a well-defined boundary and push the responsibility of doing it throughout your entire codebase.&lt;/p&gt;
&lt;p&gt;One possible argument here is that protobuffers will hold onto any information present in a message that they don't understand. In principle this means that it's nondestructive to route a message through an intermediary that doesn't understand this version of its schema. Surely that's a win, isn't it?&lt;/p&gt;
&lt;p&gt;Granted, on paper it's a cool feature. But I've never once seen an application that will actually preserve that property. With the one exception of routing software, nothing wants to inspect only some bits of a message and then forward it on unchanged. The vast majority of programs that operate on protobuffers will decode one, transform it into another, and send it somewhere else. Alas, these transformations are bespoke and coded by hand. And hand-coded transformations from one protobuffer to another don't preserve unknown fields between the two, because it's literally meaningless.&lt;/p&gt;
&lt;p&gt;This pervasive attitude towards protobuffers always being compatible rears its head in other ugly ways. Style guides for protobuffers actively advocate against DRY and suggest inlining definitions whenever possible. The reasoning behind this is that it allows you to evolve messages separately if these definitions diverge in the future. To emphasize that point, the suggestion is to fly in the face of 60 years' worth of good programming practice just in case &lt;em&gt;maybe&lt;/em&gt; one day in the future you need to change something.&lt;/p&gt;
&lt;p&gt;At the root of the problem is that Google conflates the meaning of data with its physical representation. When you're at Google scale, this sort of thing probably makes sense. After all, they have an internal tool that allows you to compare the finances behind programmer hours vs network utilization vs the cost to store &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;x&lt;/em&gt;&lt;/span&gt; bytes vs all sorts of other things. Unlike most companies in the tech space, paying engineers is one of Google's smallest expenses. Financially it makes sense for them to waste programmers' time in order to shave off a few bytes.&lt;/p&gt;
&lt;p&gt;Outside of the top five tech companies, none of us is within five orders of magnitude of being Google scale. Your startup &lt;em&gt;cannot afford&lt;/em&gt; to waste engineer hours on shaving off bytes. But shaving off bytes and wasting programmers' time in the process is exactly what protobuffers are optimized for.&lt;/p&gt;
&lt;p&gt;Let's face it. You are not Google scale and you never will be. Stop cargo-culting technology just because &quot;Google uses it&quot; and therefore &quot;it's an industry best-practice.&quot;&lt;/p&gt;
&lt;h2 id=&quot;protobuffers-contaminate-codebases&quot;&gt;Protobuffers Contaminate Codebases&lt;/h2&gt;
&lt;p&gt;If it were possible to restrict protobuffer usage to network-boundaries I wouldn't be nearly as hard on it as a technology. Unfortunately, while there are a few solutions in principle, none of them is good enough to actually be used in real software.&lt;/p&gt;
&lt;p&gt;Protobuffers correspond to the data you want to send over the wire, which is often &lt;em&gt;related&lt;/em&gt; but not &lt;em&gt;identical&lt;/em&gt; to the actual data the application would like to work with. This puts us in the uncomfortable position of needing to choose between one of three bad alternatives:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;Maintain a separate type that describes the data you actually want, and ensure that the two evolve simultaneously.&lt;/li&gt;
&lt;li&gt;Pack rich data into the wire format for application use.&lt;/li&gt;
&lt;li&gt;Derive rich information every time you need it from a terse wire format.&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;Option 1 is clearly the &quot;right&quot; solution, but its untenable with protobuffers. The language isn't powerful enough to encode types that can perform double-duty as both wire and application formats. Which means you'd need to write a completely separate datatype, evolve it synchronously with the protobuffer, and &lt;em&gt;explicitly write serialization code between the two.&lt;/em&gt; Seeing as most people seem to use protobuffers in order to not write serialization code, this is obviously never going to happen.&lt;/p&gt;
&lt;p&gt;Instead, code that uses protobuffers allows them to proliferate throughout the codebase. True story, my main project at Google was a compiler that took &quot;programs&quot; written in one variety of protobuffer, and spit out an equivalent &quot;program&quot; in another. Both the input and output formats were expressive enough that maintaining proper parallel C++ versions of them could never possibly work. As a result, my code was unable to take advantage of any of the rich techniques we've discovered for writing compilers, because protobuffer data (and resulting code-gen) is simply too rigid to do anything interesting.&lt;/p&gt;
&lt;p&gt;The result is that a thing that could have been 50 lines of &lt;a href=&quot;https://github.com/passy/awesome-recursion-schemes&quot;&gt;recursion schemes&lt;/a&gt; was instead 10,000 lines of ad-hoc buffer-shuffling. The code I wanted to write was literally impossible when constrained by having protobuffers in the mix.&lt;/p&gt;
&lt;p&gt;While this is an anecdote, it's not in isolation. By virtue of their rigid code-generation, manifestations of protobuffers in languages are never idiomatic, nor can they be made to be---short of rewriting the code-generator.&lt;/p&gt;
&lt;p&gt;But even then, you still have the problem of needing to embed a shitty type-system into the targeted language. Because most of protobuffers' features are ill-conceived, these unsavory properties leak into our codebases. It means we're forced to not only implement, but also use these bad ideas in any project which hopes to interface with protobuffers.&lt;/p&gt;
&lt;p&gt;While it's easy to implement inane things out of a solid foundation, going the other direction is challenging at best and the dark path of Eldrich madness at worst.&lt;/p&gt;
&lt;p&gt;In short, abandon all hope ye who introduce protobuffers into your projects.&lt;/p&gt;

&lt;p class=&quot;meta&quot;&gt;&lt;span class=&quot;prev&quot;&gt;&lt;a href=&quot;http://reasonablypolymorphic.com/blog/book-of-types&quot;&gt;←&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 10 Oct 2018 20:24:51 +0000</pubDate>
<dc:creator>haskellandchill</dc:creator>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://reasonablypolymorphic.com/blog/protos-are-wrong/</dc:identifier>
</item>
<item>
<title>Uniqlo cut 90% of staff at one warehouse by replacing them with robots</title>
<link>https://qz.com/1419418/uniqlo-cut-90-of-staff-at-one-warehouse-by-replacing-them-with-robots/</link>
<guid isPermaLink="true" >https://qz.com/1419418/uniqlo-cut-90-of-staff-at-one-warehouse-by-replacing-them-with-robots/</guid>
<description>&lt;p class=&quot;_92842 quartz&quot;&gt;At a warehouse in Tokyo’s Ariake district once mainly staffed by people, robots are now doing the work of inspecting and sorting the clothing housed there by Japanese retailer Uniqlo.&lt;/p&gt;
&lt;p class=&quot;_92842 quartz&quot;&gt;The company recently remodeled the existing warehouse with an automated system created in partnership with Daifuku, a provider of material handling systems. Now that the system is running, the company revealed &lt;a href=&quot;https://uk.reuters.com/article/uk-fast-retailing-strategy/uniqlo-owner-fast-retailing-to-invest-885-million-in-warehouse-automation-idUKKCN1MJ095&quot;&gt;during a walkthrough&lt;/a&gt; of the new facility, Uniqlo has been able to cut staff at the warehouse by 90%. The warehouse can now also operate 24 hours a day.&lt;/p&gt;
&lt;p class=&quot;_92842 quartz&quot;&gt;The Japan News &lt;a href=&quot;http://the-japan-news.com/news/article/0004885809&quot;&gt;described how the automation works&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote class=&quot;_68f6d quartz&quot; readability=&quot;13&quot;&gt;
&lt;p&gt;The robotic system is designed to transfer products delivered to the warehouse by truck, read electronic tags attached to the products and confirm their stock numbers and other information.&lt;/p&gt;
&lt;p&gt;When shipping, the system wraps products placed on a conveyor belt in cardboard and attaches labels to them. Only a small portion of work at the warehouse needs to be done by employees, the company said.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p class=&quot;_92842 quartz&quot;&gt;The Tokyo warehouse is just a first step in a larger plan for Uniqlo’s parent company, Fast Retailing. It has &lt;a href=&quot;https://www.fastretailing.com/eng/ir/news/1810091300.html&quot;&gt;announced a strategic partnership&lt;/a&gt; with Daifuku with the goal of automating all Fast Retailing’s brand warehouses in Japan and overseas. Uniqlo plans to invest 100 billion yen (about $887 million) in the project over an unspecified timeframe. (The Japan News reported that it costs about 1 billion to 10 billion yen to automate an existing warehouse.)&lt;/p&gt;
&lt;p class=&quot;_92842 quartz&quot;&gt;Uniqlo believes the system will help it minimize storage costs and, importantly, deliver products faster around the world. The company has set a target of 3 trillion yen (about $26.6 billion) in annual revenue. Last year its revenue was about &lt;a href=&quot;https://www.fastretailing.com/eng/ir/library/pdf/ar2017_en.pdf&quot;&gt;1.86 trillion yen&lt;/a&gt; (pdf).&lt;/p&gt;
</description>
<pubDate>Wed, 10 Oct 2018 19:47:28 +0000</pubDate>
<dc:creator>prostoalex</dc:creator>
<og:description>Its the first step in a much larger plan to automate all Uniqlo's warehouses in Japan and overseas.</og:description>
<og:image>https://cms.qz.com/wp-content/uploads/2018/10/RTSXDVB-e1539189449881.jpg?quality=75&amp;strip=all&amp;w=1400</og:image>
<og:title>Uniqlo replaced 90% of staff at its newly automated warehouse with robots</og:title>
<og:type>article</og:type>
<og:url>https://qz.com/1419418/uniqlo-cut-90-of-staff-at-one-warehouse-by-replacing-them-with-robots/</og:url>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://qz.com/1419418/uniqlo-cut-90-of-staff-at-one-warehouse-by-replacing-them-with-robots/</dc:identifier>
</item>
<item>
<title>TSMC: First 7nm EUV Chips Taped Out, 5nm Risk Production in Q2 2019</title>
<link>https://www.anandtech.com/show/13445/tsmc-first-7nm-euv-chips-taped-out-5nm-risk-in-q2</link>
<guid isPermaLink="true" >https://www.anandtech.com/show/13445/tsmc-first-7nm-euv-chips-taped-out-5nm-risk-in-q2</guid>
<description>&lt;p&gt;Last week, TSMC made two important announcements concerning its progress with extreme ultraviolet lithography (EUVL). First up, the company has successfully taped out its first customer chip using its second-generation 7 nm process technology, which incorporates limited EUVL usage. Secondly, TSMC disclosed plans to start risk production of 5 nm devices in April.&lt;/p&gt;
&lt;h3&gt;First 7 nm EUV Chip Tapes Out at TSMC&lt;/h3&gt;
&lt;p&gt;TSMC initiated high-volume manufacturing of chips using its first generation 7 nm fabrication process (CLN7FF, N7) in April. N7 is based around deep ultraviolet (DUV) lithography with ArF excimer lasers. By contrast, TSMC’s second-generation 7 nm manufacturing technology (CLN7FF+, N7+) will use extreme ultraviolet lithography for four non-critical layers, mostly in a bid to speed up production and learn how to use ASML’s Twinscan NXE step-and-scan systems for HVM. Factual information on the improvements from N7 to N7+ are rather limited: the new tech will offer a 20% higher transistor density (because of tighter metal pitch) and ~8% lower power consumption at the same complexity and frequency (between 6% and 12% to be more precise).&lt;/p&gt;
&lt;p&gt;While the advantages of N7+ over its predecessors are not significant (e.g., TSMC has never mentioned performance increases that the new tech is expected to bring), it will still almost certainly be embraced wholeheartedly by developers of mobile SoCs who need to release new chips every year. That said, it is not surprising that TSMC has already taped out the first chip using its N7+ technology. Furthermore, the company is prepping a specialized version of the process aimed at the automotive industry, which indicates that N7+ is going to be a “long” node.&lt;/p&gt;
&lt;p&gt;TSMC is not disclosing the name of the customer whose N7+ SoC it has taped out, but considering the foundry’s alpha customers for new process technologies in the recent years, the leading suspects are obvious.&lt;/p&gt;
&lt;table align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;680&quot;&gt;&lt;tbody readability=&quot;2&quot;&gt;&lt;tr class=&quot;tgrey&quot; readability=&quot;4&quot;&gt;&lt;td align=&quot;center&quot; colspan=&quot;9&quot;&gt;Advertised PPA Improvements of New Process Technologies&lt;br/&gt;&lt;small&gt;Data announced by companies during conference calls, press briefings and in press releases&lt;/small&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;tlblue&quot;&gt;&lt;td rowspan=&quot;2&quot; width=&quot;186&quot;&gt; &lt;/td&gt;
&lt;td align=&quot;center&quot; colspan=&quot;6&quot; rowspan=&quot;1&quot; valign=&quot;middle&quot; width=&quot;137&quot;&gt;TSMC&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;tlblue&quot;&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;136&quot;&gt;16FF+&lt;br/&gt;vs&lt;br/&gt;20SOC&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;136&quot;&gt;10FF&lt;br/&gt;vs&lt;br/&gt;16FF+&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;136&quot;&gt;7FF&lt;br/&gt;vs&lt;br/&gt;16FF+&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;136&quot;&gt;7FF&lt;br/&gt;vs&lt;br/&gt;10FF&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;136&quot;&gt;7FF+&lt;br/&gt;vs&lt;br/&gt;7FF&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;136&quot;&gt;5FF&lt;br/&gt;vs&lt;br/&gt;7FF&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td class=&quot;tlgrey&quot;&gt;Power&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;60%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;40%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;60%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;&amp;lt;40%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;10%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;20%&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td class=&quot;tlgrey&quot;&gt;Performance&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;40%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;20%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;30%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;?&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;same (?)&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;15%&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td class=&quot;tlgrey&quot;&gt;Area Reduction&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;none&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;&amp;gt;50%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;70%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;&amp;gt;37%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;~17%&lt;/td&gt;
&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;45%&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;h3&gt;5 nm on Track&lt;/h3&gt;
&lt;p&gt;After N7+ comes TSMC’s first-generation 5 nm (CLN5FF, N5) process, which will use EUV on up to 14 layers. This will enable tangible improvements in terms of density, but will require TSMC to extensively use EUV equipment. When compared to TSMC’s N7, N5 technology will enable TSMC's customers to shrink area of their designs by ~45% (i.e. transistor density of N5 is ~1.8x higher than that of N7), increase frequency by 15% (at the same complexity and power) or reduce power consumption by 20% power reduction (at the same frequency and complexity).&lt;/p&gt;
&lt;p&gt;TSMC will be ready to start risk production of chips using its N5 tech in April, 2019. Keeping in mind that it typically takes foundries and their customers about a year to get from risk production to HVM, it seems like TSMC is on-track for mass production of 5 nm chips in Q2 2020, right in time to address smartphones due in the second half of 2020.&lt;/p&gt;
&lt;p&gt;EDA tools for the N5 node will be ready in November, so chip designs may be well underway now. But while many foundation IP blocks for N5 are ready today, there are important missing pieces, such as PCIe Gen 4 and USB 3.1 PHYs, which may not be ready until June. For some of TSMC's clients the lack of these pieces is not a problem, but many will have to wait.&lt;/p&gt;
&lt;p&gt;One of the factors that prevents smaller companies from designing FinFET chips is development cost. Some estimates put the average cost to develop an SoC at around $150 million in labor and IP licenses. With N5 generation, these expenditures will rise to $200 – $250 million, according to EETAsia, which will limit the number of parties interested in using the tech.&lt;/p&gt;
&lt;p&gt;Related Reading:&lt;/p&gt;
&lt;p&gt;Source: &lt;a href=&quot;https://www.eetasia.com/news/article/18100502-tsmc-to-start-5nm-production-in-april&quot;&gt;EETAsia&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 10 Oct 2018 18:59:15 +0000</pubDate>
<dc:creator>dmmalam</dc:creator>
<og:title>TSMC: First 7nm EUV Chips Taped Out, 5nm Risk Production in Q2 2019</og:title>
<og:type>article</og:type>
<og:url>https://www.anandtech.com/show/13445/tsmc-first-7nm-euv-chips-taped-out-5nm-risk-in-q2</og:url>
<og:image>https://images.anandtech.com/doci/13445/tsmc_semiconductor_chip_inspection_678x452.jpg</og:image>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.anandtech.com/show/13445/tsmc-first-7nm-euv-chips-taped-out-5nm-risk-in-q2</dc:identifier>
</item>
<item>
<title>Building a language translator from scratch with deep learning</title>
<link>https://blog.floydhub.com/language-translator/</link>
<guid isPermaLink="true" >https://blog.floydhub.com/language-translator/</guid>
<description>&lt;p&gt;Neural networks have won me over.&lt;/p&gt;
&lt;p&gt;Why, you ask? It's really quite simple – they’ve allowed me, a fledgling student of artificial intelligence, to develop a language translator from scratch.&lt;/p&gt;
&lt;p&gt;And it works.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;It really works!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now, let’s take a moment to consider this achievement.&lt;/p&gt;
&lt;p&gt;Languages are extremely complicated. Having learnt a few in my time, I know years of study is the &lt;em&gt;bare minimum&lt;/em&gt; for developing fluency.&lt;/p&gt;
&lt;p&gt;This complexity is why, for decades, machine translation required teams of domain-specific experts. You can easily imagine the squads of linguistic geniuses, huddled together for warmth, devising intricate sets of rules to transform syntax, grammar, and vocabulary between languages.&lt;/p&gt;
&lt;p&gt;But no longer.&lt;/p&gt;
&lt;p&gt;Today, neural networks autonomously learn these rules.&lt;/p&gt;
&lt;p&gt;And this means that a wee &lt;em&gt;cafe-au-lait&lt;/em&gt; drinking computer science student in France, albeit one covered in croissant crumbs, can build an English-French translator from scratch.&lt;/p&gt;
&lt;p&gt;And it doesn’t learn in years (like it would take this mere mortal), but days! And yes, again, it works (well, mostly – more on that later). Look, don’t take my word for it — let's instead look at my translator in action:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image1.png&quot; class=&quot;kg-image&quot;/&gt;A fantastic result on a previously unseen sentence from my validation set. The five differences between my translator's output and the true translation are valid synonyms and not errors.
&lt;p&gt;This was achieved using a database of 2 million sentences, trained over three days on a single 8GB GPU. For anyone familiar with Neural Machine Translation (NMT), this training time might seem short.&lt;/p&gt;
&lt;p&gt;That’s because it is.&lt;/p&gt;
&lt;p&gt;So, let’s next look a bit more deeply at some of our results. Then, together we’ll explore how NMT has worked until recently. Finally, and most interestingly, we'll dive into the recent model I used that just discards all the previous rules.&lt;/p&gt;
&lt;h3 id=&quot;how-good-can-a-3-day-translator-really-be-show-me-the-results&quot;&gt;How good can a 3-day translator really be? Show me the results&lt;/h3&gt;
&lt;p&gt;Let’s start with the slightly crude, but still necessary, numerical evaluation of how my translator fared.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;On my test set of 3,000 sentences, the translator obtained a &lt;a href=&quot;https://en.wikipedia.org/wiki/BLEU&quot; rel=&quot;noopener nofollow&quot;&gt;BLEU score&lt;/a&gt; of 0.39.&lt;/strong&gt; This score is the benchmark scoring system used in machine translation, and the current best I could find in English to French is around 0.42 (set by some smart folks as Google Brain). So, not bad.&lt;/p&gt;
&lt;p&gt;But these are just numbers. Let’s see some actual output.&lt;/p&gt;
&lt;p&gt;My first test, of course, is the most important translation for me. Its accuracy will define how successful my social life may be here in France for the next new years.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image2.png&quot; class=&quot;kg-image&quot;/&gt;Perfect! Now I just need to find some friends to ask this to...
&lt;p&gt;Excellent. Let’s ramp up the difficulty and see how it deals with a couple more clauses thrown in:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image3.png&quot; class=&quot;kg-image&quot;/&gt;Okay, despite sounding a bit more desperate, this translation is on-point.
&lt;p&gt;In this case, my translation is actually better than Google’s, which is surprising (they are definitely better overall). Google has changed ‘if so’ to just ‘if’, meaning their response does not quite make sense.&lt;/p&gt;
&lt;p&gt;On the other hand, my model has translated ‘if so’ to ‘if this is the case&lt;em&gt;’&lt;/em&gt; (&lt;em&gt;si tel est le cas&lt;/em&gt;). &lt;em&gt;This is very exciting&lt;/em&gt;. It means the network is not translating literally word for word, but understanding the meaning of terms in context and translating appropriately.&lt;/p&gt;
&lt;p&gt;Perhaps more remarkable still is my translator’s grammatical improvisations. The astute linguists among you may have noticed some shortcomings in the English input – namely its lack of commas and question mark.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image4.png&quot; class=&quot;kg-image&quot;/&gt;&lt;p&gt;In my output, we've seen the addition of commas to separate the clauses. Additionally the network has understood this to be a question and added a question mark. That's just awesome.&lt;/p&gt;
&lt;p&gt;Finally, my translator has understood the word &lt;em&gt;one&lt;/em&gt; in ‘buy you one’ to contextually mean ‘one beer/one of those’ and translated it as such to make sense in French (&lt;em&gt;vous en achetere une).&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Clearly, the model has developed a real feel for the form of French language.&lt;/p&gt;
&lt;p&gt;Now let's try a more complicated sentence that I've taken from an article that I read today:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image5.png&quot; class=&quot;kg-image&quot;/&gt;Uncanny! Google and my translator are almost identical. It's as if we trained on the same data with the same model or something.
&lt;p&gt;Another perfect result. In fact, I would say that mine beats Google again – they translated “way of war” to just “war.&quot;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;It’s all too good to be true,&lt;/em&gt; you must be thinking.&lt;/p&gt;
&lt;p&gt;Don't worry. I will now pick another example from the same article which breaks the magic:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image6.png&quot; class=&quot;kg-image&quot;/&gt;My translator has seriously buckled here, whereas Google gets it 100% correct. Notice 'Afghanistan' is repeated in the first sentence as my translator gets confused.
&lt;p&gt;&lt;strong&gt;Proper nouns&lt;/strong&gt; &lt;strong&gt;and unknown words are the downfall of my implementation of this model&lt;/strong&gt;. The network only learns meanings of words presented during training. This means unknown words (such as proper nouns) can lead to it crumble a little.&lt;/p&gt;
&lt;p&gt;Understanding this weakness, I then combined my British-English linguistic capabilities with a niche knowledge of small English town-names to confound the network entirely:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image7.png&quot; class=&quot;kg-image&quot;/&gt;Okay, my translator has really lost its marbles. Google was better, though it still called the ruffians 'kidnappers' and forgot to describe them as 'ravishing,' which, of course, is rather important.
&lt;p&gt;My translator has fallen to pieces, barely understanding a word of the input, and only correctly translating ‘Tom’ and that he was apparently ravaged.&lt;/p&gt;
&lt;p&gt;I realize that sharing this failure may now make it seem that my translator is not quite as good as I boasted. However, these errors only occur in these proper-noun (or obscure word) contexts, and the solution to these problems would not have been complex to deal with if I were to start again. (I explain how to fix this problem in the appendix of this post, so skip straight there if you’re interested).&lt;/p&gt;
&lt;p&gt;But, hey, why focus on the downsides? Overall, the results are quite incredible, and I'm quite pleased – so let’s have a look at how it works.&lt;/p&gt;
&lt;p&gt;You can also check out the code for my translator on &lt;a href=&quot;https://github.com/SamLynnEvans/Transformer&quot;&gt;GitHub&lt;/a&gt;, where you'll find a button to open up my code in a FloydHub Workspace, which is basically an interactive dev environment built for deep learning. It's easy to attach datasets to your workspace and also kick off model training jobs on FloydHub. I've included a Jupyter notebook in my repo called &lt;code&gt;start_here.ipynb&lt;/code&gt; that explains how to use my code and also start a training job to reproduce my results.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Click here if you'd like to train your own transformer while reading this post:&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://floydhub.com/run?template=https://github.com/SamLynnEvans/Transformer&quot;&gt;&lt;img src=&quot;https://static.floydhub.com/button/button.svg&quot; alt=&quot;Run on FloydHub&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;solving-machine-translation-by-using-seq2seq&quot;&gt;Solving machine translation by using seq2seq&lt;/h3&gt;
&lt;p&gt;Seq2seq is one of the easier terms to remember in deep learning, standing simply for &lt;em&gt;sequence to sequence.&lt;/em&gt; The initial concept was devilishly simple; one network encodes a sequence, and then another decodes it:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image8.png&quot; class=&quot;kg-image&quot;/&gt;In the case of our translator, the input will be English and the output French.
&lt;p&gt;What I initially found most fascinating about this model was the &lt;em&gt;state&lt;/em&gt; (see figure above). This is the vector (usually only about 200–500 numbers long) produced by the encoder that tries to capture all of the input sentence’s meaning.&lt;/p&gt;
&lt;p&gt;The state is then fed to the decoder, which attempts to translate this meaning into the output language.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The remarkable thing, therefore, about the state is that it seemed almost like a whole new language itself&lt;/em&gt;. We are not directly turning English into French any longer, but English into a sort of machine language of its own creation, before then translating (or decoding) that again into French.&lt;/p&gt;
&lt;p&gt;It is fascinating to think that so much meaning can be captured in a single array of numbers.&lt;/p&gt;
&lt;h3 id=&quot;seq2seq-architecture-encoders-and-decoders-built-using-rnns&quot;&gt;Seq2seq architecture: Encoders and Decoders built using RNNs&lt;/h3&gt;
&lt;p&gt;Recurrent Neural Networks (RNNs) have predominantly been used to build Encoders/Decoders as they can process variable length inputs (such as text).&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image9.png&quot; class=&quot;kg-image&quot;/&gt;How an RNN works. This could be the encoder; the input sentence is fed into it a word at a time. Each word is processed by a linear operation and the state is updated.
&lt;p&gt;The above diagram reflects a Vanilla RNN, where the state is updated as each word is introduced into the loop. Not only does this mean an RNN can process variable length sentences, but it also means the words are processed in the correct order.&lt;/p&gt;
&lt;p&gt;This is important because the positions of words are crucial in sentences. If all the words were simply fed into a network at once, then how might the network determine the context of each word?&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image10.png&quot; class=&quot;kg-image&quot;/&gt;&quot;Important sentence structure is.&quot; - Yoda
&lt;p&gt;A problem with basic RNNs though is they can have problems with recalling early details from a sentence. Elaborate RNN architectures such as LSTMs and GRUs went a great way toward solving these problems and you can read about how they work &lt;a href=&quot;http://colah.github.io/posts/2015-08-Understanding-LSTMs/&quot; rel=&quot;noopener nofollow&quot;&gt;here&lt;/a&gt;. However, before you invest in studying them, I’d urge you to read on.&lt;/p&gt;
&lt;h3 id=&quot;attention-attention-missing-a-trick-with-the-rnn-&quot;&gt;Attention Attention! Missing a trick with the RNN…&lt;/h3&gt;
&lt;p&gt;The encoder produces a state and the decoder uses that to make predictions. However, if we look again at how TensorFlow or Pytorch RNN architectures work, we’ll see we are missing a trick here:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image11.png&quot; class=&quot;kg-image&quot;/&gt;Typical encoder RNN: As well as producing a final state, the encoder produces output vectors that we are not making any use of!
&lt;p&gt;Not only does each word from the input contribute to the state, but each word also produces an output. It wasn’t long before researchers realized that all this extra information could also be passed from the encoder to the decoder, and help boost translation outcomes.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image12.png&quot; class=&quot;kg-image&quot;/&gt;Decoder RNN with Attention. The decoder is now also using all the outputs from the encoder each time it makes a prediction!
&lt;p&gt;These were called &lt;strong&gt;attention-based models&lt;/strong&gt;, as the decoder still used the state, but also ‘attended’ to all the encoder outputs when making predictions.&lt;/p&gt;
&lt;p&gt;Attention models were put forward in papers by &lt;a href=&quot;https://arxiv.org/abs/1409.0473&quot; rel=&quot;noopener nofollow&quot;&gt;Badanhau&lt;/a&gt; and &lt;a href=&quot;https://arxiv.org/abs/1508.04025&quot; rel=&quot;noopener nofollow&quot;&gt;Luong&lt;strong&gt;&lt;strong&gt;.&lt;/strong&gt;&lt;/strong&gt;&lt;/a&gt; As each new word entered these decoders, all the outputs from the decoder and encoder would be fed to an attention function to improve predictions.&lt;/p&gt;
&lt;h3 id=&quot;problems-i-ran-into-with-this-rnn-model&quot;&gt;Problems I ran into with this RNN model&lt;/h3&gt;
&lt;p&gt;After painstakingly studying papers on LSTMs and attention-based GRUs, and implementing my own model, I noticed something that I’d been warned of before:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RNNs are really slow&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;This is due to the use of iterative loops to process the data. While the RNN model worked well with my experiments on small datasets, trying to train large ones would’ve required &lt;strong&gt;&lt;strong&gt;a month&lt;/strong&gt;&lt;/strong&gt; on a GPU (and I don’t have that kind of time… or money).&lt;/p&gt;
&lt;p&gt;Diving deeper into the research, I discovered an entirely novel seq2seq model that discarded all the rules I’d learnt so far, and this is the one we will explore further.&lt;/p&gt;
&lt;h3 id=&quot;-attention-is-all-you-need-the-transformer-model-by-vaswani-et-al&quot;&gt;‘Attention is all you need!’ The Transformer model by Vaswani et al&lt;/h3&gt;
&lt;p&gt;The authors of &lt;a href=&quot;https://arxiv.org/abs/1706.03762&quot; rel=&quot;noopener nofollow&quot;&gt;this paper&lt;/a&gt; brilliantly hypothesized that perhaps the whole ‘state’ thing was unnecessary, that indeed all along &lt;strong&gt;&lt;strong&gt;the attention&lt;/strong&gt;&lt;/strong&gt; could be the most important factor.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image13.png&quot; class=&quot;kg-image&quot;/&gt;&lt;p&gt;Not only could using only attention (i.e. using just the outputs from each input word) yield state of the art results, but also not needing a state meant we didn’t necessarily need an RNN.&lt;/p&gt;
&lt;p&gt;The RNN had been useful in three ways; it produced a state, it could take multiple-length inputs, and it processed the order of the sentence.&lt;/p&gt;
&lt;p&gt;Not relying any further on the state, Vaswani et al proposed a novel way of inputting the data using multi-dimensional tensors and positional encodings. This meant no more for-loops. Instead, it takes advantage of highly-optimized linear algebra libraries.&lt;/p&gt;
&lt;p&gt;The time saved here could then be spent on deploying more linear layers into the network, leading not only to quicker convergence speeds, but better results. What’s not to love?&lt;/p&gt;
&lt;h3 id=&quot;but-first-obtaining-the-grand-daddy-of-all-translation-data&quot;&gt;But first: obtaining the grand-daddy of all translation data&lt;/h3&gt;
&lt;p&gt;Before we delve into the model, let’s first discuss the dataset I used.&lt;/p&gt;
&lt;p&gt;While there are many small parallel sets of data between French and English, I wanted to create the most robust translator possible and went for the big kahuna: the European Parliament Proceedings Parallel Corpus 1996–2011 (available to download &lt;a href=&quot;http://www.statmt.org/europarl/&quot; rel=&quot;noopener nofollow&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image14.jpeg&quot; class=&quot;kg-image&quot;/&gt;15 years of EU proceedings make an enthralling read for our seq2seq model!
&lt;p&gt;This beast contains 15 years of write-ups from E.U. proceedings, weighing in at 2,007,724 sentences, and 50,265,039 words. You know what they say – it is not the person with the the best algorithm that wins, but the person with the most data. Let's see how that pans out.&lt;/p&gt;
&lt;h3 id=&quot;how-does-neural-machine-translation-deal-with-text&quot;&gt;How does Neural Machine Translation deal with text?&lt;/h3&gt;
&lt;p&gt;Now, having reviewed our data, let's discuss how to process words in NMT.&lt;/p&gt;
&lt;p&gt;Our English and French sentences must be split into separate words (or tokens) and then assigned unique numbers (indexes). This number will come into play later when we discuss embeddings.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image15.png&quot; class=&quot;kg-image&quot;/&gt;Sentences turned into tokens, which are then given individual tokens (i.e. 'play' is now 51)
&lt;p&gt;Tokenisation, indexing, and batching can be handled very efficiently using TorchText and Spacy libraries. See my guide on processing NLP data using these tools &lt;a href=&quot;https://towardsdatascience.com/how-to-use-torchtext-for-neural-machine-translation-plus-hack-to-make-it-5x-faster-77f3884d95&quot; rel=&quot;nofollow noopener&quot;&gt;here.&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;fh-banner&quot;&gt;
&lt;h3 id=&quot;fh-banner-main-text&quot;&gt;Ready to build, train, and deploy AI?&lt;/h3&gt;
&lt;h4 id=&quot;fh-banner-sub-text&quot;&gt;Get started with FloydHub's collaborative AI platform for free&lt;/h4&gt;

&lt;h6 id=&quot;fh-banner-button-link-text&quot;&gt;&lt;a href=&quot;https://www.floydhub.com/?utm_source=blog&amp;amp;utm_medium=banner&amp;amp;utm_campaign=try_floydhub_for_free&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; id=&quot;fh-banner-button-link&quot;&gt;Try FloydHub for free&lt;/a&gt;&lt;/h6&gt;
&lt;/div&gt;
&lt;h3 id=&quot;the-mighty-transformer&quot;&gt;The Mighty Transformer&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;*For a complete guide on how to code the Transformer, see &lt;a href=&quot;https://blog.floydhub.com/the-transformer-in-pytorch/&quot;&gt;my post here&lt;/a&gt;. Additionally check my GitHub repo&lt;/em&gt; &lt;a href=&quot;https://github.com/SamLynnEvans/Transformer&quot; rel=&quot;noopener nofollow&quot;&gt;&lt;em&gt;here&lt;/em&gt;&lt;/a&gt; &lt;em&gt;to run my Transformer on your own datasets.&lt;/em&gt;&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image16.png&quot; class=&quot;kg-image&quot;/&gt;&lt;p&gt;The diagram above shows the overview of my Transformer model. The inputs to the encoder are copies of the English sentence, and the ‘Outputs‘ entering the decoder are copies of the French sentence.&lt;/p&gt;
&lt;p&gt;It looks quite intimidating as a whole, but in effect, there are only four processes we need to understand to implement this model:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Embedding the inputs&lt;/li&gt;
&lt;li&gt;The Positional Encodings&lt;/li&gt;
&lt;li&gt;The Attention Layer&lt;/li&gt;
&lt;li&gt;The Feed-Forward layer&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;embedding-what-are-embeddings-and-how-do-we-use-them&quot;&gt;Embedding: What are embeddings and how do we use them?&lt;/h3&gt;
&lt;p&gt;A key principle in NLP tasks is &lt;strong&gt;&lt;strong&gt;embedding.&lt;/strong&gt;&lt;/strong&gt; Originally, when performing NLP, words would be one hot encoded, and so essentially each word was represented by a single value:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image17.png&quot; class=&quot;kg-image&quot;/&gt;Vocabulary matrix of dimensions V x V. The position of the 1 distinguishes the word. If your vocabulary size is 10,000, each vector has a length of 10,000!
&lt;p&gt;However this is highly inefficient. We are providing huge vectors to our neural network where all but one of each vector’s values are 0!&lt;/p&gt;
&lt;p&gt;Additionally, words are highly nuanced and often have more than one meaning in different contexts. A one hot encoding hence provides a far lower amount of information about a word to a network than ideal.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image18.png&quot; class=&quot;kg-image&quot;/&gt;&lt;p&gt;Embeddings address this problem by providing every word a whole array of values that the model can tune. In our model the vector will be of size 512, meaning each word has 512 values that the neural network can tweak to fully interpret its meaning.&lt;/p&gt;
&lt;p&gt;And what about preloaded word-embeddings such as GloVe and word2vec? &lt;strong&gt;Forget about them&lt;/strong&gt;. Effective deep learning should be end-to-end. Let’s initialize our word vectors randomly, and get that model to learn all parameters and embeddings itself.&lt;/p&gt;
&lt;h3 id=&quot;giving-our-words-context-the-positional-encoding&quot;&gt;Giving our words context: The positional encoding&lt;/h3&gt;
&lt;p&gt;In order for the model to make sense of a sentence, it needs to know two things about each word: what does the word mean? And what is its position in the sentence?&lt;/p&gt;
&lt;p&gt;The embedding vector for each word will express the meaning, so now we need to input something that tells the network about the word’s position.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Vaswani et al&lt;/em&gt; answered this problem by using a sine and cosine function to create a constant matrix of position-specific values.&lt;/p&gt;
&lt;p&gt;However, I don’t want to bog this article down with the equations, so let’s just use this diagram to get an intuitive feel of what they did:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image19.png&quot; class=&quot;kg-image&quot;/&gt;The positional encoding matrix is a constant whose values are defined by a function(pos, i), where pos is the position of the word in the sentences, and i follows the embedded values.
&lt;p&gt;When these position specific values are added to our embedding values, each word embedding is altered in a way specific to its position in the sentence.&lt;/p&gt;
&lt;p&gt;The network is hence given information about structure, and it can use this to build understanding of the languages.&lt;/p&gt;
&lt;h3 id=&quot;the-attention-function&quot;&gt;The Attention function&lt;/h3&gt;
&lt;p&gt;Once we have our embedded values (with positional encodings), we can put them through our attention function.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image20.png&quot; class=&quot;kg-image&quot;/&gt;&lt;p&gt;In the decoder, the query will be the encoder outputs and the key and value will be the decoder outputs. A series of matrix multiplications combines these values, and tells the model which words from the input are important for making our next prediction.&lt;/p&gt;
&lt;p&gt;Here is a glance into the attention function from the decoder of my trained model, when translating the phrase “let’s look inside the attention function”.&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image21.png&quot; class=&quot;kg-image&quot;/&gt;Map of where the translator is paying attention as it predicts output words (seen down the vertical axis). Lighter areas show which words from the encoder it is using to make predictions.
&lt;p&gt;The first word we give the decoder to start translating is the &amp;lt;s&amp;gt; token (s for start). When it receives this we can see it is paying attention to &lt;em&gt;let&lt;/em&gt;, &lt;em&gt;‘s&lt;/em&gt;, and &lt;em&gt;look&lt;/em&gt; outputs from the encoder, realizing it can translate all those words to &lt;em&gt;voyons&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;It then outputs &lt;em&gt;voyons&lt;/em&gt;. To predict the next word we can now see it pays attention to the word &lt;em&gt;inside&lt;/em&gt;. Attending to &lt;em&gt;inside,&lt;/em&gt; it then predicts &lt;em&gt;a&lt;/em&gt; and then &lt;em&gt;l’&lt;/em&gt; and finally &lt;em&gt;intérieur&lt;/em&gt;. It now pays attention to the next encoder output, translates this, and so on.&lt;/p&gt;
&lt;p&gt;Most interestingly we can see that &lt;em&gt;attention function&lt;/em&gt; in French is translated as &lt;em&gt;fonction d’attention&lt;/em&gt; (it is written the other way round)&lt;em&gt;.&lt;/em&gt; When we get to this point in the sentence, the model learns to pay attention to &lt;em&gt;function&lt;/em&gt; first and then &lt;em&gt;attention&lt;/em&gt;. This is frankly astonishing – it has learnt in French the adjective must always come after the noun and we are seeing that in action.&lt;/p&gt;
&lt;h3 id=&quot;the-feed-forward-network&quot;&gt;The Feed-Forward Network&lt;/h3&gt;
&lt;p&gt;Okay, if you’ve understood things so far, give yourself a big pat on the back as we’ve made it to the final layer, and luckily this one’s pretty simple.&lt;/p&gt;
&lt;p&gt;The feed-forward network just consists of two linear operations. That’s it.&lt;/p&gt;
&lt;p&gt;Here the network can feed on all the information generated by the attention functions and begin deciphering useful patterns and correlations.&lt;/p&gt;
&lt;h3 id=&quot;training-the-model&quot;&gt;Training the model&lt;/h3&gt;
&lt;p&gt;After training the model for about three days on my 8GB GPU, I ended up converging at a loss of around 1.3 (using a simple cross entropy loss function).&lt;/p&gt;
&lt;p&gt;And at this loss value, we got a high-functioning translator, capable of all the results explored in the introduction to this piece.&lt;/p&gt;
&lt;p&gt;Let’s again reflect on this achievement.&lt;/p&gt;
&lt;p&gt;One readily available dataset from the internet, one paper by Vaswani et al, and three days of training* and there we have it; an almost state of the art French-English translator.&lt;/p&gt;
&lt;p&gt;And on that illuminating note, I’ll leave you with a final translation:&lt;/p&gt;
&lt;img src=&quot;https://blog.floydhub.com/content/images/2018/10/image22.png&quot; class=&quot;kg-image&quot;/&gt;Flawless victory
&lt;p&gt;*&lt;em&gt;plus three weeks of me smashing my against the wall trying to work out how to code it.&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&quot;appendix-tips-and-tricks&quot;&gt;Appendix: tips and tricks&lt;/h3&gt;
&lt;p&gt;In total, this project took me one month (I’d imagined it would take a few weeks at most…). If you’d like to replicate it or learn more about the code and theory, check out my tutorial on &lt;a href=&quot;https://towardsdatascience.com/how-to-use-torchtext-for-neural-machine-translation-plus-hack-to-make-it-5x-faster-77f3884d95&quot; rel=&quot;nofollow noopener&quot;&gt;Torchtext&lt;/a&gt; and &lt;a href=&quot;https://towardsdatascience.com/how-to-code-the-transformer-in-pytorch-24db27c8f9ec&quot; rel=&quot;nofollow noopener&quot;&gt;the transformer&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I also learnt many lessons and tips that either helped improve my results, or will serve me well during my next deep learning project.&lt;/p&gt;
&lt;h4 id=&quot;1-spend-more-time-researching&quot;&gt;1. Spend more time researching&lt;/h4&gt;
&lt;p&gt;Deep learning is such a fast moving field that a lot of the immediate results for web queries can contain outdated models or information.&lt;/p&gt;
&lt;p&gt;For example searching seq2seq yields heaps of information about RNNs, yet these models are becoming seemingly obsolete in face of the transformer and even more recently, &lt;a href=&quot;https://medium.com/the-artificial-impostor/notes-understanding-tensorflow-part-3-7f6633fcc7c7&quot;&gt;temporal convolutional networks&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If I’d spent more time researching at the beginning, I could’ve immediately begun building the transformer (or even better &lt;a href=&quot;https://arxiv.org/pdf/1808.03867.pdf&quot; rel=&quot;noopener nofollow&quot;&gt;this model&lt;/a&gt; I only just discovered), and got a quick-training translator straight away.&lt;/p&gt;
&lt;h4 id=&quot;2-be-organized-and-store-your-training-logs&quot;&gt;2. Be organized and store your training logs&lt;/h4&gt;
&lt;p&gt;I eventually learnt to store training logs (either as text files or figures). There were many times I thought my model wasn’t working (or had become slower) because I was comparing it to the wrong log. I lost countless hours searching for non-existent bugs due to this silly mistake. Platforms like &lt;a href=&quot;https://www.floydhub.com/pricing?utm_source=blog&amp;amp;utm_medium=link&amp;amp;utm_campaign=found_in_translation&quot;&gt;FloydHub&lt;/a&gt; solve this problem – FloydHub automatically stores and version controls your training logs, metrics graphs, hyperparameters, and code.&lt;/p&gt;
&lt;h4 id=&quot;3-think-more-about-your-dataset&quot;&gt;3. Think more about your dataset&lt;/h4&gt;
&lt;p&gt;While the Europarl dataset is the largest I could find, it is far from perfect. The language used is incredibly formal, and it is missing some everyday words (such as &lt;em&gt;love&lt;/em&gt;!) as they would not be used in parliamentary proceedings. Using only this means some simple and colloquial sentences don’t translate well. It would have been better to spend more time searching additional data and adding it to my dataset.&lt;/p&gt;
&lt;h4 id=&quot;5-synonym-hack&quot;&gt;5. Synonym hack&lt;/h4&gt;
&lt;p&gt;Not having the computing power to handle huge vocabulary sizes, I implemented a synonym hack into my final model. When you enter words to translate my model doesn’t know, it looks them up in a thesaurus and tries to find a term the model does know, and substitutes them.&lt;/p&gt;
&lt;h4 id=&quot;6-train-on-smaller-dataset-first&quot;&gt;6. Train on smaller dataset first&lt;/h4&gt;
&lt;p&gt;Before training on the big dataset, I ran experiments on a smaller set of 155,000 sentences (&lt;a href=&quot;http://www.manythings.org/anki/fra-eng.zip&quot; rel=&quot;noopener nofollow&quot;&gt;download link&lt;/a&gt;). This way I could find which model and parameters seemed to work best, before investing time and money in training the huge dataset.&lt;/p&gt;
&lt;h4 id=&quot;7-beam-search&quot;&gt;7. Beam search&lt;/h4&gt;
&lt;p&gt;For the best translation results, we should use beam search. I used it for the results shown at the top. This is &lt;a href=&quot;https://www.youtube.com/watch?v=RLWuzLLSIgw&quot; rel=&quot;noopener nofollow&quot;&gt;a good video&lt;/a&gt; explaining it, and you can see my code &lt;a href=&quot;https://github.com/SamLynnEvans/Transformer&quot; rel=&quot;noopener nofollow&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&quot;8-try-using-byte-pair-encodings-to-solve-the-open-ended-language-problem&quot;&gt;8. Try using byte-pair encodings to solve the open-ended language problem&lt;/h4&gt;
&lt;p&gt;In order to deal with proper-nouns or new vocabulary encountered by the machines, researchers have implemented word-byte encodings. These split words into sub-words and build the network on this input instead, read more &lt;a href=&quot;https://github.com/rsennrich/subword-nmt&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Another solution for proper nouns word be slightly more hacky, and involve the neural network assuming words it doesn’t know to be proper nouns. Then it would not attempt to translate them, but repeat them exactly as they are in the output text. This could be achieved by editing how the data is processed.&lt;/p&gt;
&lt;hr/&gt;&lt;h3 id=&quot;about-samuel-lynn-evans&quot;&gt;About Samuel Lynn-Evans&lt;/h3&gt;
&lt;p&gt;For the last 10 years, Sam has combined his passion for science and languages by teaching life sciences in foreign countries. Seeing the huge potential for ML in scientific progress, he began studying AI at school 42 in Paris, with the aim of applying NLP to biological and medical problems.&lt;/p&gt;
&lt;p&gt;You can follow along with Sam on &lt;a href=&quot;https://twitter.com/SamLynnEvans&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=&quot;https://medium.com/@samuellynnevans&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;
</description>
<pubDate>Wed, 10 Oct 2018 17:50:38 +0000</pubDate>
<dc:creator>saip</dc:creator>
<og:type>article</og:type>
<og:title>Found in translation: Building a language translator from scratch with deep learning</og:title>
<og:description>Building an English-French language translator neural network from scratch with deep learning.</og:description>
<og:url>https://blog.floydhub.com/language-translator/</og:url>
<og:image>https://blog.floydhub.com/content/images/2018/10/header.jpeg</og:image>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://blog.floydhub.com/language-translator/</dc:identifier>
</item>
<item>
<title>Dropbox traffic infrastructure: Edge network</title>
<link>https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/</link>
<guid isPermaLink="true" >https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/</guid>
<description>&lt;p&gt;&lt;img data-attachment-id=&quot;5263&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/01-screenshot2018-09-3002-11-17copy/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png&quot; data-orig-size=&quot;2540,1208&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;01-Screenshot+2018-09-30+02.11.17+copy&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309&quot; class=&quot;alignnone size-medium wp-image-5263&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;309&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5263&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/01-screenshot2018-09-3002-11-17copy/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png&quot; data-orig-size=&quot;2540,1208&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;01-Screenshot+2018-09-30+02.11.17+copy&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309&quot; class=&quot;alignnone size-medium wp-image-5263&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;309&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=650&amp;amp;h=309 650w, https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=1300&amp;amp;h=618 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=600&amp;amp;h=285 600w, https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=768&amp;amp;h=365 768w, https://dropboxtechblog.files.wordpress.com/2018/10/01-screenshot2018-09-3002-11-17copy.png?w=1024&amp;amp;h=487 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;In this post we will describe the Edge network part of Dropbox traffic infrastructure. This is an extended transcript of our &lt;a href=&quot;https://www.nginx.com/nginxconf/2018/agenda/#day-2-oleg-guba&quot;&gt;NginxConf 2018&lt;/a&gt; presentation. Around the same time last year we described low-level aspects of our infra in the &lt;a href=&quot;https://blogs.dropbox.com/tech/2017/09/optimizing-web-servers-for-high-throughput-and-low-latency/&quot;&gt;Optimizing web servers for high throughput and low latency&lt;/a&gt; post. This time we’ll cover higher-level things like our points of presence around the world, GSLB, RUM DNS, L4 loadbalancers, nginx setup and its dynamic configuration, and a bit of gRPC proxying.&lt;/p&gt;
&lt;h2&gt;Dropbox scale&lt;/h2&gt;
&lt;p&gt;Dropbox has more than half a billion registered users who trust us with &lt;a href=&quot;https://blogs.dropbox.com/tech/2016/05/inside-the-magic-pocket/&quot;&gt;exabytes of data&lt;/a&gt; and petabytes of corresponding metadata. For the Traffic team this means millions of HTTP requests and terabits of traffic. To support all of that we’ve built an extensive network of points of presence (PoPs) around the world that we call Edge.&lt;/p&gt;
&lt;h2&gt;Why do we need Edge?&lt;/h2&gt;
&lt;p&gt;Many of the readers know the basic idea of CDNs: terminating TCP and TLS connections closer to the user leads to improved user experience because of greatly reduced latencies. Here is a quick reminder: a comparison of an HTTP request latency made directly to a data center and the same request made through a PoP:&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5264&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/02-03-screenshot2018-10-0422-29-22/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png&quot; data-orig-size=&quot;4832,1200&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;02-03-Screenshot+2018-10-04+22.29.22&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161&quot; class=&quot;alignnone size-medium wp-image-5264&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;161&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5264&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/02-03-screenshot2018-10-0422-29-22/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png&quot; data-orig-size=&quot;4832,1200&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;02-03-Screenshot+2018-10-04+22.29.22&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161&quot; class=&quot;alignnone size-medium wp-image-5264&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;161&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=650&amp;amp;h=161 650w, https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=1297&amp;amp;h=322 1297w, https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=600&amp;amp;h=149 600w, https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=768&amp;amp;h=191 768w, https://dropboxtechblog.files.wordpress.com/2018/10/02-03-screenshot2018-10-0422-29-22.png?w=1024&amp;amp;h=254 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;Numbers are given based on:&lt;br/&gt;20ms PoP↔user latency, 150ms PoP↔DC latency, 100ms server execution time&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;As you can see, by simply putting the PoP close to the user one can improve latency by more than factor of two.&lt;/p&gt;
&lt;p&gt;But that is not all. Our users benefit greatly from faster file uploads and downloads. Let’s see how latency affects TCP congestion window (CWND) growth during file uploads:&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5265&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/04-screenshot2018-10-0403-47-45/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png&quot; data-orig-size=&quot;1758,888&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;04-Screenshot+2018-10-04+03.47.45&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328&quot; class=&quot;alignnone size-medium wp-image-5265&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;328&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5265&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/04-screenshot2018-10-0403-47-45/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png&quot; data-orig-size=&quot;1758,888&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;04-Screenshot+2018-10-04+03.47.45&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328&quot; class=&quot;alignnone size-medium wp-image-5265&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;328&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=650&amp;amp;h=328 650w, https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=1300&amp;amp;h=656 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=600&amp;amp;h=303 600w, https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=768&amp;amp;h=388 768w, https://dropboxtechblog.files.wordpress.com/2018/10/04-screenshot2018-10-0403-47-45.png?w=1024&amp;amp;h=517 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Here we can see a low and high latency connection comparison that represents a connection with and without a PoP respectively:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;The client with lower latency is progressing through slow start faster, because it is an RTT-bound process&lt;/li&gt;
&lt;li&gt;This client also settles on the higher threshold for congestion avoidance, because of the lower level of packet loss. This happens because that packets need to spend less time on the public, and possibly congested, internet links—once they hit the PoP we take them into our own backbone network&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote&gt;
&lt;p&gt;Aside from all latency-related performance gains, building our own Edge network gives us (traffic engineers) a lot of freedom: for example we can easily experiment with new low- and high-level protocols, external and internal loadbalancing algorithms, and more closely integrate with the rest of the infrastructure.&lt;br/&gt;We can do things like research BBR congestion control effects on file download speed, latency, and packet loss.&lt;/p&gt;
&lt;h2&gt;Picking PoP locations&lt;/h2&gt;
&lt;/blockquote&gt;
&lt;p&gt;As of today, Dropbox has 20 PoPs around the world:&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5266&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/05-screenshot2018-10-09at1-54-03pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png&quot; data-orig-size=&quot;2518,1214&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;05-Screen+Shot+2018-10-09+at+1.54.03+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313&quot; class=&quot;alignnone size-medium wp-image-5266&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;313&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5266&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/05-screenshot2018-10-09at1-54-03pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png&quot; data-orig-size=&quot;2518,1214&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;05-Screen+Shot+2018-10-09+at+1.54.03+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313&quot; class=&quot;alignnone size-medium wp-image-5266&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;313&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=650&amp;amp;h=313 650w, https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=1298&amp;amp;h=626 1298w, https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=600&amp;amp;h=289 600w, https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=768&amp;amp;h=370 768w, https://dropboxtechblog.files.wordpress.com/2018/10/05-screenshot2018-10-09at1-54-03pm.png?w=1024&amp;amp;h=494 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;We’ve just announced our PoP in Toronto, and will get two more in Scandinavia by the end of the year.&lt;/p&gt;
&lt;p&gt;In 2019, we are planning to look at increasing our Edge footprint by researching the viability of PoPs in LATAM, Middle East, and APAC.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5267&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/06-screenshot2018-10-09at1-54-15pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png&quot; data-orig-size=&quot;2496,1212&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;06-Screen+Shot+2018-10-09+at+1.54.15+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316&quot; class=&quot;alignnone size-medium wp-image-5267&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;316&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5267&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/06-screenshot2018-10-09at1-54-15pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png&quot; data-orig-size=&quot;2496,1212&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;06-Screen+Shot+2018-10-09+at+1.54.15+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316&quot; class=&quot;alignnone size-medium wp-image-5267&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;316&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=650&amp;amp;h=316 650w, https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=1300&amp;amp;h=632 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=600&amp;amp;h=291 600w, https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=768&amp;amp;h=373 768w, https://dropboxtechblog.files.wordpress.com/2018/10/06-screenshot2018-10-09at1-54-15pm.png?w=1024&amp;amp;h=497 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;The process of PoP selection, which was easy at first, now becomes more and more complicated: we need to consider backbone capacity, peering connectivity, &lt;a href=&quot;https://www.submarinecablemap.com&quot;&gt;submarine cables&lt;/a&gt;, but most importantly the location with respect to all the other PoPs we have.&lt;/p&gt;
&lt;p&gt;The current PoP selection procedure is human guided but algorithm-assisted. Even with a small number of PoPs without assistive software it may be challenging to choose between, for example, a PoP in Brazil and a PoP in Australia. The problem persists as the number of PoPs grows: e.g. what location will benefit Dropbox users better, Vienna or Warsaw?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We try to alternate new PoP placement between selecting the most advantageous PoP for the existing and potential Dropbox users.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A tiny script helps us brute-force the problem by:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;Splitting the Earth into 7th level &lt;a href=&quot;http://s2geometry.io/&quot;&gt;s2 regions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Placing all the existing PoPs&lt;/li&gt;
&lt;li&gt;Computing the distance to the nearest PoP for all the regions weighted by “population”&lt;/li&gt;
&lt;li&gt;Doing exhaustive search to find the “best” location for the new PoP&lt;/li&gt;
&lt;li&gt;Adding it to the map&lt;/li&gt;
&lt;li&gt;Looping back to step 3, etc.&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;By “population” one can use pretty much any metric we want to optimize, for example total number of people in the area, or number of existing/potential users. As for the loss function to determine the score of each placement one can use something standard like L1 or L2 loss. In our case we try to overcompensate for the effects of latency on the TCP throughput.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Some of you may see that the problem here that can be solved by more sophisticated methods like Gradient Descent or Bayesian Optimization. This is indeed true, but because our problem space is so small (there are &lt;a href=&quot;http://s2geometry.io/resources/s2cell_statistics&quot;&gt;less than 100K 7th level s2 cells&lt;/a&gt;) we can just brute-force through it and get a definitively optimal result instead of the one that can get stuck on a local optimum.&lt;/p&gt;
&lt;h2&gt;GSLB&lt;/h2&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let’s start with the most important part of the Edge—GSLB. GSLB is responsible for loadbalancing users across PoPs. That usually means sending each user to the closest PoP, unless it is over capacity or under maintenance.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GSLB is called the “most important part” here because if it misroutes users to the suboptimal PoPs frequently, then it makes the Edge network useless, and potentially even harms performance.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The following is a discussion of commonly used GSLB techniques, their pros and cons, and how we use them at Dropbox.&lt;/p&gt;
&lt;h3&gt;BGP anycast&lt;/h3&gt;
&lt;p&gt;Anycast is the easiest loadbalancing method that relies on the core internet routing protocol, BGP. To start using anycast it is sufficient to just start advertising the same subnet from all the PoPs and internet will deliver packet to the “optimal” one automagically.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5268&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/07-screenshot2018-10-05at7-47-50pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png&quot; data-orig-size=&quot;1802,836&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;07-Screen+Shot+2018-10-05+at+7.47.50+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302&quot; class=&quot;alignnone size-medium wp-image-5268&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;302&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5268&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/07-screenshot2018-10-05at7-47-50pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png&quot; data-orig-size=&quot;1802,836&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;07-Screen+Shot+2018-10-05+at+7.47.50+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302&quot; class=&quot;alignnone size-medium wp-image-5268&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;302&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=650&amp;amp;h=302 650w, https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=1300&amp;amp;h=604 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=600&amp;amp;h=278 600w, https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=768&amp;amp;h=356 768w, https://dropboxtechblog.files.wordpress.com/2018/10/07-screenshot2018-10-05at7-47-50pm.png?w=1024&amp;amp;h=475 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Even though we get automatic failover and simplicity of the setup, anycast has many drawbacks, so let’s go over them one by one.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Anycast performance&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5269&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/08-screenshot2018-10-05at4-30-19pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png&quot; data-orig-size=&quot;2694,624&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;08-Screen+Shot+2018-10-05+at+4.30.19+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151&quot; class=&quot;alignnone size-medium wp-image-5269&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;151&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5269&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/08-screenshot2018-10-05at4-30-19pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png&quot; data-orig-size=&quot;2694,624&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;08-Screen+Shot+2018-10-05+at+4.30.19+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151&quot; class=&quot;alignnone size-medium wp-image-5269&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;151&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=650&amp;amp;h=151 650w, https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=1300&amp;amp;h=302 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=600&amp;amp;h=139 600w, https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=768&amp;amp;h=178 768w, https://dropboxtechblog.files.wordpress.com/2018/10/08-screenshot2018-10-05at4-30-19pm.png?w=1024&amp;amp;h=237 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Above, we mentioned that BGP selects the “optimal” route and for the most part that is true. The problem is that BGP does not know anything about link latency, throughput, packet loss, and so on. Generally in the presence of multiple routes to the destination, it just selects one with the least number of hops.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5270&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/09-screenshot2018-10-0414-29-50/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png&quot; data-orig-size=&quot;2250,1072&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;09-Screenshot+2018-10-04+14.29.50&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310&quot; class=&quot;alignnone size-medium wp-image-5270&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;310&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5270&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/09-screenshot2018-10-0414-29-50/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png&quot; data-orig-size=&quot;2250,1072&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;09-Screenshot+2018-10-04+14.29.50&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310&quot; class=&quot;alignnone size-medium wp-image-5270&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;310&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=650&amp;amp;h=310 650w, https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=1300&amp;amp;h=620 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=600&amp;amp;h=286 600w, https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=768&amp;amp;h=366 768w, https://dropboxtechblog.files.wordpress.com/2018/10/09-screenshot2018-10-0414-29-50.png?w=1024&amp;amp;h=488 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Anycast-based loadbalancing is mostly optimal but it behaves poorly on high percentiles.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This is true for a small and medium number of PoPs. But there is a conjecture that “critical” misrouting probability (e.g. probability of routing user to a different continent) in an anycasted network drops sharply with number of PoPs. Therefore it is possible that with increasing number of PoPs, anycast may eventually start outperforming GeoDNS. We’ll continue looking at how our anycast performance scales with the number of PoPs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Traffic steering&lt;/strong&gt;&lt;br/&gt;With anycast, we have very limited control over traffic. It is hard to explicitly move traffic from one PoP to another. We can do some traffic steering using MED attributes, prepending AS_PATHs to our announces, and by explicitly communicating with traffic providers, but this is not scalable.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Also note that in the &lt;a href=&quot;https://books.google.com/books?id=Q0t3BQAAQBAJ&amp;amp;pg=PA98&amp;amp;lpg=PA98&amp;amp;dq=N+WLLA+OMNI&amp;amp;source=bl&amp;amp;ots=-oj5dCN051&amp;amp;sig=BpDUcuuNGLUPjNwJk0nZP0TOpg0&amp;amp;hl=en&amp;amp;sa=X&amp;amp;ved=2ahUKEwiByKDaiufdAhUTHTQIHV6sD9s4ChDoATAFegQIAxAB#v=onepage&amp;amp;q=N%20WLLA%20OMNI&amp;amp;f=false&quot;&gt;N WLLA OMNI&lt;/a&gt; mnemonic &lt;code&gt;AS_PATH&lt;/code&gt; is somewhere in the middle. This effectively means that it can be easily overridden by an administrator and in practice this makes BGP anycast pick the “cheapest” route, not the “nearest” or the “fastest.”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Another property of anycast is that graceful drain of the PoP is impossible—since BGP balances packets and not connections. After the routing table change, all inflight TCP sessions will immediately be routed to the next best PoP and users will get an RST from there.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Troubleshooting&lt;/strong&gt;&lt;br/&gt;Generally reasoning about traffic routing with anycast becomes very non-trivial, since it involves the state of internet routing at a given time. Troubleshooting performance issues with anycast is hard and usually involves a lot of traceroutes, looking glasses, and back and forth communication with providers along the way.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5271&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/10-screenshot2018-10-05at4-07-34pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png&quot; data-orig-size=&quot;2694,704&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;10-Screen+Shot+2018-10-05+at+4.07.34+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170&quot; class=&quot;alignnone size-medium wp-image-5271&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;170&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5271&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/10-screenshot2018-10-05at4-07-34pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png&quot; data-orig-size=&quot;2694,704&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;10-Screen+Shot+2018-10-05+at+4.07.34+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170&quot; class=&quot;alignnone size-medium wp-image-5271&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;170&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=650&amp;amp;h=170 650w, https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=1300&amp;amp;h=340 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=600&amp;amp;h=157 600w, https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=768&amp;amp;h=201 768w, https://dropboxtechblog.files.wordpress.com/2018/10/10-screenshot2018-10-05at4-07-34pm.png?w=1024&amp;amp;h=268 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Note that, as in the case of a PoP drain, any connectivity change in the internet has a possibility of breaking users’ connections to anycasted IP addresses. Troubleshooting intermittent connection issues due to internet routing changes or faulty/misconfigured hardware can be challenging.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Here is an example of an epic anycast troubleshooting by Fastly NOC from NANOG mailing list: &lt;a href=&quot;https://mailman.nanog.org/pipermail/nanog/2018-September/096871.html&quot;&gt;Service provider story about tracking down TCP RSTs&lt;/a&gt;.&lt;br/&gt;TL;DR SYNs passing through the router had different TTL and at the same time this IP field was used for the ECMP flow hashing.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Tools&lt;/strong&gt;&lt;br/&gt;Here are couple of tricks you can use to make troubleshooting a bit easier (especially in case of anycast).&lt;/p&gt;
&lt;p&gt;Of course having a random request ID associated with every request that goes through the system and can be traced in the logs is a must. In case of the Edge, it is also helpful to echo back a header with the name of the PoP you’re connected to (or embed this into the unique request ID).&lt;/p&gt;
&lt;p&gt;Another useful thing that is commonly used is to create “debug” sites that can pre-collect all the troubleshooting data for the user so that they can attach it to the support ticket e.g.: &lt;a href=&quot;https://github-debug.com/&quot;&gt;github-debug.com&lt;/a&gt;, &lt;a href=&quot;https://www.fastly-debug.com/&quot;&gt;fastly-debug.com&lt;/a&gt;, and of course &lt;a href=&quot;https://dropbox-debug.com/&quot;&gt;dropbox-debug.com&lt;/a&gt;, which was heavily inspired by them.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5272&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/11-screenshot2018-10-0200-40-17/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png&quot; data-orig-size=&quot;2285,1363&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;11-Screenshot+2018-10-02+00.40.17&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388&quot; class=&quot;alignnone size-medium wp-image-5272&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;388&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5272&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/11-screenshot2018-10-0200-40-17/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png&quot; data-orig-size=&quot;2285,1363&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;11-Screenshot+2018-10-02+00.40.17&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388&quot; class=&quot;alignnone size-medium wp-image-5272&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;388&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=650&amp;amp;h=388 650w, https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=1300&amp;amp;h=776 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=600&amp;amp;h=358 600w, https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=768&amp;amp;h=458 768w, https://dropboxtechblog.files.wordpress.com/2018/10/11-screenshot2018-10-0200-40-17.png?w=1024&amp;amp;h=611 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;Traffic team projects like &lt;a href=&quot;https://dropbox-debug.com/&quot;&gt;dropbox-debug&lt;/a&gt;, &lt;a href=&quot;https://blogs.dropbox.com/tech/2017/04/deploying-brotli-for-static-content/&quot;&gt;Brotli static precompression&lt;/a&gt;, BBR evaluation and rollout, RUM DNS, and many others came out of &lt;a href=&quot;https://www.youtube.com/watch?v=BVuQJdFA8rY&quot;&gt;Hack Week&lt;/a&gt;: a company-wide event that inspires us to try something new and exciting!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Anycast at Dropbox&lt;/strong&gt;&lt;br/&gt;With all that said, we still use anycast for our APEX domains like dropbox.com (without www) and as a fallback in case of major DDoS attacks.&lt;/p&gt;
&lt;h3&gt;GeoDNS&lt;/h3&gt;
&lt;p&gt;Let’s talk about another common solution for implementing GSLB: GeoDNS. In this approach each PoP has its own unique unicast IP address space and DNS is responsible for handing off different IP addresses to different users based on their geographical location.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5273&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/12-screenshot2018-10-05at7-36-37pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png&quot; data-orig-size=&quot;1822,858&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;12-Screen+Shot+2018-10-05+at+7.36.37+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306&quot; class=&quot;alignnone size-medium wp-image-5273&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;306&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5273&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/12-screenshot2018-10-05at7-36-37pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png&quot; data-orig-size=&quot;1822,858&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;12-Screen+Shot+2018-10-05+at+7.36.37+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306&quot; class=&quot;alignnone size-medium wp-image-5273&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;306&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=650&amp;amp;h=306 650w, https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=1300&amp;amp;h=612 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=600&amp;amp;h=283 600w, https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=768&amp;amp;h=362 768w, https://dropboxtechblog.files.wordpress.com/2018/10/12-screenshot2018-10-05at7-36-37pm.png?w=1024&amp;amp;h=482 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;This gives us control over traffic steering and allows graceful drain. It is worth mentioning that any kind of reasoning about unicast-based setup is much easier, therefore troubleshooting becomes simpler.&lt;/p&gt;
&lt;p&gt;As you can see, there are a lot of variables involved: we rely on a DNS provider guessing user IP by their DNS resolver (or trust EDNS CS data), then guessing user location by their IP address, then approximate physical proximity to latency.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note that different DNS providers will likely end up with different decisions, based on their algorithms and quality of their GeoIP database, therefore monitoring performance of multi-provider DNS setup is much harder.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Aside from that, DNS also has a major problem with stale data. Long story short: DNS TTL is a lie. Even though we have TTL of one minute for www.dropbox.com, it still takes 15 minutes to drain 90% of traffic, and it may take a full hour to drain 95% of traffic:&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5274&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/13-screenshot2018-10-05at7-33-34pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png&quot; data-orig-size=&quot;1798,856&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;13-Screen+Shot+2018-10-05+at+7.33.34+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309&quot; class=&quot;alignnone size-medium wp-image-5274&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;309&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5274&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/13-screenshot2018-10-05at7-33-34pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png&quot; data-orig-size=&quot;1798,856&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;13-Screen+Shot+2018-10-05+at+7.33.34+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309&quot; class=&quot;alignnone size-medium wp-image-5274&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;309&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=650&amp;amp;h=309 650w, https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=1298&amp;amp;h=618 1298w, https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=600&amp;amp;h=286 600w, https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=768&amp;amp;h=366 768w, https://dropboxtechblog.files.wordpress.com/2018/10/13-screenshot2018-10-05at7-33-34pm.png?w=1024&amp;amp;h=488 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;Here we also need to mention the myriad embedded devices using Dropbox API that range from video cameras to smart fridges which have a tendency of resolving DNS addresses only during power-on.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;GeoDNS at Dropbox&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5275&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/14-screenshot2018-09-1417-18-19copy/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png&quot; data-orig-size=&quot;1740,894&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;14-Screenshot+2018-09-14+17.18.19+copy&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334&quot; class=&quot;alignnone size-medium wp-image-5275&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;334&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5275&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/14-screenshot2018-09-1417-18-19copy/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png&quot; data-orig-size=&quot;1740,894&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;14-Screenshot+2018-09-14+17.18.19+copy&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334&quot; class=&quot;alignnone size-medium wp-image-5275&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;334&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=650&amp;amp;h=334 650w, https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=1300&amp;amp;h=668 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=600&amp;amp;h=308 600w, https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=768&amp;amp;h=395 768w, https://dropboxtechblog.files.wordpress.com/2018/10/14-screenshot2018-09-1417-18-19copy.png?w=1024&amp;amp;h=526 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Our DNS setup evolved quite a bit over last few years: we started with a simple continent→PoP mappings, then switched to country→PoP with a per-state mapping data for serving network traffic to large countries like the US, Canada, etc. At the moment, we are juggling relatively complex LatLong-based routing with AS-based overrides to work around quirks in internet connectivity and peering.&lt;/p&gt;
&lt;h3&gt;Hybrid unicast/anycast GSLB&lt;/h3&gt;
&lt;p&gt;Let’s very briefly cover one of the composite approaches to GSLB: hybrid unicast/anycast setup. By combining unicast and anycast announces along with GeoDNS mapping, one can get all the benefits of unicast along with an ability to quickly drain PoPs in case of an outage.&lt;/p&gt;
&lt;p&gt;One can enable this hybrid GSLB by announcing both PoP’s unicast subnet (e.g. /24) and one of its supernets (e.g. /19) from all of the PoPs (including itself).&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5276&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/15-screenshot2018-10-05at7-31-44pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png&quot; data-orig-size=&quot;2380,1184&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;15-Screen+Shot+2018-10-05+at+7.31.44+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323&quot; class=&quot;alignnone size-medium wp-image-5276&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;323&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5276&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/15-screenshot2018-10-05at7-31-44pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png&quot; data-orig-size=&quot;2380,1184&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;15-Screen+Shot+2018-10-05+at+7.31.44+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323&quot; class=&quot;alignnone size-medium wp-image-5276&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;323&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=650&amp;amp;h=323 650w, https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=1300&amp;amp;h=646 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=600&amp;amp;h=298 600w, https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=768&amp;amp;h=382 768w, https://dropboxtechblog.files.wordpress.com/2018/10/15-screenshot2018-10-05at7-31-44pm.png?w=1024&amp;amp;h=509 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;This implies that every PoP should be set up to handle traffic destined to any PoP: i.e. have all the VIPs from all the PoPs in the BGP daemons/L4 balancers/L7 proxies configs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Such an approach gives us the ability to quickly switch between unicast and anycast addresses and therefore immediate fallback without waiting for DNS TTL to expire. This also allows graceful PoP draining and all the other benefits of DNS traffic steering. All of that comes at a relatively small operational cost of a more complicated setup and may cause scalability problems once you reach the high thousands of VIPs. On the bright side, all PoP configs now become more uniform.&lt;/p&gt;
&lt;h3&gt;Real User Metrics&lt;/h3&gt;
&lt;p&gt;All the GSLB methods discussed up until now have one critical problem: none of them uses actual user-perceived performance as a signal, but instead rely on some approximations: BGP uses number of hops as a signal, while GeoIP uses physical proximity. We want to fix that by using Real User Metrics (RUM) collection pipeline based on performance data from our desktop clients.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Companies that do not have an app usually do latency measurements with the JS-based prober on their website.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Years ago we invested in an availability measurement framework in our Desktop Clients to help us estimate the user-perceived reliability of our Edge network. The system is pretty simple: once in a while a sample of clients run availability measurements against all of our PoPs and report back the results. We extended this system to also log latency information, which gave us sufficient data to start building our own map of the internet.&lt;/p&gt;
&lt;p&gt;We also built a separate resolver_ip→client_ip submap by joining DNS and HTTP server logs for http requests to random subdomain of a wildcard DNS record. On top of which we apply a tiny bit of post-processing for EDNS ClientSubnet-capable resolvers.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5277&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/16-screenshot2018-10-05at7-40-22pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png&quot; data-orig-size=&quot;1816,720&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;16-Screen+Shot+2018-10-05+at+7.40.22+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258&quot; class=&quot;alignnone size-medium wp-image-5277&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;258&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5277&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/16-screenshot2018-10-05at7-40-22pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png&quot; data-orig-size=&quot;1816,720&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;16-Screen+Shot+2018-10-05+at+7.40.22+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258&quot; class=&quot;alignnone size-medium wp-image-5277&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;258&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=650&amp;amp;h=258 650w, https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=1300&amp;amp;h=516 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=600&amp;amp;h=238 600w, https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=768&amp;amp;h=304 768w, https://dropboxtechblog.files.wordpress.com/2018/10/16-screenshot2018-10-05at7-40-22pm.png?w=1024&amp;amp;h=406 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;We combine the aggregated latencies, resolver_ip→client_ip map, BGP fullview, peering information, and capacity data from our monitoring system to produce the final map of client_subnet→PoP.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We are also considering adding a signal from the web server logs, since we already have &lt;a href=&quot;https://linuxgazette.net/136/pfeiffer.html&quot;&gt;TCP_INFO&lt;/a&gt; data, including &lt;a href=&quot;https://trac.nginx.org/nginx/ticket/1036&quot;&gt;number of retransmits&lt;/a&gt;, cwnd/rwnd, and rtt.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;After which we pack this map into a radix tree and upload it to a DNS server, after which it is compared to both anycast and GeoIP solutions.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Specifics of map generation are up in the air right now: we’ve tried (and continue trying out) different approaches: from simple HiveQL query that does per-/24 aggregation to ML-based solutions like Random Forests, stacks of &lt;a href=&quot;https://xgboost.readthedocs.io/en/latest/get_started.html&quot;&gt;XGBoosts&lt;/a&gt;, and DNNs. Sophisticated solutions are giving slightly better, but ultimately comparable results, at the cost of way longer training and reverse engineering complexity.&lt;br/&gt;At least for now, we are sticking with the solution that is easier to reason about and easier to troubleshoot.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Data anonymization and aggregation&lt;/strong&gt;&lt;br/&gt;We anonymize and aggregate all latency and availability data by /24 subnet in case of IPv4 and /56 in case of IPv6. We don’t operate directly on real user IPs and enforce strict ACL and retention policies for all RUM data.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Data cleanup&lt;/strong&gt;&lt;br/&gt;Data cleanup is a very important step in the &lt;a href=&quot;https://xkcd.com/2054/&quot;&gt;map data pipeline&lt;/a&gt;. Here are couple of common patterns that we’ve found during our map construction:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Standard &lt;code&gt;GetTickCount64&lt;/code&gt; timer &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/sysinfo/windows-time&quot;&gt;on Windows is quantized by around 16ms&lt;/a&gt;. In our Python client we’ve switched to &lt;code&gt;&lt;a href=&quot;https://docs.python.org/3/library/time.html#time.perf_counter&quot;&gt;time.perf_counter()&lt;/a&gt;&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;TCP and HTTP probes are way less reliable than HTTPS. This is mostly due to IP and DNS hijacking in the wild. Good examples of this are Wi-Fi captive portals.&lt;/li&gt;
&lt;li&gt;Even unique DNS requests can be received multiple times. Both due to lost responses and proactive cache refreshes by some DNS servers even unique queries like &lt;code&gt;UUID4.perf.dropbox.com&lt;/code&gt; can be duplicated. We take that into account when joining the HTTP and DNS logs.&lt;/li&gt;
&lt;li&gt;And of course there are all kinds of weird timing results from negative and submicrosecond results to ones that are older than our universe (they probably came from another one).&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Data extrapolation&lt;/strong&gt;&lt;br/&gt;Currently we use the following techniques for speculatively expanding the resulting map:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;If all the samples for an AS end up in the same “best” PoP we consider that all IP ranges announced by that AS should go to that PoP.&lt;/li&gt;
&lt;li&gt;If AS has multiple “best” PoPs then we break it down into announced IP ranges. For each one we assume that if all measurements in a range end up at the same PoP we can extrapolate that choice to the whole range.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;This technique allows us to double our map coverage, make it more robust to changes, and generate a map using a smaller dataset.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Troubleshooting DNS map&lt;/strong&gt;&lt;br/&gt;Once a RUM-based map is constructed, it is crucial to be able to estimate how good it is by using a single value, something like an F1 score used for binary classification or BLEU score used for evaluating machine translation. That way, one can not only automatically prevent bad maps from going live, but also numerically compare the quality of different map iterations and construction algorithms.&lt;/p&gt;
&lt;p&gt;Another common approach for the map evaluation is &lt;a href=&quot;https://en.wikipedia.org/wiki/Training,_test,_and_validation_sets&quot;&gt;to test it against the subset of data that training process did not see&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For interactive slicing and dicing of data and ad-hoc troubleshooting, we map subnets back into the lat/long coordinates, aggregate their stats by &lt;a href=&quot;https://uber.github.io/h3/#/documentation/overview/use-cases&quot;&gt;h3 regions&lt;/a&gt; and then draw them with &lt;a href=&quot;https://kepler.gl/&quot;&gt;kepler.gl&lt;/a&gt;. This is very helpful to quickly eyeball maps that have low scores.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We went with h3 here instead of s2 because Kepler has built-in support for it, and generally h3 has simpler Python interface, therefore making it easier for us to experiment with visualizations.&lt;br/&gt;Whisper: also hexagons look cooler =)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The same approach can be used for visualizing current performance, week-over-week difference, difference between GeoIP database versions, and much more.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5278&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/17-screenshot2018-10-0321-00-57/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png&quot; data-orig-size=&quot;2618,1234&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;17-Screenshot+2018-10-03+21.00.57&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306&quot; class=&quot;alignnone size-medium wp-image-5278&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;306&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5278&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/17-screenshot2018-10-0321-00-57/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png&quot; data-orig-size=&quot;2618,1234&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;17-Screenshot+2018-10-03+21.00.57&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306&quot; class=&quot;alignnone size-medium wp-image-5278&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;306&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=650&amp;amp;h=306 650w, https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=1298&amp;amp;h=612 1298w, https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=600&amp;amp;h=283 600w, https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=768&amp;amp;h=362 768w, https://dropboxtechblog.files.wordpress.com/2018/10/17-screenshot2018-10-0321-00-57.png?w=1024&amp;amp;h=483 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;You can clearly see here where our PoPs are located. All of the big patches of blue and violet colors are getting their PoPs later this year or next year.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Another way of visualizing IP maps is to skip the whole GeoDNS mapping step and plot IP addresses on the 2D plane by &lt;a href=&quot;https://xkcd.com/195/&quot;&gt;mapping them on a space filling curve, e.g. Hilbert curve&lt;/a&gt;. One can also place additional data in the height and color dimensions. This approach will require some heavy regularization for it to be consumable by humans and even more &lt;a href=&quot;http://colorbrewer2.org/&quot;&gt;ColorBrewer2&lt;/a&gt; magic to be aesthetically pleasing.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RUM DNS at Dropbox&lt;/strong&gt;&lt;br/&gt;RUM-based DNS is an actively evolving project, and we have not shipped it to our main VIPs yet, but the data we’ve collected from our GSLB experiments shows that it is the only way we can properly utilize more than 25-30 PoPs. This project will be one of our top priorities in 2019, because even metrics collected from an early map prototypes show that it can improve effectiveness of our Edge network by up to 30% using RUM DNS.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5279&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/18-screenshot2018-10-05at5-33-21pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png&quot; data-orig-size=&quot;2694,624&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;18-Screen+Shot+2018-10-05+at+5.33.21+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151&quot; class=&quot;alignnone size-medium wp-image-5279&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;151&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5279&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/18-screenshot2018-10-05at5-33-21pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png&quot; data-orig-size=&quot;2694,624&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;18-Screen+Shot+2018-10-05+at+5.33.21+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151&quot; class=&quot;alignnone size-medium wp-image-5279&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;151&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=650&amp;amp;h=151 650w, https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=1300&amp;amp;h=302 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=600&amp;amp;h=139 600w, https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=768&amp;amp;h=178 768w, https://dropboxtechblog.files.wordpress.com/2018/10/18-screenshot2018-10-05at5-33-21pm.png?w=1024&amp;amp;h=237 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;It will also provide all the byproducts needed for the Explicit Loadbalancer… Speaking of which…&lt;/p&gt;
&lt;h3&gt;Explicit loadbalancing&lt;/h3&gt;
&lt;p&gt;A quick note about another more explicit way of routing users to PoPs. All these dances with guessing users’ IP address based on their resolver, GeoIP effectiveness, optimality of decisions made by BGP, etc. are all no longer necessary after a request arrives at the PoP. Because at that point in time, we know the users’ IP and even have an RTT measurement to them. At that point, we can route users on a higher level, like for example embedding a link to a specific PoP in the html, or handing off a different domain to a desktop client trying to download files.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The same IP→PoP map that was constructed for RUM DNS can be reused here, now exposed as an RPC service.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This loadbalancing method allows for a very granular traffic steering, even based on per-resource information, like user ID, file size, and physical location in our distributed storage. Another benefit is almost immediate draining of new connections, though references to resources that were once given out may live for extended periods of time.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Very complex schemes can be invented here, for example we can hand off whole URLs that&lt;br/&gt;in the domain name embed information for external DNS-based routing and at the same time embed information for internal routing inside path/queryargs, that will allow PoP to make more optimal routing decision. Another approach is to put that additional data as an opaque blob into the encrypted/signed cookie.&lt;br/&gt;All of these possibilities sound exciting, so &lt;a href=&quot;https://en.wikipedia.org/wiki/Second-system_effect&quot;&gt;care must be taken to not overcomplicate the system&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Explicit loadbalancing at Dropbox&lt;/strong&gt;&lt;br/&gt;We are not currently using this as an external loadbalancing method but instead rely on it for internal re-routing. The traffic team is actively preparing foundation for using it though.&lt;/p&gt;
&lt;h2&gt;Inside a point of presence&lt;/h2&gt;
&lt;p&gt;Now let’s discuss what happens when traffic actually arrives at the PoP.&lt;/p&gt;
&lt;h3&gt;Network architecture&lt;/h3&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5280&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/19-screenshot2018-10-09at1-23-46pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png&quot; data-orig-size=&quot;2406,1058&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;19-Screen+Shot+2018-10-09+at+1.23.46+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286&quot; class=&quot;alignnone size-medium wp-image-5280&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;286&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5280&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/19-screenshot2018-10-09at1-23-46pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png&quot; data-orig-size=&quot;2406,1058&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;19-Screen+Shot+2018-10-09+at+1.23.46+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286&quot; class=&quot;alignnone size-medium wp-image-5280&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;286&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=650&amp;amp;h=286 650w, https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=1300&amp;amp;h=572 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=600&amp;amp;h=264 600w, https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=768&amp;amp;h=338 768w, https://dropboxtechblog.files.wordpress.com/2018/10/19-screenshot2018-10-09at1-23-46pm.png?w=1024&amp;amp;h=450 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;PoPs consist of network equipment and sets of Linux servers. An average PoP has good connectivity: backbone, multiple transits, public and private &lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;peering&lt;/a&gt;. By increasing our network connectivity, we decrease the time packets spend in the public internet and therefore heavily decrease packet loss and improve TCP throughput. Currently about half of our traffic comes from peering.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Dropbox has an &lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;o&lt;/a&gt;&lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;pen&lt;/a&gt; &lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;p&lt;/a&gt;&lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;eering&lt;/a&gt; &lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;p&lt;/a&gt;&lt;a href=&quot;https://www.dropbox.com/peering&quot;&gt;olicy&lt;/a&gt;, so feel free to peer with us &lt;a href=&quot;https://www.peeringdb.com/asn/19679&quot;&gt;all around the world&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can read more about network setup in the &lt;a href=&quot;https://blogs.dropbox.com/tech/2017/06/evolution-of-dropboxs-edge-network/&quot;&gt;Evolution of Dropbox’s Edge Network&lt;/a&gt; post.&lt;/p&gt;
&lt;h3&gt;L4 loadbalancer&lt;/h3&gt;
&lt;p&gt;Our PoPs consist of multiple nginx boxes that are acting as L7 proxy and L4 loadbalancers (L4LBs) spreading load between them.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5281&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/20-screenshot2018-10-09at1-23-56pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png&quot; data-orig-size=&quot;2432,1212&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;20-Screen+Shot+2018-10-09+at+1.23.56+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324&quot; class=&quot;alignnone size-medium wp-image-5281&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;324&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5281&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/20-screenshot2018-10-09at1-23-56pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png&quot; data-orig-size=&quot;2432,1212&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;20-Screen+Shot+2018-10-09+at+1.23.56+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324&quot; class=&quot;alignnone size-medium wp-image-5281&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;324&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=650&amp;amp;h=324 650w, https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=1300&amp;amp;h=648 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=600&amp;amp;h=299 600w, https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=768&amp;amp;h=383 768w, https://dropboxtechblog.files.wordpress.com/2018/10/20-screenshot2018-10-09at1-23-56pm.png?w=1024&amp;amp;h=510 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;We use standard techniques to scale L4LBs and make them more resilient to failure: BGP ECMP, DSR, and consistent hashing. IPVS acts as our dataplane—a kernel-level loadbalancer with netlink API. IPVS kernel module provides us with state tracking, pluggable scheduling algorithms, and IP-in-IP encapsulation for DSR.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5282&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/21-screenshot2018-10-09at1-24-16pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png&quot; data-orig-size=&quot;2430,1180&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;21-Screen+Shot+2018-10-09+at+1.24.16+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316&quot; class=&quot;alignnone size-medium wp-image-5282&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;316&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5282&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/21-screenshot2018-10-09at1-24-16pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png&quot; data-orig-size=&quot;2430,1180&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;21-Screen+Shot+2018-10-09+at+1.24.16+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316&quot; class=&quot;alignnone size-medium wp-image-5282&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;316&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=650&amp;amp;h=316 650w, https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=1300&amp;amp;h=632 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=600&amp;amp;h=291 600w, https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=768&amp;amp;h=373 768w, https://dropboxtechblog.files.wordpress.com/2018/10/21-screenshot2018-10-09at1-24-16pm.png?w=1024&amp;amp;h=497 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;There are two main approaches for building high performance packet processors right now.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Kernel&lt;/strong&gt;&lt;br/&gt;Do packet processing early in network stack. This allows in-kernel data structures and TCP/IP parsing routines to be reused. For quite a while now, Linux has IPVS and &lt;a href=&quot;https://wiki.nftables.org/wiki-nftables/index.php/Load_balancing&quot;&gt;netfilter&lt;/a&gt; modules that can be used for connection-level loadbalancing. Recent kernels have eBPF/XDP combo which allows for a safer and faster way to process packets in kernel space. Tight coupling with kernel though has some downsides: upgrade of such LB may require reboot, very strict requirements on kernel version, and difficult integration testing.&lt;br/&gt;This approach is used by companies like &lt;a href=&quot;https://code.fb.com/open-source/open-sourcing-katran-a-scalable-network-load-balancer/&quot;&gt;Facebook&lt;/a&gt; and Dropbox.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Userspace&lt;/strong&gt;&lt;br/&gt;Create a virtual NIC PCIe device with SRIO-V, bypass the kernel through DPDK/netmap/etc, and get RX/TX queues in an application address space. This gives programmers full control over the network, but tcp/ip parsing, data structures, and even memory management must be done manually (or provided by a 3rd party library). Testing this kind of setup is also much easier.&lt;br/&gt;This approach is used by companies like &lt;a href=&quot;https://www.usenix.org/system/files/conference/nsdi16/nsdi16-paper-eisenbud.pdf&quot;&gt;Google&lt;/a&gt; and &lt;a href=&quot;https://githubengineering.com/glb-director-open-source-load-balancer/&quot;&gt;Github&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We currently use our homebrew version of consistent hashing module, but starting from linux-4.18 there is a Maglev Hash implementation: &lt;code&gt;[ip_vs_mh](https://github.com/torvalds/linux/blob/master/net/netfilter/ipvs/ip_vs_mh.c)&lt;/code&gt;. Compared to Ketama, Maglev Hash trades off some of the hash resiliency for more equal load distribution across backends and lookup speed.&lt;br/&gt;You can read more about Maglev Hash in the &lt;a href=&quot;https://www.usenix.org/system/files/conference/nsdi16/nsdi16-paper-eisenbud.pdf&quot;&gt;Maglev paper&lt;/a&gt; or &lt;a href=&quot;https://blog.acolyer.org/2016/03/21/maglev-a-fast-and-reliable-software-network-load-balancer/&quot;&gt;the morning paper&lt;/a&gt;, or go over a quick summary of &lt;a href=&quot;https://medium.com/@dgryski/consistent-hashing-algorithmic-tradeoffs-ef6b8e2fcae8&quot;&gt;consistent hash techniques from Damian Gryski&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We hash incoming packets based on 5-tuple (proto, sip, dip, sport, dport) which improves load distribution even further. This sadly means that any server-side caching becomes ineffective since different connections from the same client will likely end up on different backends. If our Edge did rely on local caching, we could use 3-tuple hashing mode where we would only hash on (protocol, sip, dip).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Another interesting fact is that L4LB will need to do some special handling of ICMP’s Packet Too Big replies, since they will originate from &lt;a href=&quot;https://tools.ietf.org/html/draft-v6ops-pmtud-ecmp-problem-00&quot;&gt;a different host and therefore can’t use plain outer header hashing&lt;/a&gt;, but instead must be hashed based on the tcp/ip headers in the ICMP packet payload. Cloudflare uses another approach for solving this problem with its &lt;code&gt;[pmtud](https://github.com/cloudflare/pmtud)&lt;/code&gt;: broadcast incoming ICMP packets to all the boxes in the PoP. This can be useful if you do not have a separate routing layer and are ECMP’ing packets straight to your L7 proxies.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Control plane for L4LBs is currently written in Go and closely integrated with our infrastructure and responsible for online reconfiguration, BGP connectivity, and health-checking of backends.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Health checks on any encapsulating DSR-based L4LB is very tricky. Special care must be taken to run health checks through the same packet encapsulation process as data itself is going, otherwise it is easy to start sending traffic to the box that does not have a properly set up tunnel yet.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Key properties of the L4LBs:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;They are resilient and horizontally scalable. Since L4LB does not terminate TCP connection and relies on the consistent hashing for connection scheduling, we can safely add/remove L4LBs because all of them will consistently route packets to the right destination&lt;/li&gt;
&lt;li&gt;Graceful removal/addition of L7 proxies. Since L4LBs also have a connection tracking table even if the set of backends changes, they will continue routing existing connections to them, which is the key distinguishing feature from plain ECMP&lt;/li&gt;
&lt;li&gt;Allows for horizontal scaling of L7 proxies. L4LB is fast enough to be network bounded, which means that we can scale L7 proxies until we have sufficient bandwidth&lt;/li&gt;
&lt;li&gt;Supports any IP-based protocol&lt;/li&gt;
&lt;li&gt;Supports any hashing algorithm. Maglev? Rendezvous? We can quickly experiment with any of them&lt;/li&gt;
&lt;li&gt;Supports any hashing policy. 3-tuple? 5-tuple? QUIC Connection ID? Easy!&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Not to mention that now we can convert basically any server in production into a high performance loadbalancer just by running a binary on it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As for the future work, we have a number of things we want to try. First, replace the routing dataplane with either a DPDK or XDP/eBPF solution, or possibly just integrating an open-source project like &lt;a href=&quot;https://github.com/facebookincubator/katran&quot;&gt;Katran&lt;/a&gt;. Second, we currently use IP-in-IP for packet encapsulation and it’s about time we switch it to something more modern like &lt;a href=&quot;https://lwn.net/Articles/615044/&quot;&gt;GUE&lt;/a&gt; which is way more NIC-friendly in terms of steering and offload support.&lt;/p&gt;
&lt;h3&gt;L7 proxies (nginx)&lt;/h3&gt;
&lt;/blockquote&gt;
&lt;p&gt;Having PoPs close to our users decreases the time needed for both TCP and TLS handshakes, which essentially leads to a faster TTFB. But owning this infrastructure instead of renting it from a CDN provider allows us to easily experiment and iterate on emerging technologies that optimize latency and throughput sensitive workloads even further. Let’s discuss some of them.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCP&lt;/strong&gt;&lt;br/&gt;Starting from the lowest layers of the stack here is a &lt;a href=&quot;https://lwn.net/Articles/564825/&quot;&gt;Fair Queueing packet scheduler&lt;/a&gt; example: not only because it introduces fairness between flows, but also adds “pacing” to the upper level protocol. Let’s look at some specific examples.&lt;/p&gt;
&lt;p&gt;Without fair queueing, packets will be dumped to the network as they arrive from the TCP stack, which will lead to the huge Head-of-Line blocking further down network stack.&lt;/p&gt;
&lt;p&gt;With FQ packets of different flows are interleaved and one flow no longer blocks another.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5283&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/22-screenshot2018-10-0401-49-34/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png&quot; data-orig-size=&quot;2348,732&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;22-Screenshot+2018-10-04+01.49.34&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203&quot; class=&quot;alignnone size-medium wp-image-5283&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;203&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5283&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/22-screenshot2018-10-0401-49-34/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png&quot; data-orig-size=&quot;2348,732&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;22-Screenshot+2018-10-04+01.49.34&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203&quot; class=&quot;alignnone size-medium wp-image-5283&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;203&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=650&amp;amp;h=203 650w, https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=1300&amp;amp;h=406 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=600&amp;amp;h=187 600w, https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=768&amp;amp;h=239 768w, https://dropboxtechblog.files.wordpress.com/2018/10/22-screenshot2018-10-0401-49-34.png?w=1024&amp;amp;h=319 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Without pacing, if you want to send multiple megabytes of data to the user, and current TCP congestion window allows that, then you’ll just dump thousands of packets onto the underlying network stack.&lt;/p&gt;
&lt;p&gt;With pacing, TCP will hint packet scheduler a desired sending rate (based on the congestion window and rtt) and then scheduler is responsible for submitting packets to the network stack every once in a while to maintain that steady sending rate:&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5284&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/23-screenshot2018-10-0401-49-15/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png&quot; data-orig-size=&quot;2266,732&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;23-Screenshot+2018-10-04+01.49.15&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210&quot; class=&quot;alignnone size-medium wp-image-5284&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;210&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5284&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/23-screenshot2018-10-0401-49-15/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png&quot; data-orig-size=&quot;2266,732&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;23-Screenshot+2018-10-04+01.49.15&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210&quot; class=&quot;alignnone size-medium wp-image-5284&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;210&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=650&amp;amp;h=210 650w, https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=1300&amp;amp;h=420 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=600&amp;amp;h=194 600w, https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=768&amp;amp;h=248 768w, https://dropboxtechblog.files.wordpress.com/2018/10/23-screenshot2018-10-0401-49-15.png?w=1024&amp;amp;h=331 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;FQ comes at a relatively low CPU cost of around 5%, but it essentially makes routers and shapers along the path way happier, which leads to lower packet loss and less &lt;a href=&quot;https://www.bufferbloat.net/projects/bloat/wiki/What_can_I_do_about_Bufferbloat/&quot;&gt;bufferbloat&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Fun fact: when we first deployed FQ we’ve noticed that all the buffer drops on our Top-of-the-Rack (ToR) switches had gone away. Even though they were very beefy boxes capable of handling terabits of traffic it seems like they had shallow buffers and were susceptible to packet drop during microbursts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is only one of the features that new Linux kernels provide, including but not limited to: &lt;a href=&quot;https://lwn.net/Articles/542642/&quot;&gt;Tail Loss Probe&lt;/a&gt;, &lt;a href=&quot;https://lwn.net/Articles/507065/&quot;&gt;TCP Small Queues&lt;/a&gt;, &lt;code&gt;[TCP_NOTSENT_LOWAT](https://lwn.net/Articles/560082/)&lt;/code&gt;, &lt;a href=&quot;https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=eb9fae328faff9807a4ab5c1834b19f34dd155d4&quot;&gt;RACK&lt;/a&gt;, etc.&lt;/p&gt;
&lt;p&gt;We work on network- and transport-level optimizations from time to time—and when we do, it’s super fun and usually involves some amount of Wiresharking and &lt;a href=&quot;https://storage.googleapis.com/pub-tools-public-publication-data/pdf/41316.pdf&quot;&gt;packetdril&lt;/a&gt;&lt;a href=&quot;https://storage.googleapis.com/pub-tools-public-publication-data/pdf/41316.pdf&quot;&gt;ling&lt;/a&gt;. For example, one upcoming project for the Traffic team is to evaluate &lt;a href=&quot;https://datatracker.ietf.org/meeting/102/materials/slides-102-iccrg-an-update-on-bbr-work-at-google-00&quot;&gt;BBR v2&lt;/a&gt; (once it is ready for public testing).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TLS&lt;/strong&gt;&lt;br/&gt;All connections to Dropbox are protected by TLS that encrypts and authenticates data in transit over the public internet. We also re-encrypt data and send it over an encrypted and mutually authenticated channel over our backbone network.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Since we use the same TLS stack internally for gRPC, we are very invested in its performance, especially around the TLS handshake part, where we make sure our libraries are using the most &lt;a href=&quot;https://boringssl.googlesource.com/boringssl/+/488ca0eacefd3bc8c7570e8ed5053f4a49451419&quot;&gt;efficient hardware instructions possible&lt;/a&gt;, and for large file transfers, where we try to &lt;a href=&quot;https://github.com/grpc/grpc/pull/14060&quot;&gt;minimize&lt;/a&gt; &lt;a href=&quot;https://github.com/grpc/grpc/pull/14060&quot;&gt;the&lt;/a&gt; &lt;a href=&quot;https://github.com/grpc/grpc/pull/14060&quot;&gt;number of memory copies that they perform&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Our TLS setup is relatively simple: BoringSSL, TLS tickets with frequently rotated ephemeral keys, preferring AEAD ciphersuites with ChaCha20/Poly1305 for older hardware (we are very close the &lt;a href=&quot;https://github.com/cloudflare/sslconfig/blob/master/conf&quot;&gt;Cloudflare’s TLS config&lt;/a&gt;.) We are also in the process of rolling out the RFC version of the TLS 1.3 across our Edge network.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As for the future plans: as our boxes get closer to 100Gbit we are starting to look towards &lt;code&gt;[TCP_ULP](https://github.com/torvalds/linux/blob/master/Documentation/networking/tls.txt)&lt;/code&gt; and how we can add support for it to our software stack.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;HTTP&lt;/strong&gt;&lt;br/&gt;The main job of the nginx proxies on the Edge is to maintain keep alive connections to the backends in data center over our fat-long-pipe backbone. This essentially means that we have a set of hot connections that are never constrained by CWND on an almost lossless link.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5285&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/24-screenshot2018-10-09at1-24-32pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png&quot; data-orig-size=&quot;2454,978&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;24-Screen+Shot+2018-10-09+at+1.24.32+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259&quot; class=&quot;alignnone size-medium wp-image-5285&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;259&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5285&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/24-screenshot2018-10-09at1-24-32pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png&quot; data-orig-size=&quot;2454,978&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;24-Screen+Shot+2018-10-09+at+1.24.32+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259&quot; class=&quot;alignnone size-medium wp-image-5285&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;259&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=650&amp;amp;h=259 650w, https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=1300&amp;amp;h=518 1300w, https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=600&amp;amp;h=239 600w, https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=768&amp;amp;h=306 768w, https://dropboxtechblog.files.wordpress.com/2018/10/24-screenshot2018-10-09at1-24-32pm.png?w=1024&amp;amp;h=408 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;blockquote&gt;
&lt;p&gt;Very quick note about how we build and deploy nginx: like everything else in Dropbox, we use Bazel to reproducibly and hermetically build a static nginx binary, copy over configs, package all of this into a squshfs, use torrent to distribute resulting package to all the servers, mount it (read-only), switch symlink, and finally run nginx upgrade.&lt;br/&gt;We probably should write a blog post on it too, since it is very simple and very efficient.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Our nginx configuration is static and bundled with the binary therefore we need a way to dynamically configure some aspects of the configuration without full redeploy. Here is where &lt;strong&gt;Upstream Management Service&lt;/strong&gt; kicks in. UMS is basically a look-aside external loadbalancer for nginx which allows us to reconfigure upstreams on the fly. One can create such system by:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Regenerating config for nginx and hot reloading it. Sadly, when used extensively this approach negatively impacts connection reuse and increases memory pressure&lt;/li&gt;
&lt;li&gt;Using &lt;a href=&quot;https://nginx.org/en/docs/http/ngx_http_api_module.html&quot;&gt;configuration API&lt;/a&gt; from the nginx plus&lt;/li&gt;
&lt;li&gt;Using standalone sidecar proxy on the same box, but that will lead to major increase in CPU/MEM resource usage&lt;/li&gt;
&lt;li&gt;Using Lua APIs or custom C modules&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Because we are already relying on the Lua there, we’ve built a data plane for UMS with it by combining a &lt;code&gt;balancer_by_lua_block&lt;/code&gt; directive and &lt;code&gt;ngx.timer.every&lt;/code&gt; hook that periodically fetches configuration from control plane via https.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A nice side effect of writing the balancer module in Lua: we can now quickly experiment with different loadbalancing algorithms before writing them in C. The downside of Lua is that it is tricky to test, especially in a company where Lua is not one of the primary languages.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5286&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/25-screenshot2018-10-09at1-24-46pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png&quot; data-orig-size=&quot;2448,1124&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;25-Screen+Shot+2018-10-09+at+1.24.46+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298&quot; class=&quot;alignnone size-medium wp-image-5286&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;298&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5286&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/25-screenshot2018-10-09at1-24-46pm/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png&quot; data-orig-size=&quot;2448,1124&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;25-Screen+Shot+2018-10-09+at+1.24.46+PM&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298&quot; class=&quot;alignnone size-medium wp-image-5286&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;298&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=650&amp;amp;h=298 650w, https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=1298&amp;amp;h=596 1298w, https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=600&amp;amp;h=275 600w, https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=768&amp;amp;h=353 768w, https://dropboxtechblog.files.wordpress.com/2018/10/25-screenshot2018-10-09at1-24-46pm.png?w=1024&amp;amp;h=470 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;Control plane for UMS is a Golang service that gets information from our service discovery, monitoring system, and manual overrides, then aggregates and exposes it as a REST endpoint that nginx then accesses through a simple &lt;code&gt;httpc:request_uri&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;gRPC&lt;/strong&gt;&lt;br/&gt;Nginx is terminating HTTP, HTTP/2, and &lt;a href=&quot;http://nginx.org/en/docs/http/ngx_http_grpc_module.html&quot;&gt;gRPC connections&lt;/a&gt; on the Edge. Ability to proxy gRPC through our stack allows us to experiment with our apps talking gRPC directly to the application servers. Being able to do that streamlines development process and unifies the way services communicate externally and internally.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We are looking how we can use gRPC for all APIs. For the APIs that we can’t switch to gRPC, like web, we consider converting all HTTP requests into the gRPC method calls right at the Edge.&lt;/p&gt;
&lt;h2&gt;Wrap up and future blog posts&lt;/h2&gt;
&lt;/blockquote&gt;
&lt;p&gt;All of this pretty much covers the external part of Traffic Infrastructure, but there is another half that is not directly visible to our users: gRPC-based service mesh, scalable and robust service discovery, and a distributed filesystem for config distribution with notification support. All of that is coming soon in the next series of blog posts.&lt;/p&gt;
&lt;h2&gt;We’re hiring!&lt;/h2&gt;
&lt;p&gt;Do you like traffic-related stuff? Dropbox has a globally distributed Edge network, terabits of traffic, and millions of requests per second. All of which is managed by a small team in Mountain View, CA.&lt;/p&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5287&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/26-screenshot2018-10-0318-04-58/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png&quot; data-orig-size=&quot;2076,1164&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;26-Screenshot+2018-10-03+18.04.58&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364&quot; class=&quot;alignnone size-medium wp-image-5287&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;364&quot;/&gt;&lt;/p&gt;&lt;noscript&gt;
&lt;p&gt;&lt;img data-attachment-id=&quot;5287&quot; data-permalink=&quot;https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/26-screenshot2018-10-0318-04-58/&quot; data-orig-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png&quot; data-orig-size=&quot;2076,1164&quot; data-comments-opened=&quot;1&quot; data-image-meta=&quot;{&amp;quot;aperture&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;credit&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;camera&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;caption&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;created_timestamp&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;copyright&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;focal_length&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;iso&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;shutter_speed&amp;quot;:&amp;quot;0&amp;quot;,&amp;quot;title&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;orientation&amp;quot;:&amp;quot;0&amp;quot;}&quot; data-image-title=&quot;26-Screenshot+2018-10-03+18.04.58&quot; data-image-description=&quot;&quot; data-medium-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364&quot; data-large-file=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364&quot; class=&quot;alignnone size-medium wp-image-5287&quot; src=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364&quot; alt=&quot;&quot; width=&quot;650&quot; height=&quot;364&quot; srcset=&quot;https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=650&amp;amp;h=364 650w, https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=1298&amp;amp;h=728 1298w, https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=600&amp;amp;h=336 600w, https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=768&amp;amp;h=431 768w, https://dropboxtechblog.files.wordpress.com/2018/10/26-screenshot2018-10-0318-04-58.png?w=1024&amp;amp;h=574 1024w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot;/&gt;&lt;/p&gt;
&lt;/noscript&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.dropbox.com/jobs/listing/1233364?gh_src=f80311fa1&quot;&gt;Traffic team is hiring both SWEs and SREs&lt;/a&gt; to work on TCP/IP packet processors and loadbalancers, HTTP/2 proxies, and our internal gRPC-based service mesh. Not your thing? Dropbox is also hiring for &lt;a href=&quot;https://www.dropbox.com/jobs/teams/engineering?gh_src=f80311fa1#open-positions&quot;&gt;a wide variety of engineering positions in San Francisco, New York, Seattle, Tel Aviv, and other offices around the world&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Acknowledgments&lt;/h2&gt;
&lt;p&gt;This article describes the work done by many people over a course of multiple years. Thanks to all current and past traffic team members: all of you helped make Dropbox faster and more reliable:&lt;br/&gt;Ashwin Amit, Brian Pane, Dmitry Kopytkov, Dzmitry Markovich, Eduard Snesarev, Haowei Yuan, John Serrano, Jon Lee, Kannan Goundan, Konstantin Belyalov, Mario Brito, Oleg Guba, Patrick Lee, Preslav Le, Ross Delinger, Ruslan Nigmatullin, Vladimir Sheyda, Yi-Shu Tai.&lt;/p&gt;
</description>
<pubDate>Wed, 10 Oct 2018 16:37:32 +0000</pubDate>
<dc:creator>el_duderino</dc:creator>
<og:title>Dropbox traffic infrastructure: Edge network</og:title>
<og:url>https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/</og:url>
<og:image>https://dropboxtechblog.files.wordpress.com/2018/10/01-featured-image2x.png?w=600</og:image>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://blogs.dropbox.com/tech/2018/10/dropbox-traffic-infrastructure-edge-network/</dc:identifier>
</item>
<item>
<title>Rust has a static “garbage collector”</title>
<link>https://words.steveklabnik.com/borrow-checking-escape-analysis-and-the-generational-hypothesis</link>
<guid isPermaLink="true" >https://words.steveklabnik.com/borrow-checking-escape-analysis-and-the-generational-hypothesis</guid>
<description>&lt;time datetime=&quot;2018-10-10&quot; class=&quot;article_time&quot;&gt;October 10, 2018&lt;/time&gt;&lt;p&gt;There’s a fairly common argument that pops up on programming forums, and it’s about the nature of what “garbage collection” means. In the research world, &lt;a href=&quot;http://www.memorymanagement.org/glossary/g.html#term-garbage-collection&quot;&gt;this&lt;/a&gt; is what GC means:&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;10&quot;&gt;
&lt;p&gt;Garbage collection (GC), also known as automatic memory management, is the automatic recycling of dynamically allocated memory(2). Garbage collection is performed by a garbage collector which recycles memory that it can prove will never be used again. Systems and languages which use garbage collection can be described as garbage-collected.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Historically, there has been two major forms of GC: reference counting, and tracing. The argument happens because, with the rise of tracing garbage collectors in many popular programming languages, for many programmers, “garbage collection” is synonymous with “tracing garbage collection.” For this reason, I’ve been coming around to the term “automatic memory management”, as it doesn’t carry this baggage.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;I’ve often seen people make statements like this one, from the Rust subreddit this morning:&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;7&quot;&gt;
&lt;p&gt;Manual memory management requires more work than garbage collected. Its a trade off of course to be more performant or use lower resources. When and where should Rust be used or not used according to you?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;While I don’t &lt;em&gt;completely&lt;/em&gt; disagree with this sentiment, it’s also never quite sat right with me. Yes, Rust is a bit harder &lt;em&gt;at the start&lt;/em&gt;, but once you get over a hump, I don’t generally find writing Rust to be significantly harder than using a GC’d language. I’ve been trying to figure out why that is.&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;11&quot;&gt;
&lt;p&gt;The idea that it’s easy for me because I’m an amazing programmer is not an answer I’m willing to accept here, both because I don’t think that’s particularly true, but also because I’ve seen Rust have a pretty wide appeal to a fairly large group of people, and they can’t &lt;em&gt;all&lt;/em&gt; be amazing programmers. It’s just math.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;p&gt;My first clue comes from my own programming history. Some of my first programming languages were C, C++, and Java. These languages are &lt;em&gt;statically&lt;/em&gt; typed, that is, they require you to declare (or have inferred) the type of variables up front, and check that the type holds. That is, they’re known at compile time. I can remember the first time I came across Perl, and the concept of dynamic typing. Wow, this is &lt;em&gt;so much easier&lt;/em&gt;! I could do &lt;em&gt;anything&lt;/em&gt;. From then on, I pretty much focused on dynamically typed languages.&lt;/p&gt;
&lt;p&gt;While doing my work in Ruby, one thing I worked hard on was testing. Rubyists are big on tests; with a language that’s &lt;em&gt;so&lt;/em&gt; dynamic, you really need them to make sure your stuff is working properly.&lt;/p&gt;
&lt;p&gt;When I decided to start writing a bunch of Rust, I had to get used to using static types again. But I also wrote less tests. Many of the things that I was testing for were things that were taken care of by the type system. In other words, my tests were sort of like “dynamic type checking.” Instead of being checked by a compiler at compile-time, these behaviors of my system were checked at run time, by my tests. This isn’t a novel insight; many others have stated this relationship between tests and types.&lt;/p&gt;
&lt;p&gt;We often acknowledge that writing tests is a &lt;em&gt;skill&lt;/em&gt;. When I first started with Ruby, I was bad at testing. I got better with practice. But I don’t think we collectively acknowledge that working with types is &lt;em&gt;also&lt;/em&gt; a skill. At first, it’s tough. But as you develop those skills, it becomes easier and easier.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;Let’s switch gears a little, to garbage collection.&lt;/p&gt;
&lt;p&gt;In garbage collection research, there’s a term, the &lt;a href=&quot;http://www.memorymanagement.org/glossary/g.html#term-generational-hypothesis&quot;&gt;“generational hypothesis”&lt;/a&gt;. It states&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;6&quot;&gt;
&lt;p&gt;In most cases, young objects are much more likely to die than old objects.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If that succinct description doesn’t make sense, here’s a slightly longer one: there’s a kind of GC called a “generational garbage collector.” There are a few options when implementing one, but I’m going to describe one form in particular. What it does is this: new objects are allocated in a section of memory called the “nursery,” an analogy to where human children go shortly after they’re born. When the GC runs, it looks through the nursery. Any objects that survive are promoted to a new section of memory. Some collectors may have multiple of these “generations.” The generational hypothesis states that most objects die in the nursery. The GC can then take advantage of this fact by scanning the nursery more often than the older generations, which allows you to not scan every object every collection.&lt;/p&gt;
&lt;p&gt;Empirically, the generational hypothesis is true. But I haven’t seen much investigation into &lt;em&gt;why&lt;/em&gt; it is true. That said, I’m also not a GC expert. If you have references here, please get in touch.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;There’s another concept related to GCs called “escape analysis.” This is an optimization which several languages do. The idea is fairly straightforward: if something is declared in a function, and never leaves (“escapes”) that function, you don’t need to put the object on the heap, you can stack allocate it instead.&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; readability=&quot;6.9700598802395&quot;&gt;
&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;“It isn’t that the generational hypothesis isn’t true for Go, it’s just that the young objects live and die young on the stack.The result is that generational collection is much less effective than you might find in other managed runtime languages” &lt;a href=&quot;https://twitter.com/hashtag/golang?src=hash&amp;amp;ref_src=twsrc%5Etfw&quot;&gt;#golang&lt;/a&gt; &lt;a href=&quot;https://t.co/aXEleY2yQ6&quot;&gt;https://t.co/aXEleY2yQ6&lt;/a&gt;&lt;/p&gt;
— Dave Cheney (@davecheney) &lt;a href=&quot;https://twitter.com/davecheney/status/1019430967054819328?ref_src=twsrc%5Etfw&quot;&gt;July 18, 2018&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;If you squint a little at this tweet, you can almost think of escape analysis as a &lt;em&gt;stronger&lt;/em&gt; version of the generational hypothesis. The claim is that escape analysis applies so often to Go code that any object that reaches the heap is effectively in the older generation.&lt;/p&gt;
&lt;p&gt;Why is this? I’m not totally sure, but I have a feeling that is has to do with the core concept of functions and a call stack. Additionally, the value/reference type distinction. The more you program with values in functions, rather than references, the less likely objects are to escape past the call stack. in generational hypothesis terms, values allocated lower in the call stack tend to live longer, and ones higher in the call stack tend to live shorter.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;There’s an interesting area of type research called “gradual typing.” The idea is that typing is not an either/or, static vs dynamic. It’s a spectrum. Some things are statically typed, some things are dynamically typed, and it all works together. The idea is that you can start off writing things that are dynamically typed, and then once you’re more sure of the behaviors you want, you can start to statically type them.&lt;/p&gt;
&lt;p&gt;TypeScript is a great example:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;prettyprint lang-ts&quot;&gt;// person is dynamically typed
function greeter(person) {
    return &quot;Hello, &quot; + person;
}

// person is statically typed
function greeter(person: string) {
    return &quot;Hello, &quot; + person;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;TypeScript is really, really growing in popularity. I think one of those factors is the gradual typing; you can slowly work on your type-using skills, and you don’t have to use them everywhere.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;Interestingly enough, many JIT compilers rely on the fact that in practice, programmers tend to pass the same types of things to functions, even if the language is dynamically typed. This is called &lt;a href=&quot;https://hacks.mozilla.org/2017/02/a-crash-course-in-just-in-time-jit-compilers/&quot;&gt;“type specialization”&lt;/a&gt;. This is similar to the generational hypothesis to me, but in a different domain. And as I said about it, empirically, this is true. But I haven’t seen much investigation into &lt;em&gt;why&lt;/em&gt; it is true. That said, I’m also not a JIT expert. If you have references here, please get in touch.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;So what’s all this have to do with Rust?&lt;/p&gt;
&lt;p&gt;Similar to the dichotomy between static and dynamic typing, I think that Rust is proving out a new niche in the concept of garbage collection. That is, historically, we think of GC as something &lt;em&gt;dynamic&lt;/em&gt;, that is, it involves a run-time component that does stuff at runtime. However, the idea of automatic memory management doesn’t &lt;em&gt;inherently&lt;/em&gt; mean that it has to execute at runtime.&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;12&quot;&gt;
&lt;p&gt;I should mention that C++ paved a lot of the path here too, so maybe the above is worded too strongly. I do think that Rust is &lt;em&gt;significantly&lt;/em&gt; different here, but you may not. If you don’t, please replace the above with “Rust is continuing to prove out a niche pioneered by C++,” and that’s fine by me.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This also opens up two more things about why I don’t feel that “Rust is too hard and so you should use a GC’d language when you can afford it.” First of all, Rust’s strong, static checking of memory provides me a similar peace of mind to a runtime GC. To make an analogy to types and tests, when I program in a language like C, I have to think a lot about the details of memory management, because I don’t really have anything at all checking my work. Its memory management is completely unchecked, similar to (compile time) types in a Ruby program. But with automatic memory management, I don’t have to worry about this, as the memory management system has my back. I won’t get a use after free, I won’t get dangling pointers.&lt;/p&gt;
&lt;p&gt;I further think this line of thought is on the right track because lifetimes are generic types, and the ownership system is affine types.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;This also relates to the “difficulty” of Rust. In the same way that learning to use static types takes time, learning to use static memory management takes time. But once you’ve developed that skill, you can rely on those static checks to free up your brain to instead focus on your program itself, and not the house-keeping tasks that these systems are checking for.&lt;/p&gt;
&lt;p&gt;And, just like with static types, different people will make different choices of tradeoff for effort. Some people refuse to use dynamically typed languages, because they’ve invested the time into effectively using static types and prefer to have these things checked. Others don’t want to waste time on learning these kinds of things, and are more focused on shipping things. They have their own set of skills to ensure reliability. I think both approaches make sense depending on what you’re doing.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;In some ways, you can think of the borrow checker as an even stronger form of escape analysis; that is, instead of saying “oh, this escapes, so allocate it on the heap”, the borrow checker says “oh, this escapes, so error at compile time.” For example, this code:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;prettyprint lang-rust&quot;&gt;fn bar() -&amp;gt; i32 {
    5
}

fn foo() -&amp;gt; &amp;amp;'static i32 {
    &amp;amp;bar()
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;gives this error:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;prettyprint lang-text&quot;&gt;error[E0716]: temporary value dropped while borrowed
 --&amp;gt; src/lib.rs:6:6
  |
6 |     &amp;amp;bar()
  |      ^^^^^ creates a temporary which is freed while still in use
7 | }
  | - temporary value is freed at the end of this statement
  |
  = note: borrowed value must be valid for the static lifetime...
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code class=&quot;prettyprint&quot;&gt;bar()&lt;/code&gt; produces a value, and so &lt;code class=&quot;prettyprint&quot;&gt;&amp;amp;bar()&lt;/code&gt; would produce a reference to a value on &lt;code class=&quot;prettyprint&quot;&gt;foo()&lt;/code&gt;‘s stack. Returning it would be a dangling pointer. In a system without automatic memory management, this would cause a dangling pointer. In a system with dynamic automatic memory management, this would heap allocate the return value of &lt;code class=&quot;prettyprint&quot;&gt;bar()&lt;/code&gt;, so that everything works out. But Rust’s automatic memory management is fully static, and so it has to error in this situation.&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;Similar to gradual typing, this means that you can also have gradual GC. For example, Rust does have &lt;code class=&quot;prettyprint&quot;&gt;Rc&amp;lt;T&amp;gt;&lt;/code&gt; and &lt;code class=&quot;prettyprint&quot;&gt;Arc&amp;lt;T&amp;gt;&lt;/code&gt;, which are reference-counted types, clearly GC according to the literature. This moves the memory management from static to dynamic.&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;6.047619047619&quot;&gt;
&lt;p&gt;I don’t think that the transition here is as seamless as in TypeScript, though that’s a whole other post… additionally, &lt;a href=&quot;https://blog.acolyer.org/2016/02/05/is-sound-gradual-typing-dead/&quot;&gt;it’s not like gradual typing is perfect&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;p&gt;One last thing before I go: the lifetime elision rules are also an empiric statement about how programmers write code, but I’m not sure what the underlying reasons are. From &lt;a href=&quot;https://github.com/rust-lang/rfcs/blob/master/text/0141-lifetime-elision.md&quot;&gt;the RFC&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote class=&quot;large&quot; readability=&quot;8&quot;&gt;
&lt;p&gt;We found that of the 169 lifetimes that currently require annotation for libstd, 147 would be elidable under the new rules, or 87%.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If it were 100%, we could never require you to write annotations. But with 87%, we can let you not write annotations, and most code that follows most normal coding practices never needs to write explicit lifetimes.&lt;/p&gt;


&lt;p&gt;686&lt;/p&gt;
&lt;p&gt;Kudos&lt;/p&gt;


&lt;p&gt;686&lt;/p&gt;
&lt;p&gt;Kudos&lt;/p&gt;
</description>
<pubDate>Wed, 10 Oct 2018 16:05:09 +0000</pubDate>
<dc:creator>steveklabnik</dc:creator>
<og:title>Rust has a static garbage collector • Steve Klabnik</og:title>
<og:type>article</og:type>
<og:description>There’s a fairly common argument that pops up on programming forums, and it’s about the nature of what “garbage collection” means. In the research world, this is what GC means: Garbage collection (GC), also known as automatic memory management, is... | Steve Klabnik | “The most violent element in society is ignorance.” - Emma Goldman</og:description>
<og:image>[]</og:image>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://words.steveklabnik.com/borrow-checking-escape-analysis-and-the-generational-hypothesis</dc:identifier>
</item>
</channel>
</rss>