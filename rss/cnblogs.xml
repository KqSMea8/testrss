<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>大兴公寓的那场火，烧毁了我的所有 - 闰土少年</title>
<link>http://www.cnblogs.com/running-runtu/p/7890885.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/running-runtu/p/7890885.html</guid>
<description>&lt;h2&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/701424/201711/701424-20171124153246187-1831425135.png&quot; alt=&quot;&quot;/&gt;&lt;/h2&gt;
&lt;h2&gt; &lt;/h2&gt;
&lt;h2 id=&quot;articleHeader0&quot;&gt;前言&lt;/h2&gt;

&lt;p&gt;前些日子我还想着如果有时间，我一定要去北京的西二旗看看。今天我就听说了大兴火灾，这场火势蔓延到了整个北京城的上空，同时也断送了多少北漂人的梦想。从此，北京地铁4号线，西红门站，又多了一个悲伤的故事。&lt;/p&gt;
&lt;p&gt;接下来，正文从这开始～&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/701424/201711/701424-20171124153257687-1245802014.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; 今天看到朋友圈到处是这些北漂族大清早拖着箱子离去的视频，恐怕他们也没想到，2017年的冬天竟然这样寒冷，暖气片的热度还没有温存，又不得不再找下一个栖息之所。&lt;/p&gt;
&lt;p&gt;北京有关部门发出通知，给三天时间搬家，否则停电停水停暖，然后是各种整顿各种拆，各种安全大检查。搬迁的不止聚福缘这个公寓，北京所有的公寓都要搬迁。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/701424/201711/701424-20171124153327171-317040744.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;突然涌现出这么多浩浩荡荡搬家的人，租房市场供需不对等，没有足够的房子来容纳这么多人，然后房东坐地起价。&lt;/p&gt;
&lt;p&gt;我在北京的朋友说在他去的半小时之内房租直接涨了500，之前一间卧室1000左右，现在直接涨到2000多，一套房子下来，租金直逼4、5000，像北漂一族好多都是一个人养活一个家，无力支付这样高额的房租。&lt;/p&gt;
&lt;p&gt;大兴火灾后的这一个星期，北京异常的寒冷，政府一声令下，整个在北京寒风中拖家带口的异乡人，给人一种说不出的凄凉。&lt;/p&gt;
&lt;p&gt;一场大火多少人没了亲人，现在又上万人没了住所。这个冬天的夜晚北京正在上演上万人大迁徙，迁去哪里他们不知道，也许是下一个路口，也许是露宿街头。&lt;/p&gt;
&lt;p&gt;这也许就是现实，赤裸裸的，一丝不挂。此时也许只有梦中的老家可以给予一丝丝温暖。&lt;/p&gt;
&lt;p&gt;这场火让我一个在北京的同行朋友意识到，来北京十几年，自己在这座城市没有根基。火灾没有带走他们的生命，但将会带走他们的生活。“如果老家的收入能达到北京的70%，我干嘛不回去？”但现实是，回乡的收入可能仅为目前收入的三分之一。另外，回乡意味着他闯荡北京这十几年一朝清零，从头开始。但他也清楚，如果留在北京，未来只能退到六环之外找房安身。&lt;/p&gt;
&lt;p&gt;死难者离开了这个世界，活下来的人却要退到六环以外，还有人无路可退、不得不离开北京。&lt;/p&gt;
&lt;p&gt;有一句话讲，谁也不知道未来和意外谁先到来。这也成为保险行业人员最为诱人的话术。不曾想，大兴公寓一场大火，意外比未来来得更快。&lt;/p&gt;
&lt;p&gt;面对不期而遇的意外，对于有些人，生命此刻是一场狂欢的旅行，而对于有些人，生命此刻是一趟炼狱与修行。这就是世界的多样性，我们无法拒绝，只好适应。&lt;/p&gt;
&lt;p&gt;也许在不久的将来，好多人都要打道回府，老家工资低，消费却是高。忽然觉得力不从心，大城市容纳不下，老家回不成，尴尬至极。&lt;/p&gt;
&lt;p&gt;今天在公交车上我还跟我们公司的PHP闲聊，说我们生活在均价8、9000一平米的城市里，每月到手的工资才不到3000块钱，这是何等的讽刺。&lt;/p&gt;
&lt;p&gt;留不下的大城市，回不去的故乡......&lt;/p&gt;
&lt;p&gt;北漂不易，且行且珍惜！&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/701424/201711/701424-20171124153351937-851572286.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;从2008北京欢迎你，到2016北京考验你，再到2017北京驱赶你，最后2018北京看不见你。感谢帝都，让我看到了生存的艰辛。&lt;/p&gt;
&lt;p&gt;为此，我想说的是，努力不一定给你带来巨大的财富和声誉，但心中安宁，才有晴天。&lt;/p&gt;

&lt;h2 id=&quot;articleHeader1&quot;&gt;后记&lt;/h2&gt;

&lt;p&gt;这座城市叫北京，是一个稍微不努力就得卷铺盖走人的城市。可即使是这样，也改变不了我对西二旗的崇高信仰！北京以痛吻我，我却报之以歌。&lt;/p&gt;
&lt;p&gt;希望有一天，我也可以像西二旗人一样，月薪五万，活得像五千。&lt;/p&gt;

&lt;hr/&gt;
&lt;p&gt;声明 &lt;br/&gt;欢迎转载，请注明出处和作者，同时保留声明。 &lt;br/&gt;作者：闰土少年 &lt;br/&gt;出处：&lt;a href=&quot;http://www.cnblogs.com/runnin...&quot; target=&quot;_blank&quot;&gt;http://www.cnblogs.com/runnin...&lt;/a&gt;&lt;br/&gt;本博客的文章如无特殊说明，均为原创，转载请注明出处。如未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。&lt;/p&gt;
&lt;hr/&gt;

&lt;p&gt;想了解我的更多动态？欢迎关注我的微信公众号：&lt;strong&gt;闰土哥的前端路&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/701424/201711/701424-20171124153232000-1036274250.png&quot; alt=&quot;&quot;/&gt;&lt;/strong&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 24 Nov 2017 07:35:00 +0000</pubDate>
<dc:creator>闰土少年</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/running-runtu/p/7890885.html</dc:identifier>
</item>
<item>
<title>这次真的忽略了一些ActiveMQ内心的娇艳 - 禁心尽力</title>
<link>http://www.cnblogs.com/1315925303zxz/p/7889979.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/1315925303zxz/p/7889979.html</guid>
<description>&lt;p&gt;好久没总结了，内心有点空虚了，所以今天主要给园里的朋友们分享一点儿这几天使用ActiveMQ过程中踩过的小坑，虽然说这东西简单易用，代码几行配置也就几行，问题不大但是后果有点严重，所以就要必要总结一下了。&lt;/p&gt;
&lt;p&gt;首先ActiveMQ有俩种消息队列模式：点对点和发布订阅，这俩种都有不可替代的应用场景，前者适用于消息唯一传递的业务，后者适用于分布式环境下进行多面数据同步的操作。&lt;/p&gt;
&lt;p&gt;其次一些关于它的官方简介和安装步骤我就不占博客园数据库的内存了，写了也没啥鸟用，用烂的朋友想要提取点儿精华，没接触过的朋友请先安装一个玩玩点对点和发布订阅模式吧(&lt;a href=&quot;http://www.cnblogs.com/1315925303zxz/p/6377551.html&quot; target=&quot;_blank&quot;&gt;http://www.cnblogs.com/1315925303zxz/p/6377551.html&lt;/a&gt;)，理解一下这俩种机制的区别和出现消息临界值时的特性，我下面也放一些我前期用于测试的Demo，其中总结了一些他们二者的主要区别，都是实战中必须要考虑的因素可以参考：&lt;/p&gt;
&lt;p&gt;假设：存在一个消息生产者、多个消费者，分别在点对点和发布订阅模式下进行消息获取，当出现消息临界值的时候都有什么现象？这些需要朋友你自己体会，我能做的只有送上代码供各位测试了。&lt;/p&gt;
&lt;h2&gt;消息生产者&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ProducerDemo2 {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     
&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; Random r = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Random();
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         ConnectionFactory connectionFactory; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 连接工厂&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;         Connection connection = &lt;span&gt;null&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 连接&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt;         Session session; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 会话 接受或者发送消息的线程&lt;/span&gt;
&lt;span&gt; 9&lt;/span&gt;         Destination destination; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 消息的目的地&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;         MessageProducer messageProducer;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;消息生产者
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 实例化连接工厂&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;         connectionFactory = &lt;span&gt;new&lt;/span&gt; ActiveMQConnectionFactory(&quot;admin&quot;, &quot;admin&quot;, &quot;tcp://10.0.40.73:61616&quot;);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;用户名、密码、连接地址&lt;/span&gt;
&lt;span&gt;13&lt;/span&gt;         &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过连接工厂获取连接&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt;             connection =&lt;span&gt; connectionFactory.createConnection();
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 启动连接&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;            connection.start();
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 创建session&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt;             session = connection.createSession(&lt;span&gt;true&lt;/span&gt;, Session.AUTO_ACKNOWLEDGE);        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;true:支持事务    false:不支持事务
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 创建/选择一个消息队列&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt;             destination = session.createQueue(&quot;BMW&quot;);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;点对点
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;destination = session.createTopic(&quot;ToyotaYQ&quot;);    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发布订阅
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;创建消息生产者&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt;             messageProducer =&lt;span&gt; session.createProducer(destination);
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;创建一条文本消息 &lt;/span&gt;
&lt;span&gt;26&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; num = r.nextInt(100&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;             TextMessage message = session.createTextMessage(&quot;ActiveMQ 生产者2发送消息&quot;+&lt;span&gt;num);
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;             System.out.println(&quot;生产者2发送消息：&quot;+&lt;span&gt;num);
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;通过消息生产者发出消息 &lt;/span&gt;
&lt;span&gt;30&lt;/span&gt; &lt;span&gt;            messageProducer.send(message);
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;提交&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;            session.commit();
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;         } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (JMSException e) {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;            e.printStackTrace();
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;消息消费者(可以copy多个进行消息争抢测试)&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ConsumerDemo2 {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; private static final String USERNAME =
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ActiveMQConnection.DEFAULT_USER;&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;默认连接用户名(amdin)
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; private static final String PASSWORD =
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ActiveMQConnection.DEFAULT_PASSWORD;&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;默认连接密码(admin)
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; private static final String BROKEURL =
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ActiveMQConnection.DEFAULT_BROKER_URL;&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;默认连接地址(tcp:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;localhost:61616)&lt;/span&gt;
&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         ConnectionFactory connectionFactory; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 连接工厂&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;         Connection connection = &lt;span&gt;null&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 连接&lt;/span&gt;
&lt;span&gt;13&lt;/span&gt;         Session session; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 会话 接受或者发送消息的线程&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;         Destination destination; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 消息的目的地&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt;         MessageConsumer messageConsumer; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 消息的消费者
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 实例化连接工厂&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt;         connectionFactory = &lt;span&gt;new&lt;/span&gt; ActiveMQConnectionFactory(&quot;admin&quot;, &quot;admin&quot;, &quot;tcp://10.0.40.73:61616&quot;);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;用户名、密码、连接地址&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt;         &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过连接工厂获取连接&lt;/span&gt;
&lt;span&gt;20&lt;/span&gt;             connection =&lt;span&gt; connectionFactory.createConnection();
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 启动连接&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt; &lt;span&gt;            connection.start();
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 创建session&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt;             session = connection.createSession(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;, Session.AUTO_ACKNOWLEDGE);
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 创建/选择一个消息队列&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt;             destination = session.createQueue(&quot;BMW&quot;);            &lt;span&gt;//&lt;/span&gt;&lt;span&gt;点对点模式
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;destination = session.createTopic(&quot;ToyotaYQ&quot;);    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发布订阅模式
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 创建消息消费者&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt;             messageConsumer =&lt;span&gt; session.createConsumer(destination);
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; 
&lt;span&gt;31&lt;/span&gt;             &lt;span&gt;while&lt;/span&gt; (&lt;span&gt;true&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;                  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置消费者接收消息的时间(3s)&lt;/span&gt;
&lt;span&gt;33&lt;/span&gt;                 TextMessage textMessage = (TextMessage)messageConsumer.receive(3000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt;(textMessage == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;                     System.out.println(&quot;没有消息&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;                 }&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt;                    System.out.println(textMessage.getText());
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;System.exit(0);&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;         } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (JMSException e) {
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;            e.printStackTrace();
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;注意事项：&lt;/h2&gt;
&lt;p&gt;1、生产者发送消息时必须支持事务，就是创建消息会话的时候设置为true，否则会出现“javax.jms.IllegalStateException: Not a transacted session”异常。消费者可以不支持。&lt;/p&gt;
&lt;p&gt;2、&lt;strong&gt;点对点模式下，同一时刻只能有一个消费者从队列中获取消息内容，如果存在多个消费者，则会出现消息争抢现象直到消息全部抢完，处于阻塞状态，如果再有消息被放进来时，接着会进行争抢，但是只会有一个消费者获取到消息，不会出现多个消费者抢到消息的情况。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3、点对点模式下，生产者发送消息时，消费者可以处于离线状态，当消费者再次运行时可以接收到历史消息；但是在发布订阅模式下，消费者必须处于运行状态获取消息，历史消息也是不会被获取到的。&lt;/strong&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;实战上线后踩过的坑以及解决方案：&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1、用户订单入库成功后发送到MQ中的订单消息丢失，出现处理订单遗漏的情况？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决方案1：打开消息持久开关。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;因为Activemq支持两种消息传送模式：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PERSISTENT （持久消息）该模式是activemq默认的传送方式，此模式下可以保证消息只会被成功传送一次和成功使用一次，消息具有可靠性。在消息传递到目标消费者，在消费者没有成功应答前，消息不会丢失。所以很自然的，需要一个地方来持久性存储。如果消息消费者在进行消费过程发生失败，则消息会被再次投递；&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; NON_PERSISTENT（非持久消息）该模式适用于消息不重要的，可以接受消息丢失的哪一类消息，这种消息只会被投递一次，消息不会在持久性存储中存储，也不会保证消息丢失后的重新投递。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;与spring整合使用ActiveMQ配置文件如下：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;　　&amp;lt;&lt;/span&gt;&lt;span&gt;bean &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;jmsTemplate&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;org.springframework.jms.core.JmsTemplate&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;connectionFactory&quot;&lt;/span&gt;&lt;span&gt; ref&lt;/span&gt;&lt;span&gt;=&quot;connectionFactory&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; deliveryMode, priority, timeToLive 的开关，要生效，必须配置为true，默认false&lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;explicitQosEnabled&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;&lt;strong&gt;true&lt;/strong&gt;&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; 【发送模式  DeliveryMode.NON_PERSISTENT=1:非持久 ; DeliveryMode.PERSISTENT=2:持久】&lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt; 
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;deliveryMode&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt; 
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;bean&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;解决方案2：设置消息重发机制。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ActiveMQ针对消息丢失情况提供了消息重发机制，假设消息发送失败，为了解决这一尴尬局面，我们可以在实际项目中配置消息重发机制，以防万一。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;　　&amp;lt;&lt;/span&gt;&lt;span&gt;bean &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;targetConnectionFactory&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;brokerURL&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;tcp://192.168.136.139:61616&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;redeliveryPolicy&quot;&lt;/span&gt;&lt;span&gt; ref&lt;/span&gt;&lt;span&gt;=&quot;activeMQRedeliveryPolicy&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;  &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; 引用重发机制 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt; 
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;bean&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    
    &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; ActiveMQ消息发送失败后的重发机制 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;bean &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;activeMQRedeliveryPolicy&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;org.apache.activemq.RedeliveryPolicy&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt;是否在每次尝试重新发送失败后,增长这个等待时间 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;useExponentialBackOff&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;true&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt;重发次数,默认为6次   这里设置为1次 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;maximumRedeliveries&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt;重发时间间隔,默认为1秒 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;initialRedeliveryDelay&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;1000&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt;第一次失败后重新发送之前等待500毫秒,第二次失败再等待500 * 2毫秒,这里的2就是value &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;backOffMultiplier&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt;最大传送延迟，只在useExponentialBackOff为true时有效（V5.5），假设首次重连间隔为10ms，倍数为2，那么第   
                                   二次重连时间间隔为 20ms，第三次重连时间间隔为40ms，当重连时间间隔大的最大重连时间间隔时，以后每次重连时间间隔都为最大重连时间间隔。 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;  
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;maximumRedeliveryDelay&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;1000&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;  
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;bean&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;前天任务调度服务上线后，出现消息丢失的情况，根据以上解决方案是否能够根治这种情况，本人也是不太能够保证，希望稍后能在留言区得到各位老兄的帮助。&lt;/p&gt;

</description>
<pubDate>Fri, 24 Nov 2017 06:59:00 +0000</pubDate>
<dc:creator>禁心尽力</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/1315925303zxz/p/7889979.html</dc:identifier>
</item>
<item>
<title>Nodejs学习笔记（十六）--- Pomelo介绍&amp;入门 - porschev</title>
<link>http://www.cnblogs.com/zhongweiv/p/nodejs_pomelo.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhongweiv/p/nodejs_pomelo.html</guid>
<description>&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;Pomelo：一个快速、可扩展、Node.js分布式游戏服务器框架&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;19&quot;&gt;
&lt;p&gt;从三四年前接触Node.js开始就接触到了Pomelo，从Pomelo最初的版本到现在，总的来说网易出品还算不错，但是发展不算快；用它做过一些项目和小游戏表现还不错。&lt;/p&gt;
&lt;p&gt;用它的主要好处：&lt;/p&gt;
&lt;p&gt;1. 入门简单，有比较丰富的文档和示例（虽然现在看版本也比较老了，但是入门没什么问题）&lt;/p&gt;
&lt;p&gt;2.分布式多进程且扩展简单（单进程多线程，每个服务器都是一个Node进程，通过配置文件就可以管理集群）&lt;/p&gt;
&lt;p&gt;3.可以不去关注底层和网络相关逻辑，聚焦业务逻辑的处理，对于有Web服务器开发经验却没有游戏服务器开发经验来说还是比较友好的&lt;/p&gt;
&lt;p&gt;4.提供了很多工具和客户端支持（像IOS、Android &amp;amp; Java、Javascript、C、Cocos2d-x、U3D等）&lt;/p&gt;
&lt;p&gt;...... 　&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;　　入门参考链接&lt;/p&gt;
&lt;p&gt;　　&lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo/wiki/Home-in-Chinese&quot;&gt;https://github.com/NetEase/pomelo/wiki/Home-in-Chinese&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;　　其它链接：　　&lt;/p&gt;
&lt;p&gt;　　&lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo&quot;&gt;https://github.com/NetEase/pomelo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;　　&lt;a class=&quot;wilson_quote&quot; href=&quot;https://www.npmjs.com/package/pomelo&quot;&gt;https://www.npmjs.com/package/pomelo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;　　安装要求　　&lt;/p&gt;
&lt;blockquote readability=&quot;11.367164179104&quot;&gt;
&lt;p&gt;Windows下安装要求环境&lt;/p&gt;
&lt;p&gt;Python (2.5 &amp;lt; 版本 &amp;lt; 3)&lt;/p&gt;
&lt;p&gt;VC++编译器&lt;/p&gt;
&lt;p&gt;PS:  Windows新环境自已检查一下，我本机环境已经装好python2.7，Visaul Studio也安装了所以也有VC++编译器&lt;/p&gt;
&lt;p&gt;　　其它操作系统应该问题不大&lt;/p&gt;
&lt;p&gt;官方安装介绍文档：&lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo/wiki/%E5%AE%89%E8%A3%85pomelo&quot;&gt;https://github.com/NetEase/pomelo/wiki/%E5%AE%89%E8%A3%85pomelo&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; 　  全局安装Pomelo&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
npm install pomelo -g
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　安装成功后如下图，可以看到现在最新版本为2.2.5&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_1.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;　说明：Pomelo光是安装可能出现各种失败&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;　　　　1. 回头去检查一下，Python和VC++编辑器是否有问题&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;　　　　2.如果以前全局安装过Pomelo，最好删除掉 “C:\Users\当前用户\AppData\Roaming\npm\node_modules”目录下Pomelo文件夹和“C:\Users\当前用户\AppData\Roaming\npm-cache”目录下Pomelo开头的文件夹&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;　　　　3.如果并不报错，npm卡住不动，多数是网络原因，重复多安几次；或者打开FQ工具试试；也可以用淘宝镜像 &lt;a class=&quot;wilson_quote&quot; href=&quot;https://cnpmjs.org/&quot;&gt;cnpm&lt;/a&gt; 安装&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;　&lt;span&gt;&lt;strong&gt;安装好pomelo之后，开始创建项目并安装依赖项&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
pomelo init 项目名
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　执行创建项目命令后，出现如下图选择项（&lt;em&gt;Please select underly connector, 1 for websocket(native socket), 2 for socket.io, 3 for wss, 4 for socket.io(wss), 5 for udp, 6 for mqtt: [1]&lt;/em&gt;）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_2.png&quot; alt=&quot;&quot; width=&quot;1098&quot; height=&quot;230&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  这是让你选择connector的协议，除了5 for udp,其它都是长连接，我们接下来选择 2 for socket.io&lt;/p&gt;
&lt;p&gt;  在上图cmd中输入2，并回车，选择socket.io继续安装&lt;/p&gt;
&lt;p&gt;  这里connector协议可以通过app.js配置进行修改&lt;span&gt;//&lt;/span&gt; &lt;span&gt;app configuration&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
app.configure('production|development', 'connector', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(){
  app.set(&lt;/span&gt;'&lt;span&gt;connectorConfig&lt;/span&gt;'&lt;span&gt;,
    {
      &lt;span&gt;connector : pomelo.connectors.sioconnector,&lt;/span&gt;&lt;br/&gt;　　　 ...&lt;br/&gt;});
});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;  成功后，转到项目根目录，执行安装项目执行 npm-install.bat 依赖项 (其它平台执行npm-install.sh)&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;cd 项目目录
npm&lt;/span&gt;-install.bat
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 项目创建完成后，目录如下图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_3.png&quot; alt=&quot;&quot; width=&quot;328&quot; height=&quot;969&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;项目结构说明&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;　　&lt;span&gt;game-server ：&lt;/span&gt; &lt;/strong&gt; 游戏服务器，所有游戏服务器功能和逻辑都在此目录下&lt;/p&gt;
&lt;p&gt;　　　　&lt;span&gt;&lt;strong&gt;game-server/app.js：&lt;/strong&gt;&lt;/span&gt;入口文件&lt;/p&gt;
&lt;p&gt;　　　　&lt;span&gt;&lt;strong&gt;game-server/app：&lt;/strong&gt;&lt;/span&gt; 存放游戏逻辑和功能相关代码都这个子目录下，servers目录下可以新建多个目录来创建不同类型的服务器，在pomelo中，使用路径来区分服务器类型&lt;/p&gt;
&lt;p&gt;　　　　&lt;span&gt;&lt;strong&gt;game-server/config：&lt;/strong&gt;&lt;/span&gt;存放游戏服务器配置文件目录，像日志、服务器、数据库等几乎所有配置文件都可以存放到此目录下&lt;/p&gt;
&lt;p&gt;　　　　&lt;span&gt;&lt;strong&gt;game-server/logs：&lt;/strong&gt;&lt;/span&gt;日志目录，存放游戏服务器所有日志文件&lt;/p&gt;
&lt;p&gt;　　&lt;span&gt;&lt;strong&gt;web-server：&lt;/strong&gt;&lt;/span&gt;  web服务器（如果你是个H5游戏，这里就是Web客户端，如果是IOS、Andriod客户端，这目录就没什么用）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;　　&lt;span&gt;shared：&lt;/span&gt;&lt;/strong&gt;公共代码存放处，这里要以放一些共用代码&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;所有依赖项安装成功后，开始启动项目&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt; &lt;/strong&gt;启动game-server&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
cd game-&lt;span&gt;server
pomelo start&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;    启动命令执行成功后，出现如下图错误提示&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_4.png&quot; alt=&quot;&quot; width=&quot;1098&quot; height=&quot;122&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[2017-11-23 11:54:42.226] [ERROR] console -&lt;span&gt; Option path is not valid. Please refer to the README.
[&lt;/span&gt;2017-11-23 11:54:42.226] [ERROR] console -&lt;span&gt; Option close timeout is not valid. Please refer to the README.
[&lt;/span&gt;2017-11-23 11:54:42.226] [ERROR] console -&lt;span&gt; Option heartbeats is not valid. Please refer to the README.
[&lt;/span&gt;2017-11-23 11:54:42.226] [ERROR] console - Option log level is not valid. Please refer to the README.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;  问题原因和解决方式&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  原因：新版的socket.io用法不正确的导致的，官方早已修复，就是没有publish到npm包中&lt;/p&gt;
&lt;p&gt;  修复方式：把node_modules目录下的pomelo中sioconnector.js(..&lt;em&gt;/game-server/node_modules/pomelo/lib/connectors/sioconnector.js&lt;/em&gt;) &lt;/p&gt;
&lt;p&gt;                   替换为 &lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo/blob/master/lib/connectors/sioconnector.js&quot;&gt;https://github.com/NetEase/pomelo/blob/master/lib/connectors/sioconnector.js&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; &lt;/strong&gt;替换后再启动game-server，就没有这些错误提示了^_^!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; 测试连接&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  1.启动web-server&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
cd web-&lt;span&gt;server
node app&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 启动后如下图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_5.png&quot; alt=&quot;&quot; width=&quot;1098&quot; height=&quot;299&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  会发些有一些提示，这是express写法问题，可以打开web-server根目录下app.js，按如下修改&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt;var app = express.createServer();  注释掉这一行代码，替换为下面这一行代码&lt;/span&gt;
&lt;span&gt;var app = express();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 再启动时无express用法提示^_^!&lt;/p&gt;
&lt;p&gt; 2.打开http://localhost:3001&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_6.png&quot; alt=&quot;&quot; width=&quot;1122&quot; height=&quot;721&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; 如上图，点击“Test Game Server”按钮，提示“game server is ok.”,则此项目game-server可用^_^!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt; 上面大体了解了pomelo，要入门还是以一个聊天服务器为入门示例最好，其它逻辑相对简单，入门学习不会因其它游戏逻辑影响。&lt;/p&gt;
&lt;p&gt; 官方有个非常好的示例：&lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/chatofpomelo&quot;&gt;https://github.com/NetEase/chatofpomelo&lt;/a&gt;  官方也有很多说明&lt;/p&gt;
&lt;p&gt; 网上也有很多文章分析讲解这项目，我就不完全解释些项目了，接下来我就在上面新建的好的“PomeloDemo”的基础上改成一个聊天服务器&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; 1.新建gate和chat服务器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  在app/servers目录下新建gate和chat服务器，新建好后目录如下&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_7.png&quot; alt=&quot;&quot; width=&quot;321&quot; height=&quot;304&quot;/&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;gate服务器：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 在一般情况下用户量一台机器就可以支撑，但用户量多了就得扩充服务器，gate服务器的作用就相当于前端负载均衡服务器；&lt;/p&gt;
&lt;p&gt; 客户端向gate服务器发出请求，gate服务器会给客户端分配一个connector服务器；&lt;/p&gt;
&lt;p&gt; 分配策略是根据客户端的某一个key做hash得到connector的id，这样就可以实现各个connector服务器的负载均衡。这个一会儿会实现&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; connector服务器： &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 接受客户端请求，并将其路由到&lt;code&gt;chat&lt;/code&gt;服务器，以及维护客户端的链接；&lt;/p&gt;
&lt;p&gt; 同时，接收客户端对后端服务器的请求，按照用户配置的路由策略，将请求路由给具体的后端服务器。当后端服务器处理完请求或者需要给客户端推送消息的时候，connector服务器同样会扮演一个中间角色，完成对客户端的消息发送；&lt;/p&gt;
&lt;p&gt; connector服务器会同时拥有clientPort和port，其中clientPort用来监听客户端的连接，port端口用来给后端提供服务；&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;chat服务器：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; handler和remote决定了服务器的行为；&lt;/p&gt;
&lt;p&gt; handler接收用户发送过来的send请求，remote由connector RPC发起远程调用时调用；&lt;/p&gt;
&lt;p&gt; 在remote里由于涉及到用户的加入和退出，所以会有对channel的操作。&lt;/p&gt;

&lt;p&gt; 其实也可以提前了解一些Pomelo中的术语，不分别解释，可以提前看看：&lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo/wiki/%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A&quot;&gt;https://github.com/NetEase/pomelo/wiki/%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A&lt;/a&gt;&lt;/p&gt;

&lt;p&gt; &lt;strong&gt;2.配置master.json&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('9e508315-8dce-461f-ad59-0e770e39542d')&quot; readability=&quot;34&quot;&gt;&lt;img id=&quot;code_img_closed_9e508315-8dce-461f-ad59-0e770e39542d&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_9e508315-8dce-461f-ad59-0e770e39542d&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('9e508315-8dce-461f-ad59-0e770e39542d',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_9e508315-8dce-461f-ad59-0e770e39542d&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
&lt;span&gt;{
  &quot;development&quot;: {
    &quot;id&quot;: &quot;master-server-1&quot;, &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;port&quot;: 15005
  },
  &quot;production&quot;: {
    &quot;id&quot;: &quot;master-server-1&quot;, &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;port&quot;: 15005
  }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;master.json&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;  &lt;strong/&gt;&lt;strong&gt;3.配置servers.json&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  打开config目录下servers.json文件，配置好各种 type 的服务器，配置如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('c42c4f34-6120-4289-810b-e5c8e921bf28')&quot; readability=&quot;60&quot;&gt;&lt;img id=&quot;code_img_closed_c42c4f34-6120-4289-810b-e5c8e921bf28&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_c42c4f34-6120-4289-810b-e5c8e921bf28&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('c42c4f34-6120-4289-810b-e5c8e921bf28',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_c42c4f34-6120-4289-810b-e5c8e921bf28&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;115&quot;&gt;
&lt;pre&gt;
&lt;span&gt;{
    &quot;development&quot;:{
        &quot;connector&quot;:[
             {&quot;id&quot;:&quot;connector-server-1&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:14050, &quot;clientPort&quot;: 13050, &quot;frontend&quot;: true},
             {&quot;id&quot;:&quot;connector-server-2&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:14051, &quot;clientPort&quot;: 13051, &quot;frontend&quot;: true},
             {&quot;id&quot;:&quot;connector-server-3&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:14052, &quot;clientPort&quot;: 13052, &quot;frontend&quot;: true}
         ],
        &quot;chat&quot;:[
             {&quot;id&quot;:&quot;chat-server-1&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:16050},
             {&quot;id&quot;:&quot;chat-server-2&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:16051},
             {&quot;id&quot;:&quot;chat-server-3&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:16052}
        ],
        &quot;gate&quot;:[
           {&quot;id&quot;: &quot;gate-server-1&quot;, &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;clientPort&quot;: 15014, &quot;frontend&quot;: true}
        ]
    },
    &quot;production&quot;:{
           &quot;connector&quot;:[
             {&quot;id&quot;:&quot;connector-server-1&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:14050, &quot;clientPort&quot;: 13050, &quot;frontend&quot;: true},
             {&quot;id&quot;:&quot;connector-server-2&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:14051, &quot;clientPort&quot;: 13051, &quot;frontend&quot;: true},
             {&quot;id&quot;:&quot;connector-server-3&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:14052, &quot;clientPort&quot;: 13052, &quot;frontend&quot;: true}
         ],
        &quot;chat&quot;:[
             {&quot;id&quot;:&quot;chat-server-1&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:16050},
             {&quot;id&quot;:&quot;chat-server-2&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:16051},
             {&quot;id&quot;:&quot;chat-server-3&quot;, &quot;host&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:16052}
        ],
        &quot;gate&quot;:[
           {&quot;id&quot;: &quot;gate-server-1&quot;, &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;clientPort&quot;: 15014, &quot;frontend&quot;: true}
        ]
  }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;servers.json&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;  解释一下配置中的各字段：&lt;/p&gt;
&lt;p&gt;  &lt;span&gt;&lt;strong&gt;id: &lt;/strong&gt;&lt;/span&gt;  字符串类型的应用服务器ID&lt;/p&gt;
&lt;p&gt;  &lt;span&gt;&lt;strong&gt;host：&lt;/strong&gt;&lt;/span&gt;应用服务器的IP或者域名&lt;/p&gt;
&lt;p&gt;  &lt;span&gt;&lt;strong&gt;port：&lt;/strong&gt;&lt;/span&gt;RPC请求监听的端口&lt;/p&gt;
&lt;p&gt;  &lt;span&gt;&lt;strong&gt;clientPort：&lt;/strong&gt;&lt;/span&gt; 前端服务器的客户端请求的监听端口&lt;/p&gt;
&lt;p&gt;  &lt;span&gt;&lt;strong&gt;frontend：&lt;/strong&gt;&lt;/span&gt;bool类型，是否是前端服务器，默认: false&lt;/p&gt;
&lt;p&gt;  可选参数：&lt;/p&gt;
&lt;p&gt; &lt;span&gt; &lt;strong&gt;max-connections：&lt;/strong&gt;&lt;/span&gt;前端服务器最大客户连接数&lt;/p&gt;
&lt;p&gt;  &lt;span&gt;&lt;strong&gt;args：&lt;/strong&gt;&lt;/span&gt; &lt;code&gt;node/v8&lt;/code&gt;配置，如配置为&lt;code&gt;&quot;args&quot;: &quot;--debug=5858 &quot;&lt;/code&gt;这样就可以启用项目调试（没用过，临时问了一下谷歌，看别人是这么解释的^_^!）&lt;/p&gt;

&lt;p&gt; &lt;strong&gt;4.配置adminServer.json&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; &lt;/strong&gt;打开config目录下adminServer.json文件，配置好各种 type 的服务器，配置如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('dd6203ed-094c-4d70-9f9a-b2029894da3a')&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_dd6203ed-094c-4d70-9f9a-b2029894da3a&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_dd6203ed-094c-4d70-9f9a-b2029894da3a&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('dd6203ed-094c-4d70-9f9a-b2029894da3a',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_dd6203ed-094c-4d70-9f9a-b2029894da3a&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;[{
    &quot;type&quot;: &quot;connector&quot;,
    &quot;token&quot;: &quot;agarxhqb98rpajloaxn34ga8xrunpagkjwlaw3ruxnpaagl29w4rxn&quot;
}, {
    &quot;type&quot;: &quot;chat&quot;,
    &quot;token&quot;: &quot;agarxhqb98rpajloaxn34ga8xrunpagkjwlaw3ruxnpaagl29w4rxn&quot;
},{
    &quot;type&quot;: &quot;gate&quot;,
    &quot;token&quot;: &quot;agarxhqb98rpajloaxn34ga8xrunpagkjwlaw3ruxnpaagl29w4rxn&quot;
}]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;adminServer.json&lt;/span&gt;&lt;/div&gt;
&lt;p&gt; 它有什么作用，可以看一下以下2个链接&lt;/p&gt;
&lt;p&gt; &lt;a class=&quot;wilson_quote&quot; href=&quot;http://blog.csdn.net/nynyvkhhiiii/article/details/49249915&quot;&gt;http://blog.csdn.net/nynyvkhhiiii/article/details/49249915&lt;/a&gt;&lt;/p&gt;
&lt;p&gt; &lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo-admin#server-master-auth&quot;&gt;https://github.com/NetEase/pomelo-admin#server-master-auth&lt;/a&gt;&lt;/p&gt;

&lt;p&gt; &lt;strong&gt;5.解决服务器分配问题&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 从上面的servers.json配置的修改可以看出与最开始创建出来的项目一个服务器相比，connector和chat我都配置了三个服务器&lt;/p&gt;
&lt;p&gt; 这就要解决客户端请求服务器分配问题&lt;/p&gt;
&lt;p&gt; 解决思路：用户访问gate服务器，使用用户的uid的crc32的校验码与connector服务器的个数取余，从而得到一个connector服务器，把这个connector服务器分配给请求用户&lt;/p&gt;
&lt;p&gt; 在app目录下新建util目录，目录下新建“dispatcher.js”和 “routeUtil.js”文件，处理此服务器分配逻辑&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('52f1591b-5561-46f8-9b77-ef128a2a6bd5')&quot; readability=&quot;32&quot;&gt;&lt;img id=&quot;code_img_closed_52f1591b-5561-46f8-9b77-ef128a2a6bd5&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_52f1591b-5561-46f8-9b77-ef128a2a6bd5&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('52f1591b-5561-46f8-9b77-ef128a2a6bd5',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_52f1591b-5561-46f8-9b77-ef128a2a6bd5&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;59&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; crc = require('crc'&lt;span&gt;);

module.exports.dispatch &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(uid, connectors) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; index = Math.abs(crc.crc32(uid)) %&lt;span&gt; connectors.length;
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; connectors[index];
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;dispatcher.js&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('e7eb3678-1ed1-4959-9eee-693a80f1dbd5')&quot; readability=&quot;35&quot;&gt;&lt;img id=&quot;code_img_closed_e7eb3678-1ed1-4959-9eee-693a80f1dbd5&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_e7eb3678-1ed1-4959-9eee-693a80f1dbd5&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('e7eb3678-1ed1-4959-9eee-693a80f1dbd5',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_e7eb3678-1ed1-4959-9eee-693a80f1dbd5&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;65&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; exp =&lt;span&gt; module.exports;
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; dispatcher = require('./dispatcher'&lt;span&gt;);

exp.chat &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(session, msg, app, cb) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; chatServers = app.getServersByType('chat'&lt;span&gt;);

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!chatServers || chatServers.length === 0&lt;span&gt;) {
        cb(&lt;/span&gt;&lt;span&gt;new&lt;/span&gt; Error('can not find chat servers.'&lt;span&gt;));
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
    }

    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; res = dispatcher.dispatch(session.get('rid'&lt;span&gt;), chatServers);

    cb(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, res.id);
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;routeUtil.js&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;  准备好这些文件后，在game-server服务器入口文件app.js中添加配配置&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; pomelo = require('pomelo'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var routeUtil = require('./app/util/routeUtil');

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * Init app for client.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;var&lt;/span&gt; app =&lt;span&gt; pomelo.createApp();
app.set(&lt;/span&gt;'name', 'PomeloDemo'&lt;span&gt;);

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; app configuration&lt;/span&gt;&lt;span&gt;
//&lt;/span&gt;&lt;span&gt; app.configure('production|development', 'connector', function(){&lt;/span&gt;
app.configure('production|development', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(){
  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; route configures&lt;/span&gt;
  &lt;span&gt;app.route('chat'&lt;/span&gt;&lt;span&gt;&lt;span&gt;, routeUtil.chat);&lt;/span&gt;
  app.set(&lt;/span&gt;'connectorConfig'&lt;span&gt;,
  {
      connector : pomelo.connectors.sioconnector,
      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 'websocket', 'polling-xhr', 'polling-jsonp', 'polling'&lt;/span&gt;
      transports : ['websocket', 'polling'&lt;span&gt;],
      heartbeats : &lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;,
      closeTimeout : &lt;/span&gt;60 * 1000&lt;span&gt;,
      heartbeatTimeout : &lt;/span&gt;60 * 1000&lt;span&gt;,
      heartbeatInterval : &lt;/span&gt;25 * 1000&lt;span&gt;
  });
  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; filter configures&lt;/span&gt;
&lt;span&gt;&lt;span&gt;  app.filter(pomelo.timeout());&lt;/span&gt;
});

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; start app&lt;/span&gt;
&lt;span&gt;app.start();

process.on(&lt;/span&gt;'uncaughtException', &lt;span&gt;function&lt;/span&gt;&lt;span&gt; (err) {
  console.error(&lt;/span&gt;' Caught exception: ' +&lt;span&gt; err.stack);
});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;  &lt;strong&gt;app.filter(pomelo.timeout());&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;  过滤器，pomelo内置了一些过滤器，可以自行去了解一下，也可以根据自已的需求去自定义!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;  &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;　注意：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;   app.configure('production|development', 'connector', function(){   &lt;/p&gt;
&lt;p&gt;   修改为&lt;/p&gt;
&lt;p&gt;   app.configure('production|development',  function(){&lt;/p&gt;
&lt;p&gt;   这个如果不修改，在启动调用时会遇到&lt;strong&gt; engine.io&lt;/strong&gt; 中报错  &lt;strong&gt;&lt;em&gt;TypeError: Cannot read property  &lt;strong&gt;'indexOf' of undefined  at Server.verify&lt;/strong&gt; &lt;/em&gt;&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt; 6.实现 &lt;em id=&quot;__mceDel&quot;&gt;gate.gateHandler.queryEntry&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  作用：用户连接gate服务器，返回分配的connector&lt;/p&gt;
&lt;p&gt;  在gate目录下handler下新建gateHandler.js，代码如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('696e14b1-6854-4524-9101-fb1defbebf70')&quot; readability=&quot;36.5&quot;&gt;&lt;img id=&quot;code_img_closed_696e14b1-6854-4524-9101-fb1defbebf70&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_696e14b1-6854-4524-9101-fb1defbebf70&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('696e14b1-6854-4524-9101-fb1defbebf70',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_696e14b1-6854-4524-9101-fb1defbebf70&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;68&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; dispatcher = require('../../../util/dispatcher'&lt;span&gt;);

module.exports &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Handler(app);
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; Handler = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.app =&lt;span&gt; app;
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; handler =&lt;span&gt; Handler.prototype;

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * Gate handler that dispatch user to connectors.
 *
 * @param {Object} msg message from client
 * @param {Object} session
 * @param {Function} next next stemp callback
 *
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
handler.queryEntry &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(msg, session, next) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; uid =&lt;span&gt; msg.uid;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!&lt;span&gt;uid) {
        next(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, {
            code: &lt;/span&gt;500&lt;span&gt;
        });
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; get all connectors&lt;/span&gt;
    &lt;span&gt;var&lt;/span&gt; connectors = &lt;span&gt;this&lt;/span&gt;.app.getServersByType('connector'&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!connectors || connectors.length === 0&lt;span&gt;) {
        next(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, {
            code: &lt;/span&gt;500&lt;span&gt;
        });
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; select connector&lt;/span&gt;
    &lt;span&gt;var&lt;/span&gt; res =&lt;span&gt; dispatcher.dispatch(uid, connectors);
    next(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, {
        code: &lt;/span&gt;200&lt;span&gt;,
        host: res.host,
        port: res.clientPort
    });
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;gateHandler.js&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt; 7.实现chat服务器chatRemote.js &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; chat服务器会接受connector的远程调用，完成channel维护中的用户的加入以及离开&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('7cc55ba6-9684-463d-854a-4d0ad0a5bd50')&quot; readability=&quot;40.5&quot;&gt;&lt;img id=&quot;code_img_closed_7cc55ba6-9684-463d-854a-4d0ad0a5bd50&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_7cc55ba6-9684-463d-854a-4d0ad0a5bd50&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('7cc55ba6-9684-463d-854a-4d0ad0a5bd50',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_7cc55ba6-9684-463d-854a-4d0ad0a5bd50&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;76&quot;&gt;
&lt;pre&gt;
module.exports = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ChatRemote(app);
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; ChatRemote = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.app =&lt;span&gt; app;
    &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.channelService = app.get('channelService'&lt;span&gt;);
};

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * Add user into chat channel.
 *
 * @param {String} uid unique id for user
 * @param {String} sid server id
 * @param {String} name channel name
 * @param {boolean} flag channel parameter
 *
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
ChatRemote.prototype.add &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(uid, sid, name, flag, cb) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; channel = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.channelService.getChannel(name, flag);
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; username = uid.split('*')[0&lt;span&gt;];
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; param =&lt;span&gt; {
        route: &lt;/span&gt;'onAdd'&lt;span&gt;,
        user: username
    };
    channel.pushMessage(param);

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;( !!&lt;span&gt; channel) {
        channel.add(uid, sid);
    }

    cb(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.get(name, flag));
};

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * Get user from chat channel.
 *
 * @param {Object} opts parameters for request
 * @param {String} name channel name
 * @param {boolean} flag channel parameter
 * @return {Array} users uids in channel
 *
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
ChatRemote.prototype.get &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(name, flag) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; users =&lt;span&gt; [];
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; channel = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.channelService.getChannel(name, flag);
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;( !!&lt;span&gt; channel) {
        users &lt;/span&gt;=&lt;span&gt; channel.getMembers();
    }
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;(&lt;span&gt;var&lt;/span&gt; i = 0; i &amp;lt; users.length; i++&lt;span&gt;) {
        users[i] &lt;/span&gt;= users[i].split('*')[0&lt;span&gt;];
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; users;
};

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * Kick user out chat channel.
 *
 * @param {String} uid unique id for user
 * @param {String} sid server id
 * @param {String} name channel name
 *
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
ChatRemote.prototype.kick &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(uid, sid, name, cb) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; channel = &lt;span&gt;this&lt;/span&gt;.channelService.getChannel(name, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; leave channel&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;( !!&lt;span&gt; channel) {
        channel.leave(uid, sid);
    }
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; username = uid.split('*')[0&lt;span&gt;];
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; param =&lt;span&gt; {
        route: &lt;/span&gt;'onLeave'&lt;span&gt;,
        user: username
    };
    channel.pushMessage(param);
    cb();
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;chatRemote.js&lt;/span&gt;&lt;/div&gt;
&lt;p&gt; 可以看到上面代码中的add和kick分别对应着加入和离开channel&lt;/p&gt;

&lt;p&gt;&lt;strong&gt; 8.实现chat服务器chatHandler.js&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; chat服务器执行聊天逻辑，维护channel信息，一个房间就是一个channel，一个channel里有多个用户，当有用户发起聊天的时候，就会将其内容广播到整个channel。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('225408c6-62e4-4ef8-95ca-23b2bea8bee2')&quot; readability=&quot;37&quot;&gt;&lt;img id=&quot;code_img_closed_225408c6-62e4-4ef8-95ca-23b2bea8bee2&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_225408c6-62e4-4ef8-95ca-23b2bea8bee2&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('225408c6-62e4-4ef8-95ca-23b2bea8bee2',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_225408c6-62e4-4ef8-95ca-23b2bea8bee2&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;69&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; chatRemote = require('../remote/chatRemote'&lt;span&gt;);

module.exports &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Handler(app);
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; Handler = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.app =&lt;span&gt; app;
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; handler =&lt;span&gt; Handler.prototype;

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * Send messages to users
 *
 * @param {Object} msg message from client
 * @param {Object} session
 * @param  {Function} next next stemp callback
 *
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
handler.send &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(msg, session, next) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; rid = session.get('rid'&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; username = session.uid.split('*')[0&lt;span&gt;];
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; channelService = &lt;span&gt;this&lt;/span&gt;.app.get('channelService'&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; param =&lt;span&gt; {
        route: &lt;/span&gt;'onChat'&lt;span&gt;,
        msg: msg.content,
        from: username,
        target: msg.target
    };
    channel &lt;/span&gt;= channelService.getChannel(rid, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;the target is all users&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;(msg.target == '*'&lt;span&gt;) {
        channel.pushMessage(param);
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;the target is specific user&lt;/span&gt;
    &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; tuid = msg.target + '*' +&lt;span&gt; rid;
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; tsid = channel.getMember(tuid)['sid'&lt;span&gt;];
        channelService.pushMessageByUids(param, [{
            uid: tuid,
            sid: tsid
        }]);
    }
    next(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, {
        route: msg.route
    });
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;chatHandler.js&lt;/span&gt;&lt;/div&gt;
&lt;p&gt; 这里面是发送消息（给房间内所有人和指定用户）&lt;/p&gt;

&lt;p&gt;&lt;strong&gt; 9.实现connector中entryHandler.js&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  主要完成接受客户端的请求，维护与客户端的连接，路由客户端的请求到chat服务器;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('f7584f23-d543-484b-b15d-42bc365b1d52')&quot; readability=&quot;42.5&quot;&gt;&lt;img id=&quot;code_img_closed_f7584f23-d543-484b-b15d-42bc365b1d52&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_f7584f23-d543-484b-b15d-42bc365b1d52&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('f7584f23-d543-484b-b15d-42bc365b1d52',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_f7584f23-d543-484b-b15d-42bc365b1d52&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;80&quot;&gt;
&lt;pre&gt;
module.exports = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Handler(app);
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; Handler = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.app =&lt;span&gt; app;
};

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; handler =&lt;span&gt; Handler.prototype;

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * New client entry chat server.
 *
 * @param  {Object}   msg     request message
 * @param  {Object}   session current session object
 * @param  {Function} next    next stemp callback
 * @return {Void}
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
handler.enter &lt;/span&gt;= &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(msg, session, next) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; self = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; rid =&lt;span&gt; msg.rid;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; uid = msg.username + '*' +&lt;span&gt; rid
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; sessionService = self.app.get('sessionService'&lt;span&gt;);

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;duplicate log in&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;( !!&lt;span&gt; sessionService.getByUid(uid)) {
        next(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, {
            code: &lt;/span&gt;500&lt;span&gt;,
            error: &lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;            
        });
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
    }

    session.bind(uid);
    session.set(&lt;/span&gt;'rid'&lt;span&gt;, rid);
    session.push(&lt;/span&gt;'rid', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(err) {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt;(err) {
            console.error(&lt;/span&gt;'set rid for session service failed! error is : %j'&lt;span&gt;, err.stack);
        }
    });
    session.on(&lt;/span&gt;'closed', onUserLeave.bind(&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, self.app));

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;put user into channel&lt;/span&gt;
    self.app.rpc.chat.chatRemote.add(session, uid, self.app.get('serverId'), rid, &lt;span&gt;true&lt;/span&gt;, &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(users){
        next(&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;, {
            users:users
        });
    });
};

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * User log out handler
 *
 * @param {Object} app current application
 * @param {Object} session current session object
 *
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;var&lt;/span&gt; onUserLeave = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(app, session) {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!session || !&lt;span&gt;session.uid) {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
    }
    app.rpc.chat.chatRemote.kick(session, session.uid, app.get(&lt;/span&gt;'serverId'), session.get('rid'), &lt;span&gt;null&lt;/span&gt;&lt;span&gt;);
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;entryHandler.js&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;  这里完成的主要就是RPC远程调用chat服务器chatRemote中的实现&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;10.运行&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  到此这个聊天服务器实现就完成， 打开命令行工具，执行没有错误信息，基本就成功了！&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
cd game-&lt;span&gt;server目录
pomelo start&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;  我就在web-server目录中写了个测试客户端&lt;/p&gt;
&lt;p&gt;  把结构改了一下，换成了ejs模版，代码如下&lt;/p&gt;
&lt;p&gt;  routes中index.js文件代码&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('fede8bf8-0a6d-4eef-90bd-fa324e3bdfdb')&quot; readability=&quot;34&quot;&gt;&lt;img id=&quot;code_img_closed_fede8bf8-0a6d-4eef-90bd-fa324e3bdfdb&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_fede8bf8-0a6d-4eef-90bd-fa324e3bdfdb&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('fede8bf8-0a6d-4eef-90bd-fa324e3bdfdb',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_fede8bf8-0a6d-4eef-90bd-fa324e3bdfdb&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; express = require('express'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; router =&lt;span&gt; express.Router();

router.get(&lt;/span&gt;'/', &lt;span&gt;function&lt;/span&gt;&lt;span&gt; (req, res, next) {
    res.render(&lt;/span&gt;'index', { title: 'Nodejs学习笔记（十六）--- Pomelo介绍&amp;amp;入门'&lt;span&gt; });
});

module.exports &lt;/span&gt;= router;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;index.js&lt;/span&gt;&lt;/div&gt;
&lt;p&gt; views中index.ejs文件代码&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;72&quot;&gt;
&lt;pre&gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;&amp;lt;%= title %&amp;gt;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div id=&quot;tipMsg&quot; style=&quot;color:red; height:30px;&quot;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;div id=&quot;pnlLogin&quot;&amp;gt;    
    &amp;lt;h1&amp;gt;1.登录（连接Gate服务器）&amp;lt;/h1&amp;gt;
    用户名：&amp;lt;input id=&quot;txtUserName&quot; type=&quot;text&quot; maxlength=&quot;20&quot; &amp;gt;&amp;lt;/br&amp;gt;
    房间号：&amp;lt;input id=&quot;txtRoomId&quot; type=&quot;text&quot; maxlength=&quot;8&quot; &amp;gt;
    &amp;lt;input id=&quot;btnLogin&quot; type=&quot;button&quot; value=&quot;点击登录&quot; /&amp;gt;
    &amp;lt;br/&amp;gt;
    &amp;lt;/div&amp;gt;    
    &amp;lt;div id=&quot;pnlChat&quot; style=&quot;display:none;&quot;&amp;gt;
    &amp;lt;h1&amp;gt;2.聊天室&amp;lt;/h1&amp;gt;    
    用户名：&amp;lt;span id=&quot;spUserName&quot; style=&quot;color:blue;padding-right:50px;&quot;&amp;gt;&amp;lt;/span&amp;gt;
    房间号：&amp;lt;span id=&quot;spRoomId&quot; style=&quot;color:blue;padding-right:50px;&quot;&amp;gt;&amp;lt;/span&amp;gt;    
    &amp;lt;div id=&quot;txtMessage&quot; style=&quot;width:800px; height:400px;border:1px solid #000; overflow-y:auto; overflow-x:hidden; &quot;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;br/&amp;gt;
    发送给：&amp;lt;select id=&quot;selUserList&quot; style=&quot;width:200px;&quot;&amp;gt;
                &amp;lt;option value=&quot;*&quot;&amp;gt;所有人&amp;lt;/option&amp;gt;
           &amp;lt;/select&amp;gt;
           &amp;lt;br/&amp;gt;
           &amp;lt;br/&amp;gt;
           &amp;lt;textarea id=&quot;txtSendMessage&quot; type=&quot;text&quot; style=&quot;width:690px;height:80px; overflow:auto;float:left;&quot; &amp;gt;&amp;lt;/textarea&amp;gt;
           &amp;lt;input id=&quot;btnSend&quot; type=&quot;button&quot; value=&quot;发送&quot; style=&quot;margin-left:10px; height:80px; width:100px;float:left;&quot; /&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&amp;lt;script src=&quot;js/socket.io.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script src=&quot;js/pomeloclient.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script src=&quot;js/jquery-1.11.2.min.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;&lt;span&gt;

$(&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(){

    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; rid = ''&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; uname = ''&lt;span&gt;;

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;监听&quot;onAdd&quot;, 当有新用户加入时触发&lt;/span&gt;
    pomelo.on('onAdd', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(data) {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; user =&lt;span&gt; data.user;
        $(&lt;/span&gt;'#txtMessage').append('&amp;lt;span style=&quot;color:green;&quot;&amp;gt;[上线提醒]:欢迎 ' + user + ' 加入聊天室&amp;lt;span&amp;gt;&amp;lt;br/&amp;gt;'&lt;span&gt;);

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;添加到用户列表&lt;/span&gt;
        $('#selUserList').append('&amp;lt;option value=&quot;' + user + '&quot;&amp;gt;' + user + '&amp;lt;/option&amp;gt;'&lt;span&gt;);
    });

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;监听&quot;onLeave&quot;, 当有用户离开聊天室时触发&lt;/span&gt;
    pomelo.on('onLeave', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(data) {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; user =&lt;span&gt; data.user;
        $(&lt;/span&gt;'#txtMessage').append('&amp;lt;span style=&quot;color:green;&quot;&amp;gt;[离线提醒]: ' + user + ' 离开聊天室&amp;lt;span&amp;gt;&amp;lt;br/&amp;gt;'&lt;span&gt;);

         &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;从用户列表移除&lt;/span&gt;
        $('#selUserList option[value=&quot;' + user + '&quot;]'&lt;span&gt;).remove();
    });

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 监听&quot;onChat&quot;, 接收消息&lt;/span&gt;
    pomelo.on('onChat', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(data) {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; from =&lt;span&gt; data.from,
            target &lt;/span&gt;=&lt;span&gt; data.target,
            msg &lt;/span&gt;=&lt;span&gt; data.msg;            
                
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(msg === &lt;span&gt;null&lt;/span&gt;) &lt;span&gt;return&lt;/span&gt;&lt;span&gt;;

        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; name = (target == '*' ? '所有人'&lt;span&gt; : target);
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; time =&lt;span&gt; getNowFormatDate();        
        
        $(&lt;/span&gt;&quot;#txtMessage&quot;).append('&amp;lt;span style=&quot;color:blue;&quot;&amp;gt;[' + time +'][' + from + '] 对 [' +  name + '] 说： ' + msg + '&amp;lt;span&amp;gt;&amp;lt;br/&amp;gt;'&lt;span&gt;);
    });

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;当从聊天断开时&lt;/span&gt;
    pomelo.on('disconnect', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(reason) {        
        $(&lt;/span&gt;'#pnlLogin'&lt;span&gt;).show();
        $(&lt;/span&gt;'#pnlChat'&lt;span&gt;).hide();                
    });

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;登录&lt;/span&gt;
    $('#btnLogin').on('click', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(){
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; userNameReg = /^[a-zA-Z0-9]+$/&lt;span&gt;,
            roomIdReg &lt;/span&gt;= /^[0-9]+$/&lt;span&gt;;

            uname &lt;/span&gt;= $.trim($('#txtUserName'&lt;span&gt;).val()),
            rid &lt;/span&gt;= $.trim($('#txtRoomId'&lt;span&gt;).val());

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(uname.length == 0&lt;span&gt;){
            alert(&lt;/span&gt;'请输入登录名'&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        }

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!&lt;span&gt;userNameReg.test(uname)) {
            alert(&lt;/span&gt;'登录名只能由字母或数字组成'&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        }

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(rid.length == 0&lt;span&gt;){
            alert(&lt;/span&gt;'请输入房间号'&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        }

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!&lt;span&gt;roomIdReg.test(rid)) {
            alert(&lt;/span&gt;'房间号只能是数字'&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        }
        
        queryEntry(uname, &lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(host, port){
            $(&lt;/span&gt;'#tipMsg').append('Gate 连接成功! host:' + host + '  port:' + port + '&amp;lt;br/&amp;gt;'&lt;span&gt;);
            
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;连接聊天服务器&lt;/span&gt;
&lt;span&gt;            pomelo.init({
                host: host,
                port: port,
                log: &lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;
            }, &lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
                &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; route = &quot;connector.entryHandler.enter&quot;&lt;span&gt;;
                pomelo.request(route, {
                    username: uname,
                    rid: rid
                }, &lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(data) {
                    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt;(data.error) {
                        $(&lt;/span&gt;'#tipMsg').append('Chat 连接失败!&amp;lt;br/&amp;gt;'&lt;span&gt;);
                        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
                    }            

                    $(&lt;/span&gt;'#tipMsg').append('Chat 连接成功!&amp;lt;br/&amp;gt;'&lt;span&gt;);

                    $(&lt;/span&gt;'#pnlLogin'&lt;span&gt;).hide();
                    $(&lt;/span&gt;'#pnlChat'&lt;span&gt;).show();

                    $(&lt;/span&gt;'#spUserName'&lt;span&gt;).text(uname);
                    $(&lt;/span&gt;'#spRoomId'&lt;span&gt;).text(rid);

                    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;加载当前聊天室 已在线用户列表&lt;/span&gt;
                    $.each(data.users, &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(i, item){                     
                        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(item !=&lt;span&gt; uname){
                            $(&lt;/span&gt;'#selUserList').append('&amp;lt;option value=&quot;' + item + '&quot;&amp;gt;' + item + '&amp;lt;/option&amp;gt;'&lt;span&gt;);
                        }                        
                    }); 

                });
            });
        });
    });

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发送消息&lt;/span&gt;
    $('#btnSend').on('click', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(){
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; route = &quot;chat.chatHandler.send&quot;&lt;span&gt;,
            target &lt;/span&gt;= $(&quot;#selUserList&quot;&lt;span&gt;).val(),
            msg &lt;/span&gt;= $.trim($(&quot;#txtSendMessage&quot;&lt;span&gt;).val());            

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(msg.length == 0&lt;span&gt;){
            alert(&lt;/span&gt;'不能发送空消息!'&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
        }

        pomelo.request(route, {
            rid: rid,
            content: msg,
            from: uname,
            target: target
        }, &lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(data) {
            
            $(&lt;/span&gt;&quot;#txtSendMessage&quot;).val(''&lt;span&gt;);

            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(from ==&lt;span&gt; uname) {
                &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; name = (target == '*' ? '所有人'&lt;span&gt; : target);
                &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; time =&lt;span&gt; getNowFormatDate();        
        
                $(&lt;/span&gt;&quot;#txtMessage&quot;).append('&amp;lt;span style=&quot;color:blue;&quot;&amp;gt;[' + time +'][' + from + '] 对 [' +  name + '] 说： ' + msg + '&amp;lt;span&amp;gt;&amp;lt;br/&amp;gt;'&lt;span&gt;);
            }

        });
        
    });
     
})

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;连接Gate服务器&lt;/span&gt;
&lt;span&gt;function&lt;/span&gt;&lt;span&gt; queryEntry(uid, callback) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; route = 'gate.gateHandler.queryEntry'&lt;span&gt;;
    pomelo.init({
        host: &lt;/span&gt;'127.0.0.1'&lt;span&gt;,
        port: &lt;/span&gt;15014&lt;span&gt;,
        log: &lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;
    }, &lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {    
        pomelo.request(route, {
            uid: uid
        }, &lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(data) {
            pomelo.disconnect();
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(data.code === 500&lt;span&gt;) {                
                alert(&lt;/span&gt;'用户名在此房间中已存在，请重新输入新的用户名!'&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
            }
            callback(data.host, data.port);
        });
    });
};

&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt; getNowFormatDate() {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; date = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Date();
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; seperator1 = &quot;-&quot;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; seperator2 = &quot;:&quot;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; month = date.getMonth() + 1&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; strDate =&lt;span&gt; date.getDate();
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (month &amp;gt;= 1 &amp;amp;&amp;amp; month &amp;lt;= 9&lt;span&gt;) {
        month &lt;/span&gt;= &quot;0&quot; +&lt;span&gt; month;
    }
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (strDate &amp;gt;= 0 &amp;amp;&amp;amp; strDate &amp;lt;= 9&lt;span&gt;) {
        strDate &lt;/span&gt;= &quot;0&quot; +&lt;span&gt; strDate;
    }
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; currentdate = date.getFullYear() + seperator1 + month + seperator1 +&lt;span&gt; strDate
            &lt;/span&gt;+ &quot; &quot; + date.getHours() + seperator2 +&lt;span&gt; date.getMinutes()
            &lt;/span&gt;+ seperator2 +&lt;span&gt; date.getSeconds();
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; currentdate;
}

&lt;/span&gt;&amp;lt;/script&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;   app.js代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('5fcbee27-efb4-4606-94d0-63f42e6c4d6d')&quot; readability=&quot;41.5&quot;&gt;&lt;img id=&quot;code_img_closed_5fcbee27-efb4-4606-94d0-63f42e6c4d6d&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_5fcbee27-efb4-4606-94d0-63f42e6c4d6d&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('5fcbee27-efb4-4606-94d0-63f42e6c4d6d',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_5fcbee27-efb4-4606-94d0-63f42e6c4d6d&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;78&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; express = require('express'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; path = require('path'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; logger = require('morgan'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; cookieParser = require('cookie-parser'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; bodyParser = require('body-parser'&lt;span&gt;);

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; app =&lt;span&gt; express();

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; index = require('./routers/index.js'&lt;span&gt;);

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; views engine setup&lt;/span&gt;
app.set('views', path.join(__dirname, 'views'&lt;span&gt;));
app.set(&lt;/span&gt;'view engine', 'ejs'&lt;span&gt;);

app.use(logger(&lt;/span&gt;'dev'&lt;span&gt;));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: &lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt; }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, &lt;/span&gt;'public'&lt;span&gt;)));

app.use(&lt;/span&gt;'/'&lt;span&gt;, index);

app.use(&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(req, res, next) {
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; err = &lt;span&gt;new&lt;/span&gt; Error('Not Found'&lt;span&gt;);
    err.status &lt;/span&gt;= 404&lt;span&gt;;
    res.render(&lt;/span&gt;'404'&lt;span&gt;);
});

&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (app.get('env') === 'development'&lt;span&gt;) {
    app.use(&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(err, req, res, next) {
        console.log(err);
        res.status(err.status &lt;/span&gt;|| 500&lt;span&gt;);
        res.render(&lt;/span&gt;'500'&lt;span&gt;, {
            message: err.message,
            error: err
        });
    });
}

app.use(&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(err, req, res, next) {
    console.log(err);
    res.status(err.status &lt;/span&gt;|| 500&lt;span&gt;);
    res.render(&lt;/span&gt;'500'&lt;span&gt;, {
        message: err.message,
        error: {}
    });
});

app.listen(&lt;/span&gt;10111, &lt;span&gt;function&lt;/span&gt;&lt;span&gt; () {
    console.log(&lt;/span&gt;&quot;You can debug your app test with http://127.0.0.1:10111&quot;&lt;span&gt;);
});

module.exports &lt;/span&gt;= app;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;app.js&lt;/span&gt;&lt;/div&gt;

&lt;p&gt; 运行起来后，测试结果如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images.cnblogs.com/cnblogs_com/zhongweiv/1119680/o_pomelo.gif&quot; alt=&quot;&quot; width=&quot;965&quot; height=&quot;893&quot;/&gt;&lt;/p&gt;


&lt;p&gt;   Pomelo学习入门不算复杂，写一篇感觉讲不全，写多篇感觉太散，大家将就着看，有些东西不认识的还是去看一下API文档 &lt;a class=&quot;wilson_quote&quot; href=&quot;http://pomelo.netease.com/api.html&quot;&gt;http://pomelo.netease.com/api.html&lt;/a&gt;  (也是低水准的官方API^_^!)&lt;/p&gt;
&lt;p&gt;   或者问一下google啥的... &lt;/p&gt;
&lt;p&gt;   可以参考这两个例子来学习：&lt;/p&gt;
&lt;p&gt;   &lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/chatofpomelo&quot;&gt;https://github.com/NetEase/chatofpomelo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;   &lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/lordofpomelo&quot;&gt;https://github.com/NetEase/lordofpomelo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;   入门建议从chatofpomelo开始&lt;/p&gt;
&lt;p&gt;   看之前可以提前看看一些pomelo术语，有个大体了解，再边看代码边理解：&lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo/wiki/%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A&quot;&gt;https://github.com/NetEase/pomelo/wiki/%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   主要参考资料：&lt;/p&gt;
&lt;p&gt;   &lt;a class=&quot;wilson_quote&quot; href=&quot;https://github.com/NetEase/pomelo/wiki/Home-in-Chinese&quot;&gt;https://github.com/NetEase/pomelo/wiki/Home-in-Chinese&lt;/a&gt;  (比较杂乱，可能官方大神都忙着搞赚钱的项目，将就着看，有很多东西对入门来说还是很有用的)&lt;/p&gt;

&lt;p&gt;   如果有些问题解决不了，可以去社区问一下：&lt;a class=&quot;wilson_quote&quot; href=&quot;http://nodejs.netease.com/tag/pomelo&quot;&gt;http://nodejs.netease.com/tag/pomelo&lt;/a&gt;  （感觉现在活跃度也比较低^_^!）&lt;/p&gt;
</description>
<pubDate>Fri, 24 Nov 2017 06:26:00 +0000</pubDate>
<dc:creator>porschev</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/zhongweiv/p/nodejs_pomelo.html</dc:identifier>
</item>
<item>
<title>NuGet的使用、部署、搭建私有服务 - 杰哥很忙</title>
<link>http://www.cnblogs.com/Jack-Blog/p/7890369.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Jack-Blog/p/7890369.html</guid>
<description>&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;h3 id=&quot;什么是nuget&quot;&gt;什么是NuGet?&lt;/h3&gt;
&lt;p&gt;Nuget是一个.NET平台下的开源的项目，它是Visual Studio的扩展。在使用Visual Studio开发基于.NET Framework的应用时，Nuget能把在项目中添加、移除和更新引用的工作变得更加快捷方便。&lt;/p&gt;
&lt;h3 id=&quot;为什么要使用nuget&quot;&gt;为什么要使用NuGet&lt;/h3&gt;
&lt;p&gt;如果我们项目开发不需要引用任何第三方库包或者我们自己的公共库包，那么使用NuGet毫无作用，但是实际情况恰恰相反，任何项目都需要记录日志，最好的情况是我们有一个公共的日志模块，任何老项目或新项目我们可以引用它，就无需再做开发。在新项目上来说这大大降低了工作量和开发量，因此我们需要一个库包管理机制来管理我们私有库包和我们需要使用的第三方库包。&lt;/p&gt;
&lt;h3 id=&quot;nuget的优点&quot;&gt;NuGet的优点&lt;/h3&gt;
&lt;p&gt;拿&lt;code&gt;AsyncModule.NetMQ.dll&lt;/code&gt;举例，&lt;code&gt;AsyncModule.NetMQ.dll&lt;/code&gt;依赖&lt;code&gt;NetMQ.dll&lt;/code&gt;，而&lt;code&gt;NetMQ.dll&lt;/code&gt;又依赖&lt;code&gt;AsyncIO.dll&lt;/code&gt;。&lt;br/&gt;目前我们需要数据库连接的地方我们需要引用&lt;code&gt;AsyncModule.NetMQ.dll&lt;/code&gt;,我们可能会把它手工烤到我们需要的项目中，但是由于&lt;code&gt;AsyncModule.NetMQ.dll&lt;/code&gt;需要依赖&lt;code&gt;NetMQ.dll&lt;/code&gt;，因此我们还需要手工把&lt;code&gt;NetMQ.dll&lt;/code&gt;拷到我们的项目中，同时由于&lt;code&gt;NetMQ.dll&lt;/code&gt;需要依赖&lt;code&gt;AsyncIO.dll&lt;/code&gt;,因此我们还需要手工把&lt;code&gt;AsyncIO.dll&lt;/code&gt;拷到我们的项目中。依赖这当中就会有些问题，比如我们忘记拷了，或者我们拷的版本不是我们当前需要的，就会导致很多问题。&lt;br/&gt;&lt;code&gt;NuGet&lt;/code&gt;就可以让我们避免这个问题。若我们需要的库包已经导入到我们库包服务器中，那么我们只需要一条语句就可以引用该dll，同时&lt;code&gt;NuGet&lt;/code&gt;会自动将其依赖包一起引用到我们的项目中，这完全是自动的。&lt;/p&gt;
&lt;h2 id=&quot;使用&quot;&gt;使用&lt;/h2&gt;
&lt;p&gt;在VS中找到 &lt;code&gt;Package Manager Console&lt;/code&gt;对话框&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124103240-1.png&quot; alt=&quot;20171124103240-1&quot;/&gt;&lt;br/&gt;若界面上没有找到，则从工具-NuGet Package Manager下找&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124103518-2.png&quot; alt=&quot;20171124103518-2&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;get-help-nuget&quot;&gt;Get-Help NuGet&lt;/h3&gt;
&lt;p&gt;使用&lt;code&gt;Get-Help NuGet&lt;/code&gt;命令查看帮助&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;PM&amp;gt; Get-Help nuget
TOPIC
    about_NuGet
    
SHORT DESCRIPTION
    Provides information about NuGet Package Manager commands.
           
LONG DESCRIPTION
    This topic describes the NuGet Package Manager commands. NuGet is an integrated package 
    management tool for adding libraries and tools to .NET projects.

                 
    The following NuGet cmdlets are included.

        Cmdlet                  Description
        ------------------      ----------------------------------------------
        Get-Package             Gets the set of installed packages.  With -ListAvailable, 
                                gets the set of packages available from the package source.

        Install-Package         Installs a package and its dependencies into the project.

        Uninstall-Package       Uninstalls a package. If other packages depend on this package, 
                                the command will fail unless the –Force option is specified.

        Update-Package          Updates a package and its dependencies to a newer version.

        Add-BindingRedirect     Examines all assemblies within the output path for a project
                                and adds binding redirects to the application (or web) 
                                configuration file where necessary.
                            
        Get-Project             Returns a reference to the DTE (Development Tools Environment) 
                                for the specified project. If none is specifed, returns the 
                                default project selected in the Package Manager Console.

        Open-PackagePage        Open the browser pointing to ProjectUrl, LicenseUrl or 
                                ReportAbuseUrl of the specified package.

        Register-TabExpansion   Registers a tab expansion for the parameters of a command.

SEE ALSO
    Online documentation: http://go.microsoft.com/fwlink/?LinkID=206619
    Get-Package
    Install-Package
    Uninstall-Package
    Update-Package
    Add-BindingRedirect
    Get-Project
    Open-PackagePage
    Register-TabExpansion&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;install-package&quot;&gt;Install-Package&lt;/h3&gt;
&lt;p&gt;使用&lt;code&gt;Install-Package&lt;/code&gt;安装库包，安装时会自动安装当前Framework知道的库包及依赖包，若不支持则会提示错误。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;PM&amp;gt; Install-Package AsyncModule.NetMQ
Attempting to resolve dependency 'NetMQ (≥ 4.0.0.1)'.
Attempting to resolve dependency 'AsyncIO (≥ 0.1.26)'.
Installing 'AsyncIO 0.1.26.0'.
Successfully installed 'AsyncIO 0.1.26.0'.
Installing 'NetMQ 4.0.0.1'.
Successfully installed 'NetMQ 4.0.0.1'.
Installing 'AsyncModule.NetMQ 1.1.0'.
Successfully installed 'AsyncModule.NetMQ 1.1.0'.
Adding 'AsyncIO 0.1.26.0' to NuGet.Client.
Successfully added 'AsyncIO 0.1.26.0' to NuGet.Client.
Adding 'NetMQ 4.0.0.1' to NuGet.Client.
Successfully added 'NetMQ 4.0.0.1' to NuGet.Client.
Adding 'AsyncModule.NetMQ 1.1.0' to NuGet.Client.
Successfully added 'AsyncModule.NetMQ 1.1.0' to NuGet.Client.&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;安装的时候注意对应的库包源&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;get-package&quot;&gt;Get-Package&lt;/h3&gt;
&lt;p&gt;使用&lt;code&gt;Get-Package&lt;/code&gt;安装库包&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;PM&amp;gt; Get-Package

Id                             Version              Description/Release Notes                                                                                                                                     
--                             -------              -------------------------                                                                                                                                     
AsyncIO                        0.1.26.0             AsyncIO                                                                                                                                                       
AsyncModule.NetMQ              1.1.0                基于NetMQ的异步Socket框架                                                                                                                                            
NetMQ                          4.0.0.1              A 100% native C# port of the lightweight high performance messaging library ZeroMQ                                                                            &lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;uninstall-package&quot;&gt;Uninstall-Package&lt;/h3&gt;
&lt;p&gt;使用&lt;code&gt;Uninstall-Package&lt;/code&gt;卸载已安装的库包，依赖包不会自动卸载，有需要则需要手工卸载依赖包&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;PM&amp;gt; Uninstall-Package AsyncModule.NetMQ
Removing 'AsyncModule.NetMQ 1.1.0' from NuGet.Client.
Successfully removed 'AsyncModule.NetMQ 1.1.0' from NuGet.Client.
Uninstalling 'AsyncModule.NetMQ 1.1.0'.
Successfully uninstalled 'AsyncModule.NetMQ 1.1.0'.&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;若库包有多个版本则在库包后面加上&lt;code&gt;-Version 版本号&lt;/code&gt;参数安装指定版本的库包。若依赖包指定版本已经安装则不会重复重新安装。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;PM&amp;gt; Install-Package AsyncModule.NetMQ -Version 1.1.0
Attempting to resolve dependency 'NetMQ (≥ 4.0.0.1)'.
Attempting to resolve dependency 'AsyncIO (≥ 0.1.26)'.
Installing 'AsyncModule.NetMQ 1.1.0'.
Successfully installed 'AsyncModule.NetMQ 1.1.0'.
Adding 'AsyncModule.NetMQ 1.1.0' to NuGet.Client.
Successfully added 'AsyncModule.NetMQ 1.1.0' to NuGet.Client.&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;当然也可以使用图形界面找到上图中的&lt;code&gt;Manager NuGet Package For Solution...&lt;/code&gt;打开图形界面，在需要安装的库包右侧点击安装，和输入命令是一样的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124103850-3.png&quot; alt=&quot;20171124103850-3&quot;/&gt;&lt;/p&gt;
&lt;p&gt;界面左侧列表包含已安装库包，在线，更新等筛选，在线里面根据数据源分类。中间则是当前数据源库包列表，右侧则是搜索栏和选中库包的详细信息。&lt;/p&gt;
&lt;p&gt;当安装了依赖包我们可以在项目根目录找到&lt;code&gt;packages.config&lt;/code&gt;文件，会记录我们安装的库包及版本信息&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124105559-6.png&quot; alt=&quot;20171124105559-6&quot;/&gt;&lt;/p&gt;
&lt;p&gt;同时在我们的项目文件夹下会有个&lt;code&gt;packages&lt;/code&gt;的文件夹用于保存我们下载下来的库包&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124105740-7.png&quot; alt=&quot;20171124105740-7&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;制作nuget库包&quot;&gt;制作NuGet库包&lt;/h2&gt;
&lt;p&gt;若我们需要上传我们的dll到NuGet服务器中，首先需要让我们VS编译时能导出NuGet所支持的&lt;code&gt;.nupkg&lt;/code&gt;文件&lt;br/&gt;在解决方案上面右击找到&lt;code&gt;Enable NuGet Package Restore&lt;/code&gt;点击开启功能&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124111344-8.png&quot; alt=&quot;20171124111344-8&quot;/&gt;&lt;br/&gt;开启后我们需要手动在项目的&lt;code&gt;.csproj&lt;/code&gt;文件中在&lt;code&gt;PropertyGroup&lt;/code&gt;下加入&lt;code&gt;&amp;lt;BuildPackage&amp;gt;true&amp;lt;/BuildPackage&amp;gt;&lt;/code&gt;，再次编译项目就会自动编译出&lt;code&gt;.nupkg&lt;/code&gt;文件。&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112411257-9.png&quot; alt=&quot;2017112411257-9&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;搭建nuget服务器&quot;&gt;搭建NuGet服务器&lt;/h2&gt;
&lt;p&gt;新建一个项目&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124115849-10.png&quot; alt=&quot;20171124115849-10&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124115856-11.png&quot; alt=&quot;20171124115856-11&quot;/&gt;&lt;br/&gt;这里使用3.0版本的NuGet.Server，需要.Net Framework 4.6支持。&lt;br/&gt;然后引用NuGet.Server库包&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;PM&amp;gt; Install-Package NuGet.Server&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;安装完成后，编译启动即可，就是这么简单，然后托管到IIS上。&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112412219-12.png&quot; alt=&quot;2017112412219-12&quot;/&gt;&lt;br/&gt;上传库包的时候可能需要apikey，需要在&lt;code&gt;web.config&lt;/code&gt;中设置。&lt;/p&gt;
&lt;h2 id=&quot;上传netget库包&quot;&gt;上传NetGet库包&lt;/h2&gt;
&lt;p&gt;编译出NuGet我们需要将包上传到NuGet服务器中，这样我们才能在VS中从NuGet服务器中下载下来。这里我使用&lt;a href=&quot;https://github.com/NuGetPackageExplorer/NuGetPackageExplorer&quot;&gt;NuGet Package Explorer&lt;/a&gt;工具进行上传,官方支持Win10商店和使用Chocolatey下载。&lt;br/&gt;若需要上传到NuGet官方服务器中可以在&lt;a href=&quot;https://www.nuget.org/&quot;&gt;NuGet官网&lt;/a&gt;上传，但是我们一般需要上传到指定NuGet服务器上，如我们自己的NuGet服务器。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112412320-13.png&quot; alt=&quot;2017112412320-13&quot;/&gt;&lt;br/&gt;选择第一项找到本地的&lt;code&gt;.nupkg&lt;/code&gt;文件&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112412435-14.png&quot; alt=&quot;2017112412435-14&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112412514-15.png&quot; alt=&quot;2017112412514-15&quot;/&gt;&lt;br/&gt;左侧可以编译一下信息，&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112412612-16.png&quot; alt=&quot;2017112412612-16&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124134626-17.png&quot; alt=&quot;20171124134626-17&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124134958-17.png&quot; alt=&quot;20171124134958-17&quot;/&gt;&lt;br/&gt;当上传了多个版本的dll，NuGet.Server会根据包Id和Version进行分组&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/20171124135034-18.png&quot; alt=&quot;20171124135034-18&quot;/&gt;&lt;/p&gt;
&lt;p&gt;在输入命令的时候可以用&lt;code&gt;TAB&lt;/code&gt;键智能提示出当前所有版本号&lt;br/&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112414219-19.png&quot; alt=&quot;2017112414219-19&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我们也可用通过命令上传&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;nuget.exe push {package file} {apikey} -Source http://www.jnuget.com:10080/nuget&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;当我们同一个包上传过同一个版本的时候再次上传会报错，我们需要删除NuGet.Server已存在的包，后才能再次上传。或者我们可以允许通过包同一个版本允许覆盖上传，将&lt;code&gt;web.Config&lt;/code&gt;的&lt;code&gt;allowOverrideExistingPackageOnPush&lt;/code&gt;配置改为true即可&lt;/p&gt;
&lt;h2 id=&quot;新增nuget源&quot;&gt;新增NuGet源&lt;/h2&gt;
&lt;p&gt;在Tools-Options-NuGet Package Manager-Package Sources可以增加数据源&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xl0cr.com1.z0.glb.clouddn.com/2017112414424-20.png&quot; alt=&quot;2017112414424-20&quot;/&gt;&lt;br/&gt;点击右上角的加号新增，输入完地址后点一下更新即可。&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;通过此片文章讲解了如何使用、部署NuGet，如何编译生成，上传库包到NuGet。&lt;/p&gt;
</description>
<pubDate>Fri, 24 Nov 2017 06:16:00 +0000</pubDate>
<dc:creator>杰哥很忙</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Jack-Blog/p/7890369.html</dc:identifier>
</item>
<item>
<title>Security7：管理SQL Server Agent的权限 - 悦光阴</title>
<link>http://www.cnblogs.com/ljhdo/p/5177423.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/ljhdo/p/5177423.html</guid>
<description>&lt;p&gt;SQL Server Agent对象包括警报（Alert），操作员（Operator），Job，调度（Schedule）和代理（Proxy），SQL Server使用msdb系统数据库管理Agent 对象的权限，msdb内置三个固定数据库角色，按照权限从小到大的顺序，依次是：SQLAgentUserRole&lt;strong&gt;、&lt;/strong&gt;SQLAgentReaderRole 和SQLAgentOperatorRole。如果一个用户不是这三个角色或sysadmin角色中的成员，那么该用户通过SSMS的Object Explorer看不到Agent节点。一个用户必须是SQLAgent的角色或sysadmin角色的成员，才能使用SQL Server Agent。&lt;/p&gt;
&lt;p&gt;另外，Agent的权限，还跟代理（Proxy）的访问权限有关，代理是用来执行Job Step的，只有建立代理和登陆（Login）之间的映射，用户创建（Own）的Job才能执行。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一，Agent固定数据库角色&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SQLAgentUserRole&lt;/strong&gt; 角色被授予操作Agent的最小权限的集合，其成员只能对其创建的本地Job和Job Schedule具有操作权限，也就是有，该角色的成员对于Owner是自己的Job具有权限，并且不能修改job的所有权（Ownership）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SQLAgentUserRole&lt;/strong&gt; 角色具有的权限：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;具有操作本地Job和Job Schedule的所有权限，包括创建（Create）、删除（Delete），修改（Modify），启用（Enable）、禁用（Disable）、执行（Execute）、开始（Start）、停止（Stop）等，但是不能修改Job的所有权关系（Ownership）；&lt;/li&gt;
&lt;li&gt;查看Owned Jobs的执行日志，但是不具有删除历史日志的权限；&lt;/li&gt;
&lt;li&gt;查看可用的Operator列表；&lt;/li&gt;
&lt;li&gt;查看可用的Proxy列表；&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;SQLAgentReaderRole&lt;/strong&gt; 角色，除了具有Multiserver jobs的查看权限之外，和&lt;strong&gt;SQLAgentUserRole&lt;/strong&gt;角色的权限相同；&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;SQLAgentOperatorRole&lt;/strong&gt; 角色，除了具有查看警告（Alert）的列表和属性的权限之外，和&lt;strong&gt;SQLAgentReaderRole&lt;/strong&gt; 角色的权限相同；&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;SQLAgentUserRole&lt;strong&gt;、&lt;/strong&gt;SQLAgentReaderRole 和SQLAgentOperatorRole 都对自己创建的Job具有操作权限，都不能修改Job的所有权：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/628084/201711/628084-20171124132516828-412595170.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;sysadmin &lt;/strong&gt;角色的成员，具有SQL Server Agent的全部权限，能够修改Job的所有权。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;二，执行Job Step的权限&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在执行Job Step时，SQL Server Agent使用两种类型的权限，分别是Job Owner和代理（Proxy）。如果创建的Job Step是 Transact-SQL script (T-SQL) 类型，那么使用Job Owner的权限去执行TSQL脚本；如果创建的Job Step是另外11种类型种的一种，那么使用代理的权限去执行Job Step。在Job Step执行之前，Agent模拟凭证指定的Windows User的权限，在该权限范围（Security Context）内执行Job Step，使Job Step有权限访问SQL Server 实例之外的资源。&lt;/p&gt;
&lt;p&gt;代理（Proxy）使得Job Step在特定的安全上下文中执行，DBA需要创建代理，并为代理设置必须的权限。&lt;/p&gt;
&lt;blockquote readability=&quot;11&quot;&gt;
&lt;p&gt;&lt;span&gt;SQL Server Agent lets the database administrator run each job step in a security context that has only the permissions required to perform that job step, which is determined by a SQL Server Agent proxy. To set the permissions for a particular job step, you create a proxy that has the required permissions and then assign that proxy to the job step. A proxy can be specified for more than one job step. For job steps that require the same permissions, you use the same proxy.&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;1，创建代理&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;每一个Proxy都关联一个凭证（Credential），凭证定义了执行Job Step的安全上下文（Security Context）。使用SSMS创建代理，在SQL Server Agent目录下打开新建代理账户（New Proxy Account）的向导，输入新建的代理名称和关联的凭证名称，从11个子系统（subsystem）列表中选择“SQL Server Intergration Services Package”，该子系统用于执行SSIS的Package。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/628084/201711/628084-20171124134107281-1004794923.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/628084/201711/628084-20171124134242250-588106737.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;由于代理的权限是由凭证决定的，因此，在创建代理时，为了有效管控执行Job Step的权限，一般情况下，需要为代理（Proxy）创建专用的用户账户，并未用户授予必需的权限，&lt;/p&gt;
&lt;ul class=&quot;lf-text-block lf-block&quot; data-lf-anchor-id=&quot;8e5064ac45dbf4d52b6b09434f276eeb:0&quot; readability=&quot;25.5&quot;&gt;&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;&lt;span&gt;Create dedicated user accounts specifically for proxies, and only use these proxy user accounts for running job steps.&lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p class=&quot;x-hidden-focus&quot;&gt;&lt;span&gt;Only grant the necessary permissions to proxy user accounts. Grant only those permissions actually required to run the job steps that are assigned to a given proxy account.&lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;2，授予Login访问代理的权限&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在SQL Server中，不是所有的login都有权限访问Proxy。为Proxy添加服务器级别（Server-Level）的安全主体（Login），授予其访问Proxy的权限，这样，用户就能够引用Proxy去执行Job Step。&lt;/p&gt;
&lt;p&gt;在Principals Tab中，授予Login，服务器角色（server role）或msdb数据库角色访问Proxy的权限。只有被授予访问Proxy权限的Principal，才能在Job Step中使用Proxy。默认情况下，固定服务器角色 sysadmin的成员有权限访问实例中的所有Proxy。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/628084/201711/628084-20171124134540359-271910352.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3，引用代理&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果Login有权限访问Proxy，或者Login属于有权限访问Proxy的服务器角色（Server Role），那么用户能够在Job Step中使用Proxy，例如，在创建Job Step，从Run as 列表种选择可访问的Proxy：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/628084/201711/628084-20171124132732265-1881046530.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;三，安全组（Security Group）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在Windows 域环境中，如果把Job的Owner设置为Security Group（SG），该组的成员无法访问该Job，只有把Job的Owner设置为用户的Windows 账户时，用户才能操作Job。&lt;/p&gt;

&lt;p&gt;参考文档：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/sql/ssms/agent/sql-server-agent&quot; target=&quot;_blank&quot;&gt;SQL Server Agent&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/sql/ssms/agent/implement-sql-server-agent-security&quot; target=&quot;_blank&quot;&gt;Implement SQL Server Agent Security&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/sql/ssms/agent/sql-server-agent-fixed-database-roles&quot; target=&quot;_blank&quot;&gt;SQL Server Agent Fixed Database Roles&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 24 Nov 2017 05:59:00 +0000</pubDate>
<dc:creator>悦光阴</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/ljhdo/p/5177423.html</dc:identifier>
</item>
<item>
<title>chrome扩展程序开发 - 编程人，在天涯</title>
<link>http://www.cnblogs.com/wujuntian/p/7890091.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/wujuntian/p/7890091.html</guid>
<description>&lt;p&gt;&lt;span&gt;　　前几天某懒产品经理提出了一个懒需求，大概是这样的：想从我们公司的cms后台点击进入另一个第三方后台的同时，将cms后台的一些数据自动填充到那个第三方后台的一些表单中。也就是说，以前他们需要把数据、文字一个一个拷贝粘贴到第三方后台，现在他们不干了，想让我帮他们实现这个自动“搬迁”数据的过程。这该怎么办呢？那个第三方后台也不是我能控制的了的啊，这时就要使用chrome扩展程序这个神器了，它可以实现浏览器上多个页面之间的数据传递呢！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　关于chrome扩展程序的开发，网上有一个比较完整的中文翻译的开发文档——&lt;a href=&quot;http://open.chrome.360.cn/extension_dev/overview.html&quot; target=&quot;_blank&quot;&gt;http://open.chrome.360.cn/extension_dev/overview.html&lt;/a&gt;，有兴趣可以翻阅一下。chrome扩展程序能做的事情还是挺多挺好玩的，不过这篇博文我只是想以一个很简单的例子来讲解一下它的基本开发过程，从代码编写到加载运行，最后再说明一下整个扩展程序的运行原理以及调试。这个简单例子是这样的：将一些QQ邮箱的账号密码写在文件中，然后进入QQ邮箱登陆界面的时候带入一个id参数，chrome扩展程序根据这个id去读取QQ账号密码自动填充到登录表单中，无需我们手动输入，然后这个扩展程序还要能记录邮箱的登录情况。废话不多说，这就开始了！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　首先创建一个空文件夹qqmail用于存放这个扩展程序所有的代码文件，然后写一个配置文件manifest.json，配置文件各个参数配置和意义如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;48&quot;&gt;
&lt;pre class=&quot;brush:javascript;gutter:true;&quot;&gt;
&lt;span&gt;{
        &quot;name&quot;: &quot;QQ Mail Extention&quot;,//扩展程序名称
        &quot;version&quot;: &quot;1.0&quot;,//版本
        &quot;manifest_version&quot;: 2,//一定要为2，否则会报错
        &quot;description&quot;: &quot;This Extention can help you manifest_versionto login QQ Mail faster!&quot;,//扩展程序描述
        &quot;browser_action&quot;: {
                &quot;default_icon&quot;: &quot;logo.png&quot;,//默认图标
                &quot;default_popup&quot;: &quot;popup.html&quot;//点击图标时弹出的页面
        },
        &quot;background&quot;: {
                &quot;persistent&quot;: true,
                &quot;scripts&quot;: [&quot;background.js&quot;]//扩展程序背景页脚本
        },
        &quot;content_scripts&quot;: [{
                &quot;all_frames&quot;: true,//是否运行在页面所有frame中，设置为true时扩展程序在iframe中也能起作用
                &quot;matches&quot;: [&quot;*://*/*&quot;],//定义那些页面需要注入content script脚本
                &quot;js&quot;: [&quot;jq.1.8.2_dev.js&quot;,&quot;content_scripts.js&quot;]//需要向页面注入的content script脚本
        }],
        &quot;permissions&quot;: [//扩展程序权限
                &quot;tabs&quot;, &quot;webNavigation&quot;
        ]
}　　&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;说明（browser_action和page_action只能选其中一个）：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;browser_action：扩展程序图标在chrome地址栏之外，chrome主工具栏右侧。定义处理事件适用于所有页面。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;page_action：扩展程序图标在chrome地址栏之内右侧。定义需要处理的页面的事件，并不是适用于所有页面的。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;扩展程序背景页脚本：在以上配置中为background.js，是一个独立于所有页面的脚本，常用于管理一些任务或状态，可作为不同页面之间传递数据的桥梁。它会在扩展程序的整个生命周期都存在，同时，在同一时间只有一个实例处于活动状态。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　接下来，编写扩展程序弹窗页面popup.html：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;36&quot;&gt;
&lt;pre class=&quot;brush:html;gutter:true;&quot;&gt;
&lt;span&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
        &amp;lt;head&amp;gt;
                &amp;lt;title&amp;gt;QQ邮箱快捷登录插件&amp;lt;/title&amp;gt;
                &amp;lt;meta charset=&quot;UTF-8&quot;&amp;gt;
                &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&amp;gt;
                &amp;lt;style&amp;gt;
                        table{border-collapse:collapse}
                        table td{padding:5px}
                &amp;lt;/style&amp;gt;
        &amp;lt;/head&amp;gt;
        &amp;lt;body style=&quot;height:150px;width:200px&quot;&amp;gt;
                &amp;lt;h3&amp;gt;当前QQ邮箱信息&amp;lt;/h3&amp;gt;
                &amp;lt;div id=&quot;info&quot;&amp;gt;&amp;lt;/div&amp;gt;
        &amp;lt;/body&amp;gt;
        &amp;lt;script src=&quot;jq.1.8.2_dev.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
        &amp;lt;script src=&quot;popup.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;　　popup.html中引入了两个js文件，一个是jQuery文件，另一个则是用于刷新弹窗内容的popup.js，不过，这里要先介绍一下扩展程序背景页脚本background.js：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;50&quot;&gt;
&lt;pre class=&quot;brush:javascript;gutter:true;&quot;&gt;
&lt;span&gt;var qqmail = new function() {
        var I = this, info = {'hasInfo': 0},//当前邮箱信息
        accounts = {//所有QQ邮箱账号配置
                1: {
                        'username': '2******04@qq.com',//账号
                        'password': '1242444',//密码
                        'password2': '341222'//独立密码
                },
                2: {
                        'username': '8834839@sina.com',
                        'password': '1234245',
                        'password2': '2141211'
                },
                3: {
                        'username': '8110110109@qq.com',
                        'password': '111111',
                        'password2': '222222'
                }
        };
        
        I.setInfo = function(id) {//设置当前邮箱信息
                if(accounts[id]) {
                        info = accounts[id];
                        info.hasInfo = 1;
                        I.setStatus(0);
                }
        };
        
        I.setStatus = function(i) {//设置当前邮箱状态
                var status = {
                        0: '未登录',
                        1: '还需输入独立密码',
                        2: '已登录',
                        3: '已退出登录'
                };
                if(status[i]) info.status = status[i];
        };
        
        I.getInfo = function() {//获取当前邮箱信息
                return info;
        };
};

chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {//监听来自content_scripts.js的消息并作出响应
        var f = qqmail[request.cmd];
        if(typeof f === 'function') {
                var ret = f(request.par);
                if(typeof sendResponse == 'function') {
                        sendResponse(ret);
                }
        }
});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;这个文件主要记录了一些QQ邮箱的账号、密码和独立密码，并维护当前登录邮箱的登录状态，使用chrome.runtime.onMessage.addListener()监听来自content script脚本的请求。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　好了，现在回过头来看看popup.js：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;41&quot;&gt;
&lt;pre class=&quot;brush:javascript;gutter:true;&quot;&gt;
&lt;span&gt;(function() {
        var fn = function() {
                var info = chrome.extension.getBackgroundPage().qqmail.getInfo(), s = '';
                if(info.hasInfo) {
                        var cfg = {
                                'username': '邮箱',
                                'password': '密码',
                                'password2': '独立密码',
                                'status': '登录状态'
                        };
                        s = '&amp;lt;table border=&quot;1&quot;&amp;gt;';
                        $.each(info, function(k, v) {
                                if(cfg[k]) s += '&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;' + cfg[k] + '&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;' + v + '&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;';
                        });
                        s += '&amp;lt;/table&amp;gt;';
                } else {
                        s = '尚无任何QQ邮箱信息......';
                }
                $('#info').html(s);
        };
        fn();
})();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;这个js文件主要是通过chrome.extension.getBackgroundPage()与扩展程序背景页脚本background.js取得联系，并调用其中的qqmail.getInfo()取得当前登录邮箱的信息，刷新弹窗页面popup.html的内容。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　最后就是content script文件content_scripts.js：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;53&quot;&gt;
&lt;pre class=&quot;brush:javascript;gutter:true;&quot;&gt;
&lt;span&gt;(function() {
        var init = function() {
                if(location.href.indexOf('https://mail.qq.com/?id=') &amp;gt;= 0) {//QQ邮箱登录主页面
                        var id = location.href.split('=')[1];
                        send('setInfo', id);//初始化当前邮箱信息
                } else if(location.href.indexOf('https://xui.ptlogin2.qq.com/cgi-bin/xlogin') &amp;gt;= 0) {//QQ邮箱登录表单iframe
                        send('getInfo', function(ret) {//获取当前邮箱信息填充登录表单
                                getObj('[name=&quot;u&quot;]', function(o) {
                                        o.val(ret.username);
                                        $('[name=&quot;p&quot;]').val(ret.password);
                                });
                        });
                } else if(location.href.indexOf('https://mail.qq.com/cgi-bin/loginpage?autologin') &amp;gt;= 0) {//填写QQ邮箱独立密码
                        send('setStatus', 1);//设置邮箱状态
                        send('getInfo', function(ret) {//获取当前邮箱信息填充登录表单
                                getObj('[name=&quot;pp&quot;]', function(o) {
                                        o.val(ret.password2);
                                });
                        });
                } else if(location.href.indexOf('https://mail.qq.com/cgi-bin/frame_html') &amp;gt;= 0) {//QQ邮箱成功登录
                        send('setStatus', 2);//设置邮箱状态
                } else if(location.href.indexOf('https://mail.qq.com/cgi-bin/loginpage?t=wx_logout') &amp;gt;= 0) {//QQ邮箱退出登录
                        send('setStatus', 3);//设置邮箱状态
                }
        },
        getObj = function(s, fn, tm, tmout) {//控件加载完成才获取，防止控件尚未加载完成而导致获取不到对象
                tm = tm || 100;
                var t = setInterval(function() {
                        var o = $(s);
                        if(o[0]) {
                                clearInterval(t);
                                if(tmout &amp;amp;&amp;amp; tmout &amp;gt; 0) {
                                        setTimeout(function() {
                                                fn(o);
                                        }, tmout);
                                } else {
                                        fn(o);
                                }
                        }
                }, tm);
        };
        send = function(cmd, par, cb){//给background.js发消息
                if(typeof par == 'function'){
                        cb = par;
                        par = '';
                }
                chrome.runtime.sendMessage({cmd:cmd, par:par}, cb);
        };
        $(init);
})();　　&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;这个脚本是运行在chrome每一个页面的，主要工作就是判断当前页面是哪个页面并作出相应动作，使用chrome.runtime.sendMessage()从背景页脚本请求数据、发送邮箱登陆状态给背景页。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　好了，到这里这个简单的chrome扩展程序便开发完成了，目录的所有文件如下：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/747151/201711/747151-20171124114213750-1106495043.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;代码编写完毕之后便可以开始加载这个扩展程序来运行了，在chrome上的操作示意图如下：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/747151/201711/747151-20171124115656109-1739988540.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;点击“加载已解压的扩展文件”选中刚刚的目录qqmail，加载之后信息如下：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/747151/201711/747151-20171124115905890-1307899373.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;至此，这个简单的chrome扩展程序已经开始运行，接下来操作一下邮箱登录过程，并逐步说明这个扩展程序的运行过程与原理。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　加载之后点击扩展程序图标，弹窗页面脚本popup.js便会请求背景页脚本background.js，获取邮箱信息，刷新弹窗页面内容，由于此时还没有进入QQ邮箱登录页面并传id参数，所以background.js中还没有当前登录邮箱的任何信息，所以弹窗页面是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/747151/201711/747151-20171124120603265-350874505.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;接下来打开QQ邮箱登录页面并传id，比如这样：https://mail.qq.com/?id=1，进入这个页面之后content script脚本content_scripts.js通过url匹配找到要执行的动作，即：取得参数id的值，并调用背景页脚本background.js的qqmail.setInfo()函数，取得当前要登录邮箱的信息并保存在info对象中。这时，由于QQ邮箱登录表单位于登录页面中的iframe中，扩展程序的content script脚本content_scripts.js也运行其中，通过脚本中第二个url匹配，发送消息给背景页脚本background.js，调用其中的qqmail.getInfo()函数取得info对象中的账号和密码，自动填充到登录表单中，这样就无需我们手动输入了。此时再去点击扩展程序图标，弹窗脚本popup.js再次请求背景页脚本background.js中的qqmail.getInfo()函数获取当前登录QQ邮箱信息，刷新弹窗页面，效果是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/747151/201711/747151-20171124122704078-1822265885.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;接下来，点击登录，进入独立密码填写页面，content script脚本content_scripts.js通过与背景页脚本background.js通信，做两个动作：首先调用qqmail.setStatus()函数设置邮箱登录状态，然后调用qqmail.getInfo()函数取得独立密码并自动填充表单。此时再点击扩展程序图标，popup.js重新请求背景页脚本刷新弹窗页面如下：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/747151/201711/747151-20171124125733281-226793590.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;同样的，登录成功、退出登录时，content script脚本content_scripts.js也都会发消息给背景页脚本background.js去修改当前登录邮箱的登录状态，即更新info对象的值，点击扩展图标时弹窗页面脚本popup.js也会请求背景页脚本background.js获取当前登录邮箱状态，刷新弹窗页面。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　好了，现在大概了解chrome扩展程序大概的运作原理了吧。整个扩展程序主要涉及三个js脚本文件：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1. 弹窗页面脚本：每点击一次扩展程序图标则运行一次，主要负责通过与背景页脚本通信，请求数据，刷新弹窗内容。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2. content script脚本：运行于chrome中每个打开的页面，可与背景页脚本通信，可操作当前页面。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;3. 背景页脚本：独立于chrome任何页面，存在于扩展程序整个生命周期，一般用于保存一些数据状态，充当不同页面之间数据交流的桥梁。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　最后，简单说一下chrome扩展程序开发过程中的调试方法。弹窗页面脚本的调试方法：右键扩展图标，点击“审查弹出内容”即可弹出调试窗口，对弹窗页面进行抓包。content script脚本的调试方法则与一般调试相同，直接按“F12”按钮即可。而背景页脚本，由于没有具体页面，故无法直接调试，可通过弹窗页面脚本和 content script脚本使用一定方法间接调试，因为这两个脚本都可获取到背景页脚本中的数据啊。修改了扩展程序代码之后，保存，然后直接在chrome扩展程序管理页面点击“重新加载”即可生效！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　其实chrome扩展程序能做的事情还真挺多的，本文只是提供了一个很简单的例子来说明它的开发过程与运行过程而已。一般来说，我们可以通过在某个第三方网页的url末尾加上我们自定义的参数，由我们的chrome扩展程序的content script脚本根据这个参数去请求我们自己的接口，获取数据来填充这个网页的表单，或是做一些其他的操作来达到我们的目的，也可以在content script脚本中定义某个页面的某个按钮的点击事件，在事件响应函数中就可以做我们想做的事情就是了，当然了，操作页面上的内容之前，首先要先研究一下这个页面的html代码，不然你怎么知道去操作哪些控件呢是吧。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　本文到此结束，所述内容如有不妥，敬请谅解，欢迎指教，哈哈！&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Fri, 24 Nov 2017 05:30:00 +0000</pubDate>
<dc:creator>编程人，在天涯</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/wujuntian/p/7890091.html</dc:identifier>
</item>
<item>
<title>算法族的集中管理——策略模式 - 一面千人</title>
<link>http://www.cnblogs.com/Evsward/p/Strategy.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Evsward/p/Strategy.html</guid>
<description>&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;策略模式是指对一系列的算法定义，并将每一个算法封装起来，而且使它们还可以相互替换。策略模式让算法独立于使用它的客户而独立变化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们正好可以使用策略模式加适配器模式来将查找算法的调用重新架构。&lt;/p&gt;
&lt;h3 id=&quot;分角色&quot;&gt;分角色&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;环境类Context，直接暴露给客户端使用的类。&lt;/li&gt;
&lt;li&gt;策略类Strategy，是一个抽象类，用于统筹策略&lt;/li&gt;
&lt;li&gt;具体策略类，继承自Strategy，有自己的实现方法。&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;应用&quot;&gt;应用&lt;/h3&gt;
&lt;p&gt;为了学习策略模式，我们将查找算法中的&lt;a href=&quot;http://www.cnblogs.com/Evsward/p/search.html&quot;&gt;BST和RedBlackBST两个类&lt;/a&gt;作为研究素材，研究设计模式肯定是不能修改原有代码，也就是说BST和RedBlackBST不会做任何修改，在此基础上，我们使用&lt;a href=&quot;http://www.cnblogs.com/Evsward/p/adapter.html&quot;&gt;适配器模式&lt;/a&gt;将其封装取出&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;BSTAdapter&lt;/li&gt;
&lt;li&gt;RedBlackBSTAdapter&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;下面展示BSTAdapter的代码，RedBlackAdapter与它相似。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;package pattern.strategy;

import algorithms.search.ST;
import algorithms.search.STImpl.BST;

public class BSTAdapter extends Strategy {
    @Override
    public void algorithm() {
        logger.info(this.getClass().getName());
        ST&amp;lt;Integer, String&amp;gt; st;
        st = new ST&amp;lt;Integer, String&amp;gt;(new BST&amp;lt;Integer, String&amp;gt;());
        testST(st);
    }

}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;然后贴上Strategy的代码，省略了一些与模式无关的内容。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public abstract class Strategy {
    protected static final Logger logger = LogManager.getLogger();

    public abstract void algorithm();// 核心抽象方法

    protected void testST(ST&amp;lt;Integer, String&amp;gt; sst) {...}
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;最后是Context的代码&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;package pattern.strategy;

public class Context {
    private Strategy strategy;

    public void setStrategy(Strategy strategy) {
        this.strategy = strategy;
    }

    public void testSTStrategy() {
        strategy.algorithm();
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;客户端的调用方法&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;package pattern.strategy;

import org.junit.Test;

public class StrategyClient {

    @Test
    public void testStrategy() {
        Context context = new Context();
        context.setStrategy(new RedBlackBSTAdapter());// 运行时指定具体类型
        context.testSTStrategy();
        context.setStrategy(new BSTAdapter());// 运行时指定具体类型
        context.testSTStrategy();
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;输出：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;11:22:50[algorithm]: pattern.strategy.RedBlackBSTAdapter
11:22:50[testST]: 总耗时：69ms
11:22:50[algorithm]: pattern.strategy.BSTAdapter
11:22:51[testST]: 总耗时：88ms&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;下面给出类图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/evsward/mainbase/blob/master/resource/image/patterns/Strategy/strategy.png?raw=true&quot; alt=&quot;image&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;策略模式总结&quot;&gt;策略模式总结&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;我们上面使用的策略模式和适配器模式的联通使得完全没有对BST和RedBlackBST做任何改变即可将它们套用到新的架构之中，所以策略模式是对“开闭原则”的完美实现。&lt;/li&gt;
&lt;li&gt;策略模式提供了管理相关的算法族的办法。策略类的等级结构定义了一个算法或行为族，恰当使用继承可以把公共的代码移到抽象策略类中，从而避免重复的代码。&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;缺点：&lt;/p&gt;
&lt;p&gt;以上展示的策略模式仍旧处于初级阶段，具体算法均需要通过继承来实现，可以作为研究学习使用，仍然存在一些问题，例如对具体策略类的管理，如果使用场景不当，可能每次都要新建一个具体策略类，因此我们这里将其与适配器模式联用有效地避免了这一点。&lt;/p&gt;
</description>
<pubDate>Fri, 24 Nov 2017 04:51:00 +0000</pubDate>
<dc:creator>一面千人</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Evsward/p/Strategy.html</dc:identifier>
</item>
<item>
<title>如何管理Session(防止恶意共享账号)——理论篇 - 枫叶落一地</title>
<link>http://www.cnblogs.com/pheye/p/7890065.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/pheye/p/7890065.html</guid>
<description>&lt;ul&gt;&lt;li&gt;知识要求&lt;/li&gt;
&lt;li&gt;背景&lt;/li&gt;
&lt;li&gt;技术原理&lt;/li&gt;
&lt;li&gt;如何管理&lt;code&gt;Session&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;remember me&lt;/code&gt;的问题&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TODO&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;附录&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;有一定的&lt;code&gt;WEB&lt;/code&gt;后端开发基础，熟悉&lt;code&gt;Session&lt;/code&gt;的用法，以及与&lt;code&gt;Redis&lt;/code&gt;、&lt;code&gt;Database&lt;/code&gt;的配合&lt;/li&gt;
&lt;li&gt;本文的原理讨论基于&lt;code&gt;PHP&lt;/code&gt;的&lt;code&gt;Laravel&lt;/code&gt;，尽管原理是通用的，但是读者具备相关知识理解会更轻松&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;公司在业务层面上，通常会期望自己运营的系统，一个注册帐号只能由本人使用或者少数几个人共用。实际情况却是：有些用户会将注册帐号的用户名和密码共享给成百上千个用户；也有的用户不直接提供用户名和密码，而是提供带有认证信息的&lt;code&gt;cookie&lt;/code&gt;给其他用户，同样达到共享账号的目的。不论哪种形式，都造成了公司业务的损失。因此系统应该具备查看在线用户的功能，并可对在线用户实时管理，防止注册帐号被许多人共享。&lt;/p&gt;

&lt;p&gt;在技术层面上，在线用户都是用&lt;code&gt;Session&lt;/code&gt;表示。&lt;/p&gt;
&lt;p&gt;用户通过用户名和密码正常登陆时，就会产生新的&lt;code&gt;Session&lt;/code&gt;，退出则对应&lt;code&gt;Session&lt;/code&gt;被清除。当多个用户使用同一账号登陆时，就会产生多个&lt;code&gt;Session&lt;/code&gt;，防止共享账号数量太多就是要限制同一账号的&lt;code&gt;Session&lt;/code&gt;数量。但是，这远远不够。&lt;/p&gt;
&lt;p&gt;我们都知道，&lt;code&gt;Session&lt;/code&gt;的原理是通过将&lt;code&gt;session id&lt;/code&gt;写入&lt;code&gt;cookie&lt;/code&gt;，下次浏览器访问时会把&lt;code&gt;cookie&lt;/code&gt;带上来，识别其中的&lt;code&gt;session id&lt;/code&gt;实现的（&lt;code&gt;laravel&lt;/code&gt;存储&lt;code&gt;session_id&lt;/code&gt;的&lt;code&gt;cookie&lt;/code&gt;名称为&lt;code&gt;laravel_session&lt;/code&gt;)。如果将该&lt;code&gt;session id&lt;/code&gt;传递给其他用户，其他用户再将&lt;code&gt;session id&lt;/code&gt;写入&lt;code&gt;cookie&lt;/code&gt;，就可以达到共享账号，同时&lt;code&gt;Session&lt;/code&gt;仍然是同一个的目的（见下图流程）。这种情况使得在线用户管理变得棘手，好在它们的&lt;code&gt;IP&lt;/code&gt;并不相同，所以还是有办法处理。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/73696/201711/73696-20171124123437734-935966657.jpg&quot; alt=&quot;通过cookie共享Session原理&quot;/&gt;&lt;/p&gt;
&lt;p&gt;上面两种形式是共享账号的两种主要形式，于是我们的问题就变成：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;如何管理一个账号对应多个&lt;code&gt;Session&lt;/code&gt;的问题&lt;/li&gt;
&lt;li&gt;如何管理一个&lt;code&gt;Session&lt;/code&gt;多个&lt;code&gt;IP&lt;/code&gt;的问题&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;下面先对如何管理&lt;code&gt;Session&lt;/code&gt;做综述，再对两种情况分开说明。&lt;/p&gt;

&lt;p&gt;管理&lt;code&gt;Session&lt;/code&gt;的前提是&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;系统能够获取到所有的&lt;code&gt;Session&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;获取&lt;code&gt;Session&lt;/code&gt;的所有&lt;code&gt;IP&lt;/code&gt;信息。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;一个高性能的系统，&lt;code&gt;Session&lt;/code&gt;保存在缓存系统，比如&lt;code&gt;Redis&lt;/code&gt;中。通过统一约定以&lt;code&gt;session.&lt;/code&gt;开头的键为&lt;code&gt;Session&lt;/code&gt;，就可以获取到所有&lt;code&gt;Session&lt;/code&gt;，但这实际上是个&lt;strong&gt;很差&lt;/strong&gt;的方法。&lt;code&gt;Redis&lt;/code&gt;的设计并不是为了实现这样的目的，所以它的键值匹配要么效率极低，要么不能保证返回所有结果，同时它的扩展性非常地差，比如只读取某个用户的所有&lt;code&gt;Session&lt;/code&gt;，需要对键的命名再做进一步约束。&lt;/p&gt;
&lt;p&gt;于是我们换了另外一种方案，&lt;code&gt;Session&lt;/code&gt;仍然保存在缓存系统中，同时&lt;strong&gt;异步保存在数据库中&lt;/strong&gt;，注意必须是异步，否则会影响系统的运行。具体原理是，在&lt;code&gt;Session&lt;/code&gt;的写入、销毁、回收这几个阶段发出&lt;code&gt;event&lt;/code&gt;，将&lt;code&gt;session&lt;/code&gt;连同&lt;code&gt;HTTP请求&lt;/code&gt;放到队列中（&lt;strong&gt;队列是上下文无关的，获取不到任何&lt;code&gt;HTTP请求&lt;/code&gt;的信息，需要从事件中读取&lt;/strong&gt;），然后队列取出这些事件，写入到数据库。这样就能做到不影响性能，又可获取到所有的&lt;code&gt;Session&lt;/code&gt;信息，并做灵活地管理。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Session&lt;/code&gt;默认没有携带&lt;code&gt;IP&lt;/code&gt;信息，因此在每次&lt;code&gt;Session&lt;/code&gt;写入时，需要再做一层加工，将&lt;code&gt;IP&lt;/code&gt;写入&lt;code&gt;Session&lt;/code&gt;，并且不能只保存一个&lt;code&gt;IP&lt;/code&gt;，需要保存多个，以便后续问题的处理。&lt;/p&gt;
&lt;h2 id=&quot;如何管理一个账号对应多个session的问题&quot;&gt;1.如何管理一个账号对应多个&lt;code&gt;Session&lt;/code&gt;的问题&lt;/h2&gt;
&lt;p&gt;既然数据库中已经保存了所有&lt;code&gt;Session&lt;/code&gt;，在有新的&lt;code&gt;Session&lt;/code&gt;产生时，检查是否超出指定数量。当超出时，自动删除最早的&lt;code&gt;Session&lt;/code&gt;即可。&lt;/p&gt;
&lt;h3 id=&quot;如何手动测试&quot;&gt;如何手动测试&lt;/h3&gt;
&lt;p&gt;设置好要限制的数量，假设为&lt;code&gt;2&lt;/code&gt;。安装&lt;code&gt;SessionBox&lt;/code&gt;（&lt;code&gt;Chrome插件&lt;/code&gt;)，创建&lt;code&gt;3&lt;/code&gt;个窗口以相同用户登陆，将发现最早登陆的窗口刷新后处于未登陆状态。&lt;/p&gt;
&lt;h3 id=&quot;合理的session数量&quot;&gt;合理的&lt;code&gt;Session&lt;/code&gt;数量&lt;/h3&gt;
&lt;p&gt;一个用户可能从多个设备登陆，比如&lt;code&gt;PC&lt;/code&gt;、手机、平板，所以&lt;code&gt;Session&lt;/code&gt;数量至少在&lt;code&gt;3&lt;/code&gt;个以上。用户也可能在&lt;code&gt;PC&lt;/code&gt;上开&lt;code&gt;N&lt;/code&gt;个不同浏览器，导致同一个设备有多个&lt;code&gt;Session&lt;/code&gt;，应该优化此种情况，判定为同一个设备。具体看&lt;code&gt;《TODO》&lt;/code&gt;这一节说明。&lt;/p&gt;
&lt;h2 id=&quot;如何管理一个session多个ip的问题&quot;&gt;2.如何管理一个&lt;code&gt;Session&lt;/code&gt;多个&lt;code&gt;IP&lt;/code&gt;的问题&lt;/h2&gt;
&lt;p&gt;所有的用户共享同一个&lt;code&gt;Session&lt;/code&gt;，也就没办法精确控制要保留的数量了。要么删除&lt;code&gt;Session&lt;/code&gt;，所有用户重新登陆；要么重新生成&lt;code&gt;session id&lt;/code&gt;，只保留一个用户，其他所有用户需要重新登陆。目前采用后者，因为前者有一个风险，同一个用户可能从多个地方登陆产生了大量的&lt;code&gt;IP&lt;/code&gt;，结果就踢出去了，用户体验不好。而如果是后者，如果一个用户，只是自己使用，那么不论他的&lt;code&gt;ip&lt;/code&gt;数量是否突破限制，重新生成&lt;code&gt;session id&lt;/code&gt;仍然是他的，所以不会受影响。&lt;/p&gt;
&lt;p&gt;它的原理是用户发起请求，发现&lt;code&gt;IP&lt;/code&gt;过多，就重新生成&lt;code&gt;session id&lt;/code&gt;，这个新的&lt;code&gt;session id&lt;/code&gt;会写到该用户的&lt;code&gt;cookie&lt;/code&gt;中，而其他用户由于没有这个新的&lt;code&gt;session id&lt;/code&gt;，所以需要重新登陆。&lt;/p&gt;
&lt;p&gt; 从这个流程中也可看出，这个处理过程必须是在用户发起请求时处理。&lt;strong&gt;需要注意的是，这个过程会需要考虑并发，即便是单个用户访问&lt;/strong&gt;。假设一个用户访问页面，该页面同时发起&lt;code&gt;4&lt;/code&gt;个请求。服务端同时处理这&lt;code&gt;4&lt;/code&gt;个请求，都发现&lt;code&gt;session&lt;/code&gt;的&lt;code&gt;ip&lt;/code&gt;过多，于是删除旧&lt;code&gt;session&lt;/code&gt;重新生成，造成一个问题：&lt;strong&gt;&lt;code&gt;4&lt;/code&gt;个请求删除同一个旧&lt;code&gt;session&lt;/code&gt;，然后生成了&lt;code&gt;4&lt;/code&gt;个不同的&lt;code&gt;session&lt;/code&gt;&lt;/strong&gt;。为防止这种情况，使用了&lt;code&gt;Redis&lt;/code&gt;对该&lt;code&gt;session id&lt;/code&gt;加锁，并设置&lt;code&gt;30&lt;/code&gt;秒自动过期，只有第一个获取锁的人执行重新生成，其他没获得锁的请求不处理。然后锁不用释放，自然过期即可。&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;正常而言，&lt;code&gt;session&lt;/code&gt;已经被重新生成了，旧&lt;code&gt;session id&lt;/code&gt;是走不到加锁&lt;code&gt;session id&lt;/code&gt;这一步的。如果有，那一定是在重新生成之前就进来的请求，而这些请求本来就应该被忽略。反之，如果删除锁，这些请求将再次加锁并重新生成&lt;code&gt;session&lt;/code&gt;，仍然会造成刚才说的问题，因此直接让锁自动过期即可。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;如何手动测试-1&quot;&gt;如何手动测试&lt;/h3&gt;
&lt;p&gt;假设&lt;code&gt;IP&lt;/code&gt;数量限制为1个，打开&lt;code&gt;A``B&lt;/code&gt;两台电脑，在&lt;code&gt;A&lt;/code&gt;电脑上先登陆，打开&lt;code&gt;Chrome开发者工具&lt;/code&gt;,复制&lt;code&gt;laraval_session&lt;/code&gt;的值；然后传到&lt;code&gt;B&lt;/code&gt;电脑，打开&lt;code&gt;Chrome开发者工具&lt;/code&gt;，设置&lt;code&gt;laravel_session&lt;/code&gt;的值，然后刷新下将发现变为登陆状态。再刷新下&lt;code&gt;A&lt;/code&gt;电脑，将发现处于未登陆状态。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/73696/201711/73696-20171124123808031-734563396.png&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;合理的ip限制数量&quot;&gt;合理的&lt;code&gt;ip&lt;/code&gt;限制数量&lt;/h3&gt;
&lt;p&gt;这个值则很主观，同时多个用户共享一个&lt;code&gt;Session&lt;/code&gt;的问题实际是可避免的，具体参考《&lt;code&gt;Remember Me&lt;/code&gt;的问题》的说明。因此不建议设置得太小，建议在&lt;code&gt;5&lt;/code&gt;以上。&lt;/p&gt;

&lt;p&gt;如果一个账号在线的存活期只有几个小时，那么上面说的问题影响范围都有限。为提高用户体验，用户一次登陆后可存活好几天甚至永久存活。提高存活时间有两种方法：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;修改&lt;code&gt;Session&lt;/code&gt;的过期时间&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;Remember Me&lt;/code&gt;的机制&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;上面管理&lt;code&gt;Session&lt;/code&gt;的方案，在第&lt;code&gt;1&lt;/code&gt;种方法下能顺利工作，但是在第&lt;code&gt;2&lt;/code&gt;种方法下则没法工作。所以使用了&lt;code&gt;Remember Me&lt;/code&gt;的方案，在管理机制上需要重新设计。&lt;/p&gt;
&lt;p&gt;要理解这个问题所在，我们需要理解&lt;code&gt;Remember Me&lt;/code&gt;的机制：用户登陆后，如果设置了&lt;code&gt;Remember Me&lt;/code&gt;，服务器会生成&lt;code&gt;remember me token&lt;/code&gt;，保存在数据库中，并将该&lt;code&gt;token&lt;/code&gt;写入到&lt;code&gt;cookie&lt;/code&gt;中。用户&lt;code&gt;Session&lt;/code&gt;过期后，再次访问浏览器，服务端发现&lt;code&gt;cookie&lt;/code&gt;中的&lt;code&gt;remember me&lt;/code&gt;信息与数据库中的一致，就重新生成新的&lt;code&gt;Session&lt;/code&gt;（见流程图）。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/73696/201711/73696-20171124124026812-1162705985.png&quot; alt=&quot;通过Remember永久登陆原理&quot;/&gt;&lt;/p&gt;
&lt;p&gt;在了解上述机制后，即可发现,当&lt;code&gt;remember me&lt;/code&gt;的用户超过&lt;code&gt;session&lt;/code&gt;限制数量后，最早的&lt;code&gt;session&lt;/code&gt;被删除，但由于该用户有&lt;code&gt;remember me&lt;/code&gt;，所以会重新生成&lt;code&gt;session&lt;/code&gt;自动恢复，也就说，删除&lt;code&gt;session&lt;/code&gt;对&lt;code&gt;remember me&lt;/code&gt;用户无效，会立刻重新生成。所以上述的&lt;code&gt;session&lt;/code&gt;管理方案不应该开启&lt;code&gt;remember me&lt;/code&gt;，否则是有问题的。&lt;/p&gt;
&lt;p&gt;那为什么不直接&lt;code&gt;Remember Me&lt;/code&gt;的方案呢？主要原因在于它的设计比较复杂，最终我们会切换成&lt;code&gt;Remember Me&lt;/code&gt;的机制，将会另开一篇专门讨论。&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;[ ] 多个&lt;code&gt;Session&lt;/code&gt;可能是同一个设备发出的，因此应该结合&lt;code&gt;IP&lt;/code&gt;判断是否是同一个设备，或者结合客户端发出的唯一标识（唯一标识需要是PC的唯一标识）。如果是同一个设备的就都放过的话，其实也有问题，&lt;code&gt;SessionBox&lt;/code&gt;这样的工具可以在单个浏览器创建多个&lt;code&gt;Session&lt;/code&gt;，如果这个过程脚本化，服务器会产生大量垃圾&lt;code&gt;Session&lt;/code&gt;，所以也应该限制数量。&lt;/li&gt;
&lt;li&gt;[ ] 改为&lt;code&gt;Remember me&lt;/code&gt;方案，将问题简化为只考虑一个帐户多个&lt;code&gt;Session&lt;/code&gt;的问题。&lt;/li&gt;
&lt;li&gt;[ ] 客户端发送唯一标识的方式是否具备可行性？&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;知识点&quot;&gt;知识点&lt;/h3&gt;
&lt;p&gt;Q:&lt;code&gt;Session&lt;/code&gt;与登陆用户的关系？&lt;/p&gt;
&lt;p&gt;A:严格来说，只要用户打开浏览器访问网站，就会产生&lt;code&gt;Session&lt;/code&gt;标识一个会话，跟是否登陆无关。但是一般情况下，我们只关心登陆用户的&lt;code&gt;Session&lt;/code&gt;，因此这里讨论上不做区分，只要产生&lt;code&gt;Session&lt;/code&gt;就认为有登陆用户。&lt;/p&gt;
&lt;h3 id=&quot;参考&quot;&gt;参考&lt;/h3&gt;
</description>
<pubDate>Fri, 24 Nov 2017 04:40:00 +0000</pubDate>
<dc:creator>枫叶落一地</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/pheye/p/7890065.html</dc:identifier>
</item>
<item>
<title>flask + Python3 实现的的API自动化测试平台----  IAPTest接口测试平台 - 北漂的雷子</title>
<link>http://www.cnblogs.com/leiziv5/p/7890022.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/leiziv5/p/7890022.html</guid>
<description>&lt;p&gt;&lt;strong&gt;**背景：&lt;/strong&gt; 1.平时测试接口，总是现写代码，对测试用例的管理，以及测试报告的管理持久化做的不够，&lt;br/&gt;              2.工作中移动端开发和后端开发总是不能并行进行，需要一个mock的依赖来让他们并行开发。&lt;br/&gt;              3.同时让自己锻炼去开发测试平台，掌握flask开发程序，提高自己的业务水平。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;整体思路：&lt;/strong&gt;    1.利用flask+bootstrap来进行web界面开发，对接口，接口测试用例，定时任务，测试报告的持续集成。&lt;br/&gt;                           2.IAPTest支持接口用例管理，接口多用例测试，支持定时测试任务，测试报告持久化&lt;br/&gt;                           3.目前mock服务支持单一path，定时任务可以开启暂停多用例执行，定时任务执行后自动发送测试报告，多用例的单次执行，单接口的调试功能。对测试环境的管理&lt;br/&gt;下面来看下最后的效果图，以及附上github开源地址。&lt;/p&gt;&lt;p&gt;测试环境管理界面：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121706078-1471574437.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;定时任务界面：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121717343-1159436206.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;mock界面&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121406859-1689439124.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;测试报告界面&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121342484-1797322840.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;用例管理界面&lt;br/&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121335828-983902359.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;接口管理界面&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121306218-465228929.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;**核心代码分享区：**&lt;/p&gt;&lt;p&gt;定时任务对应视图开发&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;67&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; AddtimingtaskView(MethodView):
    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; post(self):
        taskname&lt;/span&gt;=request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;taskname&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        tinmingtime&lt;/span&gt;=request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;time&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        to_email_data&lt;/span&gt;=request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;to_email&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        cao_email&lt;/span&gt;=request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;cao_email&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        weihu&lt;/span&gt;=request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;weihu&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; taskname ==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务名不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; tinmingtime ==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务执行时间不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; to_email_data==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;发送给谁邮件不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; weihu==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;维护人邮件不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        taskname_is &lt;/span&gt;= Task.query.filter_by(taskname=&lt;span&gt;taskname).first()
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; taskname_is:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务已经存在请重新填写！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        new_task&lt;/span&gt;=Task(taskname=taskname,taskstart=tinmingtime,taskrepor_to=to_email_data,taskrepor_cao=cao_email,task_make_email=&lt;span&gt;weihu,
                      makeuser&lt;/span&gt;=&lt;span&gt;current_user.id)
        db.session.add(new_task)
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            db.session.commit()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;添加定时任务成功&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; Exception as e:
            db.session.rollback()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;添加过程貌似异常艰难！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Editmingtaskview(MethodView):
    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        task_one&lt;/span&gt;=Task.query.filter_by(id=&lt;span&gt;id).first()
        procjet&lt;/span&gt;=&lt;span&gt;Project.query.all()
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; task_one:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;你编辑的不存在&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Edittimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,task_one=task_one,porjects=&lt;span&gt;procjet)
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; post(self,id):
        task_one &lt;/span&gt;= Task.query.filter_by(id=&lt;span&gt;id).first()
        procjet &lt;/span&gt;=&lt;span&gt; Project.query.all()
        taskname &lt;/span&gt;= request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;taskname&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        tinmingtime &lt;/span&gt;= request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;time&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        to_email_data &lt;/span&gt;= request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;to_email&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        cao_email &lt;/span&gt;= request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;cao_email&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        weihu &lt;/span&gt;= request.form[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;weihu&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; taskname ==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务名不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; tinmingtime ==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务执行时间不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; to_email_data==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;发送给谁邮件不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; weihu==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;维护人邮件不能为空！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        task_one.taskname&lt;/span&gt;=&lt;span&gt;taskname
        task_one.taskrepor_to&lt;/span&gt;=&lt;span&gt;to_email_data
        task_one.taskrepor_cao&lt;/span&gt;=&lt;span&gt;cao_email
        task_one.task_make_email&lt;/span&gt;=&lt;span&gt;weihu
        task_one.makeuser&lt;/span&gt;=&lt;span&gt;current_user.id
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            db.session.commit()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;编辑成功&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
            db.session.rollback()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;编辑出现问题！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Edittimingtasks.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, task_one=task_one,porjects=&lt;span&gt;procjet)
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; DeteleTaskViee(MethodView):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        task_one &lt;/span&gt;= Task.query.filter_by(id=&lt;span&gt;id).first()
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; task_one:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;你编辑的不存在&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; task_one.status==&lt;span&gt;True:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;已经删除&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        task_one.status&lt;/span&gt;=&lt;span&gt;True
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            db.session.commit()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;删除任务成功&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
            db.session.rollback()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;删除任务休息了&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
@app.route(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/gettest&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,methods=[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;POST&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;])
@login_required
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt; gettest():&lt;span&gt;#&lt;/span&gt;&lt;span&gt;ajax获取项目的测试用例&lt;/span&gt;
    projec=(request.get_data(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;project&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)).decode(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;utf-8&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; projec:
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; []
    proje&lt;/span&gt;=Project.query.filter_by(project_name=&lt;span&gt;str(projec)).first()
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; proje:
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;  []
    testyong&lt;/span&gt;=InterfaceTest.query.filter_by(projects_id=&lt;span&gt;proje.id).all()
    testyong_list&lt;/span&gt;=&lt;span&gt;[]
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt;&lt;span&gt; testyong:
        testyong_list.append({&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:i.Interface_name,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:i.id})
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;   jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:testyong_list})
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt; TestforTaskView(MethodView):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;为测试任务添加测试用例&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        procjet &lt;/span&gt;=&lt;span&gt; Project.query.all()
        task_one&lt;/span&gt;=Task.query.filter_by(id=&lt;span&gt;id).first()
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtestyongfortask.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,task_one=task_one,procjets=&lt;span&gt;procjet)
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; post(self,id):
        procjet &lt;/span&gt;=&lt;span&gt; Project.query.all()
        task_one &lt;/span&gt;= Task.query.filter_by(id=&lt;span&gt;id).first()
        proc_test&lt;/span&gt;=request.form.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;project&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; proc_test ==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;不能不添加测试项目！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtestyongfortask.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, task_one=task_one, procjets=&lt;span&gt;procjet)
        test_yongli&lt;/span&gt;=request.form.getlist(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;testyongli&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; test_yongli==&lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;亲你见过只有测试项目没有测试用例的测试任务吗！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtestyongfortask.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, task_one=task_one, procjets=&lt;span&gt;procjet)
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; oldtask &lt;span&gt;in&lt;/span&gt;&lt;span&gt; task_one.interface.all():
            task_one.interface.remove(oldtask)
        task_one.prject&lt;/span&gt;=Project.query.filter_by(project_name=&lt;span&gt;proc_test).first().id
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; yongli &lt;span&gt;in&lt;/span&gt;&lt;span&gt; test_yongli:
            task_one.interface.append(InterfaceTest.query.filter_by(id&lt;/span&gt;=&lt;span&gt;yongli).first())
            db.session.add(task_one)
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            db.session.commit()
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务更新用例成功&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;任务更新用例失败&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; render_template(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;addtestyongfortask.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, task_one=task_one, procjets=&lt;span&gt;procjet)
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt; StartTaskView(MethodView):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;开始定时任务&lt;/span&gt;
&lt;span&gt;    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        task&lt;/span&gt;=Task.query.filter_by(id=&lt;span&gt;id).first()
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; len(task.interface.all())&amp;lt;=1&lt;span&gt;:
            flash(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务执行过程的测试用例为多用例，请你谅解&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            scheduler.add_job(func&lt;/span&gt;=addtask, id=str(id), args=str(id),trigger=eval(task.taskstart),replace_existing=&lt;span&gt;True)
            task.yunxing_status&lt;/span&gt;=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;启动&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务启动成功！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;  redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; Exception as e:
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务启动失败！请检查任务的各项内容各项内容是否正常&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt; ZantingtaskView(MethodView):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;暂停定时任务&lt;/span&gt;
&lt;span&gt;    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        task &lt;/span&gt;= Task.query.filter_by(id=&lt;span&gt;id).first()
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            scheduler.pause_job(str(id))
            task.yunxing_status &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;暂停&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务暂停成功！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
            task.yunxing_status &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;创建&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务暂停失败！已经为您初始化&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt; HuifutaskView(MethodView):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;回复定时任务&lt;/span&gt;
&lt;span&gt;    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        task &lt;/span&gt;= Task.query.filter_by(id=&lt;span&gt;id).first()
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            scheduler.resume_job(str(id))
            task.yunxing_status&lt;/span&gt;=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;启动&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务恢复成功！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
            task.yunxing_status &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;创建&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务恢复失败！已经为您初始化&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt; YichuTaskView(MethodView):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;移除定时任务&lt;/span&gt;
&lt;span&gt;    @login_required
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,id):
        task &lt;/span&gt;= Task.query.filter_by(id=&lt;span&gt;id).first()
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            scheduler.delete_job(str(id))
            task.yunxing_status&lt;/span&gt;=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;关闭&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务移除成功！&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
            task.yunxing_status &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;创建&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
            db.session.commit()
            flash(u&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;定时任务移除失败！已经为您初始化&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; redirect(url_for(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;timingtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;))
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br/&gt;&lt;strong&gt;&lt;span&gt;定时任务所执行的func代码&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;78&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt; addtask(id):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;定时任务执行的时候所用的函数&lt;/span&gt;
    in_id=&lt;span&gt;int(id)
    task&lt;/span&gt;=Task.query.filter_by(id=&lt;span&gt;in_id).first()
    starttime &lt;/span&gt;=&lt;span&gt; datetime.datetime.now()
    star &lt;/span&gt;=&lt;span&gt; time.time()
    day &lt;/span&gt;= time.strftime(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%Y%m%d%H%M&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, time.localtime(time.time()))
    basedir &lt;/span&gt;= os.path.abspath(os.path.dirname(&lt;span&gt;__file__&lt;/span&gt;&lt;span&gt;))
    file_dir &lt;/span&gt;= os.path.join(basedir, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;upload&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    file &lt;/span&gt;= os.path.join(file_dir, (day + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.log&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; os.path.exists(file) &lt;span&gt;is&lt;/span&gt;&lt;span&gt; False:
        os.system(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;touch %s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; %&lt;span&gt; file)
    filepath &lt;/span&gt;= os.path.join(file_dir, (day + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; os.path.exists(filepath) &lt;span&gt;is&lt;/span&gt;&lt;span&gt; False:
        os.system(r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;touch %s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; %&lt;span&gt; filepath)
    projecct_list &lt;/span&gt;=&lt;span&gt; []
    model_list &lt;/span&gt;=&lt;span&gt; []
    Interface_name_list &lt;/span&gt;=&lt;span&gt; []
    Interface_url_list &lt;/span&gt;=&lt;span&gt; []
    Interface_meth_list &lt;/span&gt;=&lt;span&gt; []
    Interface_pase_list &lt;/span&gt;=&lt;span&gt; []
    Interface_assert_list &lt;/span&gt;=&lt;span&gt; []
    Interface_headers_list &lt;/span&gt;=&lt;span&gt; []
    id_list &lt;/span&gt;=&lt;span&gt; []
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; task_yongli &lt;span&gt;in&lt;/span&gt;&lt;span&gt; task.interface.all():
        id_list.append(task_yongli.id)
        projecct_list.append(task_yongli.projects)
        model_list.append(task_yongli.models)
        Interface_url_list.append(task_yongli.Interface_url)
        Interface_name_list.append(task_yongli.Interface_name)
        Interface_meth_list.append(task_yongli.Interface_meth)
        Interface_pase_list.append(task_yongli.Interface_pase)
        Interface_assert_list.append(task_yongli.Interface_assert)
        Interface_headers_list.append(task_yongli.Interface_headers)
    apitest &lt;/span&gt;=&lt;span&gt; ApiTestCase(Interface_url_list, Interface_meth_list, Interface_pase_list, Interface_assert_list, file,
                          Interface_headers_list)
    result_toal, result_pass, result_fail, relusts, bask_list &lt;/span&gt;=&lt;span&gt; apitest.testapi()
    endtime &lt;/span&gt;=&lt;span&gt; datetime.datetime.now()
    end &lt;/span&gt;=&lt;span&gt; time.time()
    createHtml(titles&lt;/span&gt;=u&lt;span&gt;'&lt;/span&gt;&lt;span&gt;接口测试报告&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, filepath=filepath, starttime=starttime, endtime=endtime, passge=&lt;span&gt;result_pass,
               fail&lt;/span&gt;=result_fail, id=id_list, name=projecct_list, headers=&lt;span&gt;Interface_headers_list,
               coneent&lt;/span&gt;=Interface_url_list, url=Interface_meth_list, meth=&lt;span&gt;Interface_pase_list,
               yuqi&lt;/span&gt;=Interface_assert_list, json=bask_list, relusts=&lt;span&gt;relusts)
    hour &lt;/span&gt;= end -&lt;span&gt; star
    user_id &lt;/span&gt;= User.query.filter_by(role_id=2&lt;span&gt;).first().id
    new_reust &lt;/span&gt;= TestResult(Test_user_id=user_id, test_num=result_toal, pass_num=result_pass, fail_num=&lt;span&gt;result_fail,
                           test_time&lt;/span&gt;=starttime, hour_time=hour, test_rep=(day + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;), test_log=(day + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.log&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
    email &lt;/span&gt;= EmailReport.query.filter_by(role_id=2, default_set=&lt;span&gt;True).first()
    send_emails(sender&lt;/span&gt;=email.send_email, receivers=task.taskrepor_to, password=&lt;span&gt;email.send_email_password,
                smtp&lt;/span&gt;=email.stmp_email, port=email.port, fujian1=file, fujian2=filepath, subject=u&lt;span&gt;'&lt;/span&gt;&lt;span&gt;%s自动用例执行测试报告&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; %&lt;span&gt; day,
                url&lt;/span&gt;=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;%stest_rep&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(request.url_root))
    db.session.add(new_reust)
    db.session.commit()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;mock服务的一个请求方式的代码&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;72&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MakemockserverView(MethodView):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;做一个mock服务&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;def&lt;/span&gt; get(self,path):&lt;span&gt;#&lt;/span&gt;&lt;span&gt;get请求方法&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt;         huoqupath=Mockserver.query.filter_by(path=path,status=&lt;span&gt;True).first()
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;         heders=&lt;span&gt;request.headers
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         method=&lt;span&gt;request.method
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; huoqupath:
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;             abort(404&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; method.lower() !=&lt;span&gt;huoqupath.methods:
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;  jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;-1&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;请求方式错误!&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; huoqupath.is_headers==&lt;span&gt;True:
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; comp_dict(heders,huoqupath.headers) ==&lt;span&gt;True:
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; huoqupath.ischeck==&lt;span&gt;True:
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;                     paerm =&lt;span&gt; request.values.to_dict()
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt; dict_par(paerm,huoqupath.params)==&lt;span&gt;True:
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;                         &lt;span&gt;if&lt;/span&gt; huoqupath.rebacktype == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;                             &lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;                                 json_fan =&lt;span&gt; json.dumps(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;                                 &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;successs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: json_fan})
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;                             &lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;                                 &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的返回不能正常json！请检查&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;                         &lt;span&gt;elif&lt;/span&gt; huoqupath.rebacktype == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;                             response =&lt;span&gt; make_response(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;                             response.content_type = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;application/xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt;                             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; response
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;                         &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;                             &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的类型目前系统不支持&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-4&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你输入的参数不正确&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt; huoqupath.rebacktype==&lt;span&gt;'&lt;/span&gt;&lt;span&gt;json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;                         &lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;                             json_fan=&lt;span&gt;json.dumps(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;                             &lt;span&gt;return&lt;/span&gt;  jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;successs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:json_fan})
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;                         &lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;                             &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的返回不能正常json！请检查&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;                     &lt;span&gt;elif&lt;/span&gt; huoqupath.rebacktype ==&lt;span&gt;'&lt;/span&gt;&lt;span&gt;xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;                         response=&lt;span&gt;make_response(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;                         response.content_type=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;application/xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; response
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的类型目前系统不支持&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-3&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;安全校验失败!&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; huoqupath.ischeck ==&lt;span&gt; True:
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;             paerm =&lt;span&gt; request.values.to_dict()
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; dict_par(paerm, huoqupath.params) ==&lt;span&gt; True:
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; huoqupath.rebacktype == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;                     &lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;                         json_fan =&lt;span&gt; json.dumps(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;successs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: json_fan})
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;                     &lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的返回不能正常json！请检查&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;                 &lt;span&gt;elif&lt;/span&gt; huoqupath.rebacktype == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;                     response =&lt;span&gt; make_response(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt;                     response.content_type = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;application/xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;span&gt;56&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; response
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的类型目前系统不支持&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;59&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-4&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你输入的参数不正确&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;62&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; huoqupath.rebacktype == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt;                 &lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt;                     json_fan =&lt;span&gt; json.dumps(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;65&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;successs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: json_fan})
&lt;/span&gt;&lt;span&gt;66&lt;/span&gt;                 &lt;span&gt;except&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;67&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的返回不能正常json！请检查&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt;             &lt;span&gt;elif&lt;/span&gt; huoqupath.rebacktype == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;69&lt;/span&gt;                 response =&lt;span&gt; make_response(huoqupath.fanhui)
&lt;/span&gt;&lt;span&gt;70&lt;/span&gt;                 response.content_type = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;application/xml&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;span&gt;71&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt;&lt;span&gt; response
&lt;/span&gt;&lt;span&gt;72&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;73&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt; jsonify({&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;-2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;message&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你写入的类型目前系统不支持&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;''&lt;/span&gt;}) &lt;span&gt;#&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;开源地址：https://github.com/liwanlei/FXTest&lt;/p&gt;&lt;p&gt;&lt;strong&gt;使用说明：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;1.依赖包为requirements.txt文件下的，可能部分不全，需要什么可以自己使用中增加。&lt;br/&gt;2.目前由于考虑后续迁移内部使用的话，所以移除了注册功能，改为管理员后台添加方式，默认登录：liwanlei  密码：liwanlei&lt;br/&gt;3.部分功能调试还存在一定的问题，欢迎各位多提宝贵意见，&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;strong&gt; 部分功能欠缺：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;1.定时任务的持久化，现在处理容易受到运行过程中的宕机等情况重新启动服务器的定时任务全部需要开启&lt;br/&gt;2、mock接口只能支持单一的path&lt;br/&gt;3. 测试环境没有改为动态配置，动态支持。目前测试环境管理以及上线&lt;br/&gt;4。部分地方可能还会有不严谨性，但是工具可以使用。&lt;br/&gt;5、目前仅支持 http请求中的json格式的，&lt;br/&gt;6.大家可以多提意见，后续会优化，最近一直熬夜加班可能有些消息不能及时回复，还望谅解。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;有问题可以联系我：QQ:952943386 email:leileili126@163.com  qq群：194704520  新群：683894834&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; 微信打赏&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/920110/201711/920110-20171124121638031-1920028819.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

</description>
<pubDate>Fri, 24 Nov 2017 04:18:00 +0000</pubDate>
<dc:creator>北漂的雷子</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/leiziv5/p/7890022.html</dc:identifier>
</item>
<item>
<title>canvas图表(4) - 散点图 - Jeff.Zhong</title>
<link>http://www.cnblogs.com/edwardloveyou/p/7890013.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/edwardloveyou/p/7890013.html</guid>
<description>&lt;p&gt;原文地址：&lt;a href=&quot;http://jeffzhong.space/2017/11/24/chartpoint/&quot;&gt;canvas图表(4) - 散点图&lt;/a&gt;&lt;br/&gt;今天开始完成散点图，做完这一节，我的canvas图表系列就算是完成了，毕竟平时最频繁用到的就是这几类图表了：柱状，折线，饼图，散点。经过编写canvas图表项目的实践，我对canvas也做到了比较深入的理解，也是越来越喜欢计算机图形相关的知识了。接下来canvas的学习会告一段落，我会继续接着学习webGL，同时学习使用blender建立简单的3D模型。&lt;/p&gt;
&lt;p&gt;本节效果请看：&lt;em&gt;&lt;a href=&quot;http://jeffzhong.space/sites/demo/dist/chartpoint.html&quot;&gt;散点气泡图https://edwardzhong.github.io/sites/demo/dist/chartpoint.html&lt;/a&gt;&lt;/em&gt;&lt;br/&gt;&lt;img src=&quot;http://oncse3u6r.bkt.clouddn.com/chartpoint.jpg&quot; alt=&quot;it&quot;/&gt;&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;经过学习之前的&lt;em&gt;&lt;a href=&quot;http://www.cnblogs.com/edwardloveyou/p/7884050.html&quot;&gt;其他图表&lt;/a&gt;&lt;/em&gt;后，就会发现很多地方都是相似的，只是具体的细节有些区别，所以这次主要就是讲解散点图不同的部分，功能点包括：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;组织数据；&lt;/li&gt;
&lt;li&gt;画面绘制；&lt;br/&gt;&lt;strong&gt;3. 数据动画的实现；&lt;/strong&gt;&lt;br/&gt;&lt;strong&gt;4. 位移坐标绘制&lt;/strong&gt;&lt;br/&gt;&lt;strong&gt;5. 鼠标事件的处理。&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;使用方式&quot;&gt;使用方式&lt;/h2&gt;
&lt;p&gt;用法基本跟柱状图和折线图类似，数据使用的是Echart的样例上的，但是它的数据格式太反人道了，我重新组织了数据格式，这样更符合我们的使用习惯。&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;177&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; con&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'container'&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; point &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;Point&lt;/span&gt;(con)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;va&quot;&gt;point&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;init&lt;/span&gt;(&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'1990 与 2015 年各国家人均寿命与 GDP'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;xAxis&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:{&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'GDP'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;[&lt;span class=&quot;dv&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;20000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;30000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;40000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;50000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;60000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;70000&lt;/span&gt;]&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;formatter&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'$ {value}'&lt;/span&gt;
        &lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;yAxis&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:{&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'AGE'&lt;/span&gt;
        &lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:{&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'gdp'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'age'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'number'&lt;/span&gt;
        &lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;series&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;[&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'1990'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;[
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;28604&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;77&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17096869&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Australia'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;31163&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;77.4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;27662440&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Canada'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1516&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;68&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1154605773&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'China'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;13670&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;74.7&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10582082&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Cuba'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;28599&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;75&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4986705&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Finland'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;29476&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;77.1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;56943299&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'France'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;31476&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;75.4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;78958237&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Germany'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;28666&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;78.1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;254830&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Iceland'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1777&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;57.7&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;870601776&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'India'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;29550&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;79.1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;122249285&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Japan'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2076&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;67.9&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;20194354&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'North Korea'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;12087&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;72&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;42972254&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'South Korea'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;24021&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;75.4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3397534&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'New Zealand'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;43296&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;76.8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4240375&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Norway'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10088&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;70.8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;38195258&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Poland'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;19349&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;69.6&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;147568552&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Russia'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10670&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;67.3&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;53994605&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Turkey'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;26424&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;75.7&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;57110117&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'United Kingdom'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;37062&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;75.4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;252847810&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'United States'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;]
            &lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
            &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'2015'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;dt&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;[
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;44056&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;81.8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;23968973&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Australia'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;43294&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;81.7&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;35939927&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Canada'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;13334&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;76.9&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1376048943&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'China'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;21291&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;78.5&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;11389562&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Cuba'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;38923&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;80.8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5503457&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Finland'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;37599&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;81.9&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;64395345&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'France'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;44053&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;81.1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;80688545&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Germany'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;42182&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;82.8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;329425&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Iceland'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5903&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;66.8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1311050527&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'India'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;36162&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;83.5&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;126573481&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Japan'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1390&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;71.4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;25155317&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'North Korea'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;34644&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;80.7&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;50293439&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'South Korea'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;34186&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;80.6&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4528526&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'New Zealand'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;64304&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;81.6&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5210967&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Norway'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;24787&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;77.3&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;38611794&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Poland'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;23038&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;73.13&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;143456918&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Russia'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;19360&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;76.5&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;78665830&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'Turkey'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;38225&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;81.4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;64715810&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'United Kingdom'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;xVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;53354&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;yVal&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;79.1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;321773631&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'United States'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;]
        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;]
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;数据动画&quot;&gt;数据动画&lt;/h2&gt;
&lt;p&gt;清除屏幕，然后重绘，实现动画效果。实现了气泡半径的缩放和气泡的位移动画，为了更加的美观，气泡使用了径向渐变createRadialGradient和阴影shadow，之前已经介绍过，不再详述。要注意的是，要谨慎使用阴影特性，因为它挺消耗性能，数据量一大，会卡的不要不要的😅&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;40&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;    &lt;span class=&quot;at&quot;&gt;animate&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; that&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            ctx&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            item&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;obj&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;r&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;isStop&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        (&lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;run&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;save&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;co&quot;&gt;//清屏&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;clearRect&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;W&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;H&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;co&quot;&gt;// 画坐标系&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;drawAxis&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;co&quot;&gt;// 画标签&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;drawTag&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;co&quot;&gt;// 画y轴刻度&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;drawY&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;translate&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;padding&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;shadowBlur&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            isStop&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;l&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;animateArr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;l&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;++&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                item&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;animateArr&lt;/span&gt;[i]&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;hide&lt;/span&gt;)&lt;span class=&quot;cf&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;isStop&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;strokeStyle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;shadowColor&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                
                &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; j&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;jl&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;data&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;j&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;jl&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;j&lt;span class=&quot;op&quot;&gt;++&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                    obj&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;data&lt;/span&gt;[j]&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; gradient&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;createRadialGradient&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,-&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,-&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;gradient&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;addColorStop&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'hsla('&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;hsl&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;',70%,80%,0.7)'&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;gradient&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;addColorStop&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'hsla('&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;hsl&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;',70%,60%,0.7)'&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillStyle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;gradient&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;beginPath&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                        r&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(r&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                        r&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(r&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;radius&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;r&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;isStop&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                        h&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;-4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(h&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                        h&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;+4&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(h&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;h&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;h&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;isStop&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;arc&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,-&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;obj&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;Math&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;PI&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;false&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fill&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;stroke&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;op&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;item&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;isStop&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;isStop&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;restore&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(isStop)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;}&lt;/span&gt;
            &lt;span class=&quot;at&quot;&gt;requestAnimationFrame&lt;/span&gt;(run)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;())&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;位移坐标绘制&quot;&gt;位移坐标绘制&lt;/h2&gt;
&lt;p&gt;比较有特色和有意思的是，根据鼠标位置在画板中实时绘制虚线十字架，同时在x轴y轴显示该点对应的数值信息。&lt;/p&gt;
&lt;p&gt;我首先设置了8像素的间隔，然后间隔使用moveTo和lineTo绘制坐标，分别绘制了y轴和x轴的虚线，同时根据坐标点计算出该位置对应的数值，并将它们绘制到x轴和y轴上面。&lt;br/&gt;&lt;img src=&quot;http://oncse3u6r.bkt.clouddn.com/chartpoint2.jpg&quot; alt=&quot;it&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;41&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;    &lt;span class=&quot;at&quot;&gt;drawLine&lt;/span&gt;(pos)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; that&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            ctx&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            padding&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            xmax&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;xAxis&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;data&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;slice&lt;/span&gt;(&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;)[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            xdis&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;W&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;padding&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            ymin&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;info&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            ymax&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;info&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            ydis&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;padding&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;paddingTop&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
            yNum&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;xNum&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;space&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;save&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;lineWidth&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;strokeStyle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'hsla(0,0%,30%,1)'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;co&quot;&gt;// 绘制虚线十字坐标&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;beginPath&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;space&lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt;xdis&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;++&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
            ctx[i&lt;span class=&quot;op&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'lineTo'&lt;/span&gt;:&lt;span class=&quot;st&quot;&gt;'moveTo'&lt;/span&gt;](padding&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;space&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;space&lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt;ydis&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;++&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
            ctx[i&lt;span class=&quot;op&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'lineTo'&lt;/span&gt;:&lt;span class=&quot;st&quot;&gt;'moveTo'&lt;/span&gt;](&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;padding&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;paddingTop&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;space)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;stroke&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;co&quot;&gt;// 绘制在xy轴对应的数值&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillStyle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'hsla(0,0%,30%,1)'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillRect&lt;/span&gt;(padding&lt;span class=&quot;dv&quot;&gt;-75&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2-20&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;70&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;36&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillRect&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2-55&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;padding&lt;span class=&quot;dv&quot;&gt;+10&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;110&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;40&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        yNum&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;Math&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;round&lt;/span&gt;((ymin&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;(&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;padding&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)/ydis&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;(ymax&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;ymin))&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;)/&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        xNum&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;Math&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;round&lt;/span&gt;((&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;padding)/xdis&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;xmax&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;)/&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;font&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'22px arial'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;textAlign&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'center'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;textBaseLine&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'middle'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillStyle&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;'hsla(0,0%,100%,1)'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillText&lt;/span&gt;(yNum&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;padding&lt;span class=&quot;dv&quot;&gt;-40&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2+5&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;fillText&lt;/span&gt;(xNum&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;pos&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;that&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;padding&lt;span class=&quot;dv&quot;&gt;+40&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;va&quot;&gt;ctx&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;restore&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;事件处理&quot;&gt;事件处理&lt;/h2&gt;
&lt;p&gt;mousemove的时候，如果位置在标签上和在图表画面上时，变为手形图标。滑过画板内容的时候，还要判断是否在某个气泡上面，如果是则用浮层显示该气泡对应的内容，同时前置该气泡并用scale放大。接着还要绘制该点的虚线十字架并在xy轴绘制对应数值。&lt;/p&gt;
&lt;p&gt;mousedown某个击标签就会显示隐藏对应分类，每次触发就会看到气泡的半径变化和位移的动画效果。&lt;/p&gt;
&lt;p&gt;事件相关内容具体实现可参考&lt;em&gt;&lt;a href=&quot;http://www.cnblogs.com/edwardloveyou/p/7884050.html&quot;&gt;canvas图表(3) - 饼图&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;最后&quot;&gt;最后&lt;/h2&gt;
&lt;p&gt;所有图表代码请看&lt;em&gt;&lt;a href=&quot;https://github.com/edwardzhong/html5Canvas/blob/master/chart/chart.js&quot;&gt;chart.js&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 24 Nov 2017 04:17:00 +0000</pubDate>
<dc:creator>Jeff.Zhong</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/edwardloveyou/p/7890013.html</dc:identifier>
</item>
</channel>
</rss>