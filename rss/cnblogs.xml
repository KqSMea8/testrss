<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>Ocelot 集成Butterfly 实现分布式跟踪 - 张善友</title>
<link>http://www.cnblogs.com/shanyou/p/8413506.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/shanyou/p/8413506.html</guid>
<description>&lt;p&gt;微服务，通常都是用复杂的、大规模分布式集群来实现的。微服务构建在不同的软件模块上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、有可能布在了几千台服务器，横跨多个不同的数据中心。因此，就需要一些可以帮助理解系统行为、用于分析性能问题的工具。&lt;/p&gt;
&lt;p&gt;API网关Ocelot 作为微服务的一个重要组件，出现在系统边界上的一个面向API的、串行集中式的强管控服务，这里的边界是企业IT系统的边界，主要起到隔离外部访问与内部系统的作用。通过API网关对外发布的通常是OpenAPI,在它的后面有众多的分布式应用，如微服务、消息收发、分布式数据库、分布式缓存、分布式对象存储、跨域调用，这些组件共同构成了繁杂的分布式网络。&lt;/p&gt;
&lt;p&gt;当应用A发出某个请求时，其背后可能有数十个甚至更多的服务被调用，可谓是“牵一发而动全身”。 如果将分布式系统比作高速公路网，每个前端的请求就相当于高速上行驶的车辆，而处理请求的应用就是高速上的收费站，在收费站上将车辆通行信息记录成日志，包括时间、车牌、站点、公路、价格等，如果将所有收费站上的日志整合在一起，便可以通过唯一的车牌号确定该车的完整通行记录；分布式调用系统跟踪和监控就是类比这种思想，对每一次请求进行跟踪，进而明确每个请求所经过的应用、耗时等信息。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ButterflyAPM&quot; target=&quot;_blank&quot;&gt;Butterfly&lt;/a&gt;被设计为分布式追踪和APM的Server端，它将包含Collector，Storage，独立的Web UI，并使用Open Tracing规范来设计追踪数据。目前仅根据规范实现了Open Tracing API,后续还会兼容google的opencensus。这里顺便提下为什么我们不用zipkin 或是Jaeger，他们只做了tracing，Butterfly比他们多一点就是同时要做metrics和预警，就是要做立体化监控系统。目前Butterfly也是在起步阶段，还有非常多的功能需要开发，目前有两个事情的优先级比较高一个应用程序进程级别的metrics，一个是后端collector和es的性能优化，欢迎各位同学加入一起开发，我们相信通过不断的建设，我们.NET社区一样可以达到Java的高度。回想Ocelot 的发展历程，2016年才是到现在已经开发了2年时间，完成了3.0版本的开发，现在已经是一个日趋成熟的API网关，通过API网关连接后面的服务，像今天和大家分享的最近我业余时间在开发的分布式跟踪的支持，这项任务在一年前提出来，&lt;a title=&quot;https://github.com/TomPallister/Ocelot/issues/19&quot; href=&quot;https://github.com/TomPallister/Ocelot/issues/19&quot;&gt;https://github.com/TomPallister/Ocelot/issues/19&lt;/a&gt; 这里有我们的讨论，现在集成Butterfly 来实现这个功能，让我们的微服务能够可运维。&lt;/p&gt;
&lt;p&gt;Butterfly.Client.AspNetCore 为我们提供了在ASP.NET Core项目集成Butterfly的组件，使用很简单，只需要在&lt;code&gt;ConfigureServices&lt;/code&gt; 注册Butterfly services&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public void ConfigureServices(IServiceCollection services)
{
   //your other code 
  services.AddButterfly(option =&amp;gt;
  {
      option.CollectorUrl = &quot;http://localhost:9618&quot;;
      option.Service = &quot;my service&quot;;
  });
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;其中&lt;a href=&quot;http://localhost:9618/&quot;&gt;http://localhost:9618&lt;/a&gt; 是Butterfly的服务端，提供了UI，我们在浏览器通过&lt;a href=&quot;http://localhost:9618/&quot;&gt;http://localhost:9618&lt;/a&gt; 就可以访问到。&lt;/p&gt;
&lt;p&gt;那么在API网关Ocelot 中集成Butterfly 有什么不一样呢？ 我们在Ocelot项目中加入上述代码后，我们已经可以在Butterfly UI上看到我们的追踪数据，只是数据没有连成一条链。那么我们做集成的工作主要就是以下2点：&lt;/p&gt;
&lt;p&gt;一、将追踪数据串起来，让我们可以在Butterfly UI上直观的看到各个节点的数据&lt;/p&gt;
&lt;p&gt;二、Ocelot 本身需要加入到系统跟踪的数据定义&lt;/p&gt;
&lt;p&gt;Ocelot 集成Butterfly 实现分布式跟踪的代码目前还没有加入主干，可以在我的代码库的分支&lt;a title=&quot;https://github.com/geffzhang/Ocelot/tree/Monitoring&quot; href=&quot;https://github.com/geffzhang/Ocelot/tree/Monitoring&quot;&gt;https://github.com/geffzhang/Ocelot/tree/Monitoring&lt;/a&gt; 下看到，我们首先在Ocelot的路由配置中加入一个配置项，表示是否启用分布式追踪：&lt;/p&gt;
&lt;p&gt;{&lt;br/&gt;   &quot;ReRoutes&quot;: [&lt;br/&gt;     {&lt;br/&gt;       &quot;DownstreamPathTemplate&quot;: &quot;/api/values&quot;,&lt;br/&gt;       &quot;DownstreamScheme&quot;: &quot;http&quot;,&lt;br/&gt;       &quot;UpstreamPathTemplate&quot;: &quot;/api/values&quot;,&lt;br/&gt;       &quot;UpstreamHttpMethod&quot;: [ &quot;Get&quot; ],&lt;br/&gt;       &quot;DownstreamHostAndPorts&quot;: [&lt;br/&gt;         {&lt;br/&gt;           &quot;Host&quot;: &quot;localhost&quot;,&lt;br/&gt;           &quot;Port&quot;: 5002&lt;br/&gt;         }&lt;br/&gt;       ],&lt;br/&gt;       &quot;HttpHandlerOptions&quot;: {&lt;br/&gt;         &quot;AllowAutoRedirect&quot;: true,&lt;br/&gt;         &quot;UseCookieContainer&quot;: true,&lt;br/&gt;         &quot;UseTracing&quot;: true&lt;br/&gt;       }&lt;br/&gt;     },&lt;/p&gt;
&lt;p&gt;UseTracing 表示是否启用分布式追踪，默认为false，也就是不启用。 然后在Ocelot.DependencyInjection.IOcelotBuilder 加个接口方法：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163459857-527389696.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163500623-2147258101.png&quot; alt=&quot;image&quot; width=&quot;815&quot; height=&quot;163&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;方法的实现也非常简单：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163500889-1554369370.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163501217-2034127494.png&quot; alt=&quot;image&quot; width=&quot;821&quot; height=&quot;190&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;主要就是加入Ocelot 本身需要加入到系统跟踪的数据定义，实现上主要使用DiagnosticSource， 官方的文档：&lt;a title=&quot;https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md&quot; href=&quot;https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md&quot;&gt;https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md&lt;/a&gt; 。类似于asp.net core 有个 Diagnostics中间件&lt;a title=&quot;https://github.com/aspnet/Diagnostics&quot; href=&quot;https://github.com/aspnet/Diagnostics&quot;&gt;https://github.com/aspnet/Diagnostics&lt;/a&gt;，主要功能是用于报告和处理ASP.NET Core中的异常和错误信息，以及诊断Entity Framework核心迁移错误。其中还有其他几项功能，欢迎页，错误代码页、如404 页等。以及一个还算不错的日志查看功能，这个功能也是很多人需要的功能，直接在线查看日志。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163501545-1739767070.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163501842-813483087.png&quot; alt=&quot;image&quot; width=&quot;487&quot; height=&quot;533&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;实现了Butterfly 的接口ITracingDiagnosticListener ，通过DI 注入后Butterfly 会帮我们注册好。&lt;/p&gt;
&lt;p&gt;下面我们要把我们的分布式追踪数据串起来，OpenTracing（&lt;a href=&quot;http://opentracing.io/&quot;&gt;链接：&lt;/a&gt;&lt;a href=&quot;http://opentracing.io/&quot;&gt;opentracing.io&lt;/a&gt;）通过提供平台无关、厂商无关的API，使得开发人员能够方便的添加（或更换）追踪系统的实现。OpenTracing正在为全球的分布式追踪，提供统一的概念和数据标准。标准的中文版是我们的MVP吴晟翻译的，同时他也是OpenTracing的主要成员 ： &lt;a title=&quot;https://wu-sheng.gitbooks.io/opentracing-io/content/&quot; href=&quot;https://wu-sheng.gitbooks.io/opentracing-io/content/&quot;&gt;https://wu-sheng.gitbooks.io/opentracing-io/content/&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;在广义上，一个trace代表了一个事务或者流程在（分布式）系统中的执行过程。在OpenTracing标准中，trace是多个span组成的一个有向无环图（DAG），每一个span代表trace中被命名并计时的连续性的执行片段。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://wu-sheng.gitbooks.io/opentracing-io/content/images/OTOV_0.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;分布式追踪中的每个组件都包含自己的一个或者多个span。例如，在一个常规的RPC调用过程中，OpenTracing推荐在RPC的客户端和服务端，至少各有一个span，用于记录RPC调用的客户端和服务端信息。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://wu-sheng.gitbooks.io/opentracing-io/content/images/OTOV_1.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;一个父级的span会显示的并行或者串行启动多个子span。在OpenTracing标准中，甚至允许一个子span有个多父span（例如：并行写入的缓存，可能通过一次刷新操作写入动作）。&lt;/p&gt;
&lt;p&gt;所以集成的关键点就在tracerId和spanId的关联关系的Id 处理上。&lt;/p&gt;
&lt;p&gt;tracerid 代表是全局的id，类似于Ocelot的RequestId &lt;a title=&quot;http://ocelot.readthedocs.io/en/latest/features/requestid.html&quot; href=&quot;http://ocelot.readthedocs.io/en/latest/features/requestid.html&quot;&gt;http://ocelot.readthedocs.io/en/latest/features/requestid.html&lt;/a&gt;，存放在http header 里，它的key是ot-traceid，所以在Ocelot里面可以把全局的RequestId设置为ot-traceid 。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163502092-589691587.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163502451-918428287.png&quot; alt=&quot;image&quot; width=&quot;463&quot; height=&quot;297&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;同时还需要处理spanid，使得下游的的组件的spanid是它上一级的spanid，也是存放在http header 里，它的key是ot-spanId，我们在OcelotRequestTracer 以及OcelotHttpTracingHandler 需要处理spanid&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163502904-463296638.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163503310-504353322.png&quot; alt=&quot;image&quot; width=&quot;462&quot; height=&quot;374&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上面我们说完了代码集成工作，我们来看看效果吧,我搭了一个Demo环境，服务前端—&amp;gt;Ocelot –&amp;gt;服务后端。Butterfly为每个请求生成全局唯一的ID（Traceld），通过它将不同系统的“孤立的”调用信息关联在一起，还原出更多有价值的数据。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163503639-620932285.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163503889-15071273.png&quot; alt=&quot;image&quot; width=&quot;787&quot; height=&quot;239&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上图是一条API调用请求的调用链，在Span列可以看到请求中间过程所经过的一系列应用组件，可以看到最先经过请求端的HttpClient组件，后续调用Ocelot、HttpClient、backend等，形成调用树（树上的缩进表示嵌套关系），从调用树上很容易看到前端请求的完整处理过程。在上图所示的页面中也清晰地展示了每块应用处理请求得具体耗时，非常直观地进行定位；此外，点击具体的组件，可以看到这个组件中的日志记录&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163504170-39247362.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163504498-2102842404.png&quot; alt=&quot;image&quot; width=&quot;790&quot; height=&quot;449&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;对于分布式调用跟踪系统而言，它并不仅仅提供了调用链这一功能，因为它对所有中间件的调用做埋点，所以中间件上的所有情况都可以监控的到。因此，在形成调用链的过程中也会形成一份详细的调用监控报表，它与其他监控的不同之处在于：该监控报表是带有上下钻取功能的报表。因为调用链是详细的底层统计，对上可以形成的报表维度是非常丰富的，在上图所示的调用报表里，不仅可以看到服务的情况，还可以下钻到它所调用服务的情况；另外从监控报表上还可以进行调用链的下钻，查看清晰的调用链信息。目前Butterfly这块功能也是需要继续开发的功能，欢迎各位同学一起加入开发。&lt;/p&gt;
&lt;p&gt;还有链路分析，链路与调用链不同，链路是一个统计学的概念，而调用链是单体调用的过程。分析链路的拓扑形态分析：分析来源、去向，识别不合理来源；&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://images2017.cnblogs.com/blog/510/201802/510-20180204163504795-798562609.png&quot;&gt;&lt;img title=&quot;image&quot; src=&quot;https://images2017.cnblogs.com/blog/510/201802/510-20180204163505060-1002679837.png&quot; alt=&quot;image&quot; width=&quot;804&quot; height=&quot;417&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上图是全局调用拓扑图，可以明显的看到不同的服务之间存在复杂的调用关系，也可以查看某个服务和其他服务之间的调用关系以及调用的频次； 通过该拓扑图，架构师可以清楚地观察到系统上的调用情况。&lt;/p&gt;
</description>
<pubDate>Sun, 04 Feb 2018 23:25:00 +0000</pubDate>
<dc:creator>张善友</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/shanyou/p/8413506.html</dc:identifier>
</item>
<item>
<title>IT 人士如何避免中年危机？ - CloudMan</title>
<link>http://www.cnblogs.com/CloudMan6/p/8415967.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/CloudMan6/p/8415967.html</guid>
<description>&lt;p&gt;今天咱们不谈技术，来聊点别的。&lt;/p&gt;
&lt;p&gt;这也可能是比学习具体技术更重要的话题 - &lt;strong&gt;投资&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;我把投资分成两类：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;投资股票、期货、现货、黄金这类常见投资品种。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;投资自己&lt;/em&gt;。比如看书、学习、参加培训。当然《每天5分钟玩转 Kubernetes》也算。&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;从见效周期看，第一类很快，盈亏都是立即反馈；而第二类见效慢，但好处是不管怎样都是赚！&lt;/p&gt;
&lt;p&gt;所以建议大家多做第二类投资。&lt;/p&gt;
&lt;p&gt;无论第一类还是第二类，都是越早开始越好。&lt;br/&gt;对于投资自己，提升自我价值，稳赚不赔，相信大家都会认同。&lt;/p&gt;
&lt;p&gt;而对于第一类投资，大家则会有下面这些常见问题，让 CloudMan 尝试来回答一下。&lt;/p&gt;
&lt;h2 id=&quot;-1-&quot;&gt;问题1：我好好工作就行了，没必要投资，没必要炒股。&lt;/h2&gt;
&lt;p&gt;是的，如果你所在的行业非常景气，会有一个不错的薪资待遇（比如当下的互联网）。而且随着自身能力和职位的提升，收入也会增加。如果公司还能提供股票，那财富自由的机会就更大了。所以&lt;strong&gt;干好本职工作是最重要的&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;但是&lt;/em&gt;（画外音：我就知道你会说这两个字），人无千日好，花无百日红，每个行业都是有周期的。还记得前几年的通信行业吗？风头绝不亚于现在的互联网；房地产也是啊，多么暴利啊，现在还有这么火吗？所以嘛，居安思危总是没错的。&lt;/p&gt;
&lt;p&gt;我们大部分人还是打工的，公司创业成功上市一夜成千万富翁的毕竟还是少数。而且干 IT 这行对人要求高，昨天刚虚拟化，今天就要上云计算，明天立马又 DevOps 了。&lt;/p&gt;
&lt;p&gt;据我观察，中国 IT 企业对技术人才普遍有一种错误的认识：IT 是吃青春饭的，而且好多 IT 工程师自己也是这么认为。这也是造成现在 IT 人士中年危机的一个重要原因。虽然我不认同这种观点，但形势比人强，所以还是建议大家在努力提升自身价值的同时，多一些危机感，早为将来做打算。&lt;/p&gt;
&lt;p&gt;假如咱们再乐观点，我们工作够稳定，不会被裁员，能顺利干到65岁，但 “财富自由”，提前退休也应该是很多人想追求的层次吧。&lt;/p&gt;
&lt;p&gt;咱们先来给“财富自由”下个定义，我比较认同的是：&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;财富自由就是不需要为满足正常的物质生活需求而被动出售自己的时间。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;要达到财富自由，前提是你的 &lt;em&gt;被动收入&lt;/em&gt; 能够满足你的正常物质生活需求。所谓被动收入就是即使你什么都不干也有的收入。&lt;/p&gt;
&lt;p&gt;那你会问了，有这么好的事？不干活还拿钱？&lt;/p&gt;
&lt;p&gt;有的，比如写一本 &lt;em&gt;畅销&lt;/em&gt; 并且 &lt;em&gt;长销&lt;/em&gt; 的书，那么之后你收钱的姿势只有一种 — 躺着。这本书会给你带来源源不断的版税收入。《哈利波特》就是一个很好的例子。&lt;/p&gt;
&lt;p&gt;不管是为了避免中年危机还是追求财富自由，获得被动收入都应该是我们要努力的方向。&lt;/p&gt;
&lt;p&gt;当然，写出一本畅销和长销书难度是很大的，并不适合我们这些普罗大众。好在上天还是给我们留了一条路 — &lt;strong&gt;投资股票&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;我知道你们现在在想什么 — 股票能稳赚不赔吗？&lt;/p&gt;
&lt;p&gt;这就是我要讨论的第二个问题。&lt;/p&gt;
&lt;h2 id=&quot;-2-&quot;&gt;问题2：炒股风险这么大，适合普通老百姓吗？&lt;/h2&gt;
&lt;p&gt;我们都知道炒股是 &lt;em&gt;7亏2平1赚&lt;/em&gt; ，风险确实很大。&lt;/p&gt;
&lt;p&gt;就拿 CloudMan 来说，15年初入市，赶上了牛市，但也没能逃脱下半年的千股跌停，坐了一趟刺激的过山车，最后在损失3成本金的情况下狼狈撤退。&lt;/p&gt;
&lt;p&gt;炒股亏钱的原因有很多：有人性的贪婪、有股市的不规范、有监管的漏洞，等等等等，但我觉得最重要的还是在这个 &lt;strong&gt;炒&lt;/strong&gt; 字上。&lt;/p&gt;
&lt;p&gt;当我们在交易软件中点击 &lt;em&gt;买入&lt;/em&gt; 按钮时真的知道自己买的是什么吗？股票代码后面的这家公司经营状况到底好不好？现在的股价与它合理的估值相比是高还是低？我们真的搞清楚了吗？&lt;/p&gt;
&lt;p&gt;在牛市中有一个好玩的现象是：&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;股票代码包含 6，8，9 的往往比包含 4 的涨得好。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果没搞清楚这些问题，炒股票无异于赌博，追涨杀跌，7亏2平的结果也就能够理解了。&lt;/p&gt;
&lt;p&gt;那我们还能投资股票吗？&lt;/p&gt;
&lt;p&gt;简单的答案是：&lt;strong&gt;能&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;但我更想说清楚的是这个判断背后的推理过程。&lt;/p&gt;
&lt;p&gt;我们先来看看巴菲特的伯克希尔哈撒韦公司的股票走势。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/775365/201802/775365-20180205054832685-1590653074.png&quot; alt=&quot;&quot;/&gt;&lt;img src=&quot;http://www.cnblogs.com/CloudMan6/p/images/1.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;28 年间（1990-2018）股价从 $5735 涨到 $325900，57倍，平均年化收益年 &lt;em&gt;16%&lt;/em&gt;，远远高于各种宝。&lt;/p&gt;
&lt;p&gt;下面我们来分析一下为什么巴菲特的公司能一直涨。&lt;/p&gt;
&lt;p&gt;本质上，伯克希尔哈撒韦是一家基金公司，其收益来源于它所投资的其他公司股票的增值。巴菲特的投资逻辑是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;&lt;li&gt;找到优质的公司&lt;/li&gt;
&lt;li&gt;在它股价合理或低估的时候买入&lt;/li&gt;
&lt;li&gt;耐心等待其升值&lt;/li&gt;
&lt;/ol&gt;&lt;/blockquote&gt;
&lt;p&gt;这就是价值投资的真谛。&lt;br/&gt;对比我们大部分人的炒股逻辑：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;&lt;li&gt;找市场上的热门股，黑马股&lt;/li&gt;
&lt;li&gt;听消息，好点的还用些技术分析&lt;/li&gt;
&lt;li&gt;对买卖时机没有清晰的判断依据，大部分都是追涨杀跌&lt;/li&gt;
&lt;/ol&gt;&lt;/blockquote&gt;
&lt;p&gt;巴菲特说股票是最好的投资标的，问什么呢？这就是第三个问题。&lt;/p&gt;
&lt;h2 id=&quot;-3-&quot;&gt;问题3：为什么是投资股票，而不是其他投资品？&lt;/h2&gt;
&lt;p&gt;股市是经济发展的晴雨表。从人类发展的历史看，总的社会财富是不断增加的，而财富是由社会中的企业创造的，财富的增加反映在企业的股价上就应该是一个持续上升的曲线。下面是道琼斯指数近40年的走势图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/775365/201802/775365-20180205054912341-1396659843.png&quot; alt=&quot;&quot;/&gt;&lt;img src=&quot;http://www.cnblogs.com/CloudMan6/p/images/2.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;虽然中间有回调，但因为社会总财富在不断增加，所以总的趋势是向上的。&lt;/p&gt;
&lt;p&gt;巴菲特说一定要投资股票这种本身具有 &lt;strong&gt;增长性&lt;/strong&gt; 的资产，而不是黄金、期货这类本身不产生价值的纯粹是用来赌博的标的。&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;我们投资的其实不是股票，而是股票后面那家能不断创造价值的公司。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有人会问了，你说的都是美国的股市，人家股市都100多年了，中国股市这么不规范，能投资吗？这就是第四个问题。&lt;/p&gt;
&lt;h2 id=&quot;-4-&quot;&gt;问题4：中国股市适不适合价值投资？&lt;/h2&gt;
&lt;p&gt;先来看 1990 开市以来上证指数的走势图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/775365/201802/775365-20180205054858466-1939666791.png&quot; alt=&quot;&quot;/&gt;&lt;img src=&quot;http://www.cnblogs.com/CloudMan6/p/images/3.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;即便是2008年和2015年发生了两次大的股灾，但总的趋势还是向上的。&lt;br/&gt;指数 28 年里从 95.79 涨到 3462（2018.2.2）,也涨了 36 倍，平均年化收益 &lt;em&gt;14%&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;我看过对中国股市的一个非常形象的比喻。&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;炒股就像牵着绳子遛狗，有时候狗跑到你前面，有时候又跑到你后面。&lt;br/&gt;而在中国炒股就像在大雾天遛狗，有时候你已经看不见狗了，但不用担心，绳子还在手里，狗不会跑丢，它总会回来的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;中国的股市波动虽然高于美国这类成熟市场，但价格还是要遵循价值。&lt;/p&gt;
&lt;p&gt;我自己的理解是：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;看好中国未来 30 年的发展，目前股市被严重低估，非常值得投资。&lt;/li&gt;
&lt;li&gt;不要 &lt;em&gt;炒&lt;/em&gt; 股票，而是要投资 &lt;em&gt;好&lt;/em&gt; 公司。&lt;/li&gt;
&lt;li&gt;中国股市更高的波动性会为价值投资者带来更大更稳定的回报。&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;好了，假如看了上面我的思考，你已经认可在中国股市进行价值投资。那么对于一个有执行力的人来说，下一步就应该进入具体的操作层面。这时估计你会有如下疑问。&lt;/p&gt;
&lt;h2 id=&quot;-5-&quot;&gt;问题5：我刚参加工作，没本钱，怎么投资？&lt;/h2&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;衡量投资收益的不是绝对值，而是盈亏比率。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;投资是一辈子的事，越早开始越好。&lt;br/&gt;刚开始没有本钱没关系，少投一些，不必在意盈亏的绝对值，把注意力放在比率上。&lt;/p&gt;
&lt;p&gt;投资的道路上，有些坑是必须自己要去踩一遍的。&lt;br/&gt;这些坑包括人性的弱点，不能严格执行投资纪律等。&lt;br/&gt;所以对于投资新手，即便有本钱，前期也建议少量投入。&lt;br/&gt;踩坑付出的代价越小越好。&lt;/p&gt;
&lt;p&gt;对于职场新人，一方面用很少的资金实践价值投资的方法论，一方面专注本业，提升自身价值，为以后的投资积累资金。&lt;/p&gt;
&lt;p&gt;机会一直都有，不必担心错过。&lt;/p&gt;
&lt;h2 id=&quot;-6-&quot;&gt;问题6：嗯，我认同价值投资，那具体要怎么做呢？&lt;/h2&gt;
&lt;p&gt;这是一个 Super Question。&lt;/p&gt;
&lt;p&gt;还记得前面巴菲特的价值投资逻辑吗？&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;&lt;li&gt;找到优质的公司&lt;/li&gt;
&lt;li&gt;在它股价合理或低估的时候买入&lt;/li&gt;
&lt;li&gt;耐心等待其升值&lt;/li&gt;
&lt;/ol&gt;&lt;/blockquote&gt;
&lt;p&gt;这就是我们要做的：首先判断出好公司，并在合理的价位买入，然后交给时间这个朋友，让价值慢慢发酵。&lt;/p&gt;
&lt;p&gt;至于如何判断公司好不好，价格合不合理，请听下回分解。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/775365/201802/775365-20180205055405279-1269678414.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;​&lt;/p&gt;
</description>
<pubDate>Sun, 04 Feb 2018 21:59:00 +0000</pubDate>
<dc:creator>CloudMan</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/CloudMan6/p/8415967.html</dc:identifier>
</item>
<item>
<title>我的2017——求职篇（归宿） - codingHeart</title>
<link>http://www.cnblogs.com/codingHeart/p/8410017.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/codingHeart/p/8410017.html</guid>
<description>&lt;p&gt;　　回到朋友的住处，低沉的心情使得我不由自主的进入反思模式，虽然那不是家靠谱的公司，但一码归一码，毕竟我是去面试的，我没能赢得这场战斗，甚至可以说是惨败，自己技术能力的欠缺，对方连初级岗的职位都没想过要考虑下我，想到这，我那自卑的情绪瞬间不自觉的又奔袭而来了，或许是我那一直停留在脑袋里的观念有问题吧，总觉的有学好那些框架的能力就够了，到底学哪方面，用什么框架 到公司去了 再说吧。我甚至一度把 “公司是否愿意给我时间成长”当作检验这家公司是否靠谱的标准之一。也可见即使毕业了一年的我 身上仍然有着一种稚气和矫情。（现在看来，其实这也不是什么幼稚，只是一个人不知道自己想要的，也不知道自己喜欢什么，所以任由自己被选择，但又希望选择自己的人对自己能有几分上心而已。一种 不知道什么自己真正爱什么的女生寻爱的既视感）&lt;/p&gt;
&lt;p&gt;　　一次挫败会把自己之前建立的自信全线击溃，这或许是自卑的人特有的心理机制了，此时的我不得不想到之前那家9k的公司了，我真的值9k吗？而且，那个面试官的面试也让我心里疑雾重重，为什么面试可以这么简单基础的。如果工作只是干面试的那些事儿，我想这工作 给4、5k 就能在大学校园招一大批我这样没长大的coder了。想到这些，人瞬间有种坠落深渊的感觉，感受到自己的无能和可替代性，这真是最让人心里折磨的事情，没多久便躺在床上心如死灰了。朋友回来跟我聊到的时候倒是很自然的说，“有什么好郁闷的，不是有个9k的offer了么，也不错啊，而且，再找找，会有更好的”。&lt;/p&gt;
&lt;p&gt;　　晚上，那个暖心的hr姐姐又联系我了，之前有给我发了几张她拍的租房信息，表示如果确定了的话希望早点把房子租好来入职。这个时候 这个月的第三周也快过了，我意识到上个月的工资也不剩多少了，搬家租房什么的事情估计得2k，下个月可能都要靠花呗吃饭了。然后上午的面试也是有些打击，这个时候来一个如此暖心的人倒是让人心里舒坦不少，虽然也会想自己无法胜任工作该怎么办，估计得靠朋友接济过日子了。但那时候人更多的是积极的，心里又开始有几分底气了，这或许 是“爱” 带来的魔力吧。一种 热情 不应被辜负的  决心瞬间就涌上心头。如是，我就答应下来了，下周一就可以入职。&lt;/p&gt;
&lt;p&gt;　　于是，第二天也就是周五，跑到了公司附近找房子，上午到下午，深圳7月份的太阳也算火辣，这个时候的房子已经有点难租了，要么是7、8层走楼梯，要么就是超出预算。也在网上找了一个试试看，但情况有点吓人，具体有机会再写了。最后快天黑的时候，找到了个附近的城中村吧（像又不像），680月租押一付一 将就着决解了。&lt;/p&gt;
&lt;p&gt;　　本来准备晚上直接买城际回广州的，但好像因为是周五，基本都没票了。于是第二天周六一早就飞奔回广州，其实我生活非常简单，能不用的东西我都没要，但搬起家来东西还是有点多，买了折叠的小推车和行李包 ，临时找了个邮寄点，一块钱一斤，花了接近200块，自己还留了两个小包想着自己带过去。。从中午忙碌到晚上，大部分东西都弄的差不多，人也有点累了，一早就睡了。&lt;/p&gt;
&lt;p&gt;　　第二天，打扫下卫生，跟房东交接完，已经快中午了。接着就奔袭回深圳了。晚上到了那个小屋子，也是舟车劳顿，天气很热，小屋子里更热（到现在，事实证明，这特么真是个夏暖冬凉的小黑屋）。还好在广州也算习惯的差不多了，没电扇也能辗转反侧会儿就睡着，不影响明天早上去公司报到。&lt;/p&gt;
&lt;p&gt;　　入职之后，三层asp.net webform+easyui的erp，angular+cordova的h5的erp app 是我第一时间看到的东西。也是给我的第一个任务会涉及到的东西。easyui没有听过，angular倒是在它的官网看过那个hero的教程。经理说他们（在职的同事）他们一般3天就搞定，给我一个星期。后面装电脑，装环境，加内外网混合开发 工期当然是延误了。经理对我的第一印象应该比较一般感觉。&lt;/p&gt;
&lt;p&gt;　　但接下来，我凭一己之力为公司做出一个类似百度脑图的产品帮助内部管理产品资料文档，算是帮助公司解决了个很棘手的问题吧，本来说的是三个月试用期，在第二个月的时候直接提前转正，试用期缩短到只有一个月。经理也开始对我好感有加。&lt;/p&gt;
&lt;p&gt;　　这期间，我整个人自然是处于对自己还算满意的状态，能够基本胜任当前的工作，他们也算是信任我，这已经是个很好的开头了。但因为做的东西他们都不懂，网上基本上也难找到相关的issue，经常人会因为卡壳，又找不到人来寻求帮助而焦虑，但本着自己要证明自己，焦虑也会在熟睡和第二天的工作中消逝。总之，比之前的工作更具挑战，但也更有成就感，但技能点也还是差不多原样子，相反，之前那家公司还多要个日语的技能。&lt;/p&gt;
&lt;p&gt;　　一段时间后，压力没那么大了，随着第一个月的试用期工资发下来了，晚上躺在床上，开始不自觉的心里在算：在广州的时候干着差不多的活儿，一个月才4k的工资，现在却能拿到8k，相当于在这边干一年抵那边干两年啊，好几天都是在这种满足中睡着的。等后面一个月发了正式工资，第一时间确实没有想过会有那么多，居然发了11k+。然后脑子里又会继续想 这寻寻觅觅的一个月 直接拯救了我多少年的大好青春啊。兴奋的睡不着觉的，就会继续想，扣掉一些税什么的，在广州一个月才能到手3k多点，现在可以到手11k+，这一年可抵广州那三年都不止。想多了人又会出新的思路，在广州 那边领着4k的工资，到手3.2k，但除掉租房子吃饭什么的，一个月什么都不干 也就能剩个1000块钱，可现在，同样的生活，一个月没其他大花销的话却可以剩下 9k，这好像是个一年抵九年的对比才是，想到这，刚开始一段时间人还很得意，心里很满意，很有成就感，对前面的路也是充满了不知道哪儿来的自信。&lt;/p&gt;
&lt;p&gt;　　但慢慢的人就会反思到自己的无知，当初4k的工资自己也曾像现在这样满足过。而且，还一度久久下不了辞职的决心，被一些不知所以的东西牵扯着，或许是一种舒适区吧。人也开始有些为自己之前的无知感到 痛苦，毕竟，这一年受折磨的不仅仅是自己（4k的工资对一个本来就自卑的人来说是精神上的折磨，对一个刚毕业还要还贷款的大学生来说是生活上的折磨），家里人应该也不好受，培养出一个大学生来不容易，出来还没他们做苦力的工资高，他们不说我也能体会出来。越到后面，想到这些 人越觉得可怕，我又有几个九年（我当初觉得来大城市就是攒钱的，所以会这么算）让自己这样去犯浑呢。&lt;/p&gt;
&lt;p&gt;　　我不知道怎么表达这种痛心，如果以一个上帝视角来看自己，或许，是一种  立志拿着宝剑去手刃恶龙、守卫正义的少年，路上却沉迷于 拔剑斩蛇、为民除害去了 的惋惜吧，哈哈哈哈哈。但我知道，像我这样的人并不少，他们和我一样，有比我更有天赋的，比我更爱钻研的，比我更勤奋的，也有比我更热爱这个职业的，可他们都被环境限制住了，也可能是因为贫穷之类的原因限制了认知，对自己没有足够的自信，也难有破釜沉舟的勇气，不知道外面世界的多样性，也不太明白年轻的可能性。我们都被身边的环境掣肘，不敢有太大的动作，怕影响别人，怕自己万劫不复。我并不是一个打破环境，自我突破的强者，只能勉强算是一个暂时逃脱的侥幸者。但一个人要成长，提升自己，自寻环境都是不可避免要面临的难题。我只希望我们能多给我们自己一点可能性，别让他日的自己回想现在 像我一样的为曾经感觉到 惋惜 。&lt;/p&gt;
&lt;p&gt;　　其实我到现在都很怕，我怕我仍是那个看不清自己的我，是那个会一躺入舒适区不想睡醒的我，是浪费时光而不自知的我，是无知的我。&lt;/p&gt;
&lt;p&gt;　　但慢慢的又觉得，拔剑斩蛇与手刃恶龙真的有那么大的区别吗，为名除害也未尝不是一种守卫正义的方式，或许，我们真正要明确的只是  我们手中握着的到底会是一把什么样的剑，这好像只有我们自己才能知道。我希望的是 我们不仅要去磨它，也要适时的拿它去同新的boss对战，因为只有这样才能越来越知道这把剑真正的样子。&lt;/p&gt;
&lt;p&gt;　　最后，我不想多说些什么  呆在一个创业公司里 苦点工资低点没关系之类的说法，对于我们这种苦在农村的孩子的见识来说 这个概率实在太低。而且，很多时候我们现阶段并没有资本去做这样的投资。&lt;/p&gt;
&lt;p&gt;　　你不知道努力的时候，可以将就选择差点的环境来点燃自己的斗志，可当你已经是个想努力并且知道怎么努力的人时，还是应该找个好点的环境来帮助自己成长。&lt;/p&gt;
&lt;p&gt;　　有时候 我们手里的牌并不算差，只是没打好而已。&lt;/p&gt;
&lt;p&gt;　　咱们的路都还长，先就这样了，共勉。。。&lt;/p&gt;
</description>
<pubDate>Sun, 04 Feb 2018 17:32:00 +0000</pubDate>
<dc:creator>codingHeart</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/codingHeart/p/8410017.html</dc:identifier>
</item>
<item>
<title>Android开发模板代码（二）——为ImageView设置图片，退出后能保存ImageView的状态 - Stars-one</title>
<link>http://www.cnblogs.com/kexing/p/8414218.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/kexing/p/8414218.html</guid>
<description>&lt;p&gt;接着之前的那个从图库选择图片，设置到ImageView中去，但是，我发现了一个问题，就是再次进入的时候ImageView是恢复到了默认状态，搜索了资料许久之后，终于是发现了解决方法，使用SharePreference储存数据即可&lt;/p&gt;
&lt;h3&gt;贴上代码&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  &lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; save(String imagePath){
        SharedPreferences.Editor editor &lt;/span&gt;= getSharedPreferences(&quot;data&quot;,MODE_PRIVATE).edit();&lt;span&gt;//&lt;/span&gt;&lt;span&gt;获得SHaredPreferences.Editor对象&lt;/span&gt;
        editor.putBoolean(&quot;imageChange&quot;,&lt;span&gt;true&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;添加一个名为imageChange的boolean值，数值为true&lt;/span&gt;
        editor.putString(&quot;imagePath&quot;,imagePath);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;保存imagePath图片路径&lt;/span&gt;
        editor.apply();&lt;span&gt;//&lt;/span&gt;&lt;span&gt;提交&lt;/span&gt;
&lt;span&gt;    }
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; load(){
        SharedPreferences preferences &lt;/span&gt;= getSharedPreferences(&quot;data&quot;,MODE_PRIVATE);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;获得SharedPreferences的对象
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;括号里的判断是去找imageChange这个对应的数值，若是找不到，则是返回false，找到了的话就是我们上面定义的true，就会执行其中的语句&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt;(preferences.getBoolean(&quot;imageChange&quot;,&lt;span&gt;false&lt;/span&gt;&lt;span&gt;)){
            String imagePath &lt;/span&gt;= preferences.getString(&quot;imagePath&quot;,&quot;&quot;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;取出保存的imagePath，若是找不到，则是返回一个空&lt;/span&gt;
            displayImage(imagePath);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;调用显示图片方法，为ImageView设置图片&lt;/span&gt;
&lt;span&gt;        }

    }&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;使用&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;在准备为ImageView设置图片之前，将图片路径给保存&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1210268/201802/1210268-20180204200648201-575530535.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;load()则是放在onCreateed方法中，在初始化完之后&lt;/span&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;测试：&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1210268/201802/1210268-20180204201849857-1237943897.gif&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt; 逻辑分析&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1210268/201802/1210268-20180204203335420-1034018905.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Stars-One/ChangePictureFromAlbum&quot; target=&quot;_blank&quot;&gt;Demo下载&lt;/a&gt;&lt;/p&gt;

</description>
<pubDate>Sun, 04 Feb 2018 17:08:00 +0000</pubDate>
<dc:creator>Stars-one</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/kexing/p/8414218.html</dc:identifier>
</item>
<item>
<title>跨域二三事 - 牧云云</title>
<link>http://www.cnblogs.com/MuYunyun/p/8415066.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/MuYunyun/p/8415066.html</guid>
<description>&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/MuYunyun/fe_cloud/issues/13&quot;&gt;更好的阅读体验&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;跨域是日常开发中经常开发中经常会接触到的一个重难点知识，何不总结实践一番，从此心中对之了无牵挂。&lt;/p&gt;
&lt;h3 id=&quot;同源策略&quot;&gt;同源策略&lt;/h3&gt;
&lt;p&gt;之所以会出现跨域解决方案，是因为同源策略的限制。同源策略规定了如果两个 url 的协议、域名、端口中有任何一个不等，就认定它们跨源了。比如下列表格列出和 &lt;code&gt;http://127.0.0.1:3000&lt;/code&gt; 比较的同源检测的结果，&lt;/p&gt;
&lt;p&gt;那跨源有什么后果呢？归纳有三：不能获取 Cookie、LocalStorage、IndexedDB；不能获取 dom 节点；不能进行一般的 Ajax 通信；跨域解决方案的出现就是为了解决以上痛处。&lt;/p&gt;
&lt;h3 id=&quot;jsonp-跨域&quot;&gt;JSONP 跨域&lt;/h3&gt;
&lt;p&gt;提到 JSONP 跨域，不得不先提到 &lt;code&gt;script&lt;/code&gt; 标签，和 &lt;code&gt;img&lt;/code&gt;、&lt;code&gt;iframe&lt;/code&gt; 标签类似，这些标签是不受同源策略限制的，JSONP 的核心就是通过动态加载 script 标签来完成对目标 url 的请求。&lt;/p&gt;
&lt;p&gt;先来看一段 JSONP 调用的 &lt;code&gt;Headers&lt;/code&gt; 部分，字段如下：&lt;/p&gt;
&lt;pre class=&quot;http&quot;&gt;
&lt;code&gt;Request URL:http://127.0.0.1:3000/?callback=handleResponse
Request Method:GET
Status Code:200 OK
Remote Address:127.0.0.1:3000&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;可以很鲜明地发现在 &lt;code&gt;Request URL&lt;/code&gt; 中有一句 &lt;code&gt;?callback=handleResponse&lt;/code&gt;，这个 callback 后面跟着的 handleResponse 即回调函数名（可以任意取），服务端会接收到这个参数然后拼接成形如 &lt;code&gt;handleResponse(JSON)&lt;/code&gt; 的形式返还给前端(这也是 JSONP == JSON with padding 的原因吧)，如下图，这时候浏览器就会自动调用我们事先定义好的 handleResponse 函数。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2018/2/5/1616194856858e22?w=300&amp;amp;h=81&amp;amp;f=jpeg&amp;amp;s=8224&quot;/&gt;&lt;/p&gt;
&lt;p&gt;前端代码示例：(源为 &lt;a href=&quot;http://127.0.0.1:3001&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3001&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;9&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;handleResponse&lt;/span&gt;(res) &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(res) &lt;span class=&quot;co&quot;&gt;// {text: &quot;jsonp&quot;}&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; script &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;createElement&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'script'&lt;/span&gt;)
&lt;span class=&quot;va&quot;&gt;script&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3000?callback=handleResponse'&lt;/span&gt;
&lt;span class=&quot;va&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;head&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;appendChild&lt;/span&gt;(script)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;服务端代码示例：(源为 &lt;a href=&quot;http://127.0.0.1:3000&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3000&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;12&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; server &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;http&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;createServer&lt;/span&gt;((req&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; res) &lt;span class=&quot;op&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;op&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;req&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;url&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;indexOf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'?callback'&lt;/span&gt;)) &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;// 简单处理 JSONP 跨域的时候&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;st&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'jsonp'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; callback &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;req&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;url&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;split&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'callback='&lt;/span&gt;)[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; json &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;JSON&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;stringify&lt;/span&gt;(obj)
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; build &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; callback &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;vs&quot;&gt;`(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;${&lt;/span&gt;json&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;vs&quot;&gt;)`&lt;/span&gt;
    &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;end&lt;/span&gt;(build) &lt;span class=&quot;co&quot;&gt;// 这里返还给前端的是拼接好的 JSON 对象&lt;/span&gt;
  &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看出 JSONP 具有直接访问响应文本的优点，但是要想确认 JSONP 是否请求失败并不容易，因为 script 标签的 onerror 事件还未得到浏览器广泛的支持，此外它仅能支持 GET 方式调用。&lt;/p&gt;
&lt;h3 id=&quot;cors-跨域&quot;&gt;CORS 跨域&lt;/h3&gt;
&lt;p&gt;CORS(Cross-Origin Resource Sharing) 可以理解为加强版的 Ajax，也是目前主流的跨域解决方案。它的核心思想即&lt;code&gt;前端与后端进行 Ajax 通信时，通过自定义 HTTP 头部设置从而决定请求或响应是否生效&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;比如前端代码(url 为 &lt;a href=&quot;http://127.0.0.1:3001)%E5%86%99%E4%BA%86%E6%AE%B5&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3001)写了段&lt;/a&gt; Ajax，代码如下：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;11&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; xhr &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;XMLHttpRequest&lt;/span&gt;()
&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onreadystatechange&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt; () &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;readyState&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;300&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;304&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;va&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'responseTesx:'&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;responseText&lt;/span&gt;)
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;open&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'get'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3000'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;)
&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;send&lt;/span&gt;()&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;因为端口不一致的关系这时候导致不同源了，这时候会在 Request Headers 中发现多了这么一行字段，&lt;/p&gt;
&lt;pre class=&quot;http&quot;&gt;
&lt;code&gt;Origin: http://127.0.0.1:3001&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;而且控制台中会报出如下错误:&lt;/p&gt;
&lt;pre class=&quot;http&quot;&gt;
&lt;code&gt;Failed to load http://127.0.0.1:3000/: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://127.0.0.1:3001' is therefore not allowed access.&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这时候就需要在服务端设置字段 &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;，它的作用就是设置允许来自什么源的请求，如果值设置为 &lt;code&gt;*&lt;/code&gt;，表明允许来自任意源的请求。服务端代码示例如下：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;va&quot;&gt;http&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;createServer&lt;/span&gt;((req&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; res) &lt;span class=&quot;op&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setHeader&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'Access-Control-Allow-Origin'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3001'&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;// 设置允许来自 http://127.0.0.1:3001 源的请求&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CORS 分为简单请求以及非简单请求。可以这么区分，如果请求方法为 &lt;code&gt;POST&lt;/code&gt;、&lt;code&gt;GET&lt;/code&gt;、&lt;code&gt;HEAD&lt;/code&gt; 时为简单请求，其它方法如 &lt;code&gt;PUT&lt;/code&gt;、&lt;code&gt;DELETE&lt;/code&gt; 等为非简单请求，如果是非简单请求的话，可以在 chrome 的 Network 中看到多了一次 &lt;code&gt;Request Method&lt;/code&gt; 为 &lt;code&gt;OPTIONS&lt;/code&gt; 的请求。如下图:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2018/2/5/161619485ebf54e7?w=701&amp;amp;h=214&amp;amp;f=jpeg&amp;amp;s=30882&quot;/&gt;&lt;/p&gt;
&lt;p&gt;可以把这个请求称为预请求，用白话文翻译下，浏览器询问服务器，'服务器大哥，我这次要进行 PUT 请求，你给我发张通行证呗'，服务器大哥见浏览器小弟这么殷勤，于是给了它发了张通行证，叫作 &lt;code&gt;Access-Control-Allow-Methods:PUT&lt;/code&gt;，接着浏览器就能愉快地进行 PUT 请求了。服务端代码示例如下：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;11&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;va&quot;&gt;http&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;createServer&lt;/span&gt;((req&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; res) &lt;span class=&quot;op&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setHeader&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'Access-Control-Allow-Origin'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3001'&lt;/span&gt;)
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setHeader&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'Access-Control-Allow-Methods'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3001'&lt;/span&gt;)
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;聊完简单请求和非简单请求的区别后，再来看看如何利用 CORS 实现 Cookie 的跨域传送，首先在服务器随意设置个 Cookie 值下发到浏览器，如果非跨域的情况下，浏览器再次请求服务器时就会带上服务器给的 Cookie，但是跨域的时候怎么办呢？不卖关子了，需在服务端设置 &lt;code&gt;Access-Control-Allow-Credentials&lt;/code&gt; 字段以及在客户端设置 &lt;code&gt;withCredentials&lt;/code&gt; 字段，两者缺一不可，代码如下：&lt;/p&gt;
&lt;p&gt;前端代码示例：(源为 &lt;a href=&quot;http://127.0.0.1:3001&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3001&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; xhr &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;XMLHttpRequest&lt;/span&gt;()
...
&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;withCredentials&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;// 传 cookie 的时候前端要做的&lt;/span&gt;
&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;open&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'get'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3000'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;)
&lt;span class=&quot;va&quot;&gt;xhr&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;send&lt;/span&gt;()&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;服务端代码示例: (源为 &lt;a href=&quot;http://127.0.0.1:3000&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3000&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;14&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; server &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;http&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;createServer&lt;/span&gt;((req&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; res) &lt;span class=&quot;op&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setHeader&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'Access-Control-Allow-Origin'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3001'&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;// 必填：接受域的请求&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setHeader&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'Set-Cookie'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;'type=muyy'&lt;/span&gt;]) &lt;span class=&quot;co&quot;&gt;// 下发 cookie&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setHeader&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'Access-Control-Allow-Credentials'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;// ② 选填：是否允许浏览器传 cookie 到服务端，只能设置为 true&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;res&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;end&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'date from cors'&lt;/span&gt;)
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;至此介绍了几个比较关键 HTTP 头在 CORS 中的实践运用，更为详细的资料可以参阅 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS&quot;&gt;Cross-Origin Resource Sharing&lt;/a&gt;，最后概括下 CORS 的优缺点，优点是支持所有类型的 HTTP 方法，缺点是有些老的浏览器不支持 CORS。&lt;/p&gt;
&lt;h3 id=&quot;hash-iframe&quot;&gt;hash + iframe&lt;/h3&gt;
&lt;p&gt;在文章最开始提到过 iframe 标签也是不受同源策略限制的标签之一，hash + iframe 的跨域核心思想就是，在 A 源中通过动态改变 iframe 标签的 src 的哈希值，在 B 源中通过 &lt;code&gt;window.onhashchange&lt;/code&gt; 来捕获到相应的哈希值。思路不难直接上代码：&lt;/p&gt;
&lt;p&gt;A 页面代码示例(源为 &lt;a href=&quot;http://127.0.0.1:3000&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3000&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode html&quot;&gt;
&lt;code class=&quot;sourceCode html&quot;&gt;&lt;span class=&quot;kw&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;kw&quot;&gt;&amp;lt;iframe&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; src=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://127.0.0.1:3001&quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;kw&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; iframe &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;getElementsByTagName&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'iframe'&lt;/span&gt;)[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]
    &lt;span class=&quot;va&quot;&gt;iframe&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'style'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'display: none'&lt;/span&gt;)
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;dt&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'hash'&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;va&quot;&gt;iframe&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;iframe&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'#'&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;JSON&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;stringify&lt;/span&gt;(obj) &lt;span class=&quot;co&quot;&gt;// ① 关键语句&lt;/span&gt;
  &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;lt;/body&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;B 页面代码示例(源为 &lt;a href=&quot;http://127.0.0.1:3001&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3001&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;8&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;va&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onhashchange&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;() &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;// ① 关键语句&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'来自 page2 的代码 '&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;location&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;hash&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;// 来自 page2 的代码 #{&quot;data&quot;:&quot;hash&quot;}&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刷新 A 页面，可以发现在控制台打印了如下字段，至此实现了跨域。&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;来自 page2 的代码 #&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;hash&quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这种方式进行跨域优点是支持页面和页面间的通信，缺点也是只支持 GET 方法和单向的跨域通信。&lt;/p&gt;
&lt;h3 id=&quot;postmessage&quot;&gt;postMessage&lt;/h3&gt;
&lt;p&gt;为了实现跨文档传送(cross-document messaging)，简称 XDM。HTML5 给出了一个 api —— postMessage，postMessage() 方法接收两个参数：&lt;code&gt;发送消息&lt;/code&gt;以及&lt;code&gt;消息接收方所在域的字符串&lt;/code&gt;。代码示例如下:&lt;/p&gt;
&lt;p&gt;A 页面代码示例(源为 &lt;a href=&quot;http://127.0.0.1:3000&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3000&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;12&quot;&gt;
&lt;pre class=&quot;sourceCode html&quot;&gt;
&lt;code class=&quot;sourceCode html&quot;&gt;&lt;span class=&quot;kw&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;kw&quot;&gt;&amp;lt;iframe&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; src=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://127.0.0.1:3001&quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;kw&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; iframe &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;getElementsByTagName&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'iframe'&lt;/span&gt;)[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]
    &lt;span class=&quot;va&quot;&gt;iframe&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;setAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'style'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'display: none'&lt;/span&gt;)
    &lt;span class=&quot;va&quot;&gt;iframe&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;() &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;// 此处要等 iframe 加载完毕，后续代码才会生效&lt;/span&gt;
      &lt;span class=&quot;va&quot;&gt;iframe&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;contentWindow&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;postMessage&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'a secret'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'http://127.0.0.1:3001'&lt;/span&gt;)
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;lt;/body&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;B 页面代码示例(源为 &lt;a href=&quot;http://127.0.0.1:3001&quot; class=&quot;uri&quot;&gt;http://127.0.0.1:3001&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;va&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;addEventListener&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'message'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;(event) &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;va&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'From page1 '&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;event&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;data&lt;/span&gt;)
  &lt;span class=&quot;va&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'From page1 '&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;event&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;origin&lt;/span&gt;)
&lt;span class=&quot;op&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;false&lt;/span&gt;)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刷新 A 页面，可以发现在控制台打印了如下字段，至此实现了跨域。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;From page1 a secret
From page1 http://127.0.0.1:3000&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这种跨域方式优点是是支持页面和页面间的双向通信，缺点也是只能支持 GET 方法调用。&lt;/p&gt;
&lt;h3 id=&quot;websockets&quot;&gt;WebSockets&lt;/h3&gt;
&lt;p&gt;WebSockets 属于 HTML5 的协议，它的目的是在一个持久连接上建立全双工通信。由于 WebSockets 采用了自定义协议，所以优点是客户端和服务端发送数据量少，缺点是要额外的服务器。基础的使用方法如下：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;9&quot;&gt;
&lt;pre class=&quot;sourceCode js&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;kw&quot;&gt;const&lt;/span&gt; ws &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;WebSocket&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'ws://127.0.0.1:3000'&lt;/span&gt;)
&lt;span class=&quot;va&quot;&gt;ws&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onopen&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;() &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;co&quot;&gt;// 连接成功建立&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;va&quot;&gt;ws&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onmessage&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;(event) &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;co&quot;&gt;// 处理数据&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;va&quot;&gt;ws&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onerror&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;() &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;co&quot;&gt;// 发生错误时触发，连接中断&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;va&quot;&gt;ws&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;onclose&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;() &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;co&quot;&gt;// 连接关闭时触发&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当然一般我们会使用封装好 WebSockets 的第三方库 &lt;a href=&quot;https://github.com/socketio/socket.io&quot;&gt;socket.io&lt;/a&gt;，这里具体就不展开了。&lt;/p&gt;
&lt;h3 id=&quot;项目地址&quot;&gt;项目地址&lt;/h3&gt;
&lt;p&gt;前文所述五种跨域实践的 demo 已上传至 &lt;a href=&quot;https://github.com/MuYunyun/cross-domain&quot;&gt;cross-domain&lt;/a&gt;，前端环境基于 create-react-app 搭建，后端环境用 node 搭建。&lt;/p&gt;
&lt;p&gt;当然跨域方式还有一些其他方式的实现，后续酌情慢慢填坑~&lt;/p&gt;
</description>
<pubDate>Sun, 04 Feb 2018 16:27:00 +0000</pubDate>
<dc:creator>牧云云</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/MuYunyun/p/8415066.html</dc:identifier>
</item>
<item>
<title>【蓝桥杯单片机07】彻底理解51单片机的中断系统 - 小蜜蜂老师</title>
<link>http://www.cnblogs.com/ALittleBee/p/8414903.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/ALittleBee/p/8414903.html</guid>
<description>&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;【蓝桥杯单片机07】彻底理解51单片机的中断系统&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;strong&gt;&lt;span&gt;广东职业技术学院 欧浩源&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    在接下来的教程中，将会介绍定时器、串口通信等外设的基本使用，而这些外设的使用都要涉及中断，而且中断是单片机或嵌入式开发中一个相当重要的概念。不能掌握中断系统，就无法灵活应用这些外设。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;1、什么是中断？&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    你正在追电视剧《神雕侠侣》,正看得入迷的时候，电话响了，你暂停电视剧，去接电话，在接电话的过程中，门铃又响了，你暂时放下电话，去把门打开。如果追电视剧是在执行主程序，那么电话就是&lt;span&gt;&lt;strong&gt;中断&lt;/strong&gt;&lt;/span&gt;源，电话铃响了就是&lt;span&gt;&lt;strong&gt;中断请求&lt;/strong&gt;&lt;/span&gt;，暂停电视就是&lt;span&gt;&lt;strong&gt;现场保护&lt;/strong&gt;&lt;/span&gt;，接电话就是&lt;span&gt;&lt;strong&gt;中断响应&lt;/strong&gt;&lt;/span&gt;，门铃响了是&lt;span&gt;&lt;strong&gt;更高一级的中断请求&lt;/strong&gt;&lt;/span&gt;，去把门打开，那就是&lt;span&gt;&lt;strong&gt;中断嵌套&lt;/strong&gt;&lt;/span&gt;。开完门回来接着聊电话，那是&lt;span&gt;&lt;strong&gt;中断返回&lt;/strong&gt;&lt;/span&gt;，接完电话把电视剧暂停打开就是&lt;span&gt;&lt;strong&gt;现场恢复&lt;/strong&gt;&lt;/span&gt;。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    内核与外设之间的主要交互方式有两种：&lt;span&gt;&lt;strong&gt;轮询&lt;/strong&gt;&lt;/span&gt;和&lt;span&gt;&lt;strong&gt;中断&lt;/strong&gt;&lt;/span&gt;。轮询的方式貌似公平，但实际工作效率很低，且不能及时响应紧急事件；&lt;span&gt;&lt;strong&gt;中断系统使得内核具备了应对突发事件的能力&lt;/strong&gt;&lt;/span&gt;。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    中断有个特点，就是你不知道中断什么时候发生。因此，每个中断都需要有一个中断入口地址，也成为&lt;span&gt;&lt;strong&gt;中断向&lt;/strong&gt;&lt;/span&gt;量。这样，不管中断在什么时候发生，它都有一个确定的程序执行起始点。中断响应之后，执行的那段程序，我们称作中断服务函数，也就是这个函数专门是为该中断服务的。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;2、关于51单片机的中断系统&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    一般来说，51单片机有5个中断源（忽略定时/计数器2），分2个优先级，这个5个中断源按照自然优先级从高到低依次为：&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;strong&gt;外部中断0&lt;/strong&gt;：&lt;span&gt;&lt;strong&gt;INT0&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;strong&gt;定时/计数器0&lt;/strong&gt;：&lt;span&gt;&lt;strong&gt;TF0&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;strong&gt;外部中断1&lt;/strong&gt;：&lt;span&gt;&lt;strong&gt;INT1&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;strong&gt;定时/计数器1&lt;/strong&gt;：&lt;span&gt;&lt;strong&gt;TF1&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;strong&gt;串口中断&lt;/strong&gt;：&lt;span&gt;&lt;strong&gt;RI/TI&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    下面一图将充分说明51单片机的中断系统结构：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/1172284/201802/1172284-20180205000542748-598076572.jpg&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    每个中断源都对应着一个固定的入口地址，也就是中断向量，它们依次是：&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/span&gt;  0x0003： &lt;span&gt;&lt;strong&gt;INT0&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;/span&gt;  0x000B： &lt;span&gt;&lt;strong&gt;TF0&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/span&gt;  0x0013： &lt;span&gt;&lt;strong&gt;INT1&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;/span&gt;  0x001B： &lt;span&gt;&lt;strong&gt;TF1&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;/span&gt;  0x0023： &lt;span&gt;&lt;strong&gt;RI/TI&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    也就是说，不管主程序执行到什么地方，只要外部中断1产生请求，内核要响应该中断，就会到0x0013这个地址去执行代码。如果你是在使用汇编语言进行程序开发的时候，你需要记住每个中断源对应的地址；如果你使用的是C语言，你只需要记住&lt;span&gt;&lt;strong&gt;中断源&lt;/strong&gt;&lt;/span&gt;的顺序就可以了，也就是最左边的&lt;span&gt;&lt;strong&gt;中断号&lt;/strong&gt;&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3、中断相关的寄存器&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    中断相关的寄存器有4个，每个寄存器都是可以位寻址的，这该编程带来了方便。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    其中2个为控制寄存器：&lt;span&gt;&lt;strong&gt;IE&lt;/strong&gt;&lt;/span&gt;寄存器与&lt;span&gt;&lt;strong&gt;IP&lt;/strong&gt;&lt;/span&gt;寄存器：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/1172284/201802/1172284-20180205000631264-1306991241.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    另外2个为中断请求标志：&lt;span&gt;&lt;strong&gt;TCON&lt;/strong&gt;&lt;/span&gt;寄存器与&lt;span&gt;&lt;strong&gt;SCON&lt;/strong&gt;&lt;/span&gt;寄存器：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/1172284/201802/1172284-20180205000707482-951120502.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;4、关于中断服务函数程序的编写&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    一般情况下，中断的处理函数有两个，其一为中断初始化函数，其二为中断服务函数。初始化函数就是一个普通的函数，而中断服务函数却有特殊的格式要求：&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &amp;lt;1&amp;gt; 中断函数没有返回值，也不能带参数。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &amp;lt;2&amp;gt; 函数名后面要跟一个关键字interrupt，说明这是一个中断服务函数。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &amp;lt;3&amp;gt; 在关键字interrupt后面要跟上中断号，说明这个中断服务函数是为那个中断服务的。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    中断服务函数的格式为：&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;&lt;strong&gt;void&lt;/strong&gt;&lt;/span&gt;   函数名()  &lt;span&gt;&lt;strong&gt;interrupt&lt;/strong&gt;&lt;/span&gt;  &lt;span&gt;&lt;strong&gt;中断号&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    {&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;            ----函数体----&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    我们要利用定时器0来进行间隔定时，中断程序架构我们C语言可以这样写：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/1172284/201802/1172284-20180205000756029-328237376.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;5、结束语&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    中断系统很重要，务必彻底理解，熟练掌握，对于每一个款微处理器都是这样！！！&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 04 Feb 2018 16:13:00 +0000</pubDate>
<dc:creator>小蜜蜂老师</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/ALittleBee/p/8414903.html</dc:identifier>
</item>
<item>
<title>学技术是为了什么？来自一位小白和一位大牛的精彩对话 - 青竹博客</title>
<link>http://www.cnblogs.com/hystj/p/8414847.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hystj/p/8414847.html</guid>
<description>&lt;p&gt;看不清图的，可以看字&lt;/p&gt;

&lt;blockquote readability=&quot;37&quot;&gt;
&lt;p&gt;&lt;span&gt;Dear Alex老师:&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;         很高兴能成为你的学员（网络班学员），不算第一次接触编程，但确实还是属于比较低的水平；之前属于“自学型”的，结果你肯定猜到了，当然是没有结果了。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;        之所以以这种私信的形式与你交流，不是全听了你伟大的“鸡汤”而对你表示崇高的敬意和崇拜，而是想与你真正的交流下，不求你指点我的人生，不过很乐意看到你的所想所感，因为自我认为自己是个loser！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;        首先说一下我的情况吧，我是一个快接近三十岁的IT男，无天赋，其貌也不扬，算属于踏实工作的那种；毕业已经7年了，出来算是干了IT这块（专业不是IT），不怕你笑话，那时所谓的IT就是在电脑城组装电脑；一直摸爬滚打，换了好几份工作，干过售后，干过售前，从开始的三线存储厂家，到现在的主网网络产品的总代公司，拿过华为的HCIE；自己还算属于对技术比较热衷，不排斥对技术的厌倦。可一路走来，感觉自己一无所有，没有房子，没有车子，还没结婚，钱袋子里更是剩的不多，就像你说的感觉——一直属于穷人的认知层次。其实我自己也在苦苦的思想挣扎中，想改变自己的认识。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 在公司里工作，我还算是兢兢业业的，对交代的工作都能完成。不过这也是我最恐惧的，混个五六年可能还能混出一个高职位，不过看到那些已经五六年的老员工，我真心不想成为那个样子，说真的我怕那种生活，死板而又无聊，说句高逼格的话，我向往的是：阳光和自由！我愿意走出舒适区，趁着我现在还有点冲劲。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 就拿学你的课程来说，当然不是心血来潮，或者钱多了没地方花；自己也是考虑过的，结合了时代发展的趋势，提示自己的价值考虑，多维度的发展，提升自己的技术壁垒，还有一个小小的愿望，就是圆我大学时的梦吧（大学那会参加编程比赛输了，那时我可伤心了好几天）。当时反对的声音也是有，摆着眼前的当然是什么年龄大，什么不务正业，什么不好好工作等等。每当这时我还有句高逼格的回答：我60岁壮年，我还年轻。说归说，内心其实还是有这般或者那般的纠结，不过抛开所有的困惑，就当圆自己一个当初的梦吧！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 你的见识和格局肯定比我高，当然您也不愿自称“高人”，不过您有特斯拉，我没有，哈哈；别人有过人之处的地方，虚心学习有为何不可。目前自我其实对自己的前途比较迷茫，不知往哪里走。我想积极的改变自己，不想自己陷于“穷人的思维”，可自己的格局确实太浅，虽然自己也在慢慢的改变，不过处于我人生的这个阶段，有点所谓的“前后夹击”，着实让我困惑难免。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 不知不觉跟您说了一些内心的话，希望您原谅一个loser给您传播的负能量，我知道自己路还得自己走！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;                     至此！                                                          您的学生（石xx）于2017年09月10号&lt;/span&gt;&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;我的回复&lt;/p&gt;
&lt;blockquote readability=&quot;40.5&quot;&gt;
&lt;p&gt;hey man ,&lt;/p&gt;

&lt;p&gt;我仔细看了你的来信 ，本想故意放几天再回复，那样显的沉思熟虑些，可我忍不住了。&lt;/p&gt;

&lt;p&gt;其实有很多人，如你一样，活在莫名其妙的迷茫、焦虑中，这种迷茫与工资收入关系并不是太紧密，不是所谓loser的专属，我有些朋友，一个月工资挣好几万，一年收入大几十万或数百万，但他们除了物质上滋润些，依然内心忐忑、迷茫。 包括我自己，之前也偶尔这样，买了很多人觉得好像很nb的TESLA也并没改变这些。所以，你迷茫这事，本质上与钱关系不大。&lt;/p&gt;

&lt;p&gt;你迷茫或许是因为你没有找到自己真正喜欢做的事情 ，这句话太俗套了，接下来就要告诉你follow your heart, do whatever you want之类的了。 容我讲个事情 。&lt;/p&gt;

&lt;p&gt;我的健身教练，他身材很好，跑马拉松，全程下来4小时，过中极为痛苦，我说那还跑个毛线，他说感觉自己每跑完一次，人生就得到了一次升华，我说扯蛋，他说真的，他说跑完后，那种爽，比搞姑娘要爽100倍，搞的我竟然有点心动了。&lt;/p&gt;
&lt;p&gt;我看到一篇文章，讲一个老板，有钱了，开始玩起海钓，钓一种叫石斑鱼的东西，这鱼，不太容易长大，说是能长2公斤就算非常大了，只能在特定海域才能发现大的，且跟气候等有很大关系 ，这位老板，为了钓一条大的石斑鱼，花大量时间研究它的习性、生活海域、气候相关知识，经常跑到公海上 呆好几天在船上。 只为这么一条我们平常人都不太care的事情。&lt;/p&gt;

&lt;p&gt;我今年去硅谷，走访google,fb,airbnb等公司，看到很多公司的程序员，四五十岁，还在写代码，一件事情干个几十年，乐于其中，而我们中国的程序员，写了几年代码，刚熟络起来，就想着做管理、想着创业、想着转行，焦躁的不行，生怕自己的才识被埋没，好像他做的现在的工作，都只是下一步的铺路石，他从来没有真心热爱过、上心过这个工作，心中喜欢的、期待的一直是下一个job。&lt;/p&gt;


&lt;p&gt;通过几个小片断，我想告诉你的是，  &lt;strong&gt;很多让人很有成就 感 、感到真正满足的事情，都是需要下大功夫、沉得住气熬出来的&lt;/strong&gt;，&lt;strong&gt;浅显的快乐会迅速的来，亦会迅速的走&lt;/strong&gt;。所以，对于你的建议，若你真是喜欢编程，请一头扎进去，用代码实现你之前一个个的对于技术的想法，别管他以后能给你带来多少的工资。做有趣的事情，比挣钱更让人快乐。&lt;/p&gt;

&lt;div readability=&quot;12&quot;&gt;
&lt;p&gt;我当年学英语，并不是为了挣多少钱，只因为我就是喜欢自己能流利说英语的样子。我当时自学编程，并不是为了拿它挣高工资，或为了今天的创业，只是因为，我一直想独立开发一套IT自动化的工具，当时想，如果能做出来，会觉得自己非常cool.&lt;/p&gt;

&lt;p&gt;若可以，我希望你也能与当时的我一样。&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Sun, 04 Feb 2018 15:40:00 +0000</pubDate>
<dc:creator>青竹博客</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/hystj/p/8414847.html</dc:identifier>
</item>
<item>
<title>并发思考-actor和thread那个好点？ - 舆</title>
<link>http://www.cnblogs.com/gnool/p/8414673.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/gnool/p/8414673.html</guid>
<description>&lt;p&gt;&lt;strong&gt;&lt;span&gt;实验课题：&lt;/span&gt;&lt;/strong&gt;测试actor和thread那个好？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;实验方法：&lt;/span&gt;&lt;/strong&gt;利用数据库连接池创建连接，交由线程去工作，在回收，看看程序运行状况。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;实验步骤：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1.创建数据连接工具类：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;38&quot;&gt;
&lt;pre class=&quot;brush:scala;gutter:true;&quot;&gt;
import java.sql.{Connection, DriverManager}
import java.util.concurrent.LinkedBlockingQueue

import com.scala.spark.commen.util.StreamingConfigure


object DBUtil{
  private val dbConnectionPool = new LinkedBlockingQueue[Connection]()
  private var current_num = 0 //当前连接数


  private def before(){
    if (current_num &amp;gt; StreamingConfigure.executor_max_mysql_connection.toInt &amp;amp;&amp;amp; dbConnectionPool.isEmpty()) {
      print(&quot;&quot;&quot;
              |☆☆☆■■■■■■☆☆☆☆☆☆☆■■■■■■■
            &quot;&quot;&quot;.stripMargin)
      Thread.sleep(2000)
      before()
    }else{
      Class.forName(StreamingConfigure.driver)
    }
  }

  private def initConn(): Connection = {
    val conn = DriverManager.getConnection(StreamingConfigure.url, StreamingConfigure.username, StreamingConfigure.password)
    conn
  }

  private def initConnectionPool(): LinkedBlockingQueue[Connection] = {
    AnyRef.synchronized({
      if (dbConnectionPool.isEmpty()) {
        before()
        for (i &amp;lt;- 1 to StreamingConfigure.executor_num_mysql_connection.toInt) {
          dbConnectionPool.put(initConn)
          current_num += 1
        }
      }
      dbConnectionPool
    })
  }

  def getInstance():Connection={
    var conn = dbConnectionPool.poll()
    if(conn==null){
      initConnectionPool()
      conn = dbConnectionPool.poll()
    }
    return conn
  }

  def releaseCon(con:Connection){
    dbConnectionPool.put(con)
  }

  def get_current_num()={
    current_num
  }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 2.创建thread访问数据库连接池&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;36&quot;&gt;
&lt;pre readability=&quot;7&quot;&gt;
object DBUtilTest extends App{&lt;br/&gt;for (i &amp;lt;- 1 to 10000){&lt;br/&gt;ConnThread(i).start()&lt;br/&gt;}&lt;br/&gt;}&lt;p&gt;case  class ConnThread(name:Int) extends Thread{&lt;br/&gt;override def run(): Unit = {&lt;br/&gt;val conn = DBUtil.getInstance()&lt;br/&gt;DBUtil.releaseCon(conn)&lt;br/&gt;println(s&quot;$conn conn is $name，current_num is ${DBUtil.get_current_num()}&quot;)&lt;br/&gt;}&lt;br/&gt;}
&lt;/p&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 3.创建Actor访问数据连接池&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;36&quot;&gt;
&lt;pre class=&quot;brush:scala;gutter:true;&quot;&gt;
class DBActor extends Actor{
  var count  = 0
  override def receive: Receive = {
    case &quot;create&quot; =&amp;gt;
      val conn = DBUtil.getInstance()
      count += 1
      println(s&quot;$conn conn is $count&quot;)
      DBUtil.releaseCon(conn)
  }
}

object AkkaClient extends App{

  val system = ActorSystem(&quot;DBUtil&quot;)

  val dBActor = system.actorOf(Props[DBActor],&quot;dBActor&quot;)

  for (i &amp;lt;- 1 to 10000) dBActor ! &quot;create&quot;

  println(&quot;&amp;gt;&amp;gt;&amp;gt; Press ENTER to exit &amp;lt;&amp;lt;&amp;lt;&quot;)
  try StdIn.readLine()
  finally system.terminate()
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;实验结果&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;：运行两种访问，查看结果。&lt;/p&gt;
&lt;p&gt;thread&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;91&quot;&gt;
&lt;p&gt;&lt;br/&gt;objc[10258]: Class JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/bin/java (0x10782a4c0) and /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre/lib/libinstrument.dylib (0x1079044e0). One of the two will be used. Which one is undefined.&lt;br/&gt;Sun Feb 04 22:32:06 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2291，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2280，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2295，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2293，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2299，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2287，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2286，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2298，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2292，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2289，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2300，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2301，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2302，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2290，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2297，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2303，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2283，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2304，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2296，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2281，current_num is 1&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2288，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2284，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2305，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2294，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2282，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2285，current_num is 1&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2306，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2307，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2308，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2309，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2310，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2311，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2312，current_num is 2&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2313，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2314，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2315，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2316，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2317，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2318，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2319，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2320，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2321，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2322，current_num is 3&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2323，current_num is 3&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2324，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2325，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2326，current_num is 4&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2327，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2328，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2329，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2330，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2331，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2332，current_num is 4&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2333，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2334，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2335，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2336，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2337，current_num is 5&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2338，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2339，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2340，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2341，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2342，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2343，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2344，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2345，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2346，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2347，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2348，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2349，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2350，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2351，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2352，current_num is 5&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2353，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2354，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2355，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2356，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2357，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2358，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2359，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2360，current_num is 6&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2361，current_num is 6&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2362，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2363，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2364，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2365，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2366，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2367，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2368，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2369，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2370，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2371，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2372，current_num is 7&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2373，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2374，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2375，current_num is 8&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2376，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2377，current_num is 8&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2378，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2379，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2380，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2381，current_num is 8&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2382，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2383，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2385，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2384，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2386，current_num is 9&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2388，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2387，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2389，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2390，current_num is 9&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2391，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 1，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2279，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2392，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2278，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2277，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2276，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2275，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2393，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2274，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2273，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2272，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2271，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2394，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2269，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2270，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2395，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2267，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2266，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2268，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2396，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2265，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2264，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2397，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2263，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2262，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2261，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2398，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2260，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2399，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2259，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2258，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2256，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2257，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2255，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2400，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2254，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2401，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2253，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2252，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 21，current_num is 10&lt;br/&gt;Exception in thread &quot;Thread-2243&quot; java.lang.NullPointerException&lt;br/&gt;at java.util.concurrent.LinkedBlockingQueue.put(LinkedBlockingQueue.java:332)&lt;br/&gt;at com.scala.spark.commen.pool.DBUtil$.releaseCon(DBUtil.scala:54)&lt;br/&gt;at com.scala.spark.commen.pool.ConnThread.run(DBUtilTest.scala:15)&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2251，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2245，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2246，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2247，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2404，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2249，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2248，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2250，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2403，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2402，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2419，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2420，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2421，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2422，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2423，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2424，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2425，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2426，current_num is 11&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2427，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2428，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2429，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2430，current_num is 11&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2431，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2432，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2433，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2434，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2418，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2435，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2436，current_num is 12&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2437，current_num is 13&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2438，current_num is 13&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2439，current_num is 13&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2440，current_num is 13&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2441，current_num is 13&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2442，current_num is 13&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2443，current_num is 13&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2444，current_num is 14&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2445，current_num is 14&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2446，current_num is 14&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2447，current_num is 14&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2448，current_num is 14&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2449，current_num is 14&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2450，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2451，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2452，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2453，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2454，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2455，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2456，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2457，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2458，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2459，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2460，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2461，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2462，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2463，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2464，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2465，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2466，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2467，current_num is 15&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2468，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2469，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2470，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2471，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2472，current_num is 15&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2473，current_num is 16&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2474，current_num is 16&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2475，current_num is 16&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2476，current_num is 16&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2477，current_num is 16&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2478，current_num is 16&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2479，current_num is 16&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2480，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2481，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2482，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2483，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2484，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2485，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2486，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2487，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2488，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2489，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2490，current_num is 17&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2491，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2492，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2493，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2494，current_num is 17&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2495，current_num is 18&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2496，current_num is 18&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2497，current_num is 18&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2498，current_num is 18&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2499，current_num is 18&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2500，current_num is 18&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2501，current_num is 19&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2502，current_num is 19&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2503，current_num is 19&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2504，current_num is 19&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2505，current_num is 19&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2506，current_num is 19&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2405，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2243，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2242，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2241，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2240，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 2239，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2238，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2236，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2237，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2235，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2234，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2233，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 2232，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2229，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2231，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2230，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2507，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2227，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5a27184d conn is 2226，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2228，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2225，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2224，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2223，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2222，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2219，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2221，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2218，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 2220，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2217，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2216，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2508，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2215，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 2214，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2213，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2212，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2211，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2210，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2209，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2191，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2192，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2194，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 2195，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2193，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2197，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2509，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2198，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2196，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2199，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2200，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 2201，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2202，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2204，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2205，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2206，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5a27184d conn is 2208，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2207，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2203，current_num is 20&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2528，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2527，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2529，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2530，current_num is 20&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2531，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 2532，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2534，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2533，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2535，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2536，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2537，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2538，current_num is 21&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 2539，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2540，current_num is 21&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2541，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2542，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2543，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2544，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5a27184d conn is 2545，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2546，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2547，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2548，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2549，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2550，current_num is 22&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@613be7fa conn is 2551，current_num is 23&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2552，current_num is 23&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 2553，current_num is 23&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2554，current_num is 23&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2555，current_num is 23&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2556，current_num is 24&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2557，current_num is 24&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2558，current_num is 24&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2559，current_num is 24&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 2560，current_num is 24&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 2561，current_num is 24&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7ce6c879 conn is 2562，current_num is 25&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 2563，current_num is 25&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 2564，current_num is 25&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 2565，current_num is 25&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 2566，current_num is 25&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5a27184d conn is 2567，current_num is 25&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 2568，current_num is 26&lt;br/&gt;Sun Feb 04 22:32:07 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 2569，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 2570，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 2571，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 2572，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@23034a33 conn is 2573，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@613be7fa conn is 2574，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 2575，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 2576，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 2577，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 2578，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6b6acc14 conn is 2579，current_num is 26&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 2580，current_num is 27&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 2581，current_num is 27&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 2582，current_num is 27&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 2583，current_num is 27&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 2584，current_num is 27&lt;br/&gt;............&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@45208681 conn is 9894，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@23034a33 conn is 9895，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@77ead0db conn is 9896，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2a8b9fed conn is 9897，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27114133 conn is 9898，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@68f70c3e conn is 9899，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@29f3309a conn is 9900，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@531759a9 conn is 9901，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7ce6c879 conn is 9902，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5ad0659d conn is 9903，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@e62bd9b conn is 9904，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 9905，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 9906，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@42126bd2 conn is 9907，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 9908，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1977e2 conn is 9909，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@73de9c32 conn is 9910，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5327a66d conn is 9911，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 9912，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 9913，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5840919c conn is 9914，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@13b6f892 conn is 9915，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@48e38207 conn is 9916，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6d95f874 conn is 9917，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 9918，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@322b021f conn is 9919，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@76d84c1 conn is 9920，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7079a300 conn is 9921，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@28cef164 conn is 9922，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@36039ec conn is 9923，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4b92531e conn is 9924，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@3cb85f84 conn is 9925，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2c3a40e6 conn is 9926，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@18540478 conn is 9927，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1b106c29 conn is 9928，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58d60bd6 conn is 9929，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2f78bc01 conn is 9930，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58f46dea conn is 9931，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@3ee71dd0 conn is 9932，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4d7d0ba2 conn is 9933，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@662d24b7 conn is 9934，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27d1933f conn is 9935，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2df0647c conn is 9936，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@336f8f02 conn is 9937，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@673bebd0 conn is 9938，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@43b65c0c conn is 9939，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7f2fecf3 conn is 9940，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@22532f08 conn is 9941，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12266960 conn is 9942，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@45621f3c conn is 9943，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1c8126de conn is 9944，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@613be7fa conn is 9945，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2cf9c34b conn is 9946，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2ebb6f9e conn is 9947，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@259e4407 conn is 9948，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5a27184d conn is 9949，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2762a670 conn is 9950，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6d982ab9 conn is 9951，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@12303cee conn is 9952，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@70ce732e conn is 9953，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1bcda716 conn is 9954，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@3e66caa3 conn is 9955，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c4c85bd conn is 9956，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f1e34bd conn is 9957，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@172149a8 conn is 9958，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@48b0856b conn is 9959，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@51d7f778 conn is 9960，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@738af3c0 conn is 9961，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6b6acc14 conn is 9962，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@8b52a5e conn is 9963，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1dcfdbea conn is 9964，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5dc890c5 conn is 9965，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4797fbe9 conn is 9966，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@145449bd conn is 9967，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@11cbcb1c conn is 9968，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@526b99ab conn is 9969，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@e84f4e8 conn is 9970，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@35a9df35 conn is 9971，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5ef1451f conn is 9972，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5e5c34ce conn is 9973，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@45208681 conn is 9974，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@23034a33 conn is 9975，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@77ead0db conn is 9976，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2a8b9fed conn is 9977，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@27114133 conn is 9978，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@68f70c3e conn is 9979，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@29f3309a conn is 9980，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@531759a9 conn is 9981，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7ce6c879 conn is 9982，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5ad0659d conn is 9983，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@e62bd9b conn is 9984，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7af6a47 conn is 9985，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@4c1a4732 conn is 9986，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@42126bd2 conn is 9987，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@38a4ed22 conn is 9988，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1977e2 conn is 9989，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@73de9c32 conn is 9990，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5327a66d conn is 9991，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1edcf564 conn is 9992，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6c8a3ac2 conn is 9993，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5840919c conn is 9994，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@13b6f892 conn is 9995，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@48e38207 conn is 9996，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6d95f874 conn is 9997，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@58010e0b conn is 9998，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@322b021f conn is 9999，current_num is 80&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@76d84c1 conn is 10000，current_num is 80&lt;/p&gt;
&lt;p&gt;Process finished with exit code 0&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt; actor运行结果：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;60&quot;&gt;
&lt;p&gt;&lt;br/&gt;&amp;gt;&amp;gt;&amp;gt; Press ENTER to exit &amp;lt;&amp;lt;&amp;lt;&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;Sun Feb 04 22:36:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 1，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 2，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 3，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 4，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 5，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1474d689 conn is 6，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1594b0 conn is 7，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f24626f conn is 8，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d601968 conn is 9，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 10，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 11，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 12，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 13，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 14，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 15，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1474d689 conn is 16，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1594b0 conn is 17，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f24626f conn is 18，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d601968 conn is 19，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 20，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 21，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 22，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 23，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 24，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 25，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1474d689 conn is 26，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1594b0 conn is 27，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f24626f conn is 28，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d601968 conn is 29，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 30，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 31，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 32，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 33，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 34，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 35，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1474d689 conn is 36，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1594b0 conn is 37，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f24626f conn is 38，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d601968 conn is 39，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 40，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 41，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 42，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 43，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 44，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 45，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1474d689 conn is 46，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1594b0 conn is 47，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f24626f conn is 48，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d601968 conn is 49，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 50，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 51，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 52，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 53，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 54，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 55，current_num is 10&lt;/p&gt;
&lt;p&gt;......&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 9990，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@75d54ea4 conn is 9991，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@26861a90 conn is 9992，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@594629ee conn is 9993，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d4fcba6 conn is 9994，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@2300ec5 conn is 9995，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@1474d689 conn is 9996，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@7c1594b0 conn is 9997，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5f24626f conn is 9998，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@5d601968 conn is 9999，current_num is 10&lt;br/&gt;com.mysql.jdbc.JDBC4Connection@6f925cd3 conn is 10000，current_num is 10&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Thread2300～2400运行效果：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;55&quot;&gt;
&lt;pre class=&quot;brush:scala;gutter:true;&quot;&gt;
Sun Feb 04 22:50:27 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2284，current_num is 1
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2277，current_num is 1
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2290，current_num is 2
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2287，current_num is 2
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2283，current_num is 1
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2279，current_num is 1
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2289，current_num is 2
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2280，current_num is 1
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2278，current_num is 1
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2276，current_num is 1
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2282，current_num is 1
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2288，current_num is 2
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2285，current_num is 2
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2291，current_num is 3
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2286，current_num is 2
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2293，current_num is 3
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2294，current_num is 3
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2292，current_num is 3
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2295，current_num is 3
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2296，current_num is 3
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2297，current_num is 3
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2298，current_num is 3
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2299，current_num is 3
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2300，current_num is 3
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2301，current_num is 3
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2302，current_num is 3
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2303，current_num is 4
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2304，current_num is 4
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2305，current_num is 4
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2306，current_num is 4
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2307，current_num is 4
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2308，current_num is 4
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2309，current_num is 4
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2310，current_num is 4
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2311，current_num is 4
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2312，current_num is 5
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2313，current_num is 5
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2314，current_num is 5
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2315，current_num is 5
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2316，current_num is 5
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2317，current_num is 5
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2318，current_num is 5
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2319，current_num is 5
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2320，current_num is 5
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2321，current_num is 5
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2322，current_num is 5
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2323，current_num is 5
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2324，current_num is 5
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2325，current_num is 5
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2326，current_num is 5
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2327，current_num is 5
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2328，current_num is 5
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2329，current_num is 5
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2330，current_num is 5
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2331，current_num is 5
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2332，current_num is 5
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2333，current_num is 5
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2334，current_num is 5
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2335，current_num is 6
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2336，current_num is 6
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2337，current_num is 6
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2338，current_num is 6
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2339，current_num is 6
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2340，current_num is 6
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2341，current_num is 6
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2342，current_num is 6
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2343，current_num is 7
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2344，current_num is 7
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2345，current_num is 7
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2346，current_num is 7
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2347，current_num is 7
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2348，current_num is 7
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2349，current_num is 7
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2350，current_num is 7
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2351，current_num is 8
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2352，current_num is 8
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2353，current_num is 8
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2354，current_num is 8
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2355，current_num is 8
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2356，current_num is 8
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2357，current_num is 8
com.mysql.jdbc.JDBC4Connection@803a18f conn is 2358，current_num is 8
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2359，current_num is 9
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2360，current_num is 9
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2361，current_num is 9
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2362，current_num is 9
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2363，current_num is 9
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2364，current_num is 9
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2365，current_num is 9
com.mysql.jdbc.JDBC4Connection@803a18f conn is 2366，current_num is 9
Sun Feb 04 22:50:28 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
com.mysql.jdbc.JDBC4Connection@5afe8b7d conn is 2367，current_num is 9
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2369，current_num is 10
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 1，current_num is 10
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2281，current_num is 10
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2368，current_num is 9
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2274，current_num is 10
com.mysql.jdbc.JDBC4Connection@803a18f conn is 2273，current_num is 10
com.mysql.jdbc.JDBC4Connection@5afe8b7d conn is 2272，current_num is 10
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2269，current_num is 10
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2270，current_num is 10
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2271，current_num is 10
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2268，current_num is 10
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2371，current_num is 10
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2373，current_num is 10
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2370，current_num is 10
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2265，current_num is 10
com.mysql.jdbc.JDBC4Connection@5780190e conn is 2372，current_num is 10
com.mysql.jdbc.JDBC4Connection@803a18f conn is 2267，current_num is 10
com.mysql.jdbc.JDBC4Connection@5afe8b7d conn is 2374，current_num is 10
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2266，current_num is 10
com.mysql.jdbc.JDBC4Connection@5780190e conn is 2264，current_num is 10
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2275，current_num is 10
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2263，current_num is 10
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2261，current_num is 10
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2375，current_num is 10
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2262，current_num is 10
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2260，current_num is 10
com.mysql.jdbc.JDBC4Connection@6c7e8e89 conn is 2259，current_num is 10
com.mysql.jdbc.JDBC4Connection@5afe8b7d conn is 2257，current_num is 10
com.mysql.jdbc.JDBC4Connection@5780190e conn is 2256，current_num is 10
com.mysql.jdbc.JDBC4Connection@803a18f conn is 2258，current_num is 10
com.mysql.jdbc.JDBC4Connection@70e0ec40 conn is 2376，current_num is 10
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 2255，current_num is 10
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 2254，current_num is 10
com.mysql.jdbc.JDBC4Connection@7984dcf6 conn is 2253，current_num is 10
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 2377，current_num is 10
com.mysql.jdbc.JDBC4Connection@7acc608 conn is 2378，current_num is 10
....
com.mysql.jdbc.JDBC4Connection@5afe8b7d conn is 144，current_num is 20
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 145，current_num is 20
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 146，current_num is 20
com.mysql.jdbc.JDBC4Connection@78cc3e0f conn is 147，current_num is 20
com.mysql.jdbc.JDBC4Connection@803a18f conn is 148，current_num is 20
com.mysql.jdbc.JDBC4Connection@8a92dd0 conn is 149，current_num is 20
com.mysql.jdbc.JDBC4Connection@4b2bdb5e conn is 152，current_num is 20
com.mysql.jdbc.JDBC4Connection@55f825fa conn is 154，current_num is 20
com.mysql.jdbc.JDBC4Connection@207e87e conn is 155，current_num is 20
com.mysql.jdbc.JDBC4Connection@5521b93a conn is 159，current_num is 20
com.mysql.jdbc.JDBC4Connection@2ec303b conn is 165，current_num is 20
com.mysql.jdbc.JDBC4Connection@6d8646b5 conn is 166，current_num is 20
com.mysql.jdbc.JDBC4Connection@78cc3e0f conn is 167，current_num is 20

Process finished with exit code 0
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; actor在40000000级上数据运行情况&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:scala;gutter:true;&quot;&gt;
com.mysql.jdbc.JDBC4Connection@2d02c2a4 conn is 39999985，current_num is 10
com.mysql.jdbc.JDBC4Connection@792b0c3a conn is 39999986，current_num is 10
com.mysql.jdbc.JDBC4Connection@9444bb7 conn is 39999987，current_num is 10
com.mysql.jdbc.JDBC4Connection@7cc94733 conn is 39999988，current_num is 10
com.mysql.jdbc.JDBC4Connection@47e5adec conn is 39999989，current_num is 10
com.mysql.jdbc.JDBC4Connection@660e23f6 conn is 39999990，current_num is 10
com.mysql.jdbc.JDBC4Connection@557601c1 conn is 39999991，current_num is 10
com.mysql.jdbc.JDBC4Connection@3f4d7608 conn is 39999992，current_num is 10
com.mysql.jdbc.JDBC4Connection@5564bf6f conn is 39999993，current_num is 10
com.mysql.jdbc.JDBC4Connection@4096bdd9 conn is 39999994，current_num is 10
com.mysql.jdbc.JDBC4Connection@2d02c2a4 conn is 39999995，current_num is 10
com.mysql.jdbc.JDBC4Connection@792b0c3a conn is 39999996，current_num is 10
com.mysql.jdbc.JDBC4Connection@9444bb7 conn is 39999997，current_num is 10
com.mysql.jdbc.JDBC4Connection@7cc94733 conn is 39999998，current_num is 10
com.mysql.jdbc.JDBC4Connection@47e5adec conn is 39999999，current_num is 10
com.mysql.jdbc.JDBC4Connection@660e23f6 conn is 40000000，current_num is 10
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;
&lt;span&gt;&lt;strong&gt;&lt;span&gt;实验结论：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt; 由上面运行效果得出：actor模型几乎运行10000次点用即时结束，thread模型确实慢了好久，整体感觉有一秒，大家可以试着运行感觉一下；当中thread在运行时（为了页面加载没有粘出所有数据太多）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;线程中不存在连接的查询使用，只是打印对象地址，thread在2300 - 2400 之间就存在当前连接数的增加，即表明在线程调用时，连接不能及时回收，导致了联接的创建。而actor模型在10000级连接数不变，则说明在并发稳定上，actor支持更高的并发和稳定性。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;actor模型在40000000级别连接数依然是10，这说明的不言而喻。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;上面的结论如果有异议的话，可以讨论。&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Sun, 04 Feb 2018 15:31:00 +0000</pubDate>
<dc:creator>舆</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/gnool/p/8414673.html</dc:identifier>
</item>
<item>
<title>NetCloud——一个网易云音乐评论抓取和分析的Python库 - lyrichu</title>
<link>http://www.cnblogs.com/lyrichu/p/8414434.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/lyrichu/p/8414434.html</guid>
<description>&lt;h3 id=&quot;在17的四月份我曾经写了一篇关于网易云音乐爬虫的文章还写了一篇关于评论数据可视化的文章在这大半年的时间里有时会有一些朋友给我发私信询问一些关于代码方面的问题所以我最近抽空干脆将原来的代码整理了一下做成了一个python模块netcloud放在pypi上了目前只是对原来的代码做了一些整理与重构功能还很不完善后续打算抽空继续完善如果有人用的话可能会长期维护下去&quot;&gt;  在17的四月份，我曾经写了一篇关于网易云音乐爬虫的文章，还写了一篇关于评论数据可视化的文章。在这大半年的时间里，有时会有一些朋友给我发私信询问一些关于代码方面的问题。所以我最近抽空干脆将原来的代码整理了一下，做成了一个Python模块&lt;em&gt;NetCloud&lt;/em&gt;放在Pypi上了。目前只是对原来的代码做了一些整理与重构，功能还很不完善，后续打算抽空继续完善，如果有人用的话可能会长期维护下去。&lt;/h3&gt;
&lt;h3 id=&quot;目前只需要使用命令pip-install-netcloud-即可以完成模块的安装支持windows与linux系统以前代码是基于python2的现在支持python3我简单测试了一下python3.6应该也没问题了python2下运行应该也基本没问题但是考虑到编码问题以及python社区即将在2020年不再支持2.x的版本所以强烈建议使用python3.x运行模块代码github的地址是netcloud&quot;&gt;  目前只需要使用命令pip install NetCloud 即可以完成模块的安装，支持Windows与Linux系统，以前代码是基于python2的，现在支持Python3(我简单测试了一下python3.6应该也没问题了),python2下运行应该也基本没问题,但是考虑到编码问题，以及Python社区即将在2020年不再支持2.x的版本，所以强烈建议使用Python3.x运行模块。代码github的地址是&lt;a href=&quot;https://www.github.com/Lyrichu/NetCloud&quot;&gt;Netcloud&lt;/a&gt;&lt;/h3&gt;
&lt;h2 id=&quot;关于实现功能以及一些主要接口的说明&quot;&gt;  关于实现功能以及一些主要接口的说明:&lt;/h2&gt;
&lt;h3 id=&quot;主要实现了&quot;&gt;1.主要实现了:&lt;/h3&gt;
&lt;h4 id=&quot;对于一首歌曲全部评论的抓取保存为csv文件格式&quot;&gt;- 对于一首歌曲全部评论的抓取,保存为csv文件格式&lt;/h4&gt;
&lt;h4 id=&quot;对于一个歌手全部热门评论的抓取存为csv文件&quot;&gt;- 对于一个歌手全部热门评论的抓取，存为csv文件&lt;/h4&gt;
&lt;h4 id=&quot;对于一首歌曲下全部评论用户基本信息的抓取包括用户主页url用户年龄听歌次数动态次数用户所在地区用户动态总数等这些信息也存为csv文件格式&quot;&gt;- 对于一首歌曲下全部评论用户基本信息的抓取，包括:用户主页url,用户年龄,听歌次数,动态次数,用户所在地区,用户动态总数等，这些信息也存为csv文件格式&lt;/h4&gt;
&lt;h4 id=&quot;利用全部评论以及热门评论分词生成词云统计关键词的频率&quot;&gt;- 利用全部评论以及热门评论分词生成词云，统计关键词的频率&lt;/h4&gt;
&lt;h4 id=&quot;利用一首歌曲全部评论用户的信息基于pyecharts可视化包括用户所在地区分布使用geo表示地图用户年龄的分布用户听歌数目的分布用户动态的数目分布歌曲评论数量关于时间的分布等等以前是基于matplotlib来做的但是只能生成静态的图片而pyecharts可以产生基于网页的交互式的显示效果我感觉效果可能会更好一点&quot;&gt;- 利用一首歌曲全部评论用户的信息，基于&lt;strong&gt;pyecharts&lt;/strong&gt;可视化，包括：用户所在地区分布使用geo表示(地图),用户年龄的分布，用户听歌数目的分布，用户动态的数目分布，歌曲评论数量关于时间的分布等等。以前是基于matplotlib来做的，但是只能生成静态的图片，而pyecharts可以产生基于网页的交互式的显示效果，我感觉效果可能会更好一点。&lt;/h4&gt;
&lt;h4 id=&quot;以前抓取是单线程的效率较低现在支持多线程了可以极大地提高抓取效率&quot;&gt;- 以前抓取是单线程的，效率较低，现在支持多线程了，可以极大地提高抓取效率&lt;/h4&gt;
&lt;h3 id=&quot;还需要去完善的todolist&quot;&gt;2.还需要去完善的(Todolist)&lt;/h3&gt;
&lt;h4 id=&quot;如何很好的应对反爬我实验发现在开启多线程的情况下抓取一段时间服务器可能会限制抓取封ip目前应对的措施主要是开启代理ip不过如何找到较高质量的代理ip地址就只能自己去想办法了&quot;&gt;- 如何很好的应对反爬。我实验发现，在开启多线程的情况下，抓取一段时间服务器可能会限制抓取(封ip),目前应对的措施主要是开启代理ip，不过如何找到较高质量的代理ip地址，就只能自己去想办法了&lt;/h4&gt;
&lt;h4 id=&quot;目前还不支持模拟登录网易云音乐查看个人信息听歌记录等不过python里应该已经有其他模块做到了这一点而且这个应该也不是特别难后面有空会加上&quot;&gt;-目前还不支持模拟登录网易云音乐，查看个人信息，听歌记录等，不过Python里应该已经有其他模块做到了这一点，而且这个应该也不是特别难，后面有空会加上。&lt;/h4&gt;
&lt;h4 id=&quot;目前还不支持对于歌单的批量抓取以及获取用户听歌的详细记录后续考虑增加如果有这部分数据可以深挖更多东西比如预测用户听歌风格对用户按听歌洗喜好分类以及做推荐等等&quot;&gt;-目前还不支持对于歌单的批量抓取，以及获取用户听歌的详细记录，后续考虑增加。如果有这部分数据，可以深挖更多东西，比如预测用户听歌风格，对用户按听歌洗喜好分类，以及做推荐等等。&lt;/h4&gt;
&lt;h4 id=&quot;目前的分析仅限于简单的分析统计等等后续考虑加入更深入的nlp分析&quot;&gt;-目前的分析仅限于简单的分析统计等等，后续考虑加入更深入的NLP分析。&lt;/h4&gt;
&lt;h3 id=&quot;安装以及主要的函数接口&quot;&gt;3.安装以及主要的函数接口&lt;/h3&gt;
&lt;h4 id=&quot;安装很简单只需要-pip-install-netcloud因为模块以来于一些第三方库所以在安装这些第三方库的时候可能会出现问题可以参考4的说明&quot;&gt;- 安装很简单，只需要 pip install NetCloud，因为模块以来于一些第三方库，所以在安装这些第三方库的时候可能会出现问题，可以参考4的说明&lt;/h4&gt;
&lt;h4 id=&quot;快速使用一个简单的例子如下&quot;&gt;- 快速使用，一个简单的例子如下：&lt;/h4&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;16&quot;&gt;
&lt;pre class=&quot;sourceCode python&quot;&gt;
&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; NetCloud.NetCloudCrawler &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; NetCloudCrawl
&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; NetCloud.NetCloudAnalyse &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; NetCloudAnalyse

&lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;'__main__'&lt;/span&gt;:
    song_name &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&quot;敢爱&quot;&lt;/span&gt;
    song_id &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;186888&lt;/span&gt;
    singer_name &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&quot;张国荣&quot;&lt;/span&gt;
    singer_id &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;6457&lt;/span&gt;
    crawler &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; NetCloudCrawl(song_name,song_id,singer_name,singer_id)
    crawler.generate_all_necessary_files(threads&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;)
    analyse &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; NetCloudAnalyse(song_name,singer_name,song_id,singer_id)
    analyse.generate_all_analyse_files(threads&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;20&lt;/span&gt;)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;上面的10行左右的代码就完成了对于张国荣的敢爱这首歌的全部评论的抓取张国荣歌曲热门评论的抓取以及歌曲用户基本信息的抓取并生成了相应的词云图片以及一些基本的可视化分析产生的文件结构如下图所示&quot;&gt;3.1 上面的10行左右的代码就完成了对于张国荣的《敢爱》这首歌的全部评论的抓取，张国荣歌曲热门评论的抓取，以及歌曲用户基本信息的抓取，并生成了相应的词云图片，以及一些基本的可视化分析。产生的文件结构如下图所示：&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/976328/201802/976328-20180204221514326-726635814.jpg&quot;/&gt;&lt;br/&gt;首先生成文件全部都会在songs这个文件夹下，然后对于每一首歌曲会产生以歌手名字命名的文件夹，然后是歌曲名字的文件夹，最后是相应的抓取文件，比如敢爱.csv就是《敢爱》的全部评论文件，敢爱.jpg就是歌曲评论的词云图片,hot_comments.csv是歌手的热门评论文件，最后所有的可视化结果都存放在plots文件夹下，可视化文件为html文件需要在浏览器打开查看可视化结果。&lt;/p&gt;
&lt;h4 id=&quot;模块主要是两个类一个是netcloudcrawl用于数据抓取另一个是-netcloudanalyse用于数据的分析netcloudcrawl-的-generate_all_necessary_files函数会生成必要的全部评论文件热门评论文件支持多线程默认是开启10个线程抓取netcloudanalyse的-generate_all_analyse_files-顾名思义会产生全部的可视化文件首先它会抓取用户的全部信息存入文件然后产生一系列的可视化分析文件html格式最后会产生评论的词云文件基本上调用这两个函数就可以轻松使用netcloud的主要功能了&quot;&gt;3.2 模块主要是两个类，一个是NetCloudCrawl，用于数据抓取；另一个是 NetCloudAnalyse用于数据的分析。NetCloudCrawl 的 generate_all_necessary_files函数会生成必要的全部评论文件，热门评论文件，支持多线程，默认是开启10个线程抓取。NetCloudAnalyse的 generate_all_analyse_files 顾名思义会产生全部的可视化文件，首先它会抓取用户的全部信息存入文件，然后产生一系列的可视化分析文件(html格式)，最后会产生评论的词云文件。基本上调用这两个函数就可以轻松使用NetCloud的主要功能了。&lt;/h4&gt;
&lt;h4 id=&quot;如果你想自定义抓取或者不想使用提供的可视化函数接口也可以使用模块的其他基本函数完成抓取和分析模块的主要函数接口调用格式说明如下&quot;&gt;3.3 如果你想自定义抓取，或者不想使用提供的可视化函数接口，也可以使用模块的其他基本函数完成抓取和分析，模块的主要函数接口调用格式说明如下：&lt;/h4&gt;
&lt;h4 id=&quot;netcloudcrawl类&quot;&gt;&lt;strong&gt;NetCloudCrawl类&lt;/strong&gt;&lt;/h4&gt;
&lt;h4 id=&quot;aes_encrypttextkeyiv-这个函数用于网易云api的解密基本用不到不用管&quot;&gt;- AES_encrypt(text,key,iv) 这个函数用于网易云API的解密，基本用不到，不用管&lt;/h4&gt;
&lt;h4 id=&quot;get_paramspage-获得必要的解密参数&quot;&gt;- get_params(page) 获得必要的解密参数&lt;/h4&gt;


&lt;h4 id=&quot;get_jsonurlparams-encseckey-获取网易api-json文件&quot;&gt;- get_json(url,params, encSecKey) 获取网易API json文件&lt;/h4&gt;




&lt;h4 id=&quot;get_singer_hot_songs_idssinger_url-得到歌手全部热门歌曲id列表singer_url为歌手信息页url&quot;&gt;- get_singer_hot_songs_ids(singer_url) 得到歌手全部热门歌曲id列表,singer_url为歌手信息页url&lt;/h4&gt;

&lt;h4 id=&quot;generate_all_necessary_filesthreads-10-生成全部必要的文件包括歌手的全部热门评论文件以及歌曲的全部评论文件&quot;&gt;- generate_all_necessary_files(threads = 10) 生成全部必要的文件，包括歌手的全部热门评论文件，以及歌曲的全部评论文件&lt;/h4&gt;
&lt;h4 id=&quot;test-开头的均为测试函数请不要调用&quot;&gt;- _test 开头的均为测试函数，请不要调用&lt;/h4&gt;
&lt;h4 id=&quot;netcloudanalyse类&quot;&gt;&lt;strong&gt;NetCloudAnalyse类&lt;/strong&gt;&lt;/h4&gt;
&lt;h4 id=&quot;load_comments_csv-加载全部评论文件为dataframe格式pandas&quot;&gt;- load_comments_csv() 加载全部评论文件为dataframe格式(pandas)&lt;/h4&gt;
&lt;h4 id=&quot;save_users_info_to_file-保存歌曲评论下全部用户已去重的信息到文件单线程&quot;&gt;- save_users_info_to_file() 保存歌曲评论下全部用户(已去重)的信息到文件(单线程)&lt;/h4&gt;
&lt;h4 id=&quot;threading_save_users_info_to_filethreads-10-采用多线程保存用户信息到文件默认是10个线程&quot;&gt;- threading_save_users_info_to_file(threads = 10) 采用多线程保存用户信息到文件,默认是10个线程&lt;/h4&gt;
&lt;h4 id=&quot;save_users_infousers_urltotal-供-threading_save_users_info_to_file调用的中间函数不用管&quot;&gt;- save_users_info(users_url,total) 供 threading_save_users_info_to_file调用的中间函数，不用管&lt;/h4&gt;

&lt;h4 id=&quot;from_timestamp_to_datetime_stampformat-y-m-d-hms-将时间戳转日期的函数默认格式是-年-月-日-时分秒&quot;&gt;- from_timestamp_to_date(time_stamp,format = &quot;%Y-%m-%d %H:%M:%S&quot;) 将时间戳转日期的函数,默认格式是: 年-月-日 时:分:秒&lt;/h4&gt;
&lt;h4 id=&quot;load_users_url-返回全部评论用户主页url列表用于后续用户信息抓取&quot;&gt;- load_users_url() 返回全部评论用户主页url列表，用于后续用户信息抓取&lt;/h4&gt;
&lt;h4 id=&quot;load_users_info_csv-从用户信息csv文件加载用户信息dataframe&quot;&gt;- load_users_info_csv() 从用户信息csv文件加载用户信息dataframe&lt;/h4&gt;

&lt;h4 id=&quot;core_visual_analyse-核心的对于评论用户信息的可视化分析产生的html文件有12个说明如下&quot;&gt;- core_visual_analyse() 核心的对于评论用户信息的可视化分析，产生的html文件有12个，说明如下：&lt;/h4&gt;
&lt;h5 id=&quot;age_count_bar.html-年龄分布bar-为-柱状图表示下同&quot;&gt;1. age_count_bar.html 年龄分布(bar 为 柱状图表示，下同)&lt;/h5&gt;
&lt;h5 id=&quot;agree_count_bar.html-赞同数分布&quot;&gt;2. agree_count_bar.html 赞同数分布&lt;/h5&gt;



&lt;h5 id=&quot;description_keywords_bar.html-用户简介关键词分布&quot;&gt;6. description_keywords_bar.html 用户简介关键词分布&lt;/h5&gt;
&lt;h5 id=&quot;events_count_bar.html-用户动态数目分布&quot;&gt;7. events_count_bar.html 用户动态数目分布&lt;/h5&gt;
&lt;h5 id=&quot;fans_count_bar.html-用户粉丝数量分布&quot;&gt;8. fans_count_bar.html 用户粉丝数量分布&lt;/h5&gt;
&lt;h5 id=&quot;follow_count_bar.html-用户关注者数量分布&quot;&gt;9. follow_count_bar.html 用户关注者数量分布&lt;/h5&gt;
&lt;h5 id=&quot;listening_songs_count_bar.html-用户听歌数量分布&quot;&gt;10. listening_songs_count_bar.html 用户听歌数量分布&lt;/h5&gt;
&lt;h5 id=&quot;users_city_geo.html-用户所在地区分布使用地图可视化表示&quot;&gt;11. users_city_geo.html 用户所在地区分布，使用地图可视化表示&lt;/h5&gt;
&lt;h5 id=&quot;users_location_bar.html-用户所在地区分布使用柱状图表示&quot;&gt;12. users_location_bar.html 用户所在地区分布，使用柱状图表示&lt;/h5&gt;
&lt;p&gt;一些可视化实际的效果图如下：&lt;br/&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/976328/201802/976328-20180204230940264-1322428576.png&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/976328/201802/976328-20180204230952623-1241804961.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;load_stopwords-加载停用词列表&quot;&gt;- load_stopwords() 加载停用词列表&lt;/h4&gt;
&lt;h4 id=&quot;load_all_cities-加载中国全部城市名称列表&quot;&gt;- load_all_cities() 加载中国全部城市名称列表&lt;/h4&gt;
&lt;h4 id=&quot;generate_all_analyse_filesthreads-10-生成全部的分析文件包括评论关键字词云以及评论用户信息的可视化默认线程数为10&quot;&gt;- generate_all_analyse_files(threads = 10) 生成全部的分析文件，包括评论关键字词云以及评论用户信息的可视化，默认线程数为10&lt;/h4&gt;
&lt;h4 id=&quot;test-开头的为测试文件请不要调用&quot;&gt;- _test 开头的为测试文件，请不要调用&lt;/h4&gt;
&lt;h3 id=&quot;一些可能会出现的问题&quot;&gt;4. 一些可能会出现的问题&lt;/h3&gt;
&lt;h4 id=&quot;在pip-install-netcloud-的过程中如果是在windows下wordcloud-以及-pycrypto-模块也许会安装失败此时可以去python非官方第三方库下载下载对应pyhton版本的预编译wheel文件然后手动pip安装即可另外numpy-需要-numpymkl形式的库也可以在这个网站下载&quot;&gt;4.1 在pip install NetCloud 的过程中，如果是在Windows下，wordcloud 以及 pycrypto 模块也许会安装失败，此时可以去&lt;a href=&quot;https://www.lfd.uci.edu/~gohlke/pythonlibs/&quot;&gt;python非官方第三方库下载&lt;/a&gt;下载对应pyhton版本的预编译wheel文件，然后手动pip安装即可。另外,numpy 需要 numpy+mkl形式的库，也可以在这个网站下载。&lt;/h4&gt;
&lt;h4 id=&quot;由于我没有测试完全而且代码水平有限因此代码肯定存在一些意想不到的bug如果您对这个模块感兴趣在使用的过程中出现任何问题或者有任何建议欢迎给我留言当然最好的方式是去github提issue地址是netcloud同时欢迎star-和fork谢谢支持&quot;&gt;4.2 由于我没有测试完全，而且代码水平有限，因此代码肯定存在一些意想不到的bug，如果您对这个模块感兴趣，在使用的过程中出现任何问题或者有任何建议，欢迎给我留言，当然最好的方式是去github提issue,地址是&lt;a href=&quot;https://www.github.com/Lyrichu/NetCloud&quot;&gt;NetCloud&lt;/a&gt;，同时欢迎star 和fork，谢谢支持。&lt;/h4&gt;
</description>
<pubDate>Sun, 04 Feb 2018 15:28:00 +0000</pubDate>
<dc:creator>lyrichu</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/lyrichu/p/8414434.html</dc:identifier>
</item>
<item>
<title>网络编程 - 春生</title>
<link>http://www.cnblogs.com/jiangchunsheng/p/8414771.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/jiangchunsheng/p/8414771.html</guid>
<description>&lt;p&gt;你现在已经学会了写python代码，假如你写了两个python文件a.py和b.py，分别去运行，你就会发现，这两个python的文件分别运行的很好。但是如果这两个程序之间想要传递一个数据，你要怎么做呢？&lt;/p&gt;
&lt;p&gt;这个问题以你现在的知识就可以解决了，我们可以创建一个文件，把a.py想要传递的内容写到文件中，然后b.py从这个文件中读取内容就可以了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201711/827651-20171101180819451-341987165.png&quot; alt=&quot;&quot; width=&quot;352&quot; height=&quot;98&quot;/&gt;&lt;/p&gt;

&lt;p&gt;但是当你的a.py和b.py分别在不同电脑上的时候，你要怎么办呢？&lt;/p&gt;
&lt;p&gt;类似的机制有计算机网盘，qq等等。我们可以在我们的电脑上和别人聊天，可以在自己的电脑上向网盘中上传、下载内容。这些都是两个程序在通信。&lt;/p&gt;



&lt;p&gt;我们了解的涉及到两个程序之间通讯的应用大致可以分为两种：&lt;/p&gt;
&lt;p&gt;第一种是应用类：qq、微信、网盘、优酷这一类是属于需要安装的桌面应用&lt;/p&gt;
&lt;p&gt;第二种是web类：比如百度、知乎、博客园等使用浏览器访问就可以直接使用的应用&lt;/p&gt;
&lt;p&gt;这些应用的本质其实都是两个程序之间的通讯。而这两个分类又对应了两个软件开发的架构～&lt;/p&gt;
&lt;h2&gt;1.C/S架构&lt;/h2&gt;
&lt;p&gt;C/S即：Client与Server ，中文意思：客户端与服务器端架构，这种架构也是从用户层面（也可以是物理层面）来划分的。&lt;/p&gt;
&lt;p&gt;这里的客户端一般泛指客户端应用程序EXE，程序需要先安装后，才能运行在用户的电脑上，对用户的电脑操作系统环境依赖较大。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201711/827651-20171102180740138-1487379531.png&quot; alt=&quot;&quot; width=&quot;410&quot; height=&quot;228&quot;/&gt;&lt;/p&gt;


&lt;h2&gt;2.B/S架构&lt;/h2&gt;
&lt;p&gt;B/S即：Browser与Server,中文意思：浏览器端与服务器端架构，这种架构是从用户层面来划分的。&lt;/p&gt;
&lt;p&gt;Browser浏览器，其实也是一种Client客户端，只是这个客户端不需要大家去安装什么应用程序，只需在浏览器上通过HTTP请求服务器端相关的资源（网页资源），客户端Browser浏览器就能进行增删改查。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201711/827651-20171102182619326-272756889.png&quot; alt=&quot;&quot; width=&quot;426&quot; height=&quot;286&quot;/&gt;&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/Eva-J/articles/8066842.html&quot; target=&quot;_blank&quot;&gt;网络基础&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1.一个程序如何在网络上找到另一个程序？&lt;/h2&gt;
&lt;p&gt;首先，程序必须要启动，其次，必须有这台机器的地址，我们都知道我们人的地址大概就是国家\省\市\区\街道\楼\门牌号这样字。那么每一台联网的机器在网络上也有自己的地址，它的地址是怎么表示的呢？&lt;/p&gt;
&lt;p&gt;就是使用一串数字来表示的，例如：100.4.5.6&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;&lt;img id=&quot;code_img_opened_e00659f0-eb38-4a15-91dc-941e9bdc9cb9&quot; class=&quot;code_img_opened&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_e00659f0-eb38-4a15-91dc-941e9bdc9cb9&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
IP地址是指互联网协议地址（英语：Internet Protocol Address，又译为网际协议地址），是IP Address的缩写。IP地址是IP协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。

IP地址是一个32位的二进制数，通常被分割为4个“8位二进制数”（也就是4个字节）。IP地址通常用“点分十进制”表示成（a.b.c.d）的形式，其中，a,b,c,d都是0~255之间的十进制整数。例：点分十进IP地址（100.4.5.6），实际上是32位二进制数（01100100.00000100.00000101.00000110）。
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;31&quot;&gt;&lt;img id=&quot;code_img_opened_e6540743-f3af-4441-a0fa-0988567321b4&quot; class=&quot;code_img_opened&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_e6540743-f3af-4441-a0fa-0988567321b4&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;57&quot;&gt;
&lt;pre&gt;
&quot;端口&quot;是英文port的意译，可以认为是设备与外界通讯交流的出口。
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;因此ip地址精确到具体的一台电脑，而端口精确到具体的程序。&lt;/p&gt;
&lt;h2&gt;2.osi七层模型&lt;/h2&gt;
&lt;h3&gt;&lt;strong&gt;引子&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;须知一个完整的计算机系统是由硬件、操作系统、应用软件三者组成,具备了这三个条件，一台计算机系统就可以自己跟自己玩了（打个单机游戏，玩个扫雷啥的）&lt;/p&gt;
&lt;p&gt;如果你要跟别人一起玩，那你就需要上网了，什么是互联网？&lt;/p&gt;
&lt;p&gt;互联网的核心就是由一堆协议组成，协议就是标准，比如全世界人通信的标准是英语，如果把计算机比作人，互联网协议就是计算机界的英语。所有的计算机都学会了互联网协议，那所有的计算机都就可以按照统一的标准去收发信息从而完成通信了。&lt;/p&gt;
&lt;h3&gt;osi七层模型&lt;/h3&gt;
&lt;p&gt;人们按照分工不同把互联网协议从逻辑上划分了层级：&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107205950456-843487109.png&quot; alt=&quot;&quot;/&gt;&lt;/em&gt;&lt;/p&gt;


&lt;h2&gt;3.socket概念&lt;/h2&gt;
&lt;h3&gt;socket层&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107205809034-380661986.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;理解socket&lt;/h3&gt;
&lt;p&gt;Socket是应用层与&lt;span lang=&quot;EN-US&quot;&gt;TCP/IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，&lt;span lang=&quot;EN-US&quot;&gt;Socket其实就是一个门面模式，它把复杂的&lt;span lang=&quot;EN-US&quot;&gt;TCP/IP协议族隐藏在&lt;span lang=&quot;EN-US&quot;&gt;Socket接口后面，对用户来说，一组简单的接口就是全部，让&lt;span lang=&quot;EN-US&quot;&gt;Socket去组织数据，以符合指定的协议。&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_b7aabd40-4e23-4836-83c1-f588233e723f&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;站在你的角度上看socket&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;3.套接字（socket）的发展史&lt;/h2&gt;
&lt;p&gt;套接字起源于 20 世纪 70 年代加利福尼亚大学伯克利分校版本的 Unix,即人们所说的 BSD Unix。 因此,有时人们也把套接字称为“伯克利套接字”或“BSD 套接字”。一开始,套接字被设计用在同 一台主机上多个应用程序之间的通讯。这也被称进程间通讯,或 IPC。套接字有两种（或者称为有两个种族）,分别是基于文件型的和基于网络型的。 &lt;/p&gt;
&lt;h3&gt;&lt;em&gt;基于文件类型的套接字家族&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;套接字家族的名字：AF_UNIX&lt;/p&gt;
&lt;p&gt;unix一切皆文件，基于文件的套接字调用的就是底层的文件系统来取数据，两个套接字进程运行在同一机器，可以通过访问同一个文件系统间接完成通信&lt;/p&gt;
&lt;h3&gt;&lt;em&gt;基于网络类型的套接字家族&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;套接字家族的名字：AF_INET&lt;/p&gt;
&lt;p&gt;(还有AF_INET6被用于ipv6，还有一些其他的地址家族，不过，他们要么是只用于某个平台，要么就是已经被废弃，或者是很少被使用，或者是根本没有实现，所有地址家族中，AF_INET是使用最广泛的一个，python支持很多种地址家族，但是由于我们只关心网络编程，所以大部分时候我么只使用AF_INET)&lt;/p&gt;

&lt;h2&gt;4.tcp协议和udp协议&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;TCP&lt;/strong&gt;（Transmission Control Protocol）可靠的、面向连接的协议（eg:打电话）、传输效率低全双工通信（发送缓存&amp;amp;接收缓存）、面向字节流。使用TCP的应用：Web浏览器；电子邮件、文件传输程序。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UDP&lt;/strong&gt;（User Datagram Protocol）不可靠的、无连接的服务，传输效率高（发送前时延小），一对一、一对多、多对一、多对多、面向报文，尽最大努力服务，无拥塞控制。使用UDP的应用：域名系统 (DNS)；视频流；IP语音(VoIP)。&lt;/p&gt;
&lt;p&gt;我知道说这些你们也不懂，直接上图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201710/827651-20171027102242789-2142796570.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;h2&gt;基于TCP协议的socket&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;tcp是基于链接的，必须先启动服务端，然后再启动客户端去链接服务端&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;server端&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
import socket
sk = socket.socket()
sk.bind(('127.0.0.1',8898))  #把地址绑定到套接字
sk.listen()          #监听链接
conn,addr = sk.accept() #接受客户端链接
ret = conn.recv(1024)  #接收客户端信息
print(ret)       #打印客户端信息
conn.send(b'hi')        #向客户端发送信息
conn.close()       #关闭客户端套接字
sk.close()        #关闭服务器套接字(可选)
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;client端&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
import socket
sk = socket.socket()           # 创建客户套接字
sk.connect(('127.0.0.1',8898))    # 尝试连接服务器
sk.send(b'hello!')
ret = sk.recv(1024)         # 对话(发送/接收)
print(ret)
sk.close()            # 关闭客户套接字
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;问题：在重启服务端时可能会遇到&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201711/827651-20171109174833325-1552312354.png&quot; alt=&quot;&quot; width=&quot;488&quot; height=&quot;102&quot;/&gt;&lt;/p&gt;
&lt;p&gt;解决方法：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
#加入一条socket配置，重用ip和端口
import socket
from socket import SOL_SOCKET,SO_REUSEADDR
sk = socket.socket()
sk.setsockopt(SOL_SOCKET,SO_REUSEADDR,1) #就是它，在bind前加
sk.bind(('127.0.0.1',8898))  #把地址绑定到套接字
sk.listen()          #监听链接
conn,addr = sk.accept() #接受客户端链接
ret = conn.recv(1024)   #接收客户端信息
print(ret)              #打印客户端信息
conn.send(b'hi')        #向客户端发送信息
conn.close()       #关闭客户端套接字
sk.close()        #关闭服务器套接字(可选)
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h2&gt;基于UDP协议的socket&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;udp是无链接的，先启动哪一端都不会报错&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;简单使用&lt;/h3&gt;
&lt;h4&gt;server端&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
import socket
udp_sk = socket.socket(type=socket.SOCK_DGRAM)   #创建一个服务器的套接字
udp_sk.bind(('127.0.0.1',9000))        #绑定服务器套接字
msg,addr = udp_sk.recvfrom(1024)
print(msg)
udp_sk.sendto(b'hi',addr)                 # 对话(接收与发送)
udp_sk.close()                         # 关闭服务器套接字
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4&gt;client端&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
import socket
ip_port=('127.0.0.1',9000)
udp_sk=socket.socket(type=socket.SOCK_DGRAM)
udp_sk.sendto(b'hello',ip_port)
back_msg,addr=udp_sk.recvfrom(1024)
print(back_msg.decode('utf-8'),addr)
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt; qq聊天&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_e9cdbf60-ff97-4c5e-804b-dddac9a4ebc7&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;server&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_65973f04-4ba1-4646-8caa-384b1b20cfed&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;client&lt;/span&gt;&lt;/div&gt;
&lt;h3&gt;时间服务器&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_0fba0b42-f8f7-4271-b7c9-24970d3c4268&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;server&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_d27bf3ee-2e57-494d-a327-37066d60a765&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;client&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;socket参数的详解&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
socket.socket(family=AF_INET,type=SOCK_STREAM,proto=0,fileno=None)
&lt;/pre&gt;&lt;/div&gt;
&lt;pre data-source-line=&quot;11&quot;&gt;
&lt;code class=&quot;hljs&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot;&gt;&lt;strong&gt;创建socket对象的参数说明：&lt;br/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;table border=&quot;0&quot;&gt;&lt;tbody readability=&quot;13.5&quot;&gt;&lt;tr readability=&quot;6&quot;&gt;&lt;td width=&quot;60&quot;&gt;&lt;strong&gt;family&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;地址系列应为AF_INET(默认值),AF_INET6,AF_UNIX,AF_CAN或AF_RDS。&lt;br/&gt;（AF_UNIX 域实际上是使用本地 socket 文件来通信）&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;7&quot;&gt;&lt;td width=&quot;60&quot;&gt;&lt;strong&gt;type&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;套接字类型应为SOCK_STREAM(默认值),SOCK_DGRAM,SOCK_RAW或其他SOCK_常量之一。&lt;br/&gt;&lt;strong&gt;SOCK_STREAM&lt;/strong&gt; 是基于TCP的，有保障的（即能保证数据正确传送到对方）面向连接的SOCKET，多用于资料传送。&lt;br/&gt;&lt;strong&gt;SOCK_DGRAM&lt;/strong&gt; 是基于UDP的，无保障的面向消息的socket，多用于在网络上发广播信息。&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;6&quot;&gt;&lt;td width=&quot;60&quot;&gt;&lt;strong&gt;proto&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;协议号通常为零,可以省略,或者在地址族为AF_CAN的情况下,协议应为CAN_RAW或CAN_BCM之一。&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;8&quot;&gt;&lt;td width=&quot;60&quot;&gt;&lt;strong&gt;fileno&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;如果指定了fileno,则其他参数将被忽略,导致带有指定文件描述符的套接字返回。&lt;br/&gt;与socket.fromfd()不同,fileno将返回相同的套接字,而不是重复的。&lt;br/&gt;这可能有助于使用socket.close()关闭一个独立的插座。&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;pre data-source-line=&quot;11&quot;&gt;
&lt;/pre&gt;


&lt;h2&gt;黏包现象&lt;/h2&gt;
&lt;p&gt;让我们基于tcp先制作一个远程执行命令的程序（命令ls -l ; lllllll ; pwd）&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_5c6673d2-1767-471a-94bb-fb63b00ebfb9&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;注意&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;同时执行多条命令之后，得到的结果很可能只有一部分，在执行其他命令的时候又接收到之前执行的另外一部分结果，这种显现就是黏包。&lt;/p&gt;
&lt;h3&gt;基于tcp协议实现的黏包&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_f330f827-9c79-46a5-b1b2-b488fef3ed3f&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;tcp - server&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_7bccb6ac-bc49-4ae8-9b48-ea70787d0c49&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;tcp - client&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;注意：只有TCP有粘包现象，UDP永远不会粘包&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;基于udp协议实现的黏包&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_f53f5cc7-2673-425d-9544-60d971bd28c0&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;udp - server&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_cf53ff83-fcaa-48ff-96ee-b31238af5f1f&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;udp - client&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;黏包成因&lt;/h2&gt;
&lt;h3&gt;&lt;strong&gt;为什么会出现黏包现象？ &lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107212834471-1015282383.png&quot; alt=&quot;&quot;/&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107212854393-1243611115.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107213012565-1511102109.png&quot; alt=&quot;&quot; width=&quot;329&quot; height=&quot;206&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_9736b3af-9edb-489b-a49f-74569515c2cc&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;socket数据传输过程中的用户态与内核态说明&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;例如基于tcp的套接字客户端往服务端上传文件，发送时文件内容是按照一段一段的字节流发送的，在接收方看了，根本不知道该文件的字节流从何处开始，在何处结束&lt;/p&gt;
&lt;p id=&quot;所谓粘包问题主要还是因为接收方不知道消息之间的界限不知道一次性提取多少字节的数据所造成的&quot;&gt;&lt;strong&gt;所谓粘包问题——主要还是因为接收方不知道消息之间的界限，不知道一次性提取多少字节的数据所造成的。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;此外，发送方引起的粘包是由TCP协议本身造成的，TCP为提高传输效率，发送方往往要收集到足够多的数据后才发送一个TCP段。若连续几次需要send的数据都很少，通常TCP会根据优化&lt;a class=&quot;replace_word&quot; title=&quot;算法与数据结构知识库&quot; href=&quot;http://lib.csdn.net/base/datastructure&quot; target=&quot;_blank&quot;&gt;算法&lt;/a&gt;把这些数据合成一个TCP段后一次发送出去，这样接收方就收到了粘包数据。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107212839706-127829859.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_cefa91b3-a0e7-404f-9b6c-8c1fa6750d49&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;面向流通信的tcp协议与面向消息通信的udp&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;补充说明：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_6314af6c-f0a7-463b-b699-e9d8a4e9f846&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;tcp协议的拆包&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_973d7ba4-c8e7-4e02-b88f-e49a05ca02c8&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;为何tcp是可靠传输，udp是不可靠传输&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_8247a3bb-c0a8-44ee-8d2b-a966959182ff&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;补充问题二：send(字节流)和recv(1024)及sendall&lt;/span&gt;&lt;/div&gt;
&lt;h3&gt;会发生黏包的两种情况&lt;/h3&gt;
&lt;h4&gt;情况一 发送方的缓存机制&lt;/h4&gt;
&lt;p&gt;发送端需要等缓冲区满才发送出去，造成粘包（发送数据时间间隔很短，数据了很小，会合到一起，产生粘包）&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_3db977b6-5afa-4d7d-b71b-13a57e2036d6&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_11835a63-df46-4e90-a907-9593f7e9eed7&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端&lt;/span&gt;&lt;/div&gt;
&lt;h4&gt;情况二 接收方的缓存机制&lt;/h4&gt;
&lt;p&gt;接收方不及时接收缓冲区的包，造成多个包接收（客户端发送了一段数据，服务端只收了一小部分，服务端下次再收的时候还是从缓冲区拿上次遗留的数据，产生粘包） &lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_5bf2b1b5-00eb-4c57-b1c1-38a18ef32aaa&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_9081db8d-1baf-46ea-a7e9-58af2a9d4674&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;黏包的解决方案&lt;/p&gt;
&lt;h3&gt;解决方案一&lt;/h3&gt;
&lt;p&gt;问题的根源在于，接收端不知道发送端将要传送的字节流的长度，所以解决粘包的方法就是围绕，如何让发送端在发送数据前，把自己将要发送的字节流总大小让接收端知晓，然后接收端来一个死循环接收完所有数据。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107211210612-35513522.png&quot; alt=&quot;&quot; width=&quot;399&quot; height=&quot;241&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_e6a34007-6cd4-4dfb-b926-a8cbd4cb9c02&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_c0b4c2f9-d90f-49fa-becf-e2d688a6c884&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
存在的问题：
程序的运行速度远快于网络传输速度，所以在发送一段字节前，先用send去发送该字节流长度，这种方式会放大网络延迟带来的性能损耗
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;解决方案进阶&lt;/h3&gt;
&lt;p&gt;刚刚的方法，问题在于我们我们在发送&lt;/p&gt;
&lt;p&gt;我们可以借助一个模块，这个模块可以把要发送的数据长度转换成固定长度的字节。这样客户端每次接收消息之前只要先接受这个固定长度字节的内容看一看接下来要接收的信息大小，那么最终接受的数据只要达到这个值就停止，就能刚好不多不少的接收完整的数据了。&lt;/p&gt;
&lt;h4&gt;struct模块&lt;/h4&gt;
&lt;p&gt;该模块可以把一个类型，如数字，转成固定长度的bytes&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&amp;gt;&amp;gt;&amp;gt; struct.pack('i',1111111111111)

struct.error: 'i' format requires -2147483648 &amp;lt;= number &amp;lt;= 2147483647 #这个是范围
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2017.cnblogs.com/blog/827651/201801/827651-20180107202942674-547846208.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
import json,struct
#假设通过客户端上传1T:1073741824000的文件a.txt

#为避免粘包,必须自定制报头
header={'file_size':1073741824000,'file_name':'/a/b/c/d/e/a.txt','md5':'8f6fbf8347faa4924a76856701edb0f3'} #1T数据,文件路径和md5值

#为了该报头能传送,需要序列化并且转为bytes
head_bytes=bytes(json.dumps(header),encoding='utf-8') #序列化并转成bytes,用于传输

#为了让客户端知道报头的长度,用struck将报头长度这个数字转成固定长度:4个字节
head_len_bytes=struct.pack('i',len(head_bytes)) #这4个字节里只包含了一个数字,该数字是报头的长度

#客户端开始发送
conn.send(head_len_bytes) #先发报头的长度,4个bytes
conn.send(head_bytes) #再发报头的字节格式
conn.sendall(文件内容) #然后发真实内容的字节格式

#服务端开始接收
head_len_bytes=s.recv(4) #先收报头4个bytes,得到报头长度的字节格式
x=struct.unpack('i',head_len_bytes)[0] #提取报头的长度

head_bytes=s.recv(x) #按照报头长度x,收取报头的bytes格式
header=json.loads(json.dumps(header)) #提取报头

#最后根据报头的内容提取真实的数据,比如
real_data_len=s.recv(header['file_size'])
s.recv(real_data_len)
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_3db1d818-d341-4843-abd3-42ce22f01a40&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;关于struct的详细用法&lt;/span&gt;&lt;/div&gt;
&lt;h4&gt;使用struct解决黏包 &lt;/h4&gt;
&lt;p&gt;借助struct模块，我们知道长度数字可以被转换成一个标准大小的4字节数字。因此可以利用这个特点来预先发送数据长度。&lt;/p&gt;
&lt;table border=&quot;0&quot;&gt;&lt;tbody readability=&quot;3&quot;&gt;&lt;tr&gt;&lt;td&gt;发送时&lt;/td&gt;
&lt;td&gt;接收时&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;先发送struct转换好的数据长度4字节&lt;/td&gt;
&lt;td&gt;先接受4个字节使用struct转换成数字来获取要接收的数据长度&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;再发送数据&lt;/td&gt;
&lt;td&gt;再按照长度接收数据&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_b824da64-44fa-4b5e-b63f-2f9f5b6cebc9&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端（自定制报头）&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_4d9d4813-fdbc-4a04-bc88-667d6561e2eb&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端（自定制报头）&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;我们还可以把报头做成字典，字典里包含将要发送的真实数据的详细信息，然后json序列化，然后用struck将序列化后的数据长度打包成4个字节（4个自己足够用了）&lt;/p&gt;
&lt;table border=&quot;0&quot;&gt;&lt;tbody readability=&quot;4&quot;&gt;&lt;tr&gt;&lt;td&gt;发送时&lt;/td&gt;
&lt;td&gt;接收时&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;
&lt;p&gt;先发报头长度&lt;/p&gt;
&lt;/td&gt;
&lt;td&gt;先收报头长度，用struct取出来&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;再编码报头内容然后发送&lt;/td&gt;
&lt;td&gt;根据取出的长度收取报头内容，然后解码，反序列化&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;最后发真实内容&lt;/td&gt;
&lt;td&gt;从反序列化的结果中取出待取数据的详细信息，然后去取真实的数据内容&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_5005e121-455c-480b-bae0-530bf62f65b9&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端：定制稍微复杂一点的报头&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_de6461c9-82e4-4729-acf8-d0b23e87c5c0&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端&lt;/span&gt;&lt;/div&gt;

&lt;h4&gt;&lt;strong&gt;FTP作业：上传下载文件&lt;/strong&gt;&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_7a398f80-f466-414e-9446-0221a247fbe8&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_c6fc720b-e1ac-47da-b1f2-17fa8aee3b41&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端&lt;/span&gt;&lt;/div&gt;


&lt;p&gt;如果你想在分布式系统中实现一个简单的客户端链接认证功能，又不像SSL那么复杂，那么利用hmac+加盐的方式来实现&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_fe4bf164-a800-48b9-bd16-939452273835&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;服务端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_a736a4af-369d-47fe-8ac2-f0e61fc3b325&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端(合法)&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_a40d42ef-9630-4859-b110-98830d83e73e&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端(非法:不知道加密方式)&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_9cf00629-622c-4a28-801c-6aac4f034dd1&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;客户端(非法:不知道secret_key) &lt;/span&gt;&lt;/div&gt;


&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/Eva-J/p/5081851.html&quot; target=&quot;_blank&quot;&gt;解读socketserver源码 —— http://www.cnblogs.com/Eva-J/p/5081851.html &lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_32d41c04-f4e3-4de2-b338-8190e0dd28c9&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;server端&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;&lt;img id=&quot;code_img_closed_d04509e1-dd0f-4a77-9744-a45bf41f080e&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt; &lt;span class=&quot;cnblogs_code_collapse&quot;&gt;client&lt;/span&gt;&lt;/div&gt;



</description>
<pubDate>Sun, 04 Feb 2018 15:12:00 +0000</pubDate>
<dc:creator>春生</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/jiangchunsheng/p/8414771.html</dc:identifier>
</item>
</channel>
</rss>