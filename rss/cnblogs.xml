<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>JVM----双亲委派模型 - Booker808</title>
<link>http://www.cnblogs.com/Booker808-java/p/9220621.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Booker808-java/p/9220621.html</guid>
<description>&lt;p&gt;&lt;span&gt;        我们在了解双亲委派模型之前，不得不先了解一下什么是类加载器。虚拟机设计团队之初是希望类加载过程“通过一个类的全限定名来获取描述该类的二进制字节流”这个动作能放到虚拟机外部实现，以便于让程序自己决定如何获取该类，实现这个动作的代码的工具成为类加载器。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;        可能很多人觉得类加载器，顾名思义，就是个加载类的嘛，有啥大不了的，但是类加载这个过程是很严格的，对于任意一个类，我们都需要由加载他的类加载器和类的本身来决定该类在虚拟机之中的唯一性。什么意思呢？？&lt;/span&gt;&lt;span&gt;就是说我们的虚拟机要比较两个类是否相等，那前提条件是就是这两个类必须是在同一个类加载器加载的，如果两个类都不是由同一个加载器加载的，那么这俩类就一定不相等，所以就没有比较的意义！&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;38&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
public class ClassLoaderTest {

    public static void main(String[] args) throws Exception {

        ClassLoader myLoader = new ClassLoader() {
            @Override
            public Class&amp;lt;?&amp;gt; loadClass(String name) throws ClassNotFoundException {
                try {
                    String fileName = name.substring(name.lastIndexOf(&quot;.&quot;) + 1) + &quot;.class&quot;;
                    InputStream is = getClass().getResourceAsStream(fileName);
                    if (is == null) {
                        return super.loadClass(name);
                    }
                    byte[] b = new byte[is.available()];
                    is.read(b);
                    return defineClass(name, b, 0, b.length);
                } catch (IOException e) {
                    throw new ClassNotFoundException(name);
                }
            }
        };

        Object obj = myLoader.loadClass(&quot;org.fenixsoft.classloading.ClassLoaderTest&quot;).newInstance();

        System.out.println(obj.getClass());
        System.out.println(obj instanceof org.fenixsoft.classloading.ClassLoaderTest);
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　&lt;span&gt;就比如上面这段代码，代码运行结果很令人失望，虽然打印出的类路径是相同的，但是比较后的结果却是false，这是为啥啊？好气啊，明明类路径一样，但是结果却不同？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;      这是因为，我们自己实现了属于我们自己的类加载器，我们选择了我们自己的加载路径去加载该类，而另一个同类路径名的类却是由另一个加载器（&lt;strong&gt;应用程序类加载器&lt;/strong&gt;）加载的，只要不是同一个类加载器加载的类，一定不是同一个类！！&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;双亲委派模型&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;      从java虚拟机角度来讲，只存在两种不同的类加载器：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       （1）一种是启动类加载器，由C++语言实现的，属于虚拟机的一部分；&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       （2）一种是所有的其他类加载器，这些都是由Java实现的，独立于虚拟机外部，继承自java.lang.ClassLoader；&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;      但是从&lt;strong&gt;开发人员角度来讲&lt;/strong&gt;，应该分的再细一些，绝大部分程序都使用到了以下三种系统提供的类加载器：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       （1）启动类加载器，该加载器是C++实现的，它负责加载存放于&amp;lt;JAVA_HOME&amp;gt;\lib目录下的类，它是仅仅按照文件的名字来识别的，名字不符合的类就算放到该目录下，也是毫无卵用的.....&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       （2）扩展类加载器，它是负责加载&amp;lt;JAVA_HOME&amp;gt;\lib\Ext目录下的；&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       （3）应用程序类加载器，这个类也被称为系统类加载器，它是负责用户类路径classpath上指定的类库，开发者可以直接使用这个加载器；&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;应用程序都是由这三种加载器相互配合进行加载的，有必要的话，还可以实现属于自己的类加载器，这几种加载器关系如图：&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span&gt;                                    &lt;img src=&quot;https://images2018.cnblogs.com/blog/1229366/201806/1229366-20180624145029820-870443098.png&quot; alt=&quot;&quot; width=&quot;847&quot; height=&quot;626&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       这种层次结构我们就称之为双亲委派模型，可以很直观的看出除了顶层的启动类加载器外，其他的都有属于自己的父类加载器。但是我们在这里不要混淆一个概念，就是继承（Inheritance），这个结构图并不是继承关系而是通过组合的方式来实现向上委托的.......&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       双亲委派的工作流程就是：如果一个类加载器收到了类加载的请求，它是不会自己立马亲自动手去加载的（比较懒，哈哈！），而是把该请求委托给父类，每一层都是如此，到了顶层后，这时就无法再向上传递了，所有的请求都集中到了启动类加载器，当父类反馈自己无法满足这个请求时，这时就会再把请求一层层向下传递。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       这样的好处是啥？？相信大家看这种层次结构应该很清晰，但是这有什么意义吗？比如java.lang.Object，他是存在rt.jar里的，不论哪种加载器，是系统自带的也好还是我们自己实现的也好，都会把请求一层层的往上委托，直到启动类加载器，而启动类加载器一看，自己是有这个类的，所以加载，因此Object在程序的各个类加载器的加载下永远都是同一个类。反之，没有双亲委派模型，任由各个类加载器自己去加载的话，比如我们开发者自己写了Object类，包名也是java.lang，那么系统中就会出现各种各样的Object，每一个层级的类加载器都加载了自己具有个性的Object，那么作为程序中这么基础这么重要的Object，他的唯一性得不到保证，应用程序就会杂乱不堪。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       双亲委派模型的作用想必到这里很多人应该清楚了，觉得：“哇！这个模型还真的是很强大呢...”。他是实现也是非常简单的：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;38&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
protected synchronized Class&amp;lt;?&amp;gt; loadClass(String name,boolean resolve)throws ClassNotFoundException{
    //check the class has been loaded or not
    Class c = findLoadedClass(name);
    if(c == null){
        try{
            if(parent != null){
                c = parent.loadClass(name,false);
            }else{
                c = findBootstrapClassOrNull(name);
            }
        }catch(ClassNotFoundException e){
            //if throws the exception ,the father can not complete the load
        }
        if(c == null){
            c = findClass(name);
        }
    }
    if(resolve){
        resolveClass(c);
    }
    return c;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;       从图中的代码，我们大致可以看出这个委托机制是如何实现的，当一个加载器收到请求后，首先会判断一下当前这个类是否已经被加载过，如果没有被加载的话，开始委托父类加载器了（就是这么懒，哈哈），如果没有父类的话，就默认使用启动类加载器。如果抛异常了，就代表当前类加载器的父类无法加载，满足不了请求，那么此时只能自己亲自出马了！！所以什么事还是自己来做的靠谱啊哈哈。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;总结&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;       当然，这种模型一直都不是强制性的，而是推荐我们这么做的，往年就出现过打破该机制的事件，&lt;/span&gt;&lt;span&gt;典型的例子就是JNDI服务，他的代码是交给启动类加载器去实现的，但是当JNDI要对资源进行集中化管理时，他需要调用其他公司实现并部署在应用程序的classpath下的JNDI接口，因为这些代码是需要我们开发者自己来实现的，这时启动类加载器是无法识别这些类的，于是乎出现了一种线程上下文加载器，JNDI服务可以调用该加载器去加载所需要的代码，就是通过父类加载器去请求子类加载器来实现的，这已经很明显的违背了双亲委派模型。&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 24 Jun 2018 07:24:00 +0000</pubDate>
<dc:creator>Booker808</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Booker808-java/p/9220621.html</dc:identifier>
</item>
<item>
<title>用PMML实现机器学习模型的跨平台上线 - 刘建平Pinard</title>
<link>http://www.cnblogs.com/pinard/p/9220199.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/pinard/p/9220199.html</guid>
<description>&lt;p&gt;　　　　在机器学习用于产品的时候，我们经常会遇到跨平台的问题。比如我们用Python基于一系列的机器学习库训练了一个模型，但是有时候其他的产品和项目想把这个模型集成进去，但是这些产品很多只支持某些特定的生产环境比如Java，为了上一个机器学习模型去大动干戈修改环境配置很不划算，此时我们就可以考虑用预测模型标记语言(Predictive Model Markup Language,以下简称PMML)来实现跨平台的机器学习模型部署了。&lt;/p&gt;

&lt;p&gt;　　　　PMML是数据挖掘的一种通用的规范，它用统一的XML格式来描述我们生成的机器学习模型。这样无论你的模型是sklearn,R还是Spark MLlib生成的，我们都可以将其转化为标准的XML格式来存储。当我们需要将这个PMML的模型用于部署的时候，可以使用目标环境的解析PMML模型的库来加载模型，并做预测。&lt;/p&gt;
&lt;p&gt;　　　　可以看出，要使用PMML，需要两步的工作，第一块是将离线训练得到的模型转化为PMML模型文件，第二块是将PMML模型文件载入在线预测环境，进行预测。这两块都需要相关的库支持。&lt;/p&gt;

&lt;p&gt;　　　　PMML模型的生成相关的库需要看我们使用的离线训练库。如果我们使用的是sklearn，那么可以使用sklearn2pmml这个python库来做模型文件的生成，这个库安装很简单，使用&quot;pip install sklearn2pmml&quot;即可，相关的使用我们后面会有一个demo。如果使用的是Spark MLlib, 这个库有一些模型已经自带了保存PMML模型的方法，可惜并不全。如果是R，则需要安装包&quot;XML&quot;和“PMML”。此外，JAVA库JPMML可以用来生成R,SparkMLlib,xgBoost,Sklearn的模型对应的PMML文件。github地址是：https://github.com/jpmml/jpmml。&lt;/p&gt;
&lt;p&gt;　　　　加载PMML模型需要目标环境支持PMML加载的库，如果是JAVA，则可以用JPMML来加载PMML模型文件。相关的使用我们后面会有一个demo。&lt;/p&gt;

&lt;p&gt;　　　　下面我们给一个示例，使用sklearn生成一个决策树模型，用sklearn2pmml生成模型文件，用JPMML加载模型文件，并做预测。&lt;/p&gt;
&lt;p&gt;　　　　首先是用用sklearn生成一个决策树模型，由于我们是需要保存PMML文件，所以最好把模型先放到一个Pipeline数组里面。这个数组里面除了我们的决策树模型以外，还可以有归一化，降维等预处理操作，这里作为一个示例，我们Pipeline数组里面只有决策树模型。代码如下:&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; numpy as np
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; matplotlib.pyplot as plt
&lt;/span&gt;%&lt;span&gt;matplotlib inline
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; pandas as pd
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; sklearn &lt;span&gt;import&lt;/span&gt;&lt;span&gt; tree
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; sklearn2pmml.pipeline &lt;span&gt;import&lt;/span&gt;&lt;span&gt; PMMLPipeline
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; sklearn2pmml &lt;span&gt;import&lt;/span&gt;&lt;span&gt; sklearn2pmml

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; os
os.environ[&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;PATH&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;] += os.pathsep + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;C:/Program Files/Java/jdk1.8.0_171/bin&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;

X&lt;/span&gt;=[[1,2,3,1],[2,4,1,5],[7,8,3,6],[4,8,4,7],[2,5,6,9&lt;span&gt;]]
y&lt;/span&gt;=[0,1,0,2,1&lt;span&gt;]
pipeline &lt;/span&gt;= PMMLPipeline([(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;classifier&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, tree.DecisionTreeClassifier(random_state=9&lt;span&gt;))]);
pipeline.fit(X,y)

sklearn2pmml(pipeline, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.\demo.pmml&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, with_repr = True)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　　　上面这段代码做了一个非常简单的决策树分类模型，只有5个训练样本，特征有4个，输出类别有3个。实际应用时，我们需要将模型调参完毕后才将其放入PMMLPipeline进行保存。运行代码后，我们在当前目录会得到一个PMML的XML文件，可以直接打开看，内容大概如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;48&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;?&lt;/span&gt;&lt;span&gt;xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;&lt;/span&gt;&lt;span&gt;?&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;PMML &lt;/span&gt;&lt;span&gt;xmlns&lt;/span&gt;&lt;span&gt;=&quot;http://www.dmg.org/PMML-4_3&quot;&lt;/span&gt;&lt;span&gt; version&lt;/span&gt;&lt;span&gt;=&quot;4.3&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Header&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Application &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;JPMML-SkLearn&quot;&lt;/span&gt;&lt;span&gt; version&lt;/span&gt;&lt;span&gt;=&quot;1.5.3&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Timestamp&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;2018-06-24T05:47:17Z&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Timestamp&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Header&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;MiningBuildTask&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Extension&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;span&gt;PMMLPipeline(steps=[('classifier', DecisionTreeClassifier(class_weight=None, criterion='gini', max_depth=None,
            max_features=None, max_leaf_nodes=None,
            min_impurity_decrease=0.0, min_impurity_split=None,
            min_samples_leaf=1, min_samples_split=2,
            min_weight_fraction_leaf=0.0, presort=False, random_state=9,
            splitter='best'))])&lt;/span&gt;&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Extension&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;MiningBuildTask&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;DataDictionary&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;DataField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;y&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;categorical&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;integer&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Value &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Value &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Value &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;DataField&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;DataField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;x3&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;float&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;DataField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;x4&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;float&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;DataDictionary&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;TransformationDictionary&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;DerivedField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;double(x3)&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;double&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;FieldRef &lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;=&quot;x3&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;DerivedField&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;DerivedField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;double(x4)&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;double&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;FieldRef &lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;=&quot;x4&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;DerivedField&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;TransformationDictionary&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;TreeModel &lt;/span&gt;&lt;span&gt;functionName&lt;/span&gt;&lt;span&gt;=&quot;classification&quot;&lt;/span&gt;&lt;span&gt; missingValueStrategy&lt;/span&gt;&lt;span&gt;=&quot;nullPrediction&quot;&lt;/span&gt;&lt;span&gt; splitCharacteristic&lt;/span&gt;&lt;span&gt;=&quot;multiSplit&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;MiningSchema&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;MiningField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;y&quot;&lt;/span&gt;&lt;span&gt; usageType&lt;/span&gt;&lt;span&gt;=&quot;target&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;MiningField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;x3&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;MiningField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;x4&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;MiningSchema&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Output&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;OutputField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;probability(0)&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;double&quot;&lt;/span&gt;&lt;span&gt; feature&lt;/span&gt;&lt;span&gt;=&quot;probability&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;OutputField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;probability(1)&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;double&quot;&lt;/span&gt;&lt;span&gt; feature&lt;/span&gt;&lt;span&gt;=&quot;probability&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;OutputField &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;probability(2)&quot;&lt;/span&gt;&lt;span&gt; optype&lt;/span&gt;&lt;span&gt;=&quot;continuous&quot;&lt;/span&gt;&lt;span&gt; dataType&lt;/span&gt;&lt;span&gt;=&quot;double&quot;&lt;/span&gt;&lt;span&gt; feature&lt;/span&gt;&lt;span&gt;=&quot;probability&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Output&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;True&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;SimplePredicate &lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;=&quot;double(x3)&quot;&lt;/span&gt;&lt;span&gt; operator&lt;/span&gt;&lt;span&gt;=&quot;lessOrEqual&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;3.5&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Node &lt;/span&gt;&lt;span&gt;score&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;SimplePredicate &lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;=&quot;double(x3)&quot;&lt;/span&gt;&lt;span&gt; operator&lt;/span&gt;&lt;span&gt;=&quot;lessOrEqual&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;2.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Node &lt;/span&gt;&lt;span&gt;score&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;2.0&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;True&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;2.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Node &lt;/span&gt;&lt;span&gt;score&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;SimplePredicate &lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;=&quot;double(x4)&quot;&lt;/span&gt;&lt;span&gt; operator&lt;/span&gt;&lt;span&gt;=&quot;lessOrEqual&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;8.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Node &lt;/span&gt;&lt;span&gt;score&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;True&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;1&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ScoreDistribution &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;2&quot;&lt;/span&gt;&lt;span&gt; recordCount&lt;/span&gt;&lt;span&gt;=&quot;0.0&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;TreeModel&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;PMML&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　　　可以看到里面就是决策树模型的树结构节点的各个参数，以及输入值。我们的输入被定义为x1-x4,输出定义为y。&lt;/p&gt;
&lt;p&gt;　　　　有了PMML模型文件，我们就可以写JAVA代码来读取加载这个模型并做预测了。&lt;/p&gt;
&lt;p&gt;　　　　我们创建一个Maven或者gradle工程，加入JPMML的依赖，这里给出maven在pom.xml的依赖，gradle的结构是类似的。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;org.jpmml&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;pmml-evaluator&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;1.4.1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;org.jpmml&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;pmml-evaluator-extension&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;1.4.1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　　　接着就是读取模型文件并预测的代码了，具体代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;57&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.dmg.pmml.FieldName;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.dmg.pmml.PMML;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt; org.jpmml.evaluator.*&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.xml.sax.SAXException;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; javax.xml.bind.JAXBException;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.FileInputStream;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.IOException;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.InputStream;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.HashMap;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.LinkedHashMap;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.List;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.Map;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * Created by 刘建平Pinard on 2018/6/24.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; PMMLDemo {
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; Evaluator loadPmml(){
        PMML pmml &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; PMML();
        InputStream inputStream &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            inputStream &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; FileInputStream(&quot;D:/demo.pmml&quot;&lt;span&gt;);
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (IOException e) {
            e.printStackTrace();
        }
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(inputStream == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        }
        InputStream is &lt;/span&gt;=&lt;span&gt; inputStream;
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            pmml &lt;/span&gt;=&lt;span&gt; org.jpmml.model.PMMLUtil.unmarshal(is);
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SAXException e1) {
            e1.printStackTrace();
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (JAXBException e1) {
            e1.printStackTrace();
        }&lt;/span&gt;&lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;关闭输入流&lt;/span&gt;
            &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                is.close();
            } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (IOException e) {
                e.printStackTrace();
            }
        }
        ModelEvaluatorFactory modelEvaluatorFactory &lt;/span&gt;=&lt;span&gt; ModelEvaluatorFactory.newInstance();
        Evaluator evaluator &lt;/span&gt;=&lt;span&gt; modelEvaluatorFactory.newModelEvaluator(pmml);
        pmml &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; evaluator;
    }
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; predict(Evaluator evaluator,&lt;span&gt;int&lt;/span&gt; a, &lt;span&gt;int&lt;/span&gt; b, &lt;span&gt;int&lt;/span&gt; c, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; d) {
        Map&lt;/span&gt;&amp;lt;String, Integer&amp;gt; data = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;String, Integer&amp;gt;&lt;span&gt;();
        data.put(&lt;/span&gt;&quot;x1&quot;&lt;span&gt;, a);
        data.put(&lt;/span&gt;&quot;x2&quot;&lt;span&gt;, b);
        data.put(&lt;/span&gt;&quot;x3&quot;&lt;span&gt;, c);
        data.put(&lt;/span&gt;&quot;x4&quot;&lt;span&gt;, d);
        List&lt;/span&gt;&amp;lt;InputField&amp;gt; inputFields =&lt;span&gt; evaluator.getInputFields();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;过模型的原始特征，从画像中获取数据，作为模型输入&lt;/span&gt;
        Map&amp;lt;FieldName, FieldValue&amp;gt; arguments = &lt;span&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;FieldName, FieldValue&amp;gt;&lt;span&gt;();
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; (InputField inputField : inputFields) {
            FieldName inputFieldName &lt;/span&gt;=&lt;span&gt; inputField.getName();
            Object rawValue &lt;/span&gt;=&lt;span&gt; data.get(inputFieldName.getValue());
            FieldValue inputFieldValue &lt;/span&gt;=&lt;span&gt; inputField.prepare(rawValue);
            arguments.put(inputFieldName, inputFieldValue);
        }

        Map&lt;/span&gt;&amp;lt;FieldName, ?&amp;gt; results =&lt;span&gt; evaluator.evaluate(arguments);
        List&lt;/span&gt;&amp;lt;TargetField&amp;gt; targetFields =&lt;span&gt; evaluator.getTargetFields();

        TargetField targetField &lt;/span&gt;= targetFields.get(0&lt;span&gt;);
        FieldName targetFieldName &lt;/span&gt;=&lt;span&gt; targetField.getName();

        Object targetFieldValue &lt;/span&gt;=&lt;span&gt; results.get(targetFieldName);
        System.out.println(&lt;/span&gt;&quot;target: &quot; + targetFieldName.getValue() + &quot; value: &quot; +&lt;span&gt; targetFieldValue);
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; primitiveValue = -1&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (targetFieldValue &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; Computable) {
            Computable computable &lt;/span&gt;=&lt;span&gt; (Computable) targetFieldValue;
            primitiveValue &lt;/span&gt;=&lt;span&gt; (Integer)computable.getResult();
        }
        System.out.println(a &lt;/span&gt;+ &quot; &quot; + b + &quot; &quot; + c + &quot; &quot; + d + &quot;:&quot; +&lt;span&gt; primitiveValue);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; primitiveValue;
    }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String args[]){
        PMMLDemo demo &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; PMMLDemo();
        Evaluator model &lt;/span&gt;=&lt;span&gt; demo.loadPmml();
        demo.predict(model,&lt;/span&gt;1,8,99,1&lt;span&gt;);
        demo.predict(model,&lt;/span&gt;111,89,9,11&lt;span&gt;);

    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　　　代码里有两个函数，第一个loadPmml是加载模型的，第二个predict是读取预测样本并返回预测值的。我的代码运行结果如下：&lt;/p&gt;
&lt;p&gt;target: y value: {result=2, probability_entries=[0=0.0, 1=0.0, 2=1.0], entityId=5, confidence_entries=[]}&lt;br/&gt;1 8 99 1:2&lt;br/&gt;target: y value: {result=1, probability_entries=[0=0.0, 1=1.0, 2=0.0], entityId=6, confidence_entries=[]}&lt;br/&gt;111 89 9 11:1&lt;/p&gt;
&lt;p&gt;　　　　也就是样本（1,8,99,1）被预测为类别2，而（111,89,9,11）被预测为类别1。&lt;/p&gt;
&lt;p&gt;　　　　以上就是PMML生成和加载的一个示例，使用起来其实门槛并不高，也很简单。&lt;/p&gt;

&lt;p&gt;　　　　PMML的确是跨平台的利器，但是是不是就没有缺点呢？肯定是有的！&lt;/p&gt;
&lt;p&gt;　　　　第一个就是PMML为了满足跨平台，牺牲了很多平台独有的优化，所以很多时候我们用算法库自己的保存模型的API得到的模型文件，要比生成的PMML模型文件小很多。同时PMML文件加载速度也比算法库自己独有格式的模型文件加载慢很多。&lt;/p&gt;
&lt;p&gt;　　　　第二个就是PMML加载得到的模型和算法库自己独有的模型相比，预测会有一点点的偏差，当然这个偏差并不大。比如某一个样本，用sklearn的决策树模型预测为类别1，但是如果我们把这个决策树落盘为一个PMML文件，并用JAVA加载后，继续预测刚才这个样本，有较小的概率出现预测的结果不为类别1.&lt;/p&gt;
&lt;p&gt;　　　　第三个就是对于超大模型，比如大规模的集成学习模型，比如xgboost, 随机森林，或者tensorflow，生成的PMML文件很容易得到几个G，甚至上T，这时使用PMML文件加载预测速度会非常慢，此时推荐为模型建立一个专有的环境，就没有必要去考虑跨平台了。&lt;/p&gt;
&lt;p&gt;　　　　此外，对于TensorFlow，不推荐使用PMML的方式来跨平台。可能的方法一是TensorFlow serving，自己搭建预测服务，但是会稍有些复杂。另一个方法就是将模型保存为TensorFlow的模型文件，并用TensorFlow独有的JAVA库加载来做预测。&lt;/p&gt;
&lt;p&gt;　　　　我们在下一篇会讨论用python+tensorflow训练保存模型，并用tensorflow的JAVA库加载做预测的方法和实例。&lt;/p&gt;

&lt;p&gt;（欢迎转载，转载请注明出处。欢迎沟通交流： liujianping-ok@163.com） 　&lt;/p&gt;
</description>
<pubDate>Sun, 24 Jun 2018 07:18:00 +0000</pubDate>
<dc:creator>刘建平Pinard</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/pinard/p/9220199.html</dc:identifier>
</item>
<item>
<title>OpenCV大型阵列类型Mat类 - 芳舒晴</title>
<link>http://www.cnblogs.com/Shuqing-cxw/p/9218419.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Shuqing-cxw/p/9218419.html</guid>
<description>&lt;pre&gt;
&lt;span&gt;  1&lt;/span&gt; &lt;span&gt;enum&lt;/span&gt;&lt;span&gt; ColorConversionCodes {
&lt;/span&gt;&lt;span&gt;  2&lt;/span&gt;     COLOR_BGR2BGRA     = &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; add alpha channel to RGB or BGR image&lt;/span&gt;
&lt;span&gt;  3&lt;/span&gt;     COLOR_RGB2RGBA     =&lt;span&gt; COLOR_BGR2BGRA,
&lt;/span&gt;&lt;span&gt;  4&lt;/span&gt; 
&lt;span&gt;  5&lt;/span&gt;     COLOR_BGRA2BGR     = &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; remove alpha channel from RGB or BGR image&lt;/span&gt;
&lt;span&gt;  6&lt;/span&gt;     COLOR_RGBA2RGB     =&lt;span&gt; COLOR_BGRA2BGR,
&lt;/span&gt;&lt;span&gt;  7&lt;/span&gt; 
&lt;span&gt;  8&lt;/span&gt;     COLOR_BGR2RGBA     = &lt;span&gt;2&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between RGB and BGR color spaces (with or without alpha channel)&lt;/span&gt;
&lt;span&gt;  9&lt;/span&gt;     COLOR_RGB2BGRA     =&lt;span&gt; COLOR_BGR2RGBA,
&lt;/span&gt;&lt;span&gt; 10&lt;/span&gt; 
&lt;span&gt; 11&lt;/span&gt;     COLOR_RGBA2BGR     = &lt;span&gt;3&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 12&lt;/span&gt;     COLOR_BGRA2RGB     =&lt;span&gt; COLOR_RGBA2BGR,
&lt;/span&gt;&lt;span&gt; 13&lt;/span&gt; 
&lt;span&gt; 14&lt;/span&gt;     COLOR_BGR2RGB      = &lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 15&lt;/span&gt;     COLOR_RGB2BGR      =&lt;span&gt; COLOR_BGR2RGB,
&lt;/span&gt;&lt;span&gt; 16&lt;/span&gt; 
&lt;span&gt; 17&lt;/span&gt;     COLOR_BGRA2RGBA    = &lt;span&gt;5&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 18&lt;/span&gt;     COLOR_RGBA2BGRA    =&lt;span&gt; COLOR_BGRA2RGBA,
&lt;/span&gt;&lt;span&gt; 19&lt;/span&gt; 
&lt;span&gt; 20&lt;/span&gt;     COLOR_BGR2GRAY     = &lt;span&gt;6&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between RGB/BGR and grayscale, @ref color_convert_rgb_gray &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 21&lt;/span&gt;     COLOR_RGB2GRAY     = &lt;span&gt;7&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 22&lt;/span&gt;     COLOR_GRAY2BGR     = &lt;span&gt;8&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 23&lt;/span&gt;     COLOR_GRAY2RGB     =&lt;span&gt; COLOR_GRAY2BGR,
&lt;/span&gt;&lt;span&gt; 24&lt;/span&gt;     COLOR_GRAY2BGRA    = &lt;span&gt;9&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 25&lt;/span&gt;     COLOR_GRAY2RGBA    =&lt;span&gt; COLOR_GRAY2BGRA,
&lt;/span&gt;&lt;span&gt; 26&lt;/span&gt;     COLOR_BGRA2GRAY    = &lt;span&gt;10&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 27&lt;/span&gt;     COLOR_RGBA2GRAY    = &lt;span&gt;11&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 28&lt;/span&gt; 
&lt;span&gt; 29&lt;/span&gt;     COLOR_BGR2BGR565   = &lt;span&gt;12&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between RGB/BGR and BGR565 (16-bit images)&lt;/span&gt;
&lt;span&gt; 30&lt;/span&gt;     COLOR_RGB2BGR565   = &lt;span&gt;13&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 31&lt;/span&gt;     COLOR_BGR5652BGR   = &lt;span&gt;14&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 32&lt;/span&gt;     COLOR_BGR5652RGB   = &lt;span&gt;15&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 33&lt;/span&gt;     COLOR_BGRA2BGR565  = &lt;span&gt;16&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 34&lt;/span&gt;     COLOR_RGBA2BGR565  = &lt;span&gt;17&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 35&lt;/span&gt;     COLOR_BGR5652BGRA  = &lt;span&gt;18&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 36&lt;/span&gt;     COLOR_BGR5652RGBA  = &lt;span&gt;19&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 37&lt;/span&gt; 
&lt;span&gt; 38&lt;/span&gt;     COLOR_GRAY2BGR565  = &lt;span&gt;20&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between grayscale to BGR565 (16-bit images)&lt;/span&gt;
&lt;span&gt; 39&lt;/span&gt;     COLOR_BGR5652GRAY  = &lt;span&gt;21&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 40&lt;/span&gt; 
&lt;span&gt; 41&lt;/span&gt;     COLOR_BGR2BGR555   = &lt;span&gt;22&lt;/span&gt;,  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between RGB/BGR and BGR555 (16-bit images)&lt;/span&gt;
&lt;span&gt; 42&lt;/span&gt;     COLOR_RGB2BGR555   = &lt;span&gt;23&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 43&lt;/span&gt;     COLOR_BGR5552BGR   = &lt;span&gt;24&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 44&lt;/span&gt;     COLOR_BGR5552RGB   = &lt;span&gt;25&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 45&lt;/span&gt;     COLOR_BGRA2BGR555  = &lt;span&gt;26&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 46&lt;/span&gt;     COLOR_RGBA2BGR555  = &lt;span&gt;27&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 47&lt;/span&gt;     COLOR_BGR5552BGRA  = &lt;span&gt;28&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 48&lt;/span&gt;     COLOR_BGR5552RGBA  = &lt;span&gt;29&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 49&lt;/span&gt; 
&lt;span&gt; 50&lt;/span&gt;     COLOR_GRAY2BGR555  = &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between grayscale and BGR555 (16-bit images)&lt;/span&gt;
&lt;span&gt; 51&lt;/span&gt;     COLOR_BGR5552GRAY  = &lt;span&gt;31&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 52&lt;/span&gt; 
&lt;span&gt; 53&lt;/span&gt;     COLOR_BGR2XYZ      = &lt;span&gt;32&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert RGB/BGR to CIE XYZ, @ref color_convert_rgb_xyz &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 54&lt;/span&gt;     COLOR_RGB2XYZ      = &lt;span&gt;33&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 55&lt;/span&gt;     COLOR_XYZ2BGR      = &lt;span&gt;34&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 56&lt;/span&gt;     COLOR_XYZ2RGB      = &lt;span&gt;35&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 57&lt;/span&gt; 
&lt;span&gt; 58&lt;/span&gt;     COLOR_BGR2YCrCb    = &lt;span&gt;36&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert RGB/BGR to luma-chroma (aka YCC), @ref color_convert_rgb_ycrcb &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 59&lt;/span&gt;     COLOR_RGB2YCrCb    = &lt;span&gt;37&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 60&lt;/span&gt;     COLOR_YCrCb2BGR    = &lt;span&gt;38&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 61&lt;/span&gt;     COLOR_YCrCb2RGB    = &lt;span&gt;39&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 62&lt;/span&gt; 
&lt;span&gt; 63&lt;/span&gt;     COLOR_BGR2HSV      = &lt;span&gt;40&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert RGB/BGR to HSV (hue saturation value), @ref color_convert_rgb_hsv &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 64&lt;/span&gt;     COLOR_RGB2HSV      = &lt;span&gt;41&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 65&lt;/span&gt; 
&lt;span&gt; 66&lt;/span&gt;     COLOR_BGR2Lab      = &lt;span&gt;44&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert RGB/BGR to CIE Lab, @ref color_convert_rgb_lab &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 67&lt;/span&gt;     COLOR_RGB2Lab      = &lt;span&gt;45&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 68&lt;/span&gt; 
&lt;span&gt; 69&lt;/span&gt;     COLOR_BGR2Luv      = &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert RGB/BGR to CIE Luv, @ref color_convert_rgb_luv &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 70&lt;/span&gt;     COLOR_RGB2Luv      = &lt;span&gt;51&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 71&lt;/span&gt;     COLOR_BGR2HLS      = &lt;span&gt;52&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert RGB/BGR to HLS (hue lightness saturation), @ref color_convert_rgb_hls &quot;color conversions&quot;&lt;/span&gt;
&lt;span&gt; 72&lt;/span&gt;     COLOR_RGB2HLS      = &lt;span&gt;53&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 73&lt;/span&gt; 
&lt;span&gt; 74&lt;/span&gt;     COLOR_HSV2BGR      = &lt;span&gt;54&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; backward conversions to RGB/BGR&lt;/span&gt;
&lt;span&gt; 75&lt;/span&gt;     COLOR_HSV2RGB      = &lt;span&gt;55&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 76&lt;/span&gt; 
&lt;span&gt; 77&lt;/span&gt;     COLOR_Lab2BGR      = &lt;span&gt;56&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 78&lt;/span&gt;     COLOR_Lab2RGB      = &lt;span&gt;57&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 79&lt;/span&gt;     COLOR_Luv2BGR      = &lt;span&gt;58&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 80&lt;/span&gt;     COLOR_Luv2RGB      = &lt;span&gt;59&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 81&lt;/span&gt;     COLOR_HLS2BGR      = &lt;span&gt;60&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 82&lt;/span&gt;     COLOR_HLS2RGB      = &lt;span&gt;61&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 83&lt;/span&gt; 
&lt;span&gt; 84&lt;/span&gt;     COLOR_BGR2HSV_FULL = &lt;span&gt;66&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt;&lt;/span&gt;
&lt;span&gt; 85&lt;/span&gt;     COLOR_RGB2HSV_FULL = &lt;span&gt;67&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 86&lt;/span&gt;     COLOR_BGR2HLS_FULL = &lt;span&gt;68&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 87&lt;/span&gt;     COLOR_RGB2HLS_FULL = &lt;span&gt;69&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 88&lt;/span&gt; 
&lt;span&gt; 89&lt;/span&gt;     COLOR_HSV2BGR_FULL = &lt;span&gt;70&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 90&lt;/span&gt;     COLOR_HSV2RGB_FULL = &lt;span&gt;71&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 91&lt;/span&gt;     COLOR_HLS2BGR_FULL = &lt;span&gt;72&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 92&lt;/span&gt;     COLOR_HLS2RGB_FULL = &lt;span&gt;73&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 93&lt;/span&gt; 
&lt;span&gt; 94&lt;/span&gt;     COLOR_LBGR2Lab     = &lt;span&gt;74&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 95&lt;/span&gt;     COLOR_LRGB2Lab     = &lt;span&gt;75&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 96&lt;/span&gt;     COLOR_LBGR2Luv     = &lt;span&gt;76&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 97&lt;/span&gt;     COLOR_LRGB2Luv     = &lt;span&gt;77&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 98&lt;/span&gt; 
&lt;span&gt; 99&lt;/span&gt;     COLOR_Lab2LBGR     = &lt;span&gt;78&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;100&lt;/span&gt;     COLOR_Lab2LRGB     = &lt;span&gt;79&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;101&lt;/span&gt;     COLOR_Luv2LBGR     = &lt;span&gt;80&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;102&lt;/span&gt;     COLOR_Luv2LRGB     = &lt;span&gt;81&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;103&lt;/span&gt; 
&lt;span&gt;104&lt;/span&gt;     COLOR_BGR2YUV      = &lt;span&gt;82&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;!&amp;lt; convert between RGB/BGR and YUV&lt;/span&gt;
&lt;span&gt;105&lt;/span&gt;     COLOR_RGB2YUV      = &lt;span&gt;83&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;106&lt;/span&gt;     COLOR_YUV2BGR      = &lt;span&gt;84&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;107&lt;/span&gt;     COLOR_YUV2RGB      = &lt;span&gt;85&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;108&lt;/span&gt; 
&lt;span&gt;109&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! YUV 4:2:0 family to RGB&lt;/span&gt;
&lt;span&gt;110&lt;/span&gt;     COLOR_YUV2RGB_NV12  = &lt;span&gt;90&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;111&lt;/span&gt;     COLOR_YUV2BGR_NV12  = &lt;span&gt;91&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;112&lt;/span&gt;     COLOR_YUV2RGB_NV21  = &lt;span&gt;92&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;113&lt;/span&gt;     COLOR_YUV2BGR_NV21  = &lt;span&gt;93&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;114&lt;/span&gt;     COLOR_YUV420sp2RGB  =&lt;span&gt; COLOR_YUV2RGB_NV21,
&lt;/span&gt;&lt;span&gt;115&lt;/span&gt;     COLOR_YUV420sp2BGR  =&lt;span&gt; COLOR_YUV2BGR_NV21,
&lt;/span&gt;&lt;span&gt;116&lt;/span&gt; 
&lt;span&gt;117&lt;/span&gt;     COLOR_YUV2RGBA_NV12 = &lt;span&gt;94&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;118&lt;/span&gt;     COLOR_YUV2BGRA_NV12 = &lt;span&gt;95&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;119&lt;/span&gt;     COLOR_YUV2RGBA_NV21 = &lt;span&gt;96&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;120&lt;/span&gt;     COLOR_YUV2BGRA_NV21 = &lt;span&gt;97&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;121&lt;/span&gt;     COLOR_YUV420sp2RGBA =&lt;span&gt; COLOR_YUV2RGBA_NV21,
&lt;/span&gt;&lt;span&gt;122&lt;/span&gt;     COLOR_YUV420sp2BGRA =&lt;span&gt; COLOR_YUV2BGRA_NV21,
&lt;/span&gt;&lt;span&gt;123&lt;/span&gt; 
&lt;span&gt;124&lt;/span&gt;     COLOR_YUV2RGB_YV12  = &lt;span&gt;98&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;125&lt;/span&gt;     COLOR_YUV2BGR_YV12  = &lt;span&gt;99&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;126&lt;/span&gt;     COLOR_YUV2RGB_IYUV  = &lt;span&gt;100&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;127&lt;/span&gt;     COLOR_YUV2BGR_IYUV  = &lt;span&gt;101&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;128&lt;/span&gt;     COLOR_YUV2RGB_I420  =&lt;span&gt; COLOR_YUV2RGB_IYUV,
&lt;/span&gt;&lt;span&gt;129&lt;/span&gt;     COLOR_YUV2BGR_I420  =&lt;span&gt; COLOR_YUV2BGR_IYUV,
&lt;/span&gt;&lt;span&gt;130&lt;/span&gt;     COLOR_YUV420p2RGB   =&lt;span&gt; COLOR_YUV2RGB_YV12,
&lt;/span&gt;&lt;span&gt;131&lt;/span&gt;     COLOR_YUV420p2BGR   =&lt;span&gt; COLOR_YUV2BGR_YV12,
&lt;/span&gt;&lt;span&gt;132&lt;/span&gt; 
&lt;span&gt;133&lt;/span&gt;     COLOR_YUV2RGBA_YV12 = &lt;span&gt;102&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;134&lt;/span&gt;     COLOR_YUV2BGRA_YV12 = &lt;span&gt;103&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;135&lt;/span&gt;     COLOR_YUV2RGBA_IYUV = &lt;span&gt;104&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;136&lt;/span&gt;     COLOR_YUV2BGRA_IYUV = &lt;span&gt;105&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;137&lt;/span&gt;     COLOR_YUV2RGBA_I420 =&lt;span&gt; COLOR_YUV2RGBA_IYUV,
&lt;/span&gt;&lt;span&gt;138&lt;/span&gt;     COLOR_YUV2BGRA_I420 =&lt;span&gt; COLOR_YUV2BGRA_IYUV,
&lt;/span&gt;&lt;span&gt;139&lt;/span&gt;     COLOR_YUV420p2RGBA  =&lt;span&gt; COLOR_YUV2RGBA_YV12,
&lt;/span&gt;&lt;span&gt;140&lt;/span&gt;     COLOR_YUV420p2BGRA  =&lt;span&gt; COLOR_YUV2BGRA_YV12,
&lt;/span&gt;&lt;span&gt;141&lt;/span&gt; 
&lt;span&gt;142&lt;/span&gt;     COLOR_YUV2GRAY_420  = &lt;span&gt;106&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;143&lt;/span&gt;     COLOR_YUV2GRAY_NV21 =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;144&lt;/span&gt;     COLOR_YUV2GRAY_NV12 =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;145&lt;/span&gt;     COLOR_YUV2GRAY_YV12 =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;146&lt;/span&gt;     COLOR_YUV2GRAY_IYUV =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;147&lt;/span&gt;     COLOR_YUV2GRAY_I420 =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;148&lt;/span&gt;     COLOR_YUV420sp2GRAY =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;149&lt;/span&gt;     COLOR_YUV420p2GRAY  =&lt;span&gt; COLOR_YUV2GRAY_420,
&lt;/span&gt;&lt;span&gt;150&lt;/span&gt; 
&lt;span&gt;151&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! YUV 4:2:2 family to RGB&lt;/span&gt;
&lt;span&gt;152&lt;/span&gt;     COLOR_YUV2RGB_UYVY = &lt;span&gt;107&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;153&lt;/span&gt;     COLOR_YUV2BGR_UYVY = &lt;span&gt;108&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;154&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;COLOR_YUV2RGB_VYUY = 109,
&lt;/span&gt;&lt;span&gt;155&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;COLOR_YUV2BGR_VYUY = 110,&lt;/span&gt;
&lt;span&gt;156&lt;/span&gt;     COLOR_YUV2RGB_Y422 =&lt;span&gt; COLOR_YUV2RGB_UYVY,
&lt;/span&gt;&lt;span&gt;157&lt;/span&gt;     COLOR_YUV2BGR_Y422 =&lt;span&gt; COLOR_YUV2BGR_UYVY,
&lt;/span&gt;&lt;span&gt;158&lt;/span&gt;     COLOR_YUV2RGB_UYNV =&lt;span&gt; COLOR_YUV2RGB_UYVY,
&lt;/span&gt;&lt;span&gt;159&lt;/span&gt;     COLOR_YUV2BGR_UYNV =&lt;span&gt; COLOR_YUV2BGR_UYVY,
&lt;/span&gt;&lt;span&gt;160&lt;/span&gt; 
&lt;span&gt;161&lt;/span&gt;     COLOR_YUV2RGBA_UYVY = &lt;span&gt;111&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;162&lt;/span&gt;     COLOR_YUV2BGRA_UYVY = &lt;span&gt;112&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;163&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;COLOR_YUV2RGBA_VYUY = 113,
&lt;/span&gt;&lt;span&gt;164&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;COLOR_YUV2BGRA_VYUY = 114,&lt;/span&gt;
&lt;span&gt;165&lt;/span&gt;     COLOR_YUV2RGBA_Y422 =&lt;span&gt; COLOR_YUV2RGBA_UYVY,
&lt;/span&gt;&lt;span&gt;166&lt;/span&gt;     COLOR_YUV2BGRA_Y422 =&lt;span&gt; COLOR_YUV2BGRA_UYVY,
&lt;/span&gt;&lt;span&gt;167&lt;/span&gt;     COLOR_YUV2RGBA_UYNV =&lt;span&gt; COLOR_YUV2RGBA_UYVY,
&lt;/span&gt;&lt;span&gt;168&lt;/span&gt;     COLOR_YUV2BGRA_UYNV =&lt;span&gt; COLOR_YUV2BGRA_UYVY,
&lt;/span&gt;&lt;span&gt;169&lt;/span&gt; 
&lt;span&gt;170&lt;/span&gt;     COLOR_YUV2RGB_YUY2 = &lt;span&gt;115&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;171&lt;/span&gt;     COLOR_YUV2BGR_YUY2 = &lt;span&gt;116&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;172&lt;/span&gt;     COLOR_YUV2RGB_YVYU = &lt;span&gt;117&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;173&lt;/span&gt;     COLOR_YUV2BGR_YVYU = &lt;span&gt;118&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;174&lt;/span&gt;     COLOR_YUV2RGB_YUYV =&lt;span&gt; COLOR_YUV2RGB_YUY2,
&lt;/span&gt;&lt;span&gt;175&lt;/span&gt;     COLOR_YUV2BGR_YUYV =&lt;span&gt; COLOR_YUV2BGR_YUY2,
&lt;/span&gt;&lt;span&gt;176&lt;/span&gt;     COLOR_YUV2RGB_YUNV =&lt;span&gt; COLOR_YUV2RGB_YUY2,
&lt;/span&gt;&lt;span&gt;177&lt;/span&gt;     COLOR_YUV2BGR_YUNV =&lt;span&gt; COLOR_YUV2BGR_YUY2,
&lt;/span&gt;&lt;span&gt;178&lt;/span&gt; 
&lt;span&gt;179&lt;/span&gt;     COLOR_YUV2RGBA_YUY2 = &lt;span&gt;119&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;180&lt;/span&gt;     COLOR_YUV2BGRA_YUY2 = &lt;span&gt;120&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;181&lt;/span&gt;     COLOR_YUV2RGBA_YVYU = &lt;span&gt;121&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;182&lt;/span&gt;     COLOR_YUV2BGRA_YVYU = &lt;span&gt;122&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;183&lt;/span&gt;     COLOR_YUV2RGBA_YUYV =&lt;span&gt; COLOR_YUV2RGBA_YUY2,
&lt;/span&gt;&lt;span&gt;184&lt;/span&gt;     COLOR_YUV2BGRA_YUYV =&lt;span&gt; COLOR_YUV2BGRA_YUY2,
&lt;/span&gt;&lt;span&gt;185&lt;/span&gt;     COLOR_YUV2RGBA_YUNV =&lt;span&gt; COLOR_YUV2RGBA_YUY2,
&lt;/span&gt;&lt;span&gt;186&lt;/span&gt;     COLOR_YUV2BGRA_YUNV =&lt;span&gt; COLOR_YUV2BGRA_YUY2,
&lt;/span&gt;&lt;span&gt;187&lt;/span&gt; 
&lt;span&gt;188&lt;/span&gt;     COLOR_YUV2GRAY_UYVY = &lt;span&gt;123&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;189&lt;/span&gt;     COLOR_YUV2GRAY_YUY2 = &lt;span&gt;124&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;190&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;CV_YUV2GRAY_VYUY    = CV_YUV2GRAY_UYVY,&lt;/span&gt;
&lt;span&gt;191&lt;/span&gt;     COLOR_YUV2GRAY_Y422 =&lt;span&gt; COLOR_YUV2GRAY_UYVY,
&lt;/span&gt;&lt;span&gt;192&lt;/span&gt;     COLOR_YUV2GRAY_UYNV =&lt;span&gt; COLOR_YUV2GRAY_UYVY,
&lt;/span&gt;&lt;span&gt;193&lt;/span&gt;     COLOR_YUV2GRAY_YVYU =&lt;span&gt; COLOR_YUV2GRAY_YUY2,
&lt;/span&gt;&lt;span&gt;194&lt;/span&gt;     COLOR_YUV2GRAY_YUYV =&lt;span&gt; COLOR_YUV2GRAY_YUY2,
&lt;/span&gt;&lt;span&gt;195&lt;/span&gt;     COLOR_YUV2GRAY_YUNV =&lt;span&gt; COLOR_YUV2GRAY_YUY2,
&lt;/span&gt;&lt;span&gt;196&lt;/span&gt; 
&lt;span&gt;197&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! alpha premultiplication&lt;/span&gt;
&lt;span&gt;198&lt;/span&gt;     COLOR_RGBA2mRGBA    = &lt;span&gt;125&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;199&lt;/span&gt;     COLOR_mRGBA2RGBA    = &lt;span&gt;126&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;200&lt;/span&gt; 
&lt;span&gt;201&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! RGB to YUV 4:2:0 family&lt;/span&gt;
&lt;span&gt;202&lt;/span&gt;     COLOR_RGB2YUV_I420  = &lt;span&gt;127&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;203&lt;/span&gt;     COLOR_BGR2YUV_I420  = &lt;span&gt;128&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;204&lt;/span&gt;     COLOR_RGB2YUV_IYUV  =&lt;span&gt; COLOR_RGB2YUV_I420,
&lt;/span&gt;&lt;span&gt;205&lt;/span&gt;     COLOR_BGR2YUV_IYUV  =&lt;span&gt; COLOR_BGR2YUV_I420,
&lt;/span&gt;&lt;span&gt;206&lt;/span&gt; 
&lt;span&gt;207&lt;/span&gt;     COLOR_RGBA2YUV_I420 = &lt;span&gt;129&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;208&lt;/span&gt;     COLOR_BGRA2YUV_I420 = &lt;span&gt;130&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;209&lt;/span&gt;     COLOR_RGBA2YUV_IYUV =&lt;span&gt; COLOR_RGBA2YUV_I420,
&lt;/span&gt;&lt;span&gt;210&lt;/span&gt;     COLOR_BGRA2YUV_IYUV =&lt;span&gt; COLOR_BGRA2YUV_I420,
&lt;/span&gt;&lt;span&gt;211&lt;/span&gt;     COLOR_RGB2YUV_YV12  = &lt;span&gt;131&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;212&lt;/span&gt;     COLOR_BGR2YUV_YV12  = &lt;span&gt;132&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;213&lt;/span&gt;     COLOR_RGBA2YUV_YV12 = &lt;span&gt;133&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;214&lt;/span&gt;     COLOR_BGRA2YUV_YV12 = &lt;span&gt;134&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;215&lt;/span&gt; 
&lt;span&gt;216&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! Demosaicing&lt;/span&gt;
&lt;span&gt;217&lt;/span&gt;     COLOR_BayerBG2BGR = &lt;span&gt;46&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;218&lt;/span&gt;     COLOR_BayerGB2BGR = &lt;span&gt;47&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;219&lt;/span&gt;     COLOR_BayerRG2BGR = &lt;span&gt;48&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;220&lt;/span&gt;     COLOR_BayerGR2BGR = &lt;span&gt;49&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;221&lt;/span&gt; 
&lt;span&gt;222&lt;/span&gt;     COLOR_BayerBG2RGB =&lt;span&gt; COLOR_BayerRG2BGR,
&lt;/span&gt;&lt;span&gt;223&lt;/span&gt;     COLOR_BayerGB2RGB =&lt;span&gt; COLOR_BayerGR2BGR,
&lt;/span&gt;&lt;span&gt;224&lt;/span&gt;     COLOR_BayerRG2RGB =&lt;span&gt; COLOR_BayerBG2BGR,
&lt;/span&gt;&lt;span&gt;225&lt;/span&gt;     COLOR_BayerGR2RGB =&lt;span&gt; COLOR_BayerGB2BGR,
&lt;/span&gt;&lt;span&gt;226&lt;/span&gt; 
&lt;span&gt;227&lt;/span&gt;     COLOR_BayerBG2GRAY = &lt;span&gt;86&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;228&lt;/span&gt;     COLOR_BayerGB2GRAY = &lt;span&gt;87&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;229&lt;/span&gt;     COLOR_BayerRG2GRAY = &lt;span&gt;88&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;230&lt;/span&gt;     COLOR_BayerGR2GRAY = &lt;span&gt;89&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;231&lt;/span&gt; 
&lt;span&gt;232&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! Demosaicing using Variable Number of Gradients&lt;/span&gt;
&lt;span&gt;233&lt;/span&gt;     COLOR_BayerBG2BGR_VNG = &lt;span&gt;62&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;234&lt;/span&gt;     COLOR_BayerGB2BGR_VNG = &lt;span&gt;63&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;235&lt;/span&gt;     COLOR_BayerRG2BGR_VNG = &lt;span&gt;64&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;236&lt;/span&gt;     COLOR_BayerGR2BGR_VNG = &lt;span&gt;65&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;237&lt;/span&gt; 
&lt;span&gt;238&lt;/span&gt;     COLOR_BayerBG2RGB_VNG =&lt;span&gt; COLOR_BayerRG2BGR_VNG,
&lt;/span&gt;&lt;span&gt;239&lt;/span&gt;     COLOR_BayerGB2RGB_VNG =&lt;span&gt; COLOR_BayerGR2BGR_VNG,
&lt;/span&gt;&lt;span&gt;240&lt;/span&gt;     COLOR_BayerRG2RGB_VNG =&lt;span&gt; COLOR_BayerBG2BGR_VNG,
&lt;/span&gt;&lt;span&gt;241&lt;/span&gt;     COLOR_BayerGR2RGB_VNG =&lt;span&gt; COLOR_BayerGB2BGR_VNG,
&lt;/span&gt;&lt;span&gt;242&lt;/span&gt; 
&lt;span&gt;243&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! Edge-Aware Demosaicing&lt;/span&gt;
&lt;span&gt;244&lt;/span&gt;     COLOR_BayerBG2BGR_EA  = &lt;span&gt;135&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;245&lt;/span&gt;     COLOR_BayerGB2BGR_EA  = &lt;span&gt;136&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;246&lt;/span&gt;     COLOR_BayerRG2BGR_EA  = &lt;span&gt;137&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;247&lt;/span&gt;     COLOR_BayerGR2BGR_EA  = &lt;span&gt;138&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;248&lt;/span&gt; 
&lt;span&gt;249&lt;/span&gt;     COLOR_BayerBG2RGB_EA  =&lt;span&gt; COLOR_BayerRG2BGR_EA,
&lt;/span&gt;&lt;span&gt;250&lt;/span&gt;     COLOR_BayerGB2RGB_EA  =&lt;span&gt; COLOR_BayerGR2BGR_EA,
&lt;/span&gt;&lt;span&gt;251&lt;/span&gt;     COLOR_BayerRG2RGB_EA  =&lt;span&gt; COLOR_BayerBG2BGR_EA,
&lt;/span&gt;&lt;span&gt;252&lt;/span&gt;     COLOR_BayerGR2RGB_EA  =&lt;span&gt; COLOR_BayerGB2BGR_EA,
&lt;/span&gt;&lt;span&gt;253&lt;/span&gt; 
&lt;span&gt;254&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;! Demosaicing with alpha channel&lt;/span&gt;
&lt;span&gt;255&lt;/span&gt;     COLOR_BayerBG2BGRA = &lt;span&gt;139&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;256&lt;/span&gt;     COLOR_BayerGB2BGRA = &lt;span&gt;140&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;257&lt;/span&gt;     COLOR_BayerRG2BGRA = &lt;span&gt;141&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;258&lt;/span&gt;     COLOR_BayerGR2BGRA = &lt;span&gt;142&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;259&lt;/span&gt; 
&lt;span&gt;260&lt;/span&gt;     COLOR_BayerBG2RGBA =&lt;span&gt; COLOR_BayerRG2BGRA,
&lt;/span&gt;&lt;span&gt;261&lt;/span&gt;     COLOR_BayerGB2RGBA =&lt;span&gt; COLOR_BayerGR2BGRA,
&lt;/span&gt;&lt;span&gt;262&lt;/span&gt;     COLOR_BayerRG2RGBA =&lt;span&gt; COLOR_BayerBG2BGRA,
&lt;/span&gt;&lt;span&gt;263&lt;/span&gt;     COLOR_BayerGR2RGBA =&lt;span&gt; COLOR_BayerGB2BGRA,
&lt;/span&gt;&lt;span&gt;264&lt;/span&gt; 
&lt;span&gt;265&lt;/span&gt;     COLOR_COLORCVT_MAX  = &lt;span&gt;143&lt;/span&gt;
&lt;span&gt;266&lt;/span&gt; };
&lt;/pre&gt;</description>
<pubDate>Sun, 24 Jun 2018 05:09:00 +0000</pubDate>
<dc:creator>芳舒晴</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Shuqing-cxw/p/9218419.html</dc:identifier>
</item>
<item>
<title>Scaling Memcache At Facebook - 白下</title>
<link>http://www.cnblogs.com/hzluyang/p/9220314.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hzluyang/p/9220314.html</guid>
<description>
&lt;p&gt;最近组内正在编写memcache的运维手册，围绕memcache运维在研读整理资料时发现有一块不可跳跃，那就是facebook几年前对于memcache的运维总结。&lt;/p&gt;

&lt;p&gt;相关一手资料如下：&lt;/p&gt;
&lt;p&gt;1  FaceBook工程师分享的视频  &lt;a href=&quot;https://www.youtube.com/watch?v=6phA3IAcEJ8&quot;&gt;https://www.youtube.com/watch?v=6phA3IAcEJ8&lt;/a&gt; [请FQ]&lt;/p&gt;
&lt;p&gt;2  facebook PPT https://www.usenix.org/sites/default/files/conference/protected-files/nishtala_nsdi13_slides.pdf&lt;/p&gt;
&lt;p&gt;3  facebook论文《Scaling Memcache At Facebook》 https://www.usenix.org/system/files/conference/nsdi13/nsdi13-final170_update.pdf&lt;/p&gt;

&lt;p&gt;下面围绕这些资料视频和论文做一下小结，正好为不习惯看英文的同学做摘要了。&lt;/p&gt;
&lt;p&gt;为什么facebook有大规模scaling memcache的需要&lt;/p&gt;
&lt;p&gt;facebook这种SNS的互联网产品特征：&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;1. Near real-time communication 实时沟通 （发布、回复、私信）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;2. Aggregate content on-the-fly from &lt;/span&gt;&lt;span&gt;multiple sources 聚合多个数据源的内容（头像，状态，图片等待）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;3. Be able to access and update very popular &lt;/span&gt;&lt;span&gt;shared content （热点明星的内容）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;4. Scale to process millions of user requests &lt;/span&gt;&lt;span&gt;per second （用户基数大 访问量高）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;&lt;span&gt;由此特征带来的技术需求是：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;Support a very heavy read load  （读请求远大于写请求---缓存）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p2&quot;&gt;&lt;span class=&quot;s1&quot;&gt;• Over 1 billion reads / second&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p2&quot;&gt;&lt;span class=&quot;s1&quot;&gt;• Insulate backend services from high read rates&lt;/span&gt; &lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;Geographically Distributed  （地理分割）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;Support a constantly evolving product  （持续集成和发布）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p2&quot;&gt;&lt;span class=&quot;s1&quot;&gt;• System must be flexible enough to support a variety of use cases&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p2&quot;&gt;&lt;span class=&quot;s1&quot;&gt;• Support rapid deployment of new features&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;Persistence handled outside the system （一致性要求）&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p2&quot;&gt;&lt;span class=&quot;s1&quot;&gt;• Support mechanisms to refill after updates&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;  &lt;/p&gt;
&lt;p&gt;基于以上facebook的产品特性和技术要求，facebook选择了memcache并且有了Scaling Memcache的需求&lt;/p&gt;

&lt;blockquote readability=&quot;14&quot;&gt;
&lt;p&gt;白下说：其实facebook的缓存需求代表了广大SNS产品缓存特点，相似的产品需求比如UGC较多的微博、云音乐等读场景大于写场景的。&lt;/p&gt;
&lt;p&gt;不过提到memcache就不能忽视掉redis  豌豆荚就选择了codis(Proxy based Redis cluster solution supporting pipeline and scaling dynamically)来解决可动态扩展的大规模缓存。&lt;/p&gt;

&lt;p&gt;后面会不可缺少的分享redis相关的缓存解决方案，其实谈到缓存，在聚焦于选择memcache还是redis之后，运维或者架构师应该思考这样一个问题；“如何打造维护一个可动态扩展的大规模缓存集群” 本篇文章可以看到facebook在几年前对这个方面的探讨和实践。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;memcache 常规的使用姿势：&lt;/p&gt;
&lt;p&gt;姿势1：读：读取如果miss回源数据库然后set&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624111417892-1600293524.png&quot; alt=&quot;&quot; width=&quot;344&quot; height=&quot;343&quot;/&gt;&lt;/p&gt;
&lt;p&gt;姿势2：写：更新数据库然后删除缓存&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624113641146-1740039826.png&quot; alt=&quot;&quot; width=&quot;338&quot; height=&quot;340&quot;/&gt;&lt;/p&gt;
&lt;p&gt;注：为什么用删除而不是set来解决数据更新&lt;/p&gt;
&lt;p&gt;考虑到delete比set有更好的幂等性和&lt;/p&gt;

&lt;p&gt;问题1：存在stale sets（脏写）的可能&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624114214542-46791998.png&quot; alt=&quot;&quot; width=&quot;319&quot; height=&quot;332&quot;/&gt;&lt;/p&gt;
&lt;p&gt;webA  webB 是两个前端 同事操作一个缓存对象 MC 缓存对象对应的数据库内容是DB&lt;/p&gt;
&lt;p&gt;webA  操作数据库设置为DB_A&lt;/p&gt;
&lt;p&gt;webB  操作数据库设置为DB_B&lt;/p&gt;
&lt;p&gt;webB  操作缓存设置为MC_B&lt;/p&gt;
&lt;p&gt;webA  操作缓存设置为MC_A &lt;/p&gt;
&lt;p&gt;这是你会发现，DB的内容是DB_B MC的内容是MC_A  数据库缓存不一致了&lt;/p&gt;
&lt;p&gt;这个问题怎么解决，论文里面有写，但是我这边看应该就是开启memcache CAS的功能就解决了。&lt;/p&gt;

&lt;p&gt;问题2 存在 Thundering Herds（惊群效应）缓存雪崩&lt;/p&gt;
&lt;p&gt;通俗来说就是缓存雪崩，当某个热键失效的时候，所有缓存按照姿势1的策略都会回源，这就造成数据库压力瞬间极大，严重的可能压垮数据库。&lt;/p&gt;
&lt;p&gt;facebook给出的策略：&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;Clients given a choice &lt;/span&gt;&lt;span&gt;of using a slightly stale &lt;/span&gt;&lt;span&gt;value or waiting 就是要买使用过期的内容，要么等一会儿。&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;这篇博客也做了一些探讨 [http://www.php.cn/php-weizijiaocheng-89275.html]&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;/p&gt;
&lt;blockquote readability=&quot;15&quot;&gt;
&lt;h3&gt;白下说：如何避免&lt;/h3&gt;
&lt;p&gt;1：加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。（用ZK做分布式锁）这是一个限制数据库访问的应用层解决的通用方式。&lt;/p&gt;
&lt;p&gt;2：不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。&lt;/p&gt;
&lt;p&gt;3：做二级缓存，A1为原始缓存，A2为拷贝缓存，A1失效时，可以访问A2，A1缓存失效时间设置为短期，A2设置为长期（此点为补充)。多级缓存可以存在策略&lt;/p&gt;
&lt;p&gt;4:  对于热键进行打散处理比如一key_001 key_002来区分等。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;问题3：incast congestion  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624120835208-1441903204.png&quot; alt=&quot;&quot; width=&quot;395&quot; height=&quot;176&quot;/&gt;&lt;/p&gt;
&lt;p&gt;这个问题就是webserver一次性读取很多memcache的内容，同一时间返回把网口撑爆了或者产生丢包了。&lt;/p&gt;
&lt;p&gt;解决策略：facebook是引入类似TCP的滑动窗口的机制来解决的。笔者认为一些较好的memcahce的客户端应该有解决方案。&lt;/p&gt;

&lt;p&gt;问题4  scaling问题&lt;/p&gt;
&lt;p&gt; 以上对于小规模的场景没问题，但是如果规模扩大了，比如缓存集群多了，数据库也多了，那么给管理带来了问题，尤其是fb这个规模的缓存&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624121233979-1548856180.png&quot; alt=&quot;&quot; width=&quot;350&quot; height=&quot;378&quot;/&gt;&lt;/p&gt;

&lt;p&gt;解决方案：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624121425804-212019540.png&quot; alt=&quot;&quot; width=&quot;521&quot; height=&quot;247&quot;/&gt;&lt;/p&gt;

&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;Cached data must be invalidated after database updates&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;• Solution: Tail the mysql commit log and issue deletes basedon transactions that have been committed&lt;br/&gt;• Allows caches to be resynchronized in the event of a problem&lt;/p&gt;


&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624122247887-692062670.png&quot; alt=&quot;&quot; width=&quot;592&quot; height=&quot;369&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Facebook 内部使用率mcsqueal这个组件用来根据commitlog来失效缓存。&lt;/p&gt;
&lt;blockquote readability=&quot;10&quot;&gt;
&lt;p&gt;白下说：&lt;/p&gt;
&lt;p&gt;在网易也通过类似的方式对缓存进行同步，我们的组件叫做NDC，当然对外不开源了。其实就是订阅commitLog然后投放到kafka 有相关程序消费kafka日志然后同步缓存。&lt;/p&gt;
&lt;p&gt;开源的话阿里开源了otter组件，笔者YY可以通过otter的相关commitlog同步来实现相关需求。&lt;/p&gt;

&lt;/blockquote&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt;&lt;span&gt;跨中心同步&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;p1&quot;&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624122531453-1520914470.png&quot; alt=&quot;&quot; width=&quot;651&quot; height=&quot;295&quot;/&gt;&lt;/p&gt;
&lt;p&gt;既然有了基于mysql的commitlog的缓存同步，那么跨数据中心的同步也是同理只要设置个从库就行了。&lt;/p&gt;

&lt;p&gt;现在的问题是当webserver发生写操作的时候，需要去写master，失效本地Memcache&lt;/p&gt;
&lt;p&gt;但是如果此时另外有请求读取缓存，此时发现为空，然后从replicaDB中找到 然后set缓存救护出现问题，因为masterDB 因为时延问题还没有同步完数据&lt;/p&gt;

&lt;p&gt;解决方案：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624124741512-431878627.png&quot; alt=&quot;&quot; width=&quot;534&quot; height=&quot;361&quot;/&gt;&lt;/p&gt;
&lt;p&gt;增加一个flag变量 remote-marker 解决问题 如果有设置变量就从masterDB 读取而不是从replicaDB 读取&lt;/p&gt;

&lt;p&gt;facebook给出的最佳实践建议：&lt;/p&gt;

&lt;p&gt;(1) Separating cache and persistent storage systems allows us to independently scale them. 尽量拆分缓存和存储系统以便幂等的扩容&lt;/p&gt;
&lt;p&gt;&lt;em id=&quot;__mceDel&quot;&gt;&lt;em id=&quot;__mceDel&quot;&gt;(2) Features that improve monitoring, debugging and operational efficiency are as important as performance.  不能忽视 监控d ebug 操作便捷性&lt;br/&gt;(3) Managing stateful components is operationally more complex than stateless ones. As a result keeping logic in a stateless client helps iterate on features and minimize disruption. 有状态的很难维护，尽量让客户端无状态&lt;br/&gt;(4) The system must support gradual rollout and rollback of new features even if it leads to temporary heterogeneity of feature sets.  支持回滚&lt;br/&gt;(5) Simplicity is vital. KISS原则 keep it simple and stupid&lt;/em&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;其实facebook的mcrouter工具非常完美的贯穿了最佳实践的建议，&lt;strong&gt;&lt;span&gt;后续我会继续更新博文&lt;/span&gt;&lt;/strong&gt; 介绍一下mcrouter的使用&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;https://github.com/facebook/mcrouter&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;剧透一下：&lt;/p&gt;
&lt;p&gt;对于memcache的运维 我希望做到&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;需求1：主从高可用，缓存宕机不会造成穿透&lt;br/&gt;需求2：冷热集群平滑扩容，当人扩容新缓存节点或者替换缓存升级缓存停止缓存的时候&lt;br/&gt;需求3：动态加载配置，无需重启&lt;br/&gt;需求4：多级缓存，可以支持多级比如本地&lt;br/&gt;需求5：灵活的多集群调度，多集群流量调度，前缀调度等&lt;/p&gt;

&lt;p&gt;这些需求facebook开源的mcrouter都可以实现&lt;/p&gt;

&lt;p&gt;广告时间&lt;/p&gt;
&lt;p&gt;网易运维与账号中心正在招聘包含了应用运维、系统运维、数据库运维、运维开发相关岗位:&lt;/p&gt;
&lt;p&gt;有兴趣加入的伙伴请简历 hzluyang@corp.netease.com &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624125826224-1855708527.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/840443/201806/840443-20180624125938170-247163544.png&quot; alt=&quot;&quot; width=&quot;751&quot; height=&quot;1336&quot;/&gt;&lt;/p&gt;


&lt;p&gt;&lt;em id=&quot;__mceDel&quot;&gt; &lt;/em&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 24 Jun 2018 05:03:00 +0000</pubDate>
<dc:creator>白下</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/hzluyang/p/9220314.html</dc:identifier>
</item>
<item>
<title>iOS SQLite详解 - 国孩</title>
<link>http://www.cnblogs.com/guohai-stronger/p/9218175.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/guohai-stronger/p/9218175.html</guid>
<description>&lt;p&gt;这周比较忙，前几天都加班到11点左右，基本都是到家都是12点左右（稍稍的抱怨一下，免费加班，何为免费，就是任何补偿都没有，例如调休，加班薪，餐补等各项福利，是一点都没有呀）因为App要上线了！App上线，也可以抽出部分时间整理自己的东西啦，准备花一周时间讲述iOS数据存储方式。本篇主要是讲SQLite的使用和封装，读完大约10-15分钟。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;一、SQLite概念&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SQLite是轻量型关系型数据库（下面将拓展关系型数据库的概念）；&lt;span&gt;占用资源非常少&lt;/span&gt;；是无类型的数据库（意思是可以保存所有类型的数据）----B树为SQLite提供了O(logN)的查询，插入以及删除操作，同时提供了O(1)的对记录的遍历操作。&lt;/p&gt;
&lt;p&gt;拓展》》》》&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1.关系型数据库与非关系型数据库&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;关系型数据库是建立在关系型模型的数据库，关系型数据库是通过外键来建立表与表之间的关系，而非关系型数据库是以对象的形式存在数据库中（对象之间的关系是通过对象自身的属性来确定的）&lt;/p&gt;
&lt;p&gt;举一个例子：&lt;/p&gt;
&lt;p&gt;比如 有一个学生的数据：&lt;/p&gt;
&lt;p&gt;    姓名：张四，性别：男，学号：12345678，班级：大学一班&lt;/p&gt;
&lt;p&gt;　　一个班级的数据：&lt;/p&gt;
&lt;p&gt;    班级：大学一班，班主任：李四&lt;/p&gt;
&lt;p&gt;针对这个例子：关系型数据库，需要创建学生表和班级表来存储这两条数据，而且学生表中的班级存储应该是班级表的主键。对于非关系型数据库中，我们需要创建两个对象，一个是学生对象，一个是班级对象，用java表示如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Student {
    String id;
    String name;
    String sex;
    String number;
    String classid;
}
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Grade {
    String id;
    String name;
    String teacher;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;二、SQLite基本使用&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.建表命令：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;create table 表名 (字段名1 字段类型1，字段名2 字段类型2，以此类推....)；&lt;/p&gt;
&lt;p&gt;create table if not exists (字段名1 字段类型1, 字段名2 字段类型2,以此类推 …) ;&lt;/p&gt;
&lt;p&gt; （1）图如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1305302/201806/1305302-20180623205335348-1035213787.png&quot; alt=&quot;&quot; width=&quot;610&quot; height=&quot;313&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（2）代码例子如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
- (&lt;span&gt;void&lt;/span&gt;&lt;span&gt;)createTable{
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1.设计创建表的sql语句&lt;/span&gt;
  &lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *sql = &quot;CREATE TABLE IF NOT EXISTS t_Student(id integer PRIMARY KEY AUTOINCREMENT,name text NOT NULL ,score real DEFAULT 0,sex text DEFAULT '不明'); &quot;  
&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2.执行sql语句&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; ret =&lt;span&gt; sqlite3_exec(_db, sql, NULL, NULL, NULL);
   &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3.判断执行结果&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; (ret ==&lt;span&gt; SQLITE_OK) {
        NSLog(@&lt;/span&gt;&quot;创建表成功&quot;&lt;span&gt;);
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{    
        NSLog(@&lt;/span&gt;&quot;创建表失败&quot;&lt;span&gt;);
    }  
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;2.插入命令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;insert into 表名 (字段1, 字段2, 以此类推…) values (字段1的值, 字段2的值,以此类推 …) ;&lt;/p&gt;
&lt;p&gt;（1）图如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1305302/201806/1305302-20180623210341790-1810146176.png&quot; alt=&quot;&quot; width=&quot;611&quot; height=&quot;290&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（2）代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
- (&lt;span&gt;void&lt;/span&gt;&lt;span&gt;)insertData{
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1.创建插入数据的sql语句
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;===========插入单条数据=========&lt;/span&gt;
    &lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *sql = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;INSERT INTO t_Student(name,score,sex)VALUES ('小明',65,'男');&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;==========同时插入多条数据=======&lt;/span&gt;
    NSMutableString * mstr = [NSMutableString &lt;span&gt;string&lt;/span&gt;&lt;span&gt;];
  &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; &lt;span&gt;50&lt;/span&gt;; i++&lt;span&gt;) {
        NSString &lt;/span&gt;* name = [NSString stringWithFormat:&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;name%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, i];
        CGFloat score &lt;/span&gt;= arc4random() % &lt;span&gt;101&lt;/span&gt; * &lt;span&gt;1.0&lt;/span&gt;&lt;span&gt;;
        NSString &lt;/span&gt;* sex = arc4random() % &lt;span&gt;2&lt;/span&gt; == &lt;span&gt;0&lt;/span&gt; ? &lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;男&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : &lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;女&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
        NSString &lt;/span&gt;* tsql = [NSString stringWithFormat:&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;INSERT INTO t_Student         (name,score,sex) VALUES ('%@',%f,'%@');&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, name, score, sex];
        [mstr appendString:tsql];
    }  

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;将OC字符串转换成C语言的字符串&lt;/span&gt;
    sql =&lt;span&gt; mstr.UTF8String;

      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2.执行sql语句&lt;/span&gt;
   &lt;span&gt;int&lt;/span&gt; ret =&lt;span&gt; sqlite3_exec(_db, sql, NULL, NULL, NULL);
   &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3.判断执行结果&lt;/span&gt;
   &lt;span&gt;if&lt;/span&gt; (ret==&lt;span&gt;SQLITE_OK) {
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;插入成功&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;插入失败&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }
    

}   &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;3.更新命令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;update 表名 set 字段1 = 字段1的新值, 字段2 = 字段2的新值,以此类推 … ;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1305302/201806/1305302-20180623211412375-695193872.png&quot; alt=&quot;&quot; width=&quot;616&quot; height=&quot;303&quot;/&gt;&lt;/p&gt;

&lt;p&gt;4.删除命令&lt;/p&gt;
&lt;p&gt;delete from 表名；注：删除的是表中所有记录&lt;/p&gt;
&lt;p&gt;拓展：可以附加一些额外条件删除&lt;/p&gt;
&lt;p&gt;条件语句的操作：可以选择性的删除&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;where&lt;/span&gt; 字段 = 一个值 ; &lt;span&gt;if&lt;/span&gt;(字段==某个值) &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 不能用两个 =&lt;/span&gt;
&lt;span&gt;where&lt;/span&gt; 字段 &lt;span&gt;is&lt;/span&gt; 一个值 ; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; is 相当于 =&lt;/span&gt;
&lt;span&gt;where&lt;/span&gt; 字段 &lt;span&gt;is&lt;/span&gt; not一个值 ; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; is not 相当于 !=&lt;/span&gt;
&lt;span&gt;where&lt;/span&gt; 字段 &amp;gt;&lt;span&gt; 一个值 ;
&lt;/span&gt;&lt;span&gt;where&lt;/span&gt; 字段1 = 一个值 and 字段2 &amp;gt; 一个值 ; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; and相当于C语言中的 &amp;amp;&amp;amp;&lt;/span&gt;
&lt;span&gt;where&lt;/span&gt; 字段1 = 一个值 or 字段2 = 一个值 ; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; or 相当于C语言中的 ||&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;（1）图如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1305302/201806/1305302-20180623212113147-1629622204.png&quot; alt=&quot;&quot; width=&quot;454&quot; height=&quot;240&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（2）代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
- (&lt;span&gt;void&lt;/span&gt;&lt;span&gt;)deleteData{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;创建删除数据的sql语句&lt;/span&gt;
    &lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *sql = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;DELETE FROM t_Student WHERE score &amp;lt; 10;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;执行sql语句&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; ret =&lt;span&gt; sqlite3_exec(_db, sql, NULL, NULL, NULL);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;判断执行结果&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; (ret ==&lt;span&gt; SQLITE_OK) {
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;删除成功&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;删除失败&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;5.查询数据&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SELECT 字段1,字段2 FROM 表明;&lt;/p&gt;
&lt;p&gt;（1）图如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1305302/201806/1305302-20180623212831388-1045602922.png&quot; alt=&quot;&quot; width=&quot;618&quot; height=&quot;348&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（2）代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
- (&lt;span&gt;void&lt;/span&gt;&lt;span&gt;)selectData{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;执行数据库语句&lt;/span&gt;
    &lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *sql = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;SELECT name,score FROM t_Student;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;结果集(用来收集结果)&lt;/span&gt;
    sqlite3_stmt *&lt;span&gt; stmt;
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; ret = sqlite3_prepare_v2(_db, sql, -&lt;span&gt;1&lt;/span&gt;, &amp;amp;&lt;span&gt;stmt, NULL);
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (ret ==&lt;span&gt; SQLITE_OK) {
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;查询成功&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;遍历结果集拿到查询到的数据
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;sqlite3_step获取结果集中的数据&lt;/span&gt;
        &lt;span&gt;while&lt;/span&gt; (sqlite3_step(stmt) ==&lt;span&gt; SQLITE_ROW) {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;参数1:结果集
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;参数2:列数&lt;/span&gt;
            &lt;span&gt;const&lt;/span&gt; unsigned &lt;span&gt;char&lt;/span&gt; * name = sqlite3_column_text(stmt, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;double&lt;/span&gt; score = sqlite3_column_double(stmt, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
            NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;%s %.2lf&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, name, score);
        }
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;查询失败&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;三、SQLite在项目中的使用&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对于SQLite在项目中，定义一个单例，提供一个类方法可以供全局使用，在编译时初始化这个类，然后一直保存在内存中，整个程序就会保持就有一个实例，在App退出时，系统也会自动释放这个内存。&lt;/p&gt;
&lt;p&gt;因为我们定义单例对象针对SQLite&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1、新建SQLiteManager &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;.h文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1305302/201806/1305302-20180624110631287-1906944022.png&quot; alt=&quot;&quot; width=&quot;651&quot; height=&quot;300&quot;/&gt; &lt;/p&gt;
&lt;p&gt;.m实现&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@interface&lt;/span&gt;&lt;span&gt; SQLiteManager()
@property (nonatomic,assign) sqlite3 &lt;/span&gt;*&lt;span&gt;db;

&lt;/span&gt;&lt;span&gt;@end&lt;/span&gt;

&lt;span&gt;@implementation&lt;/span&gt;&lt;span&gt; SQLiteManager
&lt;/span&gt;&lt;span&gt;static&lt;/span&gt; SQLiteManager *&lt;span&gt;instance;
&lt;/span&gt;+&lt;span&gt; (instancetype)shareInstance{
    &lt;/span&gt;&lt;span&gt;static&lt;/span&gt;&lt;span&gt; dispatch_once_t onceToken;
    dispatch_once(&lt;/span&gt;&amp;amp;onceToken, ^&lt;span&gt;{
        instance &lt;/span&gt;=&lt;span&gt; [[self alloc] init];
    });
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; instance;
}

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;打开数据库，返回是布尔值&lt;/span&gt;
-&lt;span&gt; (BOOL)openDB{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;app内数据库文件存放路径-一般存放在沙盒中&lt;/span&gt;
    NSString *documentPath =&lt;span&gt; [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject];
    NSString &lt;/span&gt;*DBPath = [documentPath stringByAppendingPathComponent:&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;appDB.sqlite&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;];
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (sqlite3_open(DBPath.UTF8String, &amp;amp;_db) !=&lt;span&gt; SQLITE_OK) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;数据库打开失败&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; NO;
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;打开成功创建表
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;用户 表&lt;/span&gt;
        NSString *creatUserTable = &lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;CREATE TABLE IF NOT EXISTS 't_User' ( 'ID' INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,'name' TEXT,'age' INTEGER,'icon' TEXT);&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;车 表&lt;/span&gt;
        NSString *creatCarTable = &lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;CREATE TABLE IF NOT EXISTS 't_Car' ('ID' INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,'type' TEXT,'output' REAL,'master' TEXT)&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;项目中一般不会只有一个表&lt;/span&gt;
        NSArray *SQL_ARR =&lt;span&gt; [NSArray arrayWithObjects:creatUserTable,creatCarTable, nil];
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; [self creatTableExecSQL:SQL_ARR];
    }
}

&lt;/span&gt;-(BOOL)creatTableExecSQL:(NSArray *&lt;span&gt;)SQL_ARR{
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (NSString *SQL &lt;span&gt;in&lt;/span&gt;&lt;span&gt; SQL_ARR) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;参数一:数据库对象  参数二:需要执行的SQL语句  其余参数不需要处理&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;[self execuSQL:SQL]) {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; NO;
        }
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; YES;
}

&lt;/span&gt;&lt;span&gt;#pragma&lt;/span&gt; 执行SQL语句
- (BOOL)execuSQL:(NSString *&lt;span&gt;)SQL{
    &lt;/span&gt;&lt;span&gt;char&lt;/span&gt; *&lt;span&gt;error;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (sqlite3_exec(self.db, SQL.UTF8String, nil, nil, &amp;amp;error) ==&lt;span&gt; SQLITE_OK) {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; YES;
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;SQLiteManager执行SQL语句出错:%s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,error);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; NO;
    }
}

&lt;/span&gt;&lt;span&gt;#pragma&lt;/span&gt; mark - 查询数据库中数据
-(NSArray *)querySQL:(NSString *&lt;span&gt;)SQL{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;准备查询
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 1&amp;gt; 参数一:数据库对象
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 2&amp;gt; 参数二:查询语句
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 3&amp;gt; 参数三:查询语句的长度:-1
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 4&amp;gt; 参数四:句柄(游标对象)&lt;/span&gt;
&lt;span&gt;    
    sqlite3_stmt &lt;/span&gt;*stmt =&lt;span&gt; nil;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (sqlite3_prepare_v2(self.db, SQL.UTF8String, -&lt;span&gt;1&lt;/span&gt;, &amp;amp;stmt, nil) !=&lt;span&gt; SQLITE_OK) {
        NSLog(&lt;/span&gt;&lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;准备查询失败!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; NULL;
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;准备成功,开始查询数据
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;定义一个存放数据字典的可变数组&lt;/span&gt;
    NSMutableArray *dictArrM =&lt;span&gt; [[NSMutableArray alloc] init];
    &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (sqlite3_step(stmt) ==&lt;span&gt; SQLITE_ROW) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;一共获取表中所有列数(字段数)&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; columnCount =&lt;span&gt; sqlite3_column_count(stmt);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;定义存放字段数据的字典&lt;/span&gt;
        NSMutableDictionary *dict =&lt;span&gt; [[NSMutableDictionary alloc] init];
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; columnCount; i++&lt;span&gt;) {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 取出i位置列的字段名,作为字典的键key&lt;/span&gt;
            &lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *cKey =&lt;span&gt; sqlite3_column_name(stmt, i);
            NSString &lt;/span&gt;*key =&lt;span&gt; [NSString stringWithUTF8String:cKey];
            
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;取出i位置存储的值,作为字典的值value&lt;/span&gt;
            &lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *cValue = (&lt;span&gt;const&lt;/span&gt; &lt;span&gt;char&lt;/span&gt; *&lt;span&gt;)sqlite3_column_text(stmt, i);
            NSString &lt;/span&gt;*value =&lt;span&gt; [NSString stringWithUTF8String:cValue];
            
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;将此行数据 中此字段中key和value包装成 字典&lt;/span&gt;
&lt;span&gt;            [dict setObject:value forKey:key];
        }
        [dictArrM addObject:dict];
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; dictArrM;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面是SQLite的工具类封装。附带github地址：&lt;a href=&quot;https://github.com/zxy1829760/SQLite-.git&quot; target=&quot;_blank&quot;&gt;https://github.com/zxy1829760/SQLite-.git&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上面讲述SQLite（包含数据库SQL语句的基本操作），大家可以将git的工具类直接拖入项目中（如果直接想对SQLite封装）--当然还有更强大的FMDB（封装更好-目前用的也比较多）。&lt;/p&gt;
&lt;p&gt;文章一开始说SQLite占用资源非常少（红色标注），下一篇将讲述SQLite为什么占用资源非常少？&lt;/p&gt;
</description>
<pubDate>Sun, 24 Jun 2018 03:18:00 +0000</pubDate>
<dc:creator>国孩</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/guohai-stronger/p/9218175.html</dc:identifier>
</item>
<item>
<title>CORDIC算法（1）：圆周旋转模式下计算三角函数和模值 - 信号君</title>
<link>http://www.cnblogs.com/ncdxlxk/p/9219872.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/ncdxlxk/p/9219872.html</guid>
<description>&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624102348646-1575163789.png&quot; alt=&quot;&quot; width=&quot;316&quot; height=&quot;301&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;CORDIC（Coordinate Rotation Digital Computer）坐标旋转数字计算机，是数学与计算机技术交叉产生的一种机器算法，用于解决计算机的数学计算问题。发展到现在，CORDIC算法及其扩展算法大致有三种计算模式：圆周旋转模式、线性旋转模式和双曲线旋转模式，分别用来实现不同的数学运算。                                              &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;本文介绍圆周旋转模式下的CORDIC算法原理及实现过程，另两种模式将分期介绍。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;简单来讲，CORDIC利用近似逼近的思想，将计算机中三角函数、开根号、求对数等复杂运算，转化为简单的加减和移位操作。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;对于实际只会识别0和1的计算机来说，加减和移位是它能轻松实现的操作，因此利用CORDIC算法将大大提升计算机对复杂运算的计算效率。目前，尽管计算机的运行速度已经足够使得大多数开发者不用太多考虑计算效率的问题，但在一些实时数据流比较大的场合（如通信、多媒体处理等），CORDIC算法依然是实现高速运算的关键。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;类似CORDIC实现的数学思想早在1624年就由Henry Briggs提出并发表，但直到1956年，CORDIC算法才真正被美国工程师Jack E.Volder发现并运用，当时他正在寻找提高计算器计算精度和实时性的算法。直到1959年，Volder的算法才为公众所知，并在计算器上大行其道。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;算法描述&lt;/strong&gt;       &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span title=&quot;&quot; data-original-title=&quot;&quot;&gt;1. 数学背景&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624102755123-800262023.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如图，XY平面中一点(x1,y1)经圆周旋转θ角度，得到点(x2,y2)。经简单的三角函数关系，可得到：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624102811871-856617064.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;通过提出因数cosθ，可得：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624102832572-139012982.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如果不考虑cosθ，得到“伪旋转”方程：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624102853613-674040584.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;伪旋转仅实现了正确的角度旋转，但向量模值变为原来的1/cosθ。&lt;/span&gt;&lt;span&gt;&lt;img class=&quot;img_loading&quot; src=&quot;data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==&quot; alt=&quot;&quot; data-ratio=&quot;0.20229007633587787&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Bb5XxBw8KNUalcg6ukZicCGAnb0r66kXRGPMT8a0UeBJg1JycpBvibia6KQW3PKMibW2VONria0w4Mhb8by9n0Oic9jQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;524&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span title=&quot;&quot; data-original-title=&quot;&quot;&gt;2. CORDIC方法&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;若使得tanθ = 2^(-i)，i为自然数，则上式变为：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624103004969-1639537341.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;注意!上式已经仅剩加减和移位运算。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如果我们把所有tanθi = 2^(-i)对应的角度和正切值制成一张表，如下所示：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img class=&quot;img_loading&quot; src=&quot;data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==&quot; alt=&quot;&quot; data-ratio=&quot;0.635678391959799&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Bb5XxBw8KNUalcg6ukZicCGAnb0r66kXR0vEqOcb2zctq6PyFZH8WAr8PLEWHlzetfxIrb1RD7nFiaIu5dru9jfQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;398&quot;/&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624103027334-1199144212.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; ……&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;可以确定的是，任意旋转角度θ，都可以由上表中的大小不同θi进行多次旋转得到。&lt;/span&gt;CORDIC正是利用这一点，将θ角度的旋转分解为从大到小、逐次逼近真实旋转角度的一组旋转，而这些旋转的实现又都可以由加减和移位运算来完成。θi可以预先制成表格，供计算机查找使用。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;算法&lt;/strong&gt;&lt;strong&gt;实现&lt;/strong&gt;      &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span title=&quot;&quot; data-original-title=&quot;&quot;&gt;1. 已知坐标(x,y)，求其向量对应的相角θ（反正切）和模值&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;思想: &lt;/span&gt;把原向量逐次向X正轴进行伪旋转逼近，整个过程的累计旋转角度即为θ，而旋转后的x坐标补偿模值增益K后即为原向量模值。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;每次迭代的方程为：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624103140599-1661110906.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;模值总增益K为：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624103155090-1436398437.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;其中d决定旋转方向为逆时针还是顺时针，z为角度累加值。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;注意！查找表中所有θi的总和约为99度，因此能实现计算的角度在-99~99度之间。实际算法实现时，我们可预先判断坐标象限，人为将其转化为第一象限内的计算，并在事后补偿为真实值。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如图：(x,y)=(3,sqrt(3))，迭代深度=16，CORDIC算法实现过程&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img class=&quot;img_loading __bg_gif&quot; src=&quot;data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==&quot; alt=&quot;&quot; data-ratio=&quot;0.75&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/Bb5XxBw8KNUalcg6ukZicCGAnb0r66kXRPlZ9Ih9EcNszibr4npLzjNDILdzMibY67JULBnonw4Tf78fs1ugxryRw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;672&quot; data-order=&quot;0&quot;/&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624103319176-155391536.gif&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span&gt;matlab代码如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
%% ***********************************************************************************  
%&lt;span&gt;     已知坐标，用cordic算法计算相角和幅值。基本公式如下：  
&lt;/span&gt;%     x(k+&lt;span&gt;1&lt;/span&gt;) = x(k) - d(k)*y(k)*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k)  
&lt;/span&gt;%     y(k+&lt;span&gt;1&lt;/span&gt;) = y(k) + d(k)*x(k)*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k)  
&lt;/span&gt;%     z(k) = z(k) - d(k)*actan(&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k))  
&lt;/span&gt;%% ***********************************************************************************&lt;span&gt;  
  
clear;close all;clc;  
&lt;/span&gt;% 初始化----------------------------------------&lt;span&gt;  
N &lt;/span&gt;= &lt;span&gt;16&lt;/span&gt;;  %&lt;span&gt;迭代次数  
tan_table &lt;/span&gt;= &lt;span&gt;2&lt;/span&gt;.^-(&lt;span&gt;0&lt;/span&gt; : N-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);  
angle_LUT &lt;/span&gt;=&lt;span&gt; atan(tan_table);  
  
K &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
&lt;/span&gt;&lt;span&gt;for&lt;/span&gt; k = &lt;span&gt;0&lt;/span&gt; : N-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;  
    K &lt;/span&gt;= K*(&lt;span&gt;1&lt;/span&gt;/sqrt(&lt;span&gt;1&lt;/span&gt; + &lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;2&lt;/span&gt;*&lt;span&gt;k)));  
end  
  
x &lt;/span&gt;= &lt;span&gt;3&lt;/span&gt;&lt;span&gt;;  
y &lt;/span&gt;= sqrt(&lt;span&gt;3&lt;/span&gt;&lt;span&gt;);  
angle_accumulate &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;  
  
&lt;/span&gt;% cordic算法计算-------------------------------  
&lt;span&gt;if&lt;/span&gt; (x==&lt;span&gt;0&lt;/span&gt; &amp;amp;&amp;amp; y==&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)   
    radian_out &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;  
    amplitude_out &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;  
&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;  %&lt;span&gt; 先做象限判断，得到相位补偿值  
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (x &amp;gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)  
        phase_shift &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;  
    elseif (y &lt;/span&gt;&amp;lt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)  
        phase_shift &lt;/span&gt;= -&lt;span&gt;pi;  
    &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;  
        phase_shift &lt;/span&gt;=&lt;span&gt; pi;  
    end  
    
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; k = &lt;span&gt;0&lt;/span&gt; : N-&lt;span&gt;1&lt;/span&gt;   %&lt;span&gt; 迭代开始  
        x_temp &lt;/span&gt;=&lt;span&gt; x;  
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (y &amp;lt; &lt;span&gt;0&lt;/span&gt;)  % d(k)=&lt;span&gt;1&lt;/span&gt;&lt;span&gt;，逆时针旋转  
            x &lt;/span&gt;= x_temp - y*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            y &lt;/span&gt;= y + x_temp*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            angle_accumulate &lt;/span&gt;= angle_accumulate - angle_LUT(k+&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);  
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;          % d(k)=-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;，顺时针旋转  
            x &lt;/span&gt;= x_temp + y*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            y &lt;/span&gt;= y - x_temp*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            angle_accumulate &lt;/span&gt;= angle_accumulate + angle_LUT(k+&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);  
        end       
        radian_out &lt;/span&gt;= angle_accumulate + phase_shift; %&lt;span&gt;弧度输出  
    end  
      
    amplitude_out &lt;/span&gt;= x*K;  %&lt;span&gt;幅值输出  
end  
      
angle_out &lt;/span&gt;= radian_out*&lt;span&gt;180&lt;/span&gt;/pi;  %相角输出
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span title=&quot;&quot; data-original-title=&quot;&quot;&gt;2. 已知角度θ，求正弦sinθ和余弦cosθ&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;思想: &lt;/span&gt;若向量模值为1，则其x坐标就是余弦值，y坐标就是正弦值。利用这一点，从(K,0)处迭代旋转至θ处的单位矢量即可。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;迭代方程及K的计算同第一小节。同时也要注意预先对象限的判断和补偿。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如图：θ=60度，迭代深度=16，CORDIC算法实现过程&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img class=&quot;img_loading __bg_gif&quot; src=&quot;data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==&quot; alt=&quot;&quot; data-ratio=&quot;0.75&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/Bb5XxBw8KNUalcg6ukZicCGAnb0r66kXRWTNKHjPfMYERl42saOVicJtrxr15qY244IQRHsy4osaiaDXk6JAegPIA/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;672&quot; data-order=&quot;1&quot;/&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624103347654-771630831.gif&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;matlab代码如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
%% ***********************************************************************************  
%&lt;span&gt;     已知相角theta，计算其正弦和余弦值。基本公式如下：  
&lt;/span&gt;%     x(k+&lt;span&gt;1&lt;/span&gt;) = x(k) - d(k)*y(k)*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k)  
&lt;/span&gt;%     y(k+&lt;span&gt;1&lt;/span&gt;) = y(k) + d(k)*x(k)*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k)  
&lt;/span&gt;%     z(k) = z(k) - d(k)*actan(&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k))  
&lt;/span&gt;%% ***********************************************************************************&lt;span&gt;  
clear;close all;clc;  
  
&lt;/span&gt;% 初始化----------------------------------------&lt;span&gt;  
N &lt;/span&gt;= &lt;span&gt;16&lt;/span&gt;;  %&lt;span&gt;迭代次数  
tan_table &lt;/span&gt;= &lt;span&gt;2&lt;/span&gt;.^-(&lt;span&gt;0&lt;/span&gt; : N-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);  
angle_LUT &lt;/span&gt;=&lt;span&gt; atan(tan_table);  
  
K &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
&lt;/span&gt;&lt;span&gt;for&lt;/span&gt; k = &lt;span&gt;0&lt;/span&gt; : N-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;  
    K &lt;/span&gt;= K*(&lt;span&gt;1&lt;/span&gt;/sqrt(&lt;span&gt;1&lt;/span&gt; + &lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;2&lt;/span&gt;*&lt;span&gt;k)));  
end  
  
theta &lt;/span&gt;= -&lt;span&gt;90&lt;/span&gt;&lt;span&gt;;  
x &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
y &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;  
phase_accumulate &lt;/span&gt;= theta/&lt;span&gt;180&lt;/span&gt;*pi;  %&lt;span&gt;转化为弧度  
  
&lt;/span&gt;% cordic算法计算-------------------------------  
&lt;span&gt;if&lt;/span&gt; (phase_accumulate &amp;gt; pi/&lt;span&gt;2&lt;/span&gt;)  %&lt;span&gt; 先做象限判断，得到相位补偿值  
    phase_accumulate &lt;/span&gt;= phase_accumulate -&lt;span&gt; pi;  
    sign_x &lt;/span&gt;= -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
    sign_y &lt;/span&gt;= -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
elseif (phase_accumulate &lt;/span&gt;&amp;lt; -pi/&lt;span&gt;2&lt;/span&gt;&lt;span&gt;)  
    phase_accumulate &lt;/span&gt;= phase_accumulate +&lt;span&gt; pi;  
    sign_x &lt;/span&gt;= -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
    sign_y &lt;/span&gt;= -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;  
    sign_x &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
    sign_y &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;  
end  
       
 &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; k = &lt;span&gt;0&lt;/span&gt; : N-&lt;span&gt;1&lt;/span&gt;   %&lt;span&gt; 迭代开始  
        x_temp &lt;/span&gt;=&lt;span&gt; x;  
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (phase_accumulate &amp;gt; &lt;span&gt;0&lt;/span&gt;)  % d(k)=&lt;span&gt;1&lt;/span&gt;&lt;span&gt;，逆时针旋转  
            x &lt;/span&gt;= x_temp - y*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            y &lt;/span&gt;= y + x_temp*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            phase_accumulate &lt;/span&gt;= phase_accumulate - angle_LUT(k+&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);  
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;                                     % d(k)=-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;，顺时针旋转  
            x &lt;/span&gt;= x_temp + y*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            y &lt;/span&gt;= y - x_temp*&lt;span&gt;2&lt;/span&gt;^(-&lt;span&gt;k);  
            phase_accumulate &lt;/span&gt;= phase_accumulate + angle_LUT(k+&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);  
        end  
end  
      
cos_out &lt;/span&gt;= sign_x*x*K;  %&lt;span&gt;余弦输出  
sin_out &lt;/span&gt;= sign_y*y*K;   %正弦输出
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;参考文献/资料&lt;/strong&gt;    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【1】https://en.wikipedia.org/wiki/CORDIC&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【2】Xilinx CORDIC算法(非常经典)——百度文库&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【3】ANDRAKA R. A Survey of CORDIC Algorithms for FPGA Based Computers[C] ，1998&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;·END·&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;想进一步跟踪本博客动态，欢迎关注我的个人微信订阅号：&lt;strong&gt;&lt;span&gt;信号君&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong data-brushtype=&quot;text&quot;&gt;信号君：寻求简单之道&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;技术成长 | 读书笔记 | 认知升级&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/746315/201806/746315-20180624104439302-493786623.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;扫描二维码关注信号君&lt;/span&gt;&lt;/p&gt;


</description>
<pubDate>Sun, 24 Jun 2018 03:01:00 +0000</pubDate>
<dc:creator>信号君</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/ncdxlxk/p/9219872.html</dc:identifier>
</item>
<item>
<title>Python3 与 C# 面向对象之～异常相关 - 鲲逸鹏</title>
<link>http://www.cnblogs.com/dotnetcrazy/p/9219751.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dotnetcrazy/p/9219751.html</guid>
<description>&lt;p&gt;周末多码文，昨天晚上一篇，今天再来一篇：&lt;/p&gt;
&lt;p&gt;在线编程：&lt;a href=&quot;https://mybinder.org/v2/gh/lotapp/BaseCode/master&quot; target=&quot;_blank&quot;&gt;https://mybinder.org/v2/gh/lotapp/BaseCode/master&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em id=&quot;__mceDel&quot;&gt;在线预览：&lt;a href=&quot;http://github.lesschina.com/python/base/oop/3.%E5%BC%82%E5%B8%B8%E7%9B%B8%E5%85%B3.html&quot; target=&quot;_blank&quot;&gt;http://github.lesschina.com/python/base/oop/3.异常相关.html&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;代码裤子：&lt;a href=&quot;https://github.com/lotapp/BaseCode/tree/master/python/2.OOP/4.Exception&quot; target=&quot;_blank&quot;&gt;https://github.com/lotapp/BaseCode/tree/master/python/2.OOP/4.Exception&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;6.340490797546&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;32.19018404908&quot;&gt;
&lt;h2 id=&quot;1.异常&quot;&gt;1.异常&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.异常&quot;&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id=&quot;1.1-try...except&quot;&gt;1.1 try...except&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.1-try...except&quot;&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;又到了开新课的时候了，小明同学这次提前预习了知识，乘着老师还没来就在黑板上写下了这段Code：&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [1]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;6.5&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# ZeroDivisionError: division by zero&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ZeroDivisionError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot;&gt;
&lt;pre&gt;
division by zero
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;7.4498327759197&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;34.765886287625&quot;&gt;
&lt;h3 id=&quot;1.2-try...except...else...finally&quot;&gt;1.2 try...except...else...finally&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.2-try...except...else...finally&quot;&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;小潘同学刚进来就看见了，自语道：“&lt;code&gt;try...except&lt;/code&gt;捕获异常谁不会？就会这么屁点东西还好意思秀，切～ 我给你把 &lt;strong&gt;格式&lt;/strong&gt;补全”&lt;/p&gt;
&lt;p&gt;于是乘着小明上厕所的时候，擦掉小明的Code，自己写了一段高大上的Code：&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [2]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;8&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;11&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;c1&quot;&gt;# 异常捕获全格式&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ZeroDivisionError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;except:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;else：没有异常就奖励100块～&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;finally：小明是傻子～&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1/0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;print('小明啊小明你调坑里了～')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot; readability=&quot;6.5&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
except: division by zero
finally：小明是傻子～
----------
小明啊小明你调坑里了～
else：没有异常就奖励100块～
finally：小明是傻子～
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;11.966386554622&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;43.87675070028&quot;&gt;
&lt;p&gt;这时候小明和老师一起进来了，同学们隐约间都听到小明的自夸声：“老师，我可好了，提前预习并且还写了个demo在黑板上呢～”&lt;/p&gt;
&lt;p&gt;老师一进门看着黑板就笑了，同学们也笑成一片。小明心想，咦～难道我写错了？定眼一看黑板，气呼呼的回座位了&lt;/p&gt;
&lt;p&gt;&lt;code&gt;else&lt;/code&gt;可以不写，不过我们 &lt;strong&gt;基本上还是会写的，毕竟可以知道是真的没有错误，而不是屏蔽了错误&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;1.3-多个异常处理&quot;&gt;1.3 多个异常处理&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.3-多个异常处理&quot;&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;老师很欣慰，觉得这个班真有意思，大家学习空前热情，为了照顾小明，老师反问道：“有谁知道 &lt;strong&gt;多个异常怎么处理&lt;/strong&gt;？”&lt;/p&gt;
&lt;p&gt;小明飞快的举手并把黑板上内容擦完，写下了如下代码：&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [3]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;c1&quot;&gt;# 多个异常捕获&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xiaopan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# NameError: name 'xiaopan' is not defined&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# ZeroDivisionError: division by zero&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;NameError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ZeroDivisionError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot; readability=&quot;6&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
name 'xiaopan' is not defined
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;13.967779056387&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;47.889528193326&quot;&gt;
&lt;p&gt;老师问了小明一声，有几个输出？&lt;/p&gt;
&lt;p&gt;小明骄傲的说道：“两个，我写了两个异常处理，当然都执行了”&lt;/p&gt;
&lt;p&gt;同学们又笑了，小潘调侃的说了句：“一看就知道去年C#没好好学，这不都一样嘛，&lt;strong&gt;遇到异常下面代码还执行吗&lt;/strong&gt;？用脑子好好想想”&lt;/p&gt;
&lt;p&gt;当我们认为某些代码可能会出错时，就可以用&lt;code&gt;try&lt;/code&gt;来运行这段代码，如果执行出错，则后续代码不会继续执行，而是直接跳转至&lt;code&gt;except&lt;/code&gt;语句块，执行完&lt;code&gt;except&lt;/code&gt;后，如果有&lt;code&gt;finally&lt;/code&gt;语句块，则执行finally语句块&lt;/p&gt;
&lt;p&gt;小明又尴尬了。。。&lt;/p&gt;
&lt;h3 id=&quot;1.4-多异常简写&quot;&gt;1.4 多异常简写&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.4-多异常简写&quot;&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;老师再次帮小明圆了个场：“已经很不简单了，就是最后小得意的时候口误了，那小明同学你知道Python里面多异常有个便捷写法吗？”&lt;/p&gt;
&lt;p&gt;小明赶紧拿起粉笔刷刷刷的写完，然后说道：“&lt;strong&gt;of course&lt;/strong&gt;”&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [4]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;7.5&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;10&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;c1&quot;&gt;# 多个异常捕获的简写(注意哦，是元组哦)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xiaopan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# NameError: name 'xiaopan' is not defined&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# ZeroDivisionError: division by zero&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ne&quot;&gt;NameError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ZeroDivisionError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot; readability=&quot;6&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
name 'xiaopan' is not defined
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;13.5&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;47&quot;&gt;
&lt;p&gt;老师赶紧夸了夸小明，心想，哎呦喂终于把这难缠的家伙弄回座位了。&lt;/p&gt;
&lt;p&gt;小明走前还不忘说一句：“简写的时候注意格式哦，是 &lt;strong&gt;元组&lt;/strong&gt; 不是逗号分隔”&lt;/p&gt;
&lt;p&gt;老师这堂课很轻松，大家都预习了而且内容也比较简单。&lt;/p&gt;
&lt;p&gt;接着以提问的方式问道：“小潘同学，你知道异常的基类是什么吗？如果要捕获所有异常该怎么做呢？”&lt;/p&gt;
&lt;p&gt;小潘站起来说道：“是&lt;code&gt;BaseException&lt;/code&gt;”&lt;/p&gt;
&lt;p&gt;老师扩充道：“所有的错误类型都继承自&lt;code&gt;BaseException&lt;/code&gt;，所以在使用&lt;code&gt;except&lt;/code&gt;时需要注意的是，它不但捕获该类型的错误，还把其子类也一起捕获了”&lt;/p&gt;
&lt;p&gt;所以一般在捕获异常的时候 &lt;strong&gt;把子类异常放在前面，父类放在后面&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;看如下代码：&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [5]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# ZeroDivisionError: division by zero&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;BaseException&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;base:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ZeroDivisionError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot;&gt;
&lt;pre&gt;
base: division by zero
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;7.1470588235294&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;31.110726643599&quot;&gt;
&lt;p&gt;如果把父类放第一个，那么&lt;code&gt;ZeroDivisionError&lt;/code&gt;永远也不会被执行了，其实你如果装了 &lt;strong&gt;代码规范提示&lt;/strong&gt;插件会提示你的&lt;/p&gt;
&lt;p&gt;可以参考我之前写的 &lt;a href=&quot;https://www.cnblogs.com/dotnetcrazy/p/9095793.html&quot; target=&quot;_blank&quot;&gt;vscode设置python3调试环境的扩充部分&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;来个通用异常捕获的简写（官方不推荐使用简写）：&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [6]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;6.5&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;c1&quot;&gt;# 直接except就行了&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;屏蔽错误&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot;&gt;
&lt;pre&gt;
屏蔽错误
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;10.230308219178&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;39.946917808219&quot;&gt;
&lt;p&gt;老师继续讲到，我们来看一个场景，现在很多在线编辑器，你在他们那些编辑框里写下了代码也是有异常抛出的，这是怎么处理的呢？&lt;/p&gt;
&lt;p&gt;微软有开源代码编辑器比较受欢迎（VSCode的一部分）：&lt;a href=&quot;https://microsoft.github.io/monaco-editor&quot; target=&quot;_blank&quot;&gt;monaco-editor&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;提示一下，如果真的要做在线编辑器，记得考虑一下&lt;code&gt;fork炸弹&lt;/code&gt;，这个其实也是很老的东西了，程序员基本上都应该接触过了&lt;/p&gt;
&lt;h3 id=&quot;1.5-抛出异常&quot;&gt;1.5 抛出异常&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.5-抛出异常&quot;&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;我们继续，像C#是用&lt;code&gt;thorw&lt;/code&gt;抛出异常，那Python怎么 &lt;code&gt;捕获异常后再抛出&lt;/code&gt; 呢？怎么&lt;code&gt;自定义异常&lt;/code&gt; 呢？&lt;/p&gt;
&lt;p&gt;继续往下看：&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [7]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;c1&quot;&gt;# 捕获异常后再丢出，eg：在线运行的用户Code&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# ZeroDivisionError: division by zero&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ZeroDivisionError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# 写个日志，回头出问题可以深究&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot;&gt;
&lt;pre&gt;
division by zero
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_area&quot; readability=&quot;7.5&quot;&gt;

&lt;div class=&quot;output_subarea output_text output_error&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;ansi-red-fg&quot;&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;ansi-red-fg&quot;&gt;ZeroDivisionError&lt;/span&gt;                         Traceback (most recent call last)
&lt;span class=&quot;ansi-green-fg&quot;&gt;&amp;lt;ipython-input-7-15f01346e2d8&amp;gt;&lt;/span&gt; in &lt;span class=&quot;ansi-cyan-fg&quot;&gt;&amp;lt;module&amp;gt;&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      9&lt;/span&gt; 
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     10&lt;/span&gt; &lt;span class=&quot;ansi-green-fg&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;ansi-blue-fg&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;ansi-blue-fg&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-fg&quot;&gt;---&amp;gt; 11&lt;/span&gt;main&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;ansi-green-fg&quot;&gt;&amp;lt;ipython-input-7-15f01346e2d8&amp;gt;&lt;/span&gt; in &lt;span class=&quot;ansi-cyan-fg&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      2&lt;/span&gt; &lt;span class=&quot;ansi-green-fg&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      3&lt;/span&gt;     &lt;span class=&quot;ansi-green-fg&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-fg&quot;&gt;----&amp;gt; 4&lt;/span&gt;&lt;span class=&quot;ansi-cyan-fg&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;ansi-blue-fg&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;ansi-cyan-fg&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;ansi-red-fg&quot;&gt;# ZeroDivisionError: division by zero&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      5&lt;/span&gt;     &lt;span class=&quot;ansi-green-fg&quot;&gt;except&lt;/span&gt; ZeroDivisionError &lt;span class=&quot;ansi-green-fg&quot;&gt;as&lt;/span&gt; ex&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      6&lt;/span&gt;         print&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;ex&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;ansi-red-fg&quot;&gt;# 写个日志，回头出问题可以深究&lt;/span&gt;

&lt;span class=&quot;ansi-red-fg&quot;&gt;ZeroDivisionError&lt;/span&gt;: division by zero
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [8]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;c1&quot;&gt;# 抛出自定义异常&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DntException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ne&quot;&gt;BaseException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DntException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;num must&amp;gt;0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get_age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get_age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# 程序崩了，这句话不会被执行了&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot; readability=&quot;7.5&quot;&gt;

&lt;div class=&quot;output_subarea output_text output_error&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;ansi-red-fg&quot;&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;ansi-red-fg&quot;&gt;DntException&lt;/span&gt;                              Traceback (most recent call last)
&lt;span class=&quot;ansi-green-fg&quot;&gt;&amp;lt;ipython-input-8-7c9dec6ec225&amp;gt;&lt;/span&gt; in &lt;span class=&quot;ansi-cyan-fg&quot;&gt;&amp;lt;module&amp;gt;&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     17&lt;/span&gt; 
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     18&lt;/span&gt; &lt;span class=&quot;ansi-green-fg&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;ansi-blue-fg&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;ansi-blue-fg&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-fg&quot;&gt;---&amp;gt; 19&lt;/span&gt;main&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;ansi-green-fg&quot;&gt;&amp;lt;ipython-input-8-7c9dec6ec225&amp;gt;&lt;/span&gt; in &lt;span class=&quot;ansi-cyan-fg&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     12&lt;/span&gt; 
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     13&lt;/span&gt; &lt;span class=&quot;ansi-green-fg&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-fg&quot;&gt;---&amp;gt; 14&lt;/span&gt;get_age&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;ansi-cyan-fg&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     15&lt;/span&gt;     get_age&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-cyan-fg&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;ansi-red-fg&quot;&gt;# 程序崩了，这句话不会被执行了&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     16&lt;/span&gt; 

&lt;span class=&quot;ansi-green-fg&quot;&gt;&amp;lt;ipython-input-8-7c9dec6ec225&amp;gt;&lt;/span&gt; in &lt;span class=&quot;ansi-cyan-fg&quot;&gt;get_age&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;(num)&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      6&lt;/span&gt; &lt;span class=&quot;ansi-green-fg&quot;&gt;def&lt;/span&gt; get_age&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;num&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      7&lt;/span&gt;     &lt;span class=&quot;ansi-green-fg&quot;&gt;if&lt;/span&gt; num &lt;span class=&quot;ansi-blue-fg&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;ansi-cyan-fg&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-fg&quot;&gt;----&amp;gt; 8&lt;/span&gt;&lt;span class=&quot;ansi-green-fg&quot;&gt;raise&lt;/span&gt; DntException&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;&quot;num must&amp;gt;0&quot;&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;      9&lt;/span&gt;     &lt;span class=&quot;ansi-green-fg&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;ansi-blue-fg&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ansi-green-intense-fg ansi-bold&quot;&gt;     10&lt;/span&gt;         print&lt;span class=&quot;ansi-blue-fg&quot;&gt;(&lt;/span&gt;num&lt;span class=&quot;ansi-blue-fg&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;ansi-red-fg&quot;&gt;DntException&lt;/span&gt;: num must&amp;gt;0
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;6&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;32&quot;&gt;
&lt;p&gt;异常这一块基本上讲完了（&lt;code&gt;logging&lt;/code&gt;模块后面会说）有什么补充的可以说的^_^&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;6.4103448275862&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;32.544827586207&quot;&gt;
&lt;h3 id=&quot;1.5-C#异常&quot;&gt;1.6 C#异常&lt;a class=&quot;anchor-link&quot; href=&quot;http://www.cnblogs.com/dotnetcrazy/p/9219751.html#1.5-C%23异常&quot;&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;小明又进行了C#的代码转换，怎么看都觉得还是C#简单啊，根本不用说啥，代码一贴就秒懂了。。。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [1]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;6.5&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;o&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;script&lt;/span&gt; csharp
try
{
    Convert.ToInt32(&quot;mmd&quot;);
}
catch (Exception ex)
{
    // Input string was not in a correct format
    Console.WriteLine(ex.Message);
}
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot; readability=&quot;6&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
Input string was not in a correct format.
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;
&lt;div class=&quot;input&quot;&gt;
&lt;p&gt;In [2]:&lt;/p&gt;
&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;input_area&quot; readability=&quot;6.5&quot;&gt;
&lt;div class=&quot; highlight hl-ipython3&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;o&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;script&lt;/span&gt; csharp
//抛出自定义异常
try
{
    throw new Exception(&quot;出错了啊&quot;);
}
catch (Exception ex)
{
    Console.WriteLine(ex.Message);
}
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;output_wrapper&quot;&gt;
&lt;div class=&quot;output&quot;&gt;
&lt;div class=&quot;output_area&quot;&gt;

&lt;div class=&quot;output_subarea output_stream output_stdout output_text&quot;&gt;
&lt;pre&gt;
出错了啊
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;

&lt;div class=&quot;inner_cell&quot; readability=&quot;7&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot; readability=&quot;36&quot;&gt;
&lt;p&gt;你可以自定义异常类，继承Exception即可，对了C#里面也是有finally的&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;出错了啊&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//Convert.ToInt32(&quot;mmd&quot;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Input string was not in a correct format&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;finally&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;现在一些需要finally的地方基本上都被using(){}接管了，所以特定场景会使用&lt;/p&gt;
&lt;p&gt;先这样了&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
<pubDate>Sun, 24 Jun 2018 02:49:00 +0000</pubDate>
<dc:creator>鲲逸鹏</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/dotnetcrazy/p/9219751.html</dc:identifier>
</item>
<item>
<title>Python3自动化运维之Fabric模版详解 - hwlong</title>
<link>http://www.cnblogs.com/hwlong/p/9216492.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hwlong/p/9216492.html</guid>
<description>&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
  Fabric是基于Python(&lt;span&gt;2.7&lt;/span&gt;,&lt;span&gt;3.4&lt;/span&gt;+&lt;span&gt;以上版本)实现的SSH命令行工具，简化了SSH的应用程序部署及系统管理任务，它提供了系统基础的操作组件，可以实现本地或远程shell命令，包括命令执行、文件上传、下载及完整执行日志输出等功能。Fabric在paramiko的基础上做了更高一层的封装，操作起来会更加简单。
Fabric官网地址为：http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;www.fabfile.org/。&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Mac os及CentOS 安装&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
pip3 install fabric3
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ubuntu安装&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~$ python --&lt;span&gt;version
Python 3.6.5&lt;/span&gt;&lt;span&gt;
devops@devops&lt;/span&gt;-&lt;span&gt;virtual&lt;/span&gt;-machine:~$ pip3 install fabric3
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;详细请参阅&lt;a href=&quot;http://www.fabfile.org/installing.html&quot; target=&quot;_blank&quot;&gt;官方文档&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;参考官方资料：&lt;a href=&quot;https://github.com/fabric/fabric/tree/1.13.1&quot;&gt;https://github.com/fabric/fabric/tree/1.13.1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.fabfile.org/changelog-v1.html?highlight=1.x&quot;&gt;http://www.fabfile.org/changelog-v1.html?highlight=1.x&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mathiasertl/fabric/&quot;&gt;https://github.com/mathiasertl/fabric/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
#!/usr/bin/&lt;span&gt;env python
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt;&lt;span&gt; fabric.api import run
&lt;br/&gt;#定义一个任务函数，通过run方法实现远程执行&quot;uname -s&quot;命令
def host_type():
    run(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;uname -s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;运行结果&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;H localhost host_type
[localhost] Executing task &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;host_type&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[localhost] run: uname &lt;/span&gt;-&lt;span&gt;s
[localhost] Login password &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;devops&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
[localhost] &lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;: Linux
[localhost] &lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;:


Done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; localhost... done.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，fab命令引用文件名fabfile.py,如果使用非默认文件名称，则需要通过&quot;-f&quot;来指定，示例：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
fab -H localhost -f host_type.py host_type
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 如果目标主机未配置密钥认证信任，将会提示输入目标主机对应账号登录密码。&lt;/p&gt;

&lt;p&gt;官方文档：&lt;a href=&quot;http://docs.fabfile.org/en/1.14/&quot;&gt;http://docs.fabfile.org/en/1.14/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;fab作为Fabric程序的命令行入口，提供了丰富的参数调用，命令格式如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
fab [options] &amp;lt;command&amp;gt;[:arg1,arg2-val2,host=foo,host=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;h1;h2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;...]...
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 常用参数介绍。更多参数可使用fab -help查看。&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;-l：显示定义好的任务函数名;&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;l
Available commands:

    host_type&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;&lt;li&gt;-f：指定fab入口文件，默认入口文件名为fabfile.py;&lt;/li&gt;
&lt;li&gt;-g：指定网关(中转)设备，比如堡垒机环境，填写堡垒机IP即可；&lt;/li&gt;
&lt;li&gt;-H：指定目标主机，多态主机用&quot;,&quot;号分隔；&lt;/li&gt;
&lt;li&gt;-P：以异步并行方式运行多主机任务，默认为串行运行；&lt;/li&gt;
&lt;li&gt;-R：指定role(角色)，以角色名区分不同业务组设备；&lt;/li&gt;
&lt;li&gt;-t：设置设备连接超时时间(秒)；&lt;/li&gt;
&lt;li&gt;-T：设置远程主机命令执行超时时间(秒)；&lt;/li&gt;
&lt;li&gt;-w：当命令执行失败，发出警告，而非默认中止任务。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;直接使用命令行执行远程操作，示例：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -p &lt;span&gt;1234567&lt;/span&gt; -H localhost -- &lt;span&gt;'&lt;/span&gt;&lt;span&gt;uname -s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[localhost] Executing task &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;lt;remainder&amp;gt;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[localhost] run: uname &lt;/span&gt;-&lt;span&gt;s
[localhost] &lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;: Linux
[localhost] &lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;:


Done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; localhost... done.
&lt;/pre&gt;&lt;/div&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
 fab命令好似结合我们编写的fabfile.py(其它文件名必须添加-f filename应用)来搭配使用的，部分命令行参数可以通过相应的方法来替代，使之更加灵活，例如&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;-H 192.168.56.133,192.168.56.134&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,我们可以通过定义env.hosts来实现，如&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;env.hosts=['192.168.56.133,192.168.56.134']&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;。fabfile的主体由多个自定义的任务函数组成，不同任务实现不同的操作逻辑。
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;全局属性设定&lt;/h2&gt;
&lt;p&gt;env对象的作用是定义fabfile的全局设定，支持多个属性，包含目标主机、用户名、密码、等角色，各属性说明如下：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;evn.host：定义目标主机，可以用IP或主机名表示，以Python的列表形式定义，如evn.hosts['192.168.56.133','192.168.56.134']。&lt;/li&gt;
&lt;li&gt;env.exclude_hosts：排除指定主机，如env.exclude_hosts=['192.168.56.133']。&lt;/li&gt;
&lt;li&gt;env.user：定义用户名，如env.user=&quot;root&quot;。&lt;/li&gt;
&lt;li&gt;env.port：定义目标主机端口，默认为22，如env.port=&quot;22&quot;。&lt;/li&gt;
&lt;li&gt;env.password：定义密码，如env.password='1234567'。&lt;/li&gt;
&lt;li&gt;env.passwords：与password功能一样，区别在于不同主机不同密码的应用场景，需要注意的是，配置passwords是需配置用户、主机、端口等信息，如：&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
env.passwords =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.131:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.132:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.133:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.134:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;&lt;li&gt;env.gateway：定义网关(中转、堡垒机)IP，如env.gateway = '192.168.56.1'。&lt;/li&gt;
&lt;li&gt;env.deploy_release_dir：自定义全局变量，格式：env.+&quot;变量名称&quot;，如env.deploy_release_dir、env.age、env.sex等。&lt;/li&gt;
&lt;li&gt;env.roledefs：定义角色分组，比如web组与db组主机区分开来，定义如下：&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
env.roledefs =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.131&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.132&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.133&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;],
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbserver&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.134&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.135&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;引用时使用Python修饰符的形式进行，角色修饰符下面的任务函数为其作用域，下面来看一个示例：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
@roles(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
def webtask():
    run(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/etc/init.d/nginx start&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)


@roles(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
def dbtask():
    run(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/etc/init.d/mysql start&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)


@roles(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
def pubclitasj():
    run(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;uptime&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)

def deploy():
    execute(webtask)
    execute(dbtask)
    execute(pubclitask)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在命令执行fab deploy就可以实现不同角色执行不同的任务函数了。&lt;/p&gt;
&lt;h2&gt;常用API&lt;/h2&gt;
&lt;p&gt;  Fabric提供了一组简单但功能强大的fabric.api命令集，简单地调用这些API就能完成大部分应用场景需求。Fabric常用方法及说明如下：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;local：执行本地命令，如：local('uname -s');&lt;/li&gt;
&lt;li&gt;lcd：切换本地目录，如：lcd('/home')；&lt;/li&gt;
&lt;li&gt;cd：切换远程目录，如：cd('/data/logs')；&lt;/li&gt;
&lt;li&gt;run：执行远程命令，如：run('free -m')；&lt;/li&gt;
&lt;li&gt;sudo：sudo方式执行远程命令，如：sudo('/etc/init.d/httpd start')；&lt;/li&gt;
&lt;li&gt;put：上传本地文件到远程主机，如：put('/home/user.info','/data/user.info');&lt;/li&gt;
&lt;li&gt;prompt：获得用户输入信息，如：prompt('please input user password:')；&lt;/li&gt;
&lt;li&gt;confirm：获得提示信息确认，如：confirm(&quot;Tests failed. Continue[Y/N]?&quot;)；&lt;/li&gt;
&lt;li&gt;reboot：重启远程主机，如：reboot()；&lt;/li&gt;
&lt;li&gt;@task：函数修饰符，标识的函数为fab可调用的，非标记对fab不可见，纯业务逻辑；&lt;/li&gt;
&lt;li&gt;runs_once：函数修复符，标识的函数只会执行一次，不受多台主机影响。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;查看本地信息&lt;/h2&gt;
&lt;p&gt;本示例调用local()方法执行本地(主控端)命令，添加&quot;@runs_once&quot;修饰符保证该任务函数只执行一次。调用run()方法执行远程命令。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/&lt;span&gt;devops$ pwd
&lt;/span&gt;/home/devops/&lt;span&gt;devops
devops@devops&lt;/span&gt;-&lt;span&gt;virtual&lt;/span&gt;-machine:~/&lt;span&gt;devops$ cat simple1.py
#&lt;/span&gt;!/usr/bin/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.api import *&lt;span&gt;


env.user &lt;/span&gt;= &lt;span&gt;'devops&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.hosts &lt;/span&gt;= [&lt;span&gt;'localhost&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
env.password &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;

@runs_once              #查看本地系统信息，当有多台主机时只运行一次
def local_task():       #本地任务函数
    local(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;uname -a&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)&lt;br/&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过fab命令调用local_task任务函数运行结果如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;f simple1.py local_task
[localhost] Executing task &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;local_task&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[localhost] local: uname &lt;/span&gt;-&lt;span&gt;a
Linux devops&lt;/span&gt;-&lt;span&gt;virtual&lt;/span&gt;-machine &lt;span&gt;4.15&lt;/span&gt;.&lt;span&gt;0&lt;/span&gt;-&lt;span&gt;20&lt;/span&gt;-generic #&lt;span&gt;21&lt;/span&gt;-Ubuntu SMP Tue Apr &lt;span&gt;24&lt;/span&gt; &lt;span&gt;06&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;15&lt;/span&gt; UTC &lt;span&gt;2018&lt;/span&gt; x86_64 x86_64 x86_64 GNU/&lt;span&gt;Linux

Done.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;查看远程主机信息&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/&lt;span&gt;devops$ cat simple2.py
#&lt;/span&gt;!/usr/bin/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.api import *&lt;span&gt;


env.user &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.hosts &lt;/span&gt;= [&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.11&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
env.password &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;



def remote_task():
    with cd(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;):        #&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;with&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;的作用是让后面的表达式的语句继承当前状态，实现&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cd /root/ &amp;amp;&amp;amp; ls -l'的效果&lt;/span&gt;
        run(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;ls -l&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 调用remote_task任务函数运行结果如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;f simple2.py remote_task
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;remote_task&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] run: ls -&lt;span&gt;l
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: total &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: -rw-------. &lt;span&gt;1&lt;/span&gt; root root &lt;span&gt;1273&lt;/span&gt; May &lt;span&gt;29&lt;/span&gt; &lt;span&gt;11&lt;/span&gt;:&lt;span&gt;47&lt;/span&gt; anaconda-&lt;span&gt;ks.cfg
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:


Done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;... done.
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;本示例使用&quot;@task'修复符标志入口函数go()对外部可见，配合&quot;@runs_once&quot;修饰符接受用户输入，最后调用worktask()任务函数实现远程命令执行。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/&lt;span&gt;devops$ cat simple3.py
#&lt;/span&gt;!/usr/bin/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.api import *&lt;span&gt;

env.user &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.hosts &lt;/span&gt;= [&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.11&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.12&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
env.password &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;


@runs_once           #主机遍历过程中，只有第一台触发此函数
def input_raw():
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; prompt(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Please input directory name:&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;default&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/home&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)


def worktask(dirname):
    run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ls -l &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+&lt;span&gt;dirname)


@task           #限定只有go函数对fab命令可见
def go():
    getdirname &lt;/span&gt;=&lt;span&gt; input_raw()
    worktask(getdirname)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该示例实现了一个动态输入远程目录名称，再获取目录列表的功能，由于我们只要求输入一次，在显示所有主机上该目录的列表信息，调用一个子函数input_raw()同时配置@runs_once修复符来达到此目的。&lt;/p&gt;
&lt;p&gt;执行结果如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;f simple3.py go
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
Please input directory name: [&lt;/span&gt;/home] /&lt;span&gt;root
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] run: ls -l /&lt;span&gt;root
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: total &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: -rw-------. &lt;span&gt;1&lt;/span&gt; root root &lt;span&gt;1273&lt;/span&gt; May &lt;span&gt;29&lt;/span&gt; &lt;span&gt;11&lt;/span&gt;:&lt;span&gt;47&lt;/span&gt; anaconda-&lt;span&gt;ks.cfg
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:

[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: ls -l /&lt;span&gt;root
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: total &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: -rw-------. &lt;span&gt;1&lt;/span&gt; root root &lt;span&gt;1273&lt;/span&gt; May &lt;span&gt;29&lt;/span&gt; &lt;span&gt;11&lt;/span&gt;:&lt;span&gt;59&lt;/span&gt; anaconda-&lt;span&gt;ks.cfg
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:


Done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;&lt;span&gt;... done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;... done.
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;本示例通过Fabric的env对象定义网关模式，即俗称的中转、堡垒机环境。定义格式为&quot;env.gateway='192.168.56.11'&quot;,其中IP“192.168.56.11”为堡垒机IP，再结合任务韩素实现目标主机文件上传与执行的操作。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:/home/install$ cat /home/devops/devops/&lt;span&gt;simple4.py
#&lt;/span&gt;!/usr/bin/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.api import *
&lt;span&gt;from&lt;/span&gt; fabric.context_managers import *
&lt;span&gt;from&lt;/span&gt;&lt;span&gt; fabric.contrib.console import confirm


env.user &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.gateway &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.11&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;                           #定义堡垒机IP，作为文件上传、执行的中转设备
env.hosts &lt;/span&gt;= [&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.12&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.13&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]

env.passwords &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.11:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,                  #堡垒机账号信息
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.12:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.13:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
}

l_pack_path &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/home/install/nginx-1.6.3.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;        #本地安装包路径
r_pack_path &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/tmp/install&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;                            #远程安装包路径


@task
def put_task():
    run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mkdir -p /tmp/install&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):
        result &lt;/span&gt;=&lt;span&gt; put(l_pack_path,r_pack_path)          #上传安装包
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; result.failed and not confirm(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;put file failed, Continue[Y/N]?&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):
        abort(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Aborint file put task!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)


@task
def run_task():                    #执行远程命令，安装nginx
    with cd(r_pack_path):
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tar -xvf nginx-1.6.3.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        with cd(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;nginx-1.6.3/&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;):                     #使用with继续继承/tmp/&lt;span&gt;install目录位置状态
            run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;./nginx_install.sh&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

@task
def go():       #上传、安装
    put_task()
    run_task()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行命令fab -f simple4.py go。运行结果如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('4c96fda6-c918-4696-83b0-3fc37700bdce')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_4c96fda6-c918-4696-83b0-3fc37700bdce&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_4c96fda6-c918-4696-83b0-3fc37700bdce&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('4c96fda6-c918-4696-83b0-3fc37700bdce',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_4c96fda6-c918-4696-83b0-3fc37700bdce&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;f simple4.py go
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: mkdir -p /tmp/&lt;span&gt;install
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] put: /home/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;.tar.gz -&amp;gt; /tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: tar -xvf nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
.....
.....
.....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: cp conf/nginx.conf &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/conf/nginx.conf.default&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;         || mkdir -p &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; ||         mkdir -p &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;         || cp -R html &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; ||         mkdir -p &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: make[&lt;span&gt;1&lt;/span&gt;]: Leaving directory `/tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax &lt;span&gt;is&lt;/span&gt;&lt;span&gt; ok
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: configuration file /usr/local/nginx/conf/nginx.conf test &lt;span&gt;is&lt;/span&gt;&lt;span&gt; successful
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:

[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: mkdir -p /tmp/&lt;span&gt;install
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] put: /home/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;.tar.gz -&amp;gt; /tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: tar -xvf nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
....
....
....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: cp conf/nginx.conf &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/conf/nginx.conf.default&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;         || mkdir -p &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; ||         mkdir -p &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;         || cp -R html &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: test -d &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; ||         mkdir -p &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/local/nginx/logs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: make[&lt;span&gt;1&lt;/span&gt;]: Leaving directory `/tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax &lt;span&gt;is&lt;/span&gt;&lt;span&gt; ok
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: configuration file /usr/local/nginx/conf/nginx.conf test &lt;span&gt;is&lt;/span&gt;&lt;span&gt; successful
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:


Done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;&lt;span&gt;... done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;&lt;span&gt;... done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;... done.
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;运行结果,默认为串行运行&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;执行命令fab -Pf simple4.py go。运行结果如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('8d6af7f4-7119-440e-8b75-936ec142d91e')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_8d6af7f4-7119-440e-8b75-936ec142d91e&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_8d6af7f4-7119-440e-8b75-936ec142d91e&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('8d6af7f4-7119-440e-8b75-936ec142d91e',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_8d6af7f4-7119-440e-8b75-936ec142d91e&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;Pf simple4.py go
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: mkdir -p /tmp/&lt;span&gt;install
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: mkdir -p /tmp/&lt;span&gt;install
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] put: /home/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;.tar.gz -&amp;gt; /tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] put: /home/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;.tar.gz -&amp;gt; /tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: tar -xvf nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
....
....
....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;/html/&lt;span&gt;index.html
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;/&lt;span&gt;README
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;/&lt;span&gt;nginx_install.sh
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;/&lt;span&gt;configure
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:

[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: ./&lt;span&gt;nginx_install.sh
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: tar -xvf nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;/&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;/src/&lt;span&gt;
....
....
....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: make[&lt;span&gt;1&lt;/span&gt;]: Leaving directory `/tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax &lt;span&gt;is&lt;/span&gt;&lt;span&gt; ok
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: configuration file /usr/local/nginx/conf/nginx.conf test &lt;span&gt;is&lt;/span&gt;&lt;span&gt; successful
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:
....
....
...
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: make[&lt;span&gt;1&lt;/span&gt;]: Leaving directory `/tmp/install/nginx-&lt;span&gt;1.6&lt;/span&gt;.&lt;span&gt;3&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax &lt;span&gt;is&lt;/span&gt;&lt;span&gt; ok
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: nginx: configuration file /usr/local/nginx/conf/nginx.conf test &lt;span&gt;is&lt;/span&gt;&lt;span&gt; successful
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;:
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;加P参数该为异步并行执行，运行结果&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;我们时常做一些文件包分发的工作，实施步骤一般是先压缩打包，在批量上传至目标服务器，最后做一致性校验。本示例通过put()方法实现文件的上传，通过对比本地与远程主机文件的md5，最终实现文件一致性校验。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/&lt;span&gt;devops$ cat simple5.py
#&lt;/span&gt;!/usr/bin/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.api import *
&lt;span&gt;from&lt;/span&gt; fabric.context_managers import *
&lt;span&gt;from&lt;/span&gt;&lt;span&gt; fabric.contrib.console import confirm

env.user &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.hosts &lt;/span&gt;= [&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.12&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.13&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
env.passwords &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.12:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.13:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
}


@runs_once
def tar_task():             #本地打包任务函数，只执行一次
    with lcd(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/home/devops/devops&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;):
        local(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tar -zcf devops.tar.gz  *&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)


@task
def put_task():                 #上传文件任务函数
    run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mkdir -p /root/devops&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    with cd(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/root/devops&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):
        with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):                  #put(上传)出现异常时继续执行，非终止
            result &lt;/span&gt;= put(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/home/devops/devops/devops.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/root/devops/devops.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; result.failed and not confirm(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;put file failed.Continue[Y/N]?&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):
            abort(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Aborting file put task!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)                        #出现异常时，确认用户是否继续，(Y继续)



@task
def check_task():               #校验文件任务函数
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):
        #本地local命令需要配置capture&lt;/span&gt;=&lt;span&gt;True才能捕获返回值
        lmd5 &lt;/span&gt;= local(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;md5sum /home/devops/devops/devops.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,capture=True).split(&lt;span&gt;'&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;)[&lt;span&gt;0&lt;/span&gt;&lt;span&gt;]
        rmd5 &lt;/span&gt;= run(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;md5sum /root/devops/devops.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).split(&lt;span&gt;'&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;)[&lt;span&gt;0&lt;/span&gt;&lt;span&gt;]
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; lmd5 ==&lt;span&gt; rmd5:                #对比本地及远程文件md5信息
        prompt(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;OK&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
        prompt(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ERROR&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)


@task
def go():
    tar_task()
    put_task()
    check_task()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行命令fab -f simple5.py go。运行结果如下：(&lt;span&gt;&lt;strong&gt;提示此程序不支持-P参数并行执行、如需并行执行，程序需要做调整)&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;f simple5.py go
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[localhost] local: tar &lt;/span&gt;-zcf devops.tar.gz  *&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: mkdir -p /root/&lt;span&gt;devops
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] put: /home/devops/devops/devops.tar.gz -&amp;gt; /root/devops/&lt;span&gt;devops.tar.gz
[localhost] local: md5sum &lt;/span&gt;/home/devops/devops/&lt;span&gt;devops.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: md5sum /root/devops/&lt;span&gt;devops.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: a1cf2be82647cbed0d41514bd80373de  /root/devops/&lt;span&gt;devops.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:

OK
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;go&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: mkdir -p /root/&lt;span&gt;devops
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] put: /home/devops/devops/devops.tar.gz -&amp;gt; /root/devops/&lt;span&gt;devops.tar.gz
[localhost] local: md5sum &lt;/span&gt;/home/devops/devops/&lt;span&gt;devops.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: md5sum /root/devops/&lt;span&gt;devops.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: a1cf2be82647cbed0d41514bd80373de  /root/devops/&lt;span&gt;devops.tar.gz
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;&lt;span&gt;:

OK

Done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;&lt;span&gt;... done.
Disconnecting &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;... done.
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;本示例通过env.roledefs定义不同主机角色，在使用&quot;@roles('webservers')&quot;修复符绑定到对应的任务函数，实现不同角色主机的部署差异。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/&lt;span&gt;devops$ cat simple6.py
#&lt;/span&gt;!/usr/bin/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.colors import *
&lt;span&gt;from&lt;/span&gt; fabric.api import *&lt;span&gt;

env.user &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.roledefs &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.11&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.12&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;],
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.13&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
}

env.passwords &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.11:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.12:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.13:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
}

@roles(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)                      #使用webtask任务函数引用&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;角色修复符
def webtask():
    print(yellow(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Install nginx php php-fpm...&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;))
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;yum -y install nginx&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;yum -y install php-fpm php-mysql php-mbstring php-xml php-mcrypt php-gd&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;chkconfig --levels 235 php-fpm on&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;chkconfig --levels 235 nginx on&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)


@roles(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)                       #dbtask任务函数引用&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;角色修复符
def dbtask():
    print(yellow(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Install Mysql...&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;yum -y install mysql mysql-server&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;chkconfig --levels 235 mysqld on&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)


@roles(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;webservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbservers&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)           #publictask任务函数同时引用两个角色修复符
def publictask():                          #部署公共类环境，如epel、ntp等
    print(yellow(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Install epel ntp....&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;yum -y install ntp&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

def deploy():
    execute(publictask)
    execute(webtask)
    execute(dbtask)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行命令fab -Pf simple6.py deploy&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
devops@devops-&lt;span&gt;virtual&lt;/span&gt;-machine:~/devops$ fab -&lt;span&gt;Pf simple6.py deploy
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;publictask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;publictask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;publictask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
Install epel ntp....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: wget -O /etc/yum.repos.d/epel.repo http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;
&lt;span&gt;Install epel ntp....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: wget -O /etc/yum.repos.d/epel.repo http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;
&lt;span&gt;Install epel ntp....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] run: wget -O /etc/yum.repos.d/epel.repo http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;
[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: --&lt;span&gt;2018&lt;/span&gt;-&lt;span&gt;06&lt;/span&gt;-&lt;span&gt;23&lt;/span&gt; &lt;span&gt;20&lt;/span&gt;:&lt;span&gt;32&lt;/span&gt;:&lt;span&gt;30&lt;/span&gt;--  http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;
[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: --&lt;span&gt;2018&lt;/span&gt;-&lt;span&gt;06&lt;/span&gt;-&lt;span&gt;23&lt;/span&gt; &lt;span&gt;20&lt;/span&gt;:&lt;span&gt;32&lt;/span&gt;:&lt;span&gt;30&lt;/span&gt;--  http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;
[&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] &lt;span&gt;out&lt;/span&gt;: --&lt;span&gt;2018&lt;/span&gt;-&lt;span&gt;06&lt;/span&gt;-&lt;span&gt;23&lt;/span&gt; &lt;span&gt;20&lt;/span&gt;:&lt;span&gt;32&lt;/span&gt;:&lt;span&gt;30&lt;/span&gt;--  http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;
&lt;span&gt;....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: yum -&lt;span&gt;y install ntp
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: yum -&lt;span&gt;y install ntp
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] run: yum -&lt;span&gt;y install ntp
....
....
....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;webtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;webtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
Install nginx php php&lt;/span&gt;-&lt;span&gt;fpm...
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.11&lt;/span&gt;] run: yum -&lt;span&gt;y install nginx
Install nginx php php&lt;/span&gt;-&lt;span&gt;fpm...
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.12&lt;/span&gt;] run: yum -&lt;span&gt;y install nginx
....
....
....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] Executing task &lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbtask&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
Install Mysql...
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: rpm -ivh http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm&lt;/span&gt;
&lt;span&gt;.....
.....
.....
[&lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;56.13&lt;/span&gt;] run: chkconfig --levels &lt;span&gt;235&lt;/span&gt;&lt;span&gt; mysqld on

Done.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;程序生产环境的发布是业务上线的最后一个环境，要求具备源码打包、发布、切换、回滚、版本管理等功能。本示例实现了这一套流程功能，其中版本切换与回滚使用了Linux下的软链接实现。&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
#!/usr/local/&lt;span&gt;env python

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; fabric.api import *
&lt;span&gt;from&lt;/span&gt; fabric.colors import *
&lt;span&gt;from&lt;/span&gt; fabric.context_managers import *
&lt;span&gt;from&lt;/span&gt;&lt;span&gt; fabric.contrib.console import confirm
import time

env.user &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
env.host &lt;/span&gt;= [&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.12&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;192.168.56.13&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
env.passwords &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.12:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;root@192.168.56.13:22&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;:&lt;span&gt;'&lt;/span&gt;&lt;span&gt;1234567&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
}

env.project_dev_source &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/data/dev/Lwebadmin/&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;              #开发服务器项目主目录
env.project_tar_source &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/data/dev/releases/&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;               #开发服务器项目压缩包存储目录
env.project_pack_name &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;release&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;                            #项目压缩包前缀，文件名为release.tar.gz

env.deploy_project_root &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/data/www/Lwebadmin/&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;            #项目生产环境主目录
env.deploy_release_dir &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;releases&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;                         #项目发布目录，位于主目录下面
env.deploy_current_dir &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;current&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;                          #对外服务的当前版本软链接
env.deploy_version &lt;/span&gt;= time.strftime(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%Y%m%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;)+&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;v2&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;           #版本号

@runs_once
def input_versionid():                                      #获得用户输入的版本号，以便做版本回滚操作
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; prompt(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Please input project rollback version ID:&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;default&lt;/span&gt;=&lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;)


@task
@runs_once
def tar_source():                                           #打包本地项目主目录，并将压缩包存储到本地压缩包目录
    prompt(yellow(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Creating source package....&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
    with lcd(env.project_dev_source):
        local(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tar -zcf %s.tar.gz .&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %(env.project_tar_source +&lt;span&gt; env.project_pack_name))
    prompt(green(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Creating source package success!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))


@task
def put_package():                                          #上传任务函数
    prompt(yellow(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Start put package....&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):
        with cd(env.deploy_project_root &lt;/span&gt;+&lt;span&gt; env.deploy_release_dir):
            run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mkdir %s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt;(env.deploy_version))           #创建版本目录
    env.deploy_full_path &lt;/span&gt;= env.deploy_project_root + env.deploy_release_dir + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; +&lt;span&gt; env.deploy_version
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):                          #上传项目压缩包至此目录
        result &lt;/span&gt;= put(env.project_tar_source + env.project_pack_name + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,env.deploy_full_path)
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; result.failed and not (&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;put file failed,Continue[Y/N]?&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):
        abort(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Aborting file put task!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    with cd(env.deploy_full_path):                          #成功解压后删除压缩包
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tar -zxvf %s.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt;(env.project_pack_name))
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rm -rf %s.tar.gz&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt;(env.project_pack_name))

    print(green(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Put &amp;amp; untar package success!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))


@task
def make_symlink():                                         #为当前版本目录做软链接
    print(yellow(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;update current symlink&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
    env.deploy_full_path &lt;/span&gt;= env.deploy_project_root + env.deploy_release_dir + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; +&lt;span&gt; env.deploy_version
    with settings(warn_only&lt;/span&gt;=&lt;span&gt;True):                           #删除软链接，重新创建并指定软链接源目录，新版本生效
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rm -rf %s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %(env.deploy_project_root +&lt;span&gt; env.deploy_current_dir))
        run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ln -s %s %s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %(env.deploy_full_path,env.deploy_project_root +&lt;span&gt; env.deploy_current_dir))
    print(green(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;make symlink success!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))


@task
def rollback():                                             #版本回滚任务函数
    print(yellow(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rollback project version&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
    versionid &lt;/span&gt;=&lt;span&gt; input_versionid()                           #获取用户输入的回滚版本号
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; versionid == &lt;span&gt;''&lt;/span&gt;&lt;span&gt;:
        abort(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Project version ID error,abort!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    env.deploy_full_path &lt;/span&gt;= env.deploy_project_root + env.deploy_release_dir + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; +&lt;span&gt; versionid
    run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rm -r %s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %(env.deploy_project_root +&lt;span&gt; env.deploy_current_dir))
    run(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ln -s %s %s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %(env.deploy_full_path,env.deploy_project_root +&lt;span&gt; env.deploy_current_dir))     #删除软链接，重新创建并指定软链接源目录，新版本生效
    print(green(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rollback sucess!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))


@task
def go():               #自动化程序版本发布入口函数
    tar_source()
    put_package()
    make_symlink()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在生产环境中将站点的根目录指向&quot;/data/www/Lwebadmin/current&quot;,由于使用Linux软链接做切换，管理员的版本发布、回滚操作用户无感知。&lt;/p&gt;

</description>
<pubDate>Sun, 24 Jun 2018 02:16:00 +0000</pubDate>
<dc:creator>hwlong</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/hwlong/p/9216492.html</dc:identifier>
</item>
<item>
<title>记在百度（熊场）的一次面试 - liulonglong</title>
<link>http://www.cnblogs.com/liuqun/p/9219692.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/liuqun/p/9219692.html</guid>
<description>&lt;p&gt;熊场一共面试了俩职位，第一个职位，我面试了三轮，在百度大厦，没有面试题，看了下我的简历，我第一个职位，的第一个面试官，让我手写算法，一个快排，手写。。who 怕 who，然后又问了很多PHP的基础题，这一轮面试面的最长，从基础到高级，几乎全问到了，基础简单的session和cookie的区别，redis和memcache缓存数据库的区别，还有问了很多我没能回答上来的，比如1000万条数据怎么优化，我回答的无非是套路上呗，只不过我这套路也很熟了，所以，不怕，问道分表，我手写出了逻辑分表，面试官还让我手写了一个单例的设计模式，还好这些早就准备好了， 还有opcode，说实话这个我现在自己搜集资料还不清楚，还待看，面完我第一轮后，然后又来了第二轮面试官，我记得我当初说我和第二轮面试官说我第一轮面的不怎么样，很多不会的，由于我面试的时候，我自己会带个本子，一言不合咱就手写代码，我把第一轮面试官的问题我没回答上来的记下来了，面试有时候也是一种技术交流，有的新的技术不会的，我们可以自己记下来，回来自己补课，自行脑补，这种交流我认为也很重要，看我们自己怎么利用这种机会了。第二轮面试官问了些常用的Linux指令，说呗。Linux命令我在第一轮就手写了三四十个，所以不怕，然后又问了我一个算法题。&lt;/p&gt;
&lt;p&gt;一千瓶液体里只有一瓶是毒药，如何用最快的方法找到那瓶毒药？&lt;/p&gt;
&lt;p&gt;根据2^10=1024，所以10个老鼠可以确定1000个瓶子具体哪个瓶子有毒。具体实现跟3个老鼠确定8个瓶子原理一样。 &lt;br/&gt;000=0 &lt;br/&gt;001=1 &lt;br/&gt;010=2 &lt;br/&gt;011=3 &lt;br/&gt;100=4 &lt;br/&gt;101=5 &lt;br/&gt;110=6 &lt;br/&gt;111=7 &lt;br/&gt;一位表示一个老鼠，0-7表示8个瓶子。也就是分别将1、3、5、7号瓶子的药混起来给老鼠1吃，2、3、6、7号瓶子的药混起来给老鼠2吃，4、5、6、7号瓶子的药混起来给老鼠3吃，哪个老鼠死了，相应的位标为1。如老鼠1死了、老鼠2没死、老鼠3死了，那么就是101=5号瓶子有毒。 &lt;br/&gt;同样道理10个老鼠可以确定1000个瓶子。&lt;/p&gt;
&lt;p&gt;这是哪个算法题及详解。 &lt;br/&gt;当初我只说了下思路，说的还不怎么对，自己回来有百度了下，思路还差点，还问了我一个非技术的问题，我来百度能给百度带来啥，（内心。。。卧槽，我来百度还能带来啥，百度可是大厂，我技术这么渣），想了想，我就找实话说了，没带半点虚的，（我会尽最大努力完成百度分配给我的任务，因为我技术很渣，原话）可能我运气不错，两轮技术面试过了，即将迎来第三轮面试，第二个技术面试官走了后，这一轮我面试等的时间算是有点长吧，怎么回事呢，我的第三轮面试官其实早就来到面试我的地方了，因为前两轮面试我的实在一个办公休闲区给我面的，我现在还没去百度上班，还不知道那地叫啥，办公休闲区很多人都在那交流，我的第二个面试官走了后，让我等着，我此时此刻心里一点不紧张，因为我没考虑那么多，这毕竟是熊场，来面试玩玩就不错了，面试完前两轮我也不知道我前两轮是否过了，那就等呗，我的第三轮面试官，其实很早来到办公区休闲区，盯着我看了会，那一会忘记多长时间了，一小会的功夫把我从脚跟子到头都看了一遍，可能是看我的举止行为，在确定我没有什么出格的行为，以及他看我顺眼后，走到我的跟前，问我，你就是谁谁吧，说了几句，这一轮没有面试我技术，看了下我简历，然后问我自己有哪些不足和前同事相处的咋样，我也还是照实说呗，说了自己几个缺点，面试官给了我几个建议，然后聊的还不错，然后就第三轮面试就结束了。这是我的第一个职位面试，也是我入职的职位，百度某某部。（自我感觉：有时候大厂问的这些问题，能带来什么，毕竟大厂的地方已经在那，无论你多牛掰，大厂这里不缺人，北京搞技术的岗位，每时每刻都缺人，每时每刻都不缺人。希望各位能明白我说的这个意思，就是你不干了，后边千千万万的人都等着你这个职位呢。）&lt;/p&gt;
&lt;p&gt;这个面试完了我有去面试了百度第二个职位在百度科技园，K4楼。由于第一个职位三轮面试时间花了近三个小时，所以第二个职位我不知道是哪个部门，匆忙就赶了过去，这个问得比较变态，其实不叫变态，只是更基础，数据结构链表怎么反转，（内心活动，我擦数据结构我都一年没看了，你让我手写，这个就说了忘记了），然后让我手写归并排序，归并排序我是依葫芦画瓢，时间短画的不怎么样，然后让我设计数据表结构，手写原声sql，还是那句，手写就手写，who怕who 。所以第二个职位的第一轮面试我也顺利过了，基础的有全问了一遍，第二轮，有几个没回答上来，这一个职位问得更加基础，数据结构的比例成分更大一些，还是那样子，有的回答上来了，有的没有回答上来，只是这次面试有个算法掉坑了，我自己感觉如果我第二个职位的第二轮面试的那个算法写对了，这个职位应该也没问题，可能自己大意了，一个算法写错了。&lt;/p&gt;
&lt;p&gt;还好自己第一个职位三轮面试的结果还不错。百度的这两个职位面试一公五轮，第一个职位三轮，第二个职位两轮，这两个职位面试的时候我都迟到了，不是不守时，因为2018年6月11号，正好周一，本来上午约了一家，结果那家聊得挺嗨，技术想留下我，结果公司人事说在面试几天，我和技术聊了很多。时间给超时了，本来约得百度是下午两点，结果开始面试的时候已经2：30了，去之前给面试官发了个消息，本人最烦不守时，所以我也烦自己不守时，这次是个例外，因为上午面试出了意外，面试超时了，面了时间也挺长。&lt;/p&gt;
&lt;p&gt;之前我面试了一家国企，中国兵器大厦，工资不高，但福利待遇还不错，面试题也是出了奇的难，反正感觉比一般的公司的面试题难。但签完入职合同后，让我处理了两天的word，还有公司里很多项目都是一个维护状态，每天挺懒散，处理word加班，感觉挺搞笑的，每天懒散的加班耗时间，感觉在这我会把我的大好青春给浪费了，你加班可以，我是搞技术的，但不是每天整个团队懒散加班。我不希望这样，因为入职两天，所以自己决定走人。所以自己在招聘平台上投递了下简历，没想到收到了百度的邀请，心里没怎么当回事，去就去呗，（内心：不是我不当回事，因为在我的印象里，百度面试，进去的应该都是很牛掰的人吧，还有我的学历不高，我怕我这个门槛都迈不过去，）可能我的运气真的爆棚吧。&lt;/p&gt;
&lt;p&gt;后记：技术永远是个进阶的，没有最强，只有更强，大厂面试除了面试你的技术，还有面试你的人品吧，问几个常问的人事问题，看你怎么回答，虽然有的是套路，一般小公司技术过了，这种套路就是问问，大厂技术过了，问的这种问题，就要慎重了，能给他们带来什么，其实看你技术，及薪资定位，如果是像我这种技术渣渣，我只能尽我最大的努力为百度做贡献。&lt;/p&gt;
&lt;p&gt;进入百度难，既然我进来了，我就要好好带下去，百度是个机会，因为BAT对不是盖的，用户量在哪，处理的问题肯定会多很多，大流量与高并发，所以我的机遇与挑战来了，这是一个镀金的机会，镀好了金光闪闪，失败我就彻底是去这个好机会，所以没有失败的机会，玩了老命拼了。 百度———狼厂，我希望自己成长为狼场里面的一只狼。为百度做点贡献。 &lt;br/&gt;来吧，我准备好了。 我准备好成为狼厂的一员了。&lt;/p&gt;
</description>
<pubDate>Sun, 24 Jun 2018 01:56:00 +0000</pubDate>
<dc:creator>liulonglong</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/liuqun/p/9219692.html</dc:identifier>
</item>
<item>
<title>react组件中的constructor和super小知识 - 一直在寻</title>
<link>http://www.cnblogs.com/faith3/p/9219446.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/faith3/p/9219446.html</guid>
<description>
&lt;h2&gt;1、react中用class申明的类一些小知识&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180623235555205-1616492599.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;如上图：类Child是通过class关键字申明，并且继承于类React。&lt;/p&gt;
&lt;p&gt;A、Child的类型是？   &lt;span&gt;&lt;strong&gt;typeof  Child   ===  'function' &lt;/strong&gt;&lt;/span&gt; ， 其实就相当于ES5用function申明的构造函数    function Child() {  //申明构造函数  }&lt;/p&gt;
&lt;p&gt;B、Child类调用时候(  new Child() )，&lt;span&gt;&lt;strong&gt;会优先执行，并且自动执行Child的constructor函数&lt;/strong&gt;&lt;/span&gt;。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;constructor() {
   console.log(&lt;/span&gt;'执行了constructor'&lt;span&gt;)
       &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; 'hah'&lt;span&gt;
   }

   getName() {
       console.log(&lt;/span&gt;'执行了方法'&lt;span&gt;)
   }
}
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; dd = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Person();
console.log(dd)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打印如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624000545830-1866124997.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;3、Child类中的this？    this指向Child的实例，相当于 new Child()   那么它们完全相等吗？  &lt;strong&gt;&lt;span&gt;不是的，react中的this是在new Child()基础上进行了包裹（下图）&lt;/span&gt;&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624001457100-1991741326.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;             上图为new Child（）      下图为 Child中的this&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624001607888-2038033623.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;结论：&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;this是在new Child()基础上进行了包裹，包含了一些react内部方法，&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;同时组件中使用Child类(  &amp;lt;div&amp;gt;  &amp;lt;Child /&amp;gt; &amp;lt;/div&amp;gt; )，可以看成 &lt;span&gt;new Child（） + react包裹&lt;/span&gt;。（细节待追究。。。）&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;2、组件中的constructor是否有必要？ 如果没有呢？？作用呢？？？&lt;/h2&gt;
&lt;p&gt;ES6的知识补充：  &lt;a href=&quot;http://es6.ruanyifeng.com/#docs/class-extends&quot; target=&quot;_blank&quot;&gt;http://es6.ruanyifeng.com/#docs/class-extends&lt;/a&gt;   如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624015759191-1341853377.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class ColorPoint extends Point {
}

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 等同于 &lt;/span&gt;
&lt;span&gt;class ColorPoint extends Point {
  constructor(...args) {
    super(...args);
  }
}&lt;br/&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
// 可见没有写constructor，在执行过程中会自动补上
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;由ES6的继承规则得知，不管子类写不写constructor，在new实例的过程都会给补上constructor。&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;所以：constructor钩子函数并不是不可缺少的，子组件可以在一些情况略去&lt;/span&gt;&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;接下来，继续看下有没有constructor钩子函数有什么区别：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;A、先看有无constructor钩子函数的 this.constructor&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;     有constructor钩子函数的 this.constructor &lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624005200299-97647880.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;      无constructor钩子函数的 this.constructor &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624005249326-760117579.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;如果&lt;strong&gt;能看细节的话，会得知 有constructor钩子函数时候，Child类会多一个constructor方法&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;B、再看有无先看有无constructor钩子函数的 this，也就是组件实例&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;     有constructor钩子函数的 this实例。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624005802751-1314295343.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;     无constructor钩子函数的 this实例。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624005836954-1288481649.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;会得知 &lt;strong&gt;有constructor钩子函数时候，可以定义state，如果用户不定义state的话，有无constructor钩子函数时候没有区别&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;结论： &lt;span&gt;如果组件要定义自己的state初始状态的话，需要写在&lt;strong&gt;constructor钩子函数中，&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;strong&gt;如果用户不使用state的话，纯用props接受参数，有没有&lt;/strong&gt;&lt;strong&gt;constructor钩子函数都可以，可以不用&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;constructor钩子函数。&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;再者如果&lt;/span&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;不使用state，那么为什么不使用&lt;/span&gt; 无状态组件（建议使用） &lt;span&gt;呢？？？&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h2&gt;3、super中的props是否必要？ 作用是什么？？&lt;/h2&gt;
&lt;p&gt;有的小伙伴每次写组件都会习惯性在constructor和super中写上props，那么这个是必要的吗？？&lt;/p&gt;
&lt;p&gt;如图：   &lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624002245498-133077391.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;首先要明确很重要的一点就是：&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;可以不写constructor，一旦写了constructor，就必须在此函数中写super(),&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;此时组件才有自己的this，在组件的全局中都可以使用this关键字，&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;否则如果只是constructor 而不执行 super() 那么以后的this都是错的！！！&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;来源ES6 ： &lt;a href=&quot;http://es6.ruanyifeng.com/#docs/class-extends&quot; target=&quot;_blank&quot;&gt;http://es6.ruanyifeng.com/#docs/class-extends&lt;/a&gt;   &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624011921369-1337302529.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; 但是super中必须写参数props吗？？   答案是不一定，先看代码：&lt;/p&gt;
&lt;p&gt;有props：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624012646344-1650230433.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624012721420-1438956371.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;无props：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624012912272-763738012.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624012955198-135846386.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;可以得出结论：&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt;当想在constructor中使用this.props的时候，super需要加入(props)，&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;此时用props也行，用this.props也行，他俩都是一个东西。（不过props可以是任意参数，this.props是固定写法）&lt;/span&gt;&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624013417239-947679704.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt; 如果在custructor生命周期不使用 this.props或者props时候，可以不传入props&lt;/strong&gt;&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;下面是一个使用props的场景，此时别忘了 componentWillReceiveProps 生命周期哟&lt;/span&gt;&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;参考另一篇文章  &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2&quot; href=&quot;https://www.cnblogs.com/faith3/p/9216165.html&quot;&gt;react的生命周期需要知道的&lt;br/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/905482/201806/905482-20180624013810215-571587924.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;接上：如果constructor中不通过super来接收props，在其他生命周期，&lt;/p&gt;
&lt;p&gt;诸如componentWillMount、componentDidMount、render中能直接使用this.props吗？？&lt;/p&gt;
&lt;p&gt;结论：可以的，&lt;strong&gt;&lt;span&gt;react在除了constructor之外的生命周期已经传入了this.props了，完全不受super(props)的影响&lt;/span&gt;&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;所以super中的props是否接收，只能影响constructor生命周期能否使用this.props，其他的生命周期已默认存在this.props&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

</description>
<pubDate>Sat, 23 Jun 2018 17:43:00 +0000</pubDate>
<dc:creator>一直在寻</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/faith3/p/9219446.html</dc:identifier>
</item>
</channel>
</rss>