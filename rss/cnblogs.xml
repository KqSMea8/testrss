<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>JDBC（三）数据库连接池（DBCP、C3P0） - 苦水润喉</title>
<link>http://www.cnblogs.com/zhangyinhua/p/7765626.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhangyinhua/p/7765626.html</guid>
<description>&lt;p&gt;前言&lt;/p&gt;
&lt;p&gt;　　这段时间状态有一点浮躁，希望自己静下心来。还有特别多的东西还没有学懂。需要学习的东西非常的多，加油！&lt;/p&gt;

&lt;p&gt;　　Java Data Base Connectivity，java数据库连接，在需要存储一些数据，或者拿到一些数据的时候，就需要往数据库里存取数据。那么java如何连接数据库呢？需要哪些步骤？&lt;/p&gt;
&lt;h2&gt;1.1、注册驱动&lt;/h2&gt;
&lt;p&gt;　　1）什么是驱动&lt;/p&gt;
&lt;p&gt;　　　　 驱动就是&lt;span&gt;JDBC实现类&lt;/span&gt;，通俗点讲，就是&lt;span&gt;能够连接到数据库功能的东西就是驱动&lt;/span&gt;，由于市面上有很多数据库，Oracle、MySql等等，所以&lt;span&gt;java就有一个连接数据库的实现规&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　范接口，&lt;/span&gt;&lt;span&gt;定义一系列的连接数据库接口(java.sql.Driver接口)，但是不提供实现，而每个数据库厂家来提供这些接口的具体实现&lt;/span&gt;，这样一来，不管使用的是什么数据库，我&lt;/p&gt;
&lt;p&gt;　　　　们开发者写的代码都是相同的，就不必因为数据库的不同，而写法不同，唯一的不同就是数据库驱动不一样，使用mysql，那么就必须使用mysql的驱动，使用Oracle就必&lt;/p&gt;
&lt;p&gt;　　　　须使用oracle的驱动实现类。&lt;/p&gt;
&lt;p&gt;　　　　看下面mysql连接数据的原理图，看看驱动是在哪里，起什么作用？&lt;/p&gt;
&lt;p&gt;　　　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/999804/201711/999804-20171101102920263-1164052119.png&quot; alt=&quot;&quot; width=&quot;827&quot; height=&quot;226&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　2）DriverManager，一个工具类，是用于操作管理JDBC实现类的&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
　原始写法：DriverManager.register(&lt;span&gt;new&lt;/span&gt; Driver());　　&lt;span&gt;//&lt;/span&gt;&lt;span&gt;因为使用的是MySql，所以在导包时就需要导入com.mysql.jdbc.Driver&lt;/span&gt;
&lt;span&gt;
　现在写法：Class.forName(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;);　　&lt;span&gt;//&lt;/span&gt;&lt;span&gt;不用导包，会执行com.mysql.jdbc.Driver类中的静态代码块，其静态代码块的内容为&lt;/span&gt;
&lt;span&gt;　          　static&lt;/span&gt;&lt;span&gt; {
　　　           　 &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {                      
　　　　　　　　　　　　　　　　 java.sql.DriverManager.registerDriver(&lt;/span&gt;&lt;span&gt;new&lt;/span&gt;&lt;span&gt; Driver());
   　　　　　　　　　　　　　　　　 } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SQLException E) {
　　　　　　　　　　　　　　　　　　　　&lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RuntimeException(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Can't register driver!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                    　　　　　　　　　}
               　　　　　　　　 }　　&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　分析：　&lt;/p&gt;
&lt;p&gt;　　　会发现&lt;span&gt;第二种加载驱动的方法的底层其实就是第一种加载驱动&lt;/span&gt;。为什么要这样呢？原因很简单，&lt;span&gt;　第一种是硬编程&lt;/span&gt;，直接将数据库驱动给写死了，无法扩展，如果使用第一&lt;/p&gt;
&lt;p&gt;　　　种，那么连接的数据库只能是mysql&lt;span&gt;，因为导包导的是mysql的驱动包&lt;/span&gt;，如果换成Oracle，就会报错，需要在代码中将Oracle的驱动包导入，这样很麻烦，而第二种写法就不&lt;/p&gt;
&lt;p&gt;　　　一样了，&lt;span&gt;第二种是使用&lt;/span&gt;&lt;span&gt;的字符串方法注册驱动的，我们只需要将该字符串提取到一个配置文件中&lt;/span&gt;，以后想换成oracle数据库，只需要将该字符串换成oracle驱动的类全名即可&lt;/p&gt;
&lt;p&gt;　　　，而不需要到代码中去修改什么东西。&lt;/p&gt;
&lt;h2&gt;1.2、获取连接&lt;/h2&gt;
&lt;p&gt;　　使用DriverManage来获得连接，因为DriverManager是驱动实现类的管理者&lt;/p&gt;
&lt;p&gt;　　Connection conn = DriverManager.getConnection(url,user,password);&lt;/p&gt;
&lt;p&gt;　　　　url:确定数据库服务器的位置，端口号，数据库名&lt;/p&gt;
&lt;p&gt;　　　　　　jdbc:mysql://localhost:3306/&lt;strong&gt;db&lt;/strong&gt;　&lt;/p&gt;
&lt;p&gt;　　　　user:登录名称，默认root&lt;/p&gt;
&lt;p&gt;　　　　password:密码，默认root　　　&lt;/p&gt;
&lt;p&gt;　　这里只是说mysql，别的数据库，url格式就不同了。&lt;/p&gt;
&lt;p&gt;　　　　MySQL　　　　jdbc:mysql://localhost:3306/&lt;strong&gt;db　　　　&lt;/strong&gt;默认端口是3306，粗体为连接时使用的数据库名&lt;/p&gt;
&lt;p&gt;　　　　Oracle　　　　 jdbc:oracle:thin:@localhost:1521:&lt;strong&gt;db&lt;/strong&gt;　　默认端口号1521&lt;/p&gt;
&lt;p&gt;　　　　DB2　　　　　 jdbc:db2://localhost:6789/&lt;strong&gt;db&lt;/strong&gt;　　　　　　默认端口号6789&lt;/p&gt;
&lt;p&gt;　　　　SQLServer　　jdbc:microsoft:sqlserver://localhost:1433;databaseName=&lt;strong&gt;db&lt;/strong&gt;　　默认端口号1433&lt;/p&gt;
&lt;p&gt;　　　　SQLServer 2005　　jdbc:sqlserver://localhost:1433;databaseName=&lt;strong&gt;db&lt;/strong&gt;　　默认端口号1433&lt;/p&gt;
&lt;h2&gt;1.3、获取执行sql对象，PreparedStatement对象　&lt;/h2&gt;
&lt;p&gt;　　通过Connection对象获取Statement或者PraparedStament对象(使用它)处理sql&lt;/p&gt;
&lt;p&gt;　　1）Statement&lt;/p&gt;
&lt;p&gt;　　　　Statement st = conn.createStatement();　　//获取sql语句执行对象&lt;/p&gt;
&lt;p&gt;　　　　st.excuteUpdate(sql);　　//执行增删改语句&lt;/p&gt;
&lt;p&gt;　　　　st.excuteQuery(sql);　　//执行查询语句　　　　　　&lt;/p&gt;
&lt;p&gt;　　　　sql语句必须是完整的。&lt;/p&gt;
&lt;p&gt;　　2）PraparedStatment&lt;/p&gt;
&lt;p&gt;　　　　sql语句&lt;span&gt;可以不是完整的，可以将参数用?替代，然后在预编译后加入未知参数&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;　　　　PraparedStatment ps = conn.prapareStatement(sql);　　//获取sql语句执行对象praparedStatment&lt;/p&gt;
&lt;p&gt;　　　　赋值&lt;/p&gt;
&lt;p&gt;　　　　　　ps.setInt(Index,value);　　ps.setString(index,value);　　//可以设置很多中类型，index从1开始，代表sql语句中的第几个未知参数，&lt;/p&gt;
&lt;p&gt;　　　　　　ps.excuteUpdate();　　//执行增删改语句&lt;/p&gt;
&lt;p&gt;　　　　　　ps.excuteQuery(sql);　　//执行查询语句&lt;/p&gt;

&lt;p&gt;　　这两个的区别，常使用的是PraparedStatment对象，因为它可以预编译，效率高，可以设置参数等等优点。&lt;/p&gt;
&lt;h2&gt;1.4、获取结果集对象&lt;/h2&gt;
&lt;p&gt;　　int count = ps.excuteUpdate();　　　//执行增删改的sql语句时，返回一个int类型的整数，代表数据库表影响的行数，&lt;/p&gt;
&lt;p&gt;　　Result result = ps.excuteQuery();　　//执行查询sql语句时，返回一个结果集对象，该对象装着所有查询到的数据信息，一行一行的存储数据库表信息。&lt;/p&gt;
&lt;h2&gt;1.5、处理结果集&lt;/h2&gt;
&lt;p&gt;　　对查询到的Result结果进行处理，拿到所有数据，并封装成对象。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
　　　　　　　　&lt;span&gt;while&lt;/span&gt;&lt;span&gt;(rs.next()){

　　　　　　　　　　获取行数据的第一种方式
　　　　　　　　　　rs.getString(index);&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;index代表第几列，从1开始&lt;/span&gt;
&lt;span&gt;
　　　　　　　　　　获取行数据的第二中方式
　　　　　　　　　　rs.getString(&lt;/span&gt;&lt;span&gt;string&lt;/span&gt;);　　&lt;span&gt;//&lt;/span&gt;&lt;span&gt;string：代表字段名称。&lt;/span&gt;
&lt;span&gt;
　　　　　　　　}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/999804/201711/999804-20171101104216232-1043927436.png&quot; alt=&quot;&quot; width=&quot;639&quot; height=&quot;322&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　总结：java的JDBC就分为5步，4个属性&lt;/p&gt;
&lt;p&gt;　　　　属性：driver、url、user、password&lt;/p&gt;
&lt;p&gt;　　　　五步：&lt;/p&gt;
&lt;p&gt;　　　　　　注册驱动、获取连接、获取执行sql语句对象、获取结果集对象、处理结果。&lt;/p&gt;

&lt;p&gt;　　创建（Create）、更新（Update）、读取（Retrieve）和删除（Delete）操作&lt;/p&gt;
&lt;p&gt;　　查询所有(读取Retrieve)&lt;/p&gt;
&lt;h2&gt;2.1、查询所有记录读取（Retrieve）&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('be88f89b-5eed-49ea-a7c2-e0596379ff67')&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_be88f89b-5eed-49ea-a7c2-e0596379ff67&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_be88f89b-5eed-49ea-a7c2-e0596379ff67&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('be88f89b-5eed-49ea-a7c2-e0596379ff67',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_be88f89b-5eed-49ea-a7c2-e0596379ff67&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Test
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; findAll() throws Exception{
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1 注册驱动&lt;/span&gt;
        Class.forName(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2 获得连接&lt;/span&gt;
        Connection conn = DriverManager.getConnection(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc:mysql://localhost:3306/test&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3语句执行者，sql语句&lt;/span&gt;
        Statement st = conn.praparedStatement(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;select * from t_user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;4 执行查询语句&lt;/span&gt;
        ResultSet rs =&lt;span&gt; st.executeQuery();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;5处理数据
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; * 如果查询多个使用，使用while循环进行所有数据获取
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; * 技巧：如果查询结果最多1条，使用  if(rs.next()) {  查询到了 } else {  没有数据 }&lt;/span&gt;
        &lt;span&gt;while&lt;/span&gt;&lt;span&gt;(rs.next()){
            &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; id = rs.getInt(&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
            String username &lt;/span&gt;= rs.getString(&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
            String password &lt;/span&gt;=rs.getString(&lt;span&gt;3&lt;/span&gt;&lt;span&gt;);
            System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.print(id + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.print(username + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;.println(password);
        }
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;6释放资源&lt;/span&gt;
&lt;span&gt;        rs.close();
        st.close();
        conn.close();
        
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;findAll()&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;2.2、增加操作(创建Create)　　&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('b101a1aa-736e-4ea1-968c-4f23f14de503')&quot; readability=&quot;35.5&quot;&gt;&lt;img id=&quot;code_img_closed_b101a1aa-736e-4ea1-968c-4f23f14de503&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_b101a1aa-736e-4ea1-968c-4f23f14de503&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('b101a1aa-736e-4ea1-968c-4f23f14de503',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_b101a1aa-736e-4ea1-968c-4f23f14de503&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;66&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Test
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; save() throws Exception{
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1 注册驱动&lt;/span&gt;
        Class.forName(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2 获得连接&lt;/span&gt;
        Connection conn = DriverManager.getConnection(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc:mysql://localhost:3306/test&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3语句执行者&lt;/span&gt;
        Statement st = conn.praparedStatement(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;insert into t_user(username,password) values(?,?)&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3.1赋值&lt;/span&gt;
                st.setString(&lt;span&gt;1&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;xiaoming&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                st.setString(&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;123&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;4 执行DML语句&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; r =&lt;span&gt; st.executeUpdate();
        
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;5处理数据&lt;/span&gt;
        System.&lt;span&gt;out&lt;/span&gt;&lt;span&gt;.println(r);
        
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;6释放资源
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;rs.close();&lt;/span&gt;
&lt;span&gt;        st.close();
        conn.close();
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;save()&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;2.3、更新操作 （Update）&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('5fb93c05-ca55-4fa5-b06c-fdad2257f063')&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_5fb93c05-ca55-4fa5-b06c-fdad2257f063&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_5fb93c05-ca55-4fa5-b06c-fdad2257f063&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('5fb93c05-ca55-4fa5-b06c-fdad2257f063',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_5fb93c05-ca55-4fa5-b06c-fdad2257f063&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Test
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; update() throws Exception{
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1 注册驱动&lt;/span&gt;
        Class.forName(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2 获得连接&lt;/span&gt;
        Connection conn = DriverManager.getConnection(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc:mysql://localhost:3306/test&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3语句执行者&lt;/span&gt;
        Statement st = conn.praparedStatement(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;update t_user set username = ？ where id = ？ &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3.1赋值参数&lt;/span&gt;
                st.setString(&lt;span&gt;1&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;xiaoye&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                st.setInt(&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;,&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;4 执行DML语句&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; r =&lt;span&gt; st.executeUpdate();
        
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;5处理数据&lt;/span&gt;
        System.&lt;span&gt;out&lt;/span&gt;&lt;span&gt;.println(r);
        
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;6释放资源
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;rs.close();&lt;/span&gt;
&lt;span&gt;        st.close();
        conn.close();
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;update()&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;2.4、删除操作（delete）&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('68215119-e262-442b-baf1-db4e0b23a8e2')&quot; readability=&quot;34&quot;&gt;&lt;img id=&quot;code_img_closed_68215119-e262-442b-baf1-db4e0b23a8e2&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_68215119-e262-442b-baf1-db4e0b23a8e2&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('68215119-e262-442b-baf1-db4e0b23a8e2',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_68215119-e262-442b-baf1-db4e0b23a8e2&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Test
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; delete() throws Exception{
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1 注册驱动&lt;/span&gt;
        Class.forName(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2 获得连接&lt;/span&gt;
        Connection conn = DriverManager.getConnection(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc:mysql://localhost:3306/test&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3语句执行者&lt;/span&gt;
        Statement st = conn.praparedStatement(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;delete from t_user where id = ?&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;3.1赋值参数&lt;/span&gt;
                st.setInt(&lt;span&gt;1&lt;/span&gt;,&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;4 执行DML语句&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; r =&lt;span&gt; st.executeUpdate();
        
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;5处理数据&lt;/span&gt;
        System.&lt;span&gt;out&lt;/span&gt;&lt;span&gt;.println(r);
        
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;6释放资源
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;rs.close();&lt;/span&gt;
&lt;span&gt;        st.close();
        conn.close();
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;delete()&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;　　也可以用我前面写的JDBC连接的工具类去连接！&lt;/p&gt;

&lt;p&gt;　　在上面，我们在进行CRUD时，一直重复性的写一些代码，比如最开始的注册驱动，获取连接代码，一直重复写，通过编写一个获取连接的工具类后，解决了这个问题，但是又&lt;/p&gt;
&lt;p&gt;　　会出现新的问题，&lt;span&gt;每进行一次操作，就会获取一个连接，用完之后，就销毁，就这样一直新建连接，销毁连接，新建，销毁，连接Connection 创建与销毁 比较耗时的&lt;/span&gt;。所以应&lt;/p&gt;
&lt;p&gt;　　该要想办法解决这个问题？&lt;/p&gt;
&lt;p&gt;　　解决方法：&lt;/p&gt;
&lt;p&gt;　　　　连接池就是为了解决这个问题而出现的一个方法，&lt;span&gt;为了提高性能，开发连接池，连接池中一直保持有n个连接，供调用者使用，调用者用完返还给连接池，继续给别的调用&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　者使&lt;/span&gt;&lt;span&gt;用&lt;/span&gt;，比如连接池中一开始就有10个连接，当有5个用户拿走了5个连接后，池中还剩5个，当第6个用户在去池中拿连接而前面5个连接还没归还时，连接池就会新建一个&lt;/p&gt;
&lt;p&gt;　　　　连接给第六个用户，让池中一直能够保存最少5个连接，而当这样新建了很多连接后，用户归还连接回来时，会比原先连接池中的10个连接更多，&lt;span&gt;连接池就会设置一个池中&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　最大空闲的连&lt;/span&gt;&lt;span&gt;接数，如果超过了这个数，就会将超过的连接给&lt;/span&gt;&lt;span&gt;释放掉&lt;/span&gt;，连接池就是这样工作的。&lt;/p&gt;
&lt;h2&gt;3.1、连接池概述&lt;/h2&gt;
&lt;p&gt;　　数据库连接池&lt;span&gt;负责分配、管理和释放数据库连接&lt;/span&gt;，它&lt;span&gt;允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个&lt;/span&gt;；&lt;span&gt;释放空闲时间超过最大空闲时间的数据库连接来避&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　免因&lt;/span&gt;&lt;span&gt;为没有释放数据库连接而引起的数据库连接遗漏&lt;/span&gt;。这项技术能明显提高对数据库操作的性能。&lt;/p&gt;
&lt;h2&gt;3.2、比较应用程序直接获取连接和使用连接池&lt;/h2&gt;
&lt;p&gt;　　1）应用程序直接获取连接&lt;/p&gt;
&lt;p&gt;　　　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/999804/201711/999804-20171101110238248-1965371301.png&quot; alt=&quot;&quot; width=&quot;568&quot; height=&quot;277&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　　　缺点：用户每次请求都需要向数据库获得链接，而数据库创建连接通常需要消耗相对较大的资源，创建时间也较长。&lt;/p&gt;
&lt;p&gt;　　　　　　    假设网站一天10万访问量，数据库服务器就需要创建10万次连接，极大的浪费数据库的资源，并且极易造成数据库服务器内存溢出、宕机。&lt;/p&gt;
&lt;p&gt;　　2）使用连接池连接&lt;/p&gt;
&lt;p&gt;　　　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/999804/201711/999804-20171101110455013-1326398434.png&quot; alt=&quot;&quot; width=&quot;562&quot; height=&quot;304&quot;/&gt;　&lt;/p&gt;
&lt;p&gt;　　　　目的：解决建立数据库连接耗费资源和时间很多的问题，提高性能。&lt;/p&gt;

&lt;p&gt;　　现在很多WEB服务器(Weblogic, WebSphere, Tomcat)都提供了DataSoruce的实现，即连接池的实现。通常我们把DataSource的实现，按其英文含义称之为数据源，&lt;/p&gt;
&lt;p&gt;　　数据源中都包含了数据库连接池的实现。&lt;br/&gt;　　也有一些开源组织提供了数据源的独立实现：&lt;br/&gt;　　　　DBCP 数据库连接池&lt;br/&gt;　　　　C3P0 数据库连接池&lt;br/&gt;　　&lt;span&gt;实际应用时不需要编写连接数据库代码，直接从数据源获得数据库的连接&lt;/span&gt;。程序员编程时也应尽量使用这些数据源的实现，以提升程序的数据库访问性能。&lt;/p&gt;
&lt;p&gt;　　DBCP、C3P0、tomcat内置连接池(JNDI)是我们开发中会用到的。&lt;/p&gt;
&lt;h2&gt;4.1、DBCP连接池&lt;/h2&gt;
&lt;p&gt;　　1）概述&lt;/p&gt;
&lt;p&gt;　　　　DBCP 是 Apache 软件基金组织下的开源连接池实现，使用DBCP数据源，应用程序应在系统中增加如下两个 jar 文件：&lt;br/&gt;　　　　　　Commons-dbcp.jar：连接池的实现&lt;br/&gt;　　　　　　Commons-pool.jar：连接池实现的依赖库&lt;br/&gt;　　　　Tomcat 的连接池正是&lt;span&gt;采用该连接池来实现的&lt;/span&gt;。该数据库连接池既可以与应用服务器整合使用，也可由应用程序独立使用。&lt;/p&gt;
&lt;p&gt;　　1）获取连接的两种方式&lt;/p&gt;
&lt;p&gt;　　　　两种方式&lt;span&gt;获得连接，使用配置文件，不使用配置文件&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;　　　　1.1）不使用配置文件，自己手动设置参数&lt;/p&gt;
&lt;p&gt; 　　　　　　第一：导包&lt;/p&gt;
&lt;p&gt;　　　　　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/999804/201711/999804-20171101142542341-1930980814.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　　　　　第二：测试例子&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('14a691fe-d3f3-4fb5-a92a-54352db344ed')&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_14a691fe-d3f3-4fb5-a92a-54352db344ed&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_14a691fe-d3f3-4fb5-a92a-54352db344ed&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('14a691fe-d3f3-4fb5-a92a-54352db344ed',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_14a691fe-d3f3-4fb5-a92a-54352db344ed&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package com.zyh.util;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import org.apache.commons.dbcp.BasicDataSource;


&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TestDBCP {

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
        Connection conn &lt;/span&gt;=&lt;span&gt; TestDBCP.getConnection();
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            String sql &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;select id,name,price from book&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
            PreparedStatement ps &lt;/span&gt;=&lt;span&gt; conn.prepareStatement(sql);
            ResultSet rs &lt;/span&gt;=&lt;span&gt; ps.executeQuery();
            &lt;/span&gt;&lt;span&gt;while&lt;/span&gt;&lt;span&gt;(rs.next()){
                String id &lt;/span&gt;= rs.getString(&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
                String name &lt;/span&gt;= rs.getString(&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;double&lt;/span&gt; price = rs.getDouble(&lt;span&gt;3&lt;/span&gt;&lt;span&gt;);
                System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.println(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;id=&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+id+&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,name=&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+name+&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,price=&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+&lt;span&gt;price);
                System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.println(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;-------------------------&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            }
            
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SQLException e) {
            e.printStackTrace();
        }
        
    }
    
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Connection getConnection(){
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;创建核心类&lt;/span&gt;
                BasicDataSource bds = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; BasicDataSource();
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;配置4个基本参数&lt;/span&gt;
                bds.setDriverClassName(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                bds.setUrl(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc:mysql:///book&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                bds.setUsername(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                bds.setPassword(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;654321&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
                
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;管理连接配置&lt;/span&gt;
                bds.setMaxActive(&lt;span&gt;50&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;最大活动数&lt;/span&gt;
                bds.setMaxIdle(&lt;span&gt;20&lt;/span&gt;);  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;最大空闲数&lt;/span&gt;
                bds.setMinIdle(&lt;span&gt;5&lt;/span&gt;);  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;最小空闲数&lt;/span&gt;
                bds.setInitialSize(&lt;span&gt;10&lt;/span&gt;);  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;初始化个数
                
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;获取连接&lt;/span&gt;
                &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                     Connection conn &lt;/span&gt;=&lt;span&gt; bds.getConnection();
                     &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; conn;
                } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SQLException e) {
                    &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RuntimeException(e);
                    }
    }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;TestDBCP&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;　　　　1.2）使用&lt;span&gt;配置文件，参数写入配置文件中即可，也就是通过配置文件来配置驱动、用户名、密码、等信息&lt;/span&gt;　　&lt;/p&gt;
&lt;p&gt;　　　　　　第一：导包&lt;/p&gt;
&lt;p&gt;　　　　　　和上面的一样的&lt;/p&gt;
&lt;p&gt;　　　　　　第二：导入配置文件dbcpconfig.properties&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('378a24a8-15a1-4ad0-8ffb-9dc9f8c796c5')&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_378a24a8-15a1-4ad0-8ffb-9dc9f8c796c5&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_378a24a8-15a1-4ad0-8ffb-9dc9f8c796c5&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('378a24a8-15a1-4ad0-8ffb-9dc9f8c796c5',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_378a24a8-15a1-4ad0-8ffb-9dc9f8c796c5&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#连接设置
driverClassName&lt;/span&gt;=&lt;span&gt;com.mysql.jdbc.Driver
url&lt;/span&gt;=jdbc:mysql:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;localhost:3306/book&lt;/span&gt;
username=&lt;span&gt;root
password&lt;/span&gt;=&lt;span&gt;654321&lt;/span&gt;&lt;span&gt;

#&lt;/span&gt;&amp;lt;!-- 初始化连接 --&amp;gt;&lt;span&gt;
initialSize&lt;/span&gt;=&lt;span&gt;10&lt;/span&gt;&lt;span&gt;

#最大连接数量
maxActive&lt;/span&gt;=&lt;span&gt;50&lt;/span&gt;&lt;span&gt;

#&lt;/span&gt;&amp;lt;!-- 最大空闲连接 --&amp;gt;&lt;span&gt;
maxIdle&lt;/span&gt;=&lt;span&gt;20&lt;/span&gt;&lt;span&gt;

#&lt;/span&gt;&amp;lt;!-- 最小空闲连接 --&amp;gt;&lt;span&gt;
minIdle&lt;/span&gt;=&lt;span&gt;5&lt;/span&gt;&lt;span&gt;

#&lt;/span&gt;&amp;lt;!-- 超时等待时间以毫秒为单位 6000毫秒/1000等于60秒 --&amp;gt;&lt;span&gt;
maxWait&lt;/span&gt;=&lt;span&gt;60000&lt;/span&gt;&lt;span&gt;


#JDBC驱动建立连接时附带的连接属性属性的格式必须为这样：[属性名&lt;/span&gt;=&lt;span&gt;property;] 
#注意：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; 与 &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;password&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; 两个属性会被明确地传递，因此这里不需要包含他们。
connectionProperties&lt;/span&gt;=useUnicode=&lt;span&gt;true&lt;/span&gt;;characterEncoding=&lt;span&gt;gbk

#指定由连接池所创建的连接的自动提交（auto&lt;/span&gt;-&lt;span&gt;commit）状态。
defaultAutoCommit&lt;/span&gt;=&lt;span&gt;true&lt;/span&gt;&lt;span&gt;

#driver &lt;/span&gt;&lt;span&gt;default&lt;/span&gt; 指定由连接池所创建的连接的只读（read-&lt;span&gt;only）状态。
#如果没有设置该值，则“setReadOnly”方法将不被调用。（某些驱动并不支持只读模式，如：Informix）
defaultReadOnly&lt;/span&gt;=&lt;span&gt;

#driver &lt;/span&gt;&lt;span&gt;default&lt;/span&gt;&lt;span&gt; 指定由连接池所创建的连接的事务级别（TransactionIsolation）。
#可用值为下列之一：（详情可见javadoc。）NONE,READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE
defaultTransactionIsolation&lt;/span&gt;=READ_UNCOMMITTED
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;dbcpconfig.properties&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;　　　　　　第三：获取连接，测试例子&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('60c8883a-d48e-4d14-aad2-a7b1007e7ac2')&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_60c8883a-d48e-4d14-aad2-a7b1007e7ac2&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_60c8883a-d48e-4d14-aad2-a7b1007e7ac2&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('60c8883a-d48e-4d14-aad2-a7b1007e7ac2',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_60c8883a-d48e-4d14-aad2-a7b1007e7ac2&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package com.zyh.util;

import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Properties;

import javax.sql.DataSource;

import org.apache.commons.dbcp.BasicDataSourceFactory;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TestDBCPPro {

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
        Connection conn &lt;/span&gt;=&lt;span&gt; TestDBCPPro.getConnection();
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            String sql &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;select id,name,price from book&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
            PreparedStatement ps &lt;/span&gt;=&lt;span&gt; conn.prepareStatement(sql);
            ResultSet rs &lt;/span&gt;=&lt;span&gt; ps.executeQuery();
            &lt;/span&gt;&lt;span&gt;while&lt;/span&gt;&lt;span&gt;(rs.next()){
                String id &lt;/span&gt;= rs.getString(&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
                String name &lt;/span&gt;= rs.getString(&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;double&lt;/span&gt; price = rs.getDouble(&lt;span&gt;3&lt;/span&gt;&lt;span&gt;);
                System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.println(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;id=&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+id+&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,name=&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+name+&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,price=&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;+&lt;span&gt;price);
                System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.println(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;-------------------------&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            }
            
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SQLException e) {
            e.printStackTrace();
        }
    }
    
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Connection getConnection(){
         &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;通过类加载器获取指定配置文件的输入流，TestDBCPPro是一个类名&lt;/span&gt;
        InputStream &lt;span&gt;in&lt;/span&gt; = TestDBCPPro.&lt;span&gt;class&lt;/span&gt;.getClassLoader().getResourceAsStream(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;dbcpconfig.properties&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        Properties properties &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Properties();
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                properties.load(&lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;加载配置文件，获得配置信息&lt;/span&gt;
                DataSource ds =&lt;span&gt; BasicDataSourceFactory.createDataSource(properties);
                Connection conn &lt;/span&gt;=&lt;span&gt; ds.getConnection();
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; conn;
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
            e.printStackTrace();
        }
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
    }
    

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;TestDBCPPro&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;　　　　1.3）编写一个数据源工具类&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('5ed5ba06-e8d6-44e4-acd1-ca7939b3d3a8')&quot; readability=&quot;33.5&quot;&gt;&lt;img id=&quot;code_img_closed_5ed5ba06-e8d6-44e4-acd1-ca7939b3d3a8&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_5ed5ba06-e8d6-44e4-acd1-ca7939b3d3a8&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('5ed5ba06-e8d6-44e4-acd1-ca7939b3d3a8',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_5ed5ba06-e8d6-44e4-acd1-ca7939b3d3a8&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package com.zyh.util;


import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Properties;

import javax.imageio.stream.FileImageInputStream;
import javax.sql.DataSource;

import org.apache.commons.dbcp.BasicDataSourceFactory;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; DBCPUtils {
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; DataSource ds = &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;static&lt;/span&gt;&lt;span&gt;{
        Properties prop &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Properties();
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            prop.load(DBCPUtils.&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;.getClassLoader().getResourceAsStream(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;dbcpconfig.properties&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;根据DBCPUtil的classes的路径，加载配置文件&lt;/span&gt;
            ds = BasicDataSourceFactory.createDataSource(prop);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;得到一个数据源 &lt;/span&gt;
        } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
            &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; ExceptionInInitializerError(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;初始化错误，请检查配置文件&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        }
    }
    
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Connection getConnection(){
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; ds.getConnection();
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SQLException e) {
            &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RuntimeException(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;服务器忙。。。&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        }
    }
    
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; release(Connection conn,Statement stmt,ResultSet rs){
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;关闭资源&lt;/span&gt;
                &lt;span&gt;if&lt;/span&gt;(rs!=&lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
                    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                        rs.close();
                    } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
                        e.printStackTrace();
                    }
                    rs &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
                }
                &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(stmt!=&lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
                    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                        stmt.close();
                    } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
                        e.printStackTrace();
                    }
                    stmt &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
                }
                &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(conn!=&lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
                    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                        conn.close();&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;关闭&lt;/span&gt;
                    } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
                        e.printStackTrace();
                    }
                    conn &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
                }
    }
    
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;DBCPUtils&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;4.2、C3P0&lt;/h2&gt;
&lt;p&gt;　　1）导包&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/999804/201711/999804-20171101150225732-246627734.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　2）从配置信息中获取  配置文件必须为xml（c3p0-config.xml）&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('bd20a9bd-4504-4ba8-b048-995ff92e96ee')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_bd20a9bd-4504-4ba8-b048-995ff92e96ee&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_bd20a9bd-4504-4ba8-b048-995ff92e96ee&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('bd20a9bd-4504-4ba8-b048-995ff92e96ee',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_bd20a9bd-4504-4ba8-b048-995ff92e96ee&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&amp;lt;c3p0-config&amp;gt;
    &amp;lt;!-- 默认配置，如果没有指定则使用这个配置 --&amp;gt;
    &amp;lt;&lt;span&gt;default&lt;/span&gt;-config&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;driverClass&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;com.mysql.jdbc.Driver&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbcUrl&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;jdbc:mysql:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;localhost:3306/book&amp;lt;/property&amp;gt;&lt;/span&gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;root&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;password&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;654321&lt;/span&gt;&amp;lt;/property&amp;gt;
    
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;checkoutTimeout&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;30000&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;idleConnectionTestPeriod&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;30&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;initialPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;10&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxIdleTime&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;30&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;100&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;minPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;10&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxStatements&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;200&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;user-overrides user=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;test-user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;10&lt;/span&gt;&amp;lt;/property&amp;gt;
            &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;minPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;1&lt;/span&gt;&amp;lt;/property&amp;gt;
            &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxStatements&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;0&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;/user-overrides&amp;gt;
    &amp;lt;/&lt;span&gt;default&lt;/span&gt;-config&amp;gt; 
    &amp;lt;!-- 命名的配置 --&amp;gt;
    &amp;lt;named-config name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jxpx&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;driverClass&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;com.mysql.jdbc.Driver&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbcUrl&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;jdbc:mysql:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;localhost:3306/myums&amp;lt;/property&amp;gt;&lt;/span&gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;root&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;password&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;root&amp;lt;/property&amp;gt;
    &amp;lt;!-- 如果池中数据连接不够时一次增长多少个 --&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;acquireIncrement&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;5&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;initialPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;20&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;minPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;10&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;40&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxStatements&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;0&lt;/span&gt;&amp;lt;/property&amp;gt;
        &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxStatementsPerConnection&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;5&lt;/span&gt;&amp;lt;/property&amp;gt;
    &amp;lt;/named-config&amp;gt;
&amp;lt;/c3p0-config&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;c3p0-config.xml&lt;/span&gt;　　&lt;/div&gt;
&lt;p&gt;　　　　从配置文件中看，需要注意一个地方，&lt;span&gt;一个是default-config，一个是name-config&lt;/span&gt;，两者都区别在于&lt;span&gt;创建核心类对象时，如果将name-config作为参数传进去，&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　那么将会调用name-config下的配置信息，否则将调用default-config下的配置信息，&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;　　　　两种方式使用c3p0，&lt;span&gt;加参数，使用named-config 的配置信息&lt;/span&gt;，&lt;span&gt;不加参数，自动加载配置信息，加载的是default-config中的信息。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;1 c3p0...jar 将自动加载配置文件。规定：WEB-INF/classes (src)  c3p0-config.xml,也就是将配置文件放在src下就会自动加载。
         &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ComboPooledDataSource dataSource = new ComboPooledDataSource(); &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;自动从配置文件 &amp;lt;default-config&amp;gt;&lt;/span&gt;
         ComboPooledDataSource dataSource = &lt;span&gt;new&lt;/span&gt; ComboPooledDataSource(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;手动指定配置文件 &amp;lt;named-config name=&quot;jxpx&quot;&amp;gt;&lt;/span&gt;
         Connection conn =&lt;span&gt; dataSource.getConnection();
         System.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;.println(conn);
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;　　3）编写一个数据源工具类&lt;/p&gt;
&lt;p&gt;　　这个工具类的xml是：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('3070a96d-30fb-458d-b82c-4d7081a8a432')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_3070a96d-30fb-458d-b82c-4d7081a8a432&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_3070a96d-30fb-458d-b82c-4d7081a8a432&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('3070a96d-30fb-458d-b82c-4d7081a8a432',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_3070a96d-30fb-458d-b82c-4d7081a8a432&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&amp;lt;?xml version=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1.0&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; encoding=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;UTF-8&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;c3p0-config&amp;gt;
  &amp;lt;&lt;span&gt;default&lt;/span&gt;-config&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;driverClass&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;com.mysql.jdbc.Driver&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbcUrl&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;jdbc:mysql:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;localhost:3306/book/property&amp;gt;&lt;/span&gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;root&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;password&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;654321&lt;/span&gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;initialPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;10&lt;/span&gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxIdleTime&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;30&lt;/span&gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;maxPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;100&lt;/span&gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;minPoolSize&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;span&gt;10&lt;/span&gt;&amp;lt;/property&amp;gt;

  &amp;lt;/&lt;span&gt;default&lt;/span&gt;-config&amp;gt;

&amp;lt;/c3p0-config&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;c3p0-config.xml&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;　　工具类&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('db12a3ba-afba-4a1e-93f2-67714451c172')&quot; readability=&quot;33.5&quot;&gt;&lt;img id=&quot;code_img_closed_db12a3ba-afba-4a1e-93f2-67714451c172&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_db12a3ba-afba-4a1e-93f2-67714451c172&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('db12a3ba-afba-4a1e-93f2-67714451c172',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_db12a3ba-afba-4a1e-93f2-67714451c172&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package com.zyh.util;

import java.beans.PropertyVetoException;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.sql.DataSource;

import com.mchange.v2.c3p0.ComboPooledDataSource;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; C3P0Util {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;得到一个数据源&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; DataSource dataSource = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ComboPooledDataSource();
    
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;从数据源中得到一个连接对象&lt;/span&gt;
    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Connection getConnection(){
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; dataSource.getConnection();
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (SQLException e) {
            &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RuntimeException(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;服务器错误&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        }
    }
    
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; release(Connection conn,Statement stmt,ResultSet rs){
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;关闭资源&lt;/span&gt;
                &lt;span&gt;if&lt;/span&gt;(rs!=&lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
                    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                        rs.close();
                    } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
                        e.printStackTrace();
                    }
                    rs &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
                }
                &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(stmt!=&lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
                    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                        stmt.close();
                    } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
                        e.printStackTrace();
                    }
                    stmt &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
                }
                &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(conn!=&lt;span&gt;null&lt;/span&gt;&lt;span&gt;){
                    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                        conn.close();&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;关闭&lt;/span&gt;
                    } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
                        e.printStackTrace();
                    }
                    conn &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
                }
    }
    
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;C3P0Util&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;4.3、用JavaWeb服务器管理数据源：Tomcat&lt;/h2&gt;
&lt;p&gt;　　开发JavaWeb应用，必须使用一个JavaWeb服务器，&lt;span&gt;JavaWeb服务器都内置数据源&lt;/span&gt;。&lt;br/&gt;　　Tomcat：（DBCP）&lt;br/&gt;　　&lt;span&gt;数据源只需要配置服务器即可&lt;/span&gt;。&lt;br/&gt;　　配置数据源的步骤：&lt;br/&gt;　　　　1）&lt;span&gt;拷贝数据库连接的jar到tomcatlib目录下&lt;/span&gt;&lt;br/&gt;　　　　2）配置数据源XML文件&lt;br/&gt;　　　　　　a)如果把配置信息写在tomcat下的conf目录的context.xml中，那么所有应用都能使用此数据源。&lt;br/&gt;　　　　　　b)如果是在当前应用的META-INF中创建context.xml, 编写数据源，那么只有当前应用可以使用。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('9daa112d-e0f4-4fd3-8361-ebef4c7dce3c')&quot; readability=&quot;32&quot;&gt;&lt;img id=&quot;code_img_closed_9daa112d-e0f4-4fd3-8361-ebef4c7dce3c&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_9daa112d-e0f4-4fd3-8361-ebef4c7dce3c&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('9daa112d-e0f4-4fd3-8361-ebef4c7dce3c',event)&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_9daa112d-e0f4-4fd3-8361-ebef4c7dce3c&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;59&quot;&gt;
&lt;pre&gt;
&amp;lt;Context&amp;gt;
  &amp;lt;Resource name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc/datasource&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; auth=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Container&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
            type&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;javax.sql.DataSource&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; username=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;root&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; password=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;654321&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
            driverClassName&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.mysql.jdbc.Driver&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; 
          url&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc:mysql://localhost:3306/book&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
            maxActive&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;8&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; maxIdle=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/Context&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;context.xml&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;　　在servlet中进行测试：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
　　Context initCtx = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; InitialContext();
　　Context envCtx &lt;/span&gt;= (Context) initCtx.lookup(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;java:comp/env&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);  //path
　　dataSource &lt;/span&gt;= (DataSource)envCtx.lookup(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;jdbc/datasource&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;);   //context.xml中resource的name
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　注意：此种配置下，驱动jar文件需放置在tomcat的lib下　　&lt;/p&gt;
&lt;p&gt;　　扩展：&lt;/p&gt;
&lt;p&gt;　　　　JNDI技术介绍：&lt;/p&gt;
&lt;p&gt;　　　　　　1）JNDI(Java Naming and Directory Interface)，&lt;span&gt;Java命名和目录接口，它对应于J2SE中的javax.naming包。&lt;/span&gt;&lt;br/&gt;　　　　　　2）这套API的主要作用在于：&lt;/p&gt;
&lt;p&gt;　　　　　　　　它可以&lt;span&gt;把Java对象放在一个容器中（JNDI容器），并为容器中的java对象取一个名称，以后程序想获得Java对象，只需通过名称检索即可&lt;/span&gt;。&lt;br/&gt;　　　　　　3）其核心API为&lt;span&gt;Context，它代表JNDI容器&lt;/span&gt;，其lookup方法为检索容器中对应名称的对象。&lt;/p&gt;

</description>
<pubDate>Wed, 01 Nov 2017 07:40:00 +0000</pubDate>
<dc:creator>苦水润喉</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/zhangyinhua/p/7765626.html</dc:identifier>
</item>
<item>
<title>跨平台这件事儿 - 风的姿态</title>
<link>http://www.cnblogs.com/fengzheng/p/7766719.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/fengzheng/p/7766719.html</guid>
<description>&lt;p class=&quot;second&quot;&gt;跨平台很神秘吗&lt;/p&gt;
&lt;p&gt;刚刚开始做开发的时候，感觉跨平台是那么高大上，就像夕阳下，湖面上的一朵白莲花，只可远观，不可亵玩焉。那么，跨平台到底是怎么一回事儿。难道真的有什么东西可以跨平台吗，这就像一台多功能交通设备，投到水里能游，放到陆地上能跑，扔到天上能飞，加速到第二宇宙速度都能脱离地球了进行星际航行了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/273364/201711/273364-20171101151829123-1959072701.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p class=&quot;second&quot;&gt;揭开跨平台神秘面纱&lt;/p&gt;
&lt;p&gt;让我们一起来揭开跨平台神秘的面纱，比起一种语言是不是跨平台的，我们更关心的是功能可不可以跨平台，毕竟我们使用各种开发语言是为了实现某些功能。举个例子，假设我们打算用 Java 开发了一款游戏，这个游戏要跨 Mac、Windows、桌面版Linux 三个平台，怎么完成这个功能呢。&lt;/p&gt;
&lt;p&gt;假设要完成游戏中人物的显示，这样一个看似很简单的功能，程序从上层向下层要做下面这些：&lt;/p&gt;
&lt;p&gt;1、最上层 Java 要调用一个图像相关的类库；&lt;/p&gt;
&lt;p&gt;2、这个类库要调用系统层提供的接口，比如显卡驱动相关接口；&lt;/p&gt;
&lt;p&gt;3、这个显卡驱动相关的接口又调用了显卡的硬件接口；&lt;/p&gt;
&lt;p&gt;我们再从下向上分析一下，如果要做到跨平台要做到什么？&lt;/p&gt;
&lt;p&gt;1、最后调用到了硬件接口，那么首先要保证硬件是相同的，比如显卡是相同的，这就要保证世界上各大显卡厂商使用相同的标准；&lt;/p&gt;
&lt;p&gt;2、再往上保证显卡配套的显卡驱动接口是相同的；&lt;/p&gt;
&lt;p&gt;3、再往上还要保证系统暴露给上层的驱动接口调用 API 是相同的，这就要求三个平台具有相同的驱动 API 标准；&lt;/p&gt;
&lt;p&gt;通过以上我们发现一个语言可不可以跨平台要看它的下一层是不是跨平台，依次类推，最后总会到达硬件层次。最后得出的结论就是只有硬件是同一种标准，那才能实现真正意义上的跨平台。但是由于历史、商业等等各种原因，导致完全统一标准几乎是不可能的。&lt;/p&gt;
&lt;p&gt;所以目前所说的语言跨平台、框架跨平台都是用其他方式实现的，并且我们可以把这里的平台理解为语言、框架的下一层级的载体。&lt;/p&gt;
&lt;p class=&quot;second&quot;&gt;几种语言的跨平台方式&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/273364/201711/273364-20171101151843779-470600973.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img class=&quot;img_loading&quot; src=&quot;data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==&quot; alt=&quot;&quot; data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/iaWSDo4TfyZjLqUL3ExZvxD3H5o92nLfZxWqV7LnibPnbYx30MInv9KqVQK3o5BBz72FHdhPH6ibBRpYs3FZzs2vg/0?wx_fmt=jpeg&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.425531914893617&quot; data-w=&quot;940&quot;/&gt;&lt;/p&gt;
&lt;p&gt;比如说 &lt;strong&gt;HTML&lt;/strong&gt; 是跨平台的，他跨的平台指的是浏览器，浏览器几乎都遵循 w3c 标准，所以 HTML 是这样实现跨平台的。&lt;/p&gt;
&lt;p&gt;比如说 &lt;strong&gt;C&lt;/strong&gt; 语言是不是跨平台的，C 语言常常被用在偏底层的开发。那么 C 语言是如果在多个平台运行的呢？首先要编写代码，编写的代码要兼容要跨的平台，要支持 windows 平台，那么就要为 windows 实现一套代码，要支持 Linux 就要为 Linux 实现一套，然后当要执行的时候，简单粗暴的说就是加上 &lt;code&gt;if else&lt;/code&gt;做个判断，是哪个平台就用其对应的代码，著名的 GUI 开发框架 Qt j就是这个原理嘛，框架本身帮你做好了平台判断，在哪个平台就用哪个平台下的 GUI 接口，所以开发者只需要调用它包装包的接口即可。写完代码之后，拿这套代码到各个平台去编译成当前平台需要的格式，这里又涉及到了编译器，不同平台下的编译器也是不同， windows 下的编译器需要把 C 代码编译成 windows 下可执行的文件格式，Linux 下的编译器需要把 C 代码编译成 Linux 下的可执行文件格式。&lt;/p&gt;
&lt;p&gt;再比如说 &lt;strong&gt;Java&lt;/strong&gt; , Java 的口号是 &lt;strong&gt;Write once, run anywhere&lt;/strong&gt;，也就是一次编写，到处运行（跨平台运行）。听上去比 C 语言还要厉害，写一次就好，不用再到各个平台上去编译，厉害了。这都要归功到 JVM（Java 虚拟机）上，JVM 有他自己的字节码格式和具体的执行机制，只要把 Java 代码编译成 JVM 需要的字节码即可。以开发者的视角，确实是跨平台了。但是具体是怎么实现的呢？首先我们安装 JDK 的时候会根据平台不同选择不同的版本，当然 JVM 也就选择了不同的版本，而代码要执行的时候，不同平台版本的 JVM 会根据自身所在的平台，把字节码转换成平台所需的机器码。看着是不是很眼熟，这不就是 C 语言里不同平台的编译器吗。&lt;/p&gt;
&lt;p&gt;回到最开始提到的那个交通设备，真的要把把它做出来，那要具备涡轮一类的推水装置、 路面行走的轮子、喷气式装置，甚至核能推进器。总结起来就是说，要跨平台就要有对应平台的功能实现。作为开发者来说，我们使用的一些语言或框架可以方便的跨平台，不需要我们关系细节，是因为语言或框架本身帮我们做了繁杂的适配工作。&lt;/p&gt;
&lt;p&gt;揭开跨平台的面纱，是不是感觉这概念没那么神秘了。&lt;/p&gt;
&lt;p&gt;欢迎关注公众号「gushidefengzheng」古时的风筝&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/273364/201711/273364-20171101152347138-843465876.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 01 Nov 2017 07:28:00 +0000</pubDate>
<dc:creator>风的姿态</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/fengzheng/p/7766719.html</dc:identifier>
</item>
<item>
<title>程序员的未来在哪里？ - 陈树义</title>
<link>http://www.cnblogs.com/chanshuyi/p/the_future_of_coder.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/chanshuyi/p/the_future_of_coder.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/595137/201711/595137-20171101151050904-1203771584.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;随着互联网创业潮的兴起，作为互联网核心的工程师们逐渐走入了大众的视野。但不知为何，程序员在许多人中的印象并不是特别好，蓬头垢面、满脸油光、格子衫、小短裤似乎成了程序员的代名词。&lt;/p&gt;
&lt;p&gt;反观同一公司里的其它岗位，产品、运营、市场岗位，却并不会给人留下不好的印象。同样作为程序员的我，不得不去思考这个问题：为什么收入并不比别人低，但为什么形象却不如人家？既然这样，那我们的努力有何意义？我们的未来到底在哪里？&lt;/p&gt;

&lt;h2 id=&quot;程序员的出身&quot;&gt;程序员的出身&lt;/h2&gt;
&lt;p&gt;要透彻地思考这个问题，就避不开出身这个根源问题。&lt;/p&gt;
&lt;p&gt;当离开养育我十几年的故乡踏上广州的求学之路时，我每个月只有800块的生活费。而这其实已经算是挺不错的生活条件了，有更多生活条件比我还差的同学。在吃饭问题刚刚得到解决，没有闲钱的情况下，人是没有能力去追求更高的物质享受的。&lt;/p&gt;
&lt;p&gt;在大学四年的时间里，我一心牵挂的是如何好好学习找到一份养家糊口的工作。于是乎我的大学可以说是比较平平淡淡的，经常是和好基友在自习室看书到晚上十余点。在现在看来，有时候会有那么一瞬间会觉得浪费了大学的大好时光，没有花点时间去学点才艺，但仔细想想也实属无奈，吃饭都成问题，还怎么追求精神享受呢。&lt;/p&gt;
&lt;p&gt;相信许多选读计算机的朋友也和我一样，并不是来自于大富大贵的家庭，更多的是普通的家庭。有一句话说得很好：穷人读工科、中产读商科、富人读艺术。对于绝大部分的普通人来说，合理的套路是：第一代读理工医科，有一技之长，安家立命，打好基础；第二代才能读金融商科，可以利用第一代的资源人脉，加强资本积累；最后第三代读人文社科，有前两代的基础，知道如何长久的维护他们手上的资源。根据我的观察，周围的程序员们确实出身于普通家庭，有的甚至是大山里的孩子。对于没有背景没有人脉的他们，有一技之长，安家立命才是最重要的。&lt;/p&gt;
&lt;h2 id=&quot;程序员的本质&quot;&gt;程序员的本质&lt;/h2&gt;
&lt;p&gt;在大学毕业后，毕业后拿到一份还算可以的薪资，但至少能养活自己。而且在后面几年里薪资也不断增长，至少现在的我已经不需要担心生存问题了。但这时我发现此时的我除了工作，似乎一无所有，没有兴趣、没有爱好、没有才艺、没有活动。&lt;/p&gt;
&lt;p&gt;我想去充实自己的业余生活，去学一门才艺、去发展一门爱好，但却发现时间怎么都不够用。此时，我渐渐意识到了程序员这个行业的本质所在。程序员钱多，但加班也多，个人的业余时间也变得少了。长此以往，整个人的交际技能会逐渐退化，人的生活也会变得稍微无趣。&lt;/p&gt;
&lt;p&gt;除了工作时间外，工作内容也是让人变得无趣的一个方面。程序员的内容都是各种枯燥的业务逻辑和机器，而且技术难题都需要静下心来才能深入理解。如果你的生活太精彩，你怎么可能静得下心来去做这么枯燥无味的事情啊。&lt;/p&gt;
&lt;p&gt;所以程序员的本质是出卖自己的时间和技能换取金钱，可以说是一个高级点的技工，只不过过得舒服自在点罢了。&lt;/p&gt;
&lt;h2 id=&quot;程序员为什么不受待见&quot;&gt;程序员为什么不受待见&lt;/h2&gt;
&lt;p&gt;知名科技博主月光博客曾经写过一篇文章《为什么程序员社会地位不高》，这篇文章很深刻地解释了程序员不受待见的原因。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;程序员的自我尊重和自我认知价值太低。&lt;/strong&gt;有一个现象可以证明这一点：程序员们互相厌恶。他们通常在非程序员面前抨击别的程序员。把一个程序员的代码给另外一个程序员，往往，常常，后者会给前者的工作以负面评价。艺术家不会这样。销售员不会这样。管理者不会这样。政治家这么做只是为了赢得选票。&lt;/p&gt;
&lt;p&gt;其他专业人士他们会公开的支持同行，即使他们有竞争。（例如律师，请不要问我为什么美国事实上是被这帮混蛋统治的）。简而言之，上面提到的这些行业人员拥有更大的行业事业，以自己的工作和行业自豪。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;程序员们并不追求浮华的头衔，性感的典礼、奖项、他们讨厌聚光灯。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;程序员们喜欢编程。他们想要独自编程。编程是他们的目标，是他们的政治，是他们的荣耀。他们对公共演讲不感兴趣。他们讨厌不如他们聪明的人。他们讨厌不理解C++编程逻辑的人。&lt;/p&gt;
&lt;p&gt;于是他开始慢慢说服自己生来就是内向的。所以他害怕外出，害怕接电话，害怕去泡吧，害怕去见陌生人，害怕所有能为他建立社会关系和社会地位的活动。&lt;/p&gt;
&lt;h2 id=&quot;程序员的未来&quot;&gt;程序员的未来&lt;/h2&gt;
&lt;p&gt;赚钱有三个层次，第一个层次是拿时间换金钱，第二个层次是拿资源换金钱，第三个层次是用钱赚钱。作为程序员的我显然还是处于拿时间换金钱的阶段，所以在很长时间里，我还是会作为一名程序员生活着。在这个阶段，我们积累技术、资源，为下个阶段做准备。&lt;/p&gt;
&lt;p&gt;当我们有了足够的技术实力和人脉资源之后，我们或许就不必事必躬亲去做一线代码工作了，我们可以拿着我们拥有的资源更加轻松地赚钱。这时候如果你还是喜欢Coding，你可以更加自由地做自己想做的事。这个阶段的你，生活必定比苦哈哈地干活来得有滋有味。&lt;/p&gt;
&lt;p&gt;而当你用资源交换得到的财富到达一个量级时，你完全可以通过投资去获取生活所需要的物质条件，这才真的是躺着赚钱。在这个阶段，你才可以真的说是人身自由的一个人。我想，到了这个阶段，你的梦想和对于这个世界的理解肯定会大有不同吧。&lt;/p&gt;
&lt;p&gt;想想刚刚毕业的我看着这几万几万的房价，一脸迷茫看不到希望，每天都在抱怨高房价中度过。但当我想通了我未来要走的路，我现在处于的阶段，我都释然了。该来的总会来的，该跌的房价总会跌，该涨的收入总会涨，该有的机会总会有。就像十年前总被说脑残的90后、被说成垮掉的一代，现在还不是走上了社会，担任了社会的中坚力量。&lt;/p&gt;
&lt;p&gt;其实回头想一想，程序员还是一个很幸运的群体，有这样一个顺畅的道路让你可以努力往上走。看看那些读机械、读食品专业的同学们，工作三年了现在估计还在几千块工资徘徊。想到这里，我很感激这个时代，给了我这么一个机会。&lt;/p&gt;
&lt;p&gt;想通了以后自己要走的路，该努力的努力，该吃的吃，该玩的玩。做该做的事情，尽量让自己的生活丰富起来，相信生活会越来越美好。&lt;/p&gt;

</description>
<pubDate>Wed, 01 Nov 2017 07:24:00 +0000</pubDate>
<dc:creator>陈树义</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/chanshuyi/p/the_future_of_coder.html</dc:identifier>
</item>
<item>
<title>多线程编程学习笔记——线程同步（二） - DotNet菜园</title>
<link>http://www.cnblogs.com/chillsrc/p/7766589.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/chillsrc/p/7766589.html</guid>
<description>&lt;p&gt;&lt;span&gt;1. 使用AutoResetEvent类来实现从一个线程向另一个线程发出通知。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.代码如下&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections.Generic;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Linq;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Text;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt; System.Threading; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;引入线程&lt;/span&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Diagnostics;

&lt;/span&gt;&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; ThreadSynchronousDemo
{
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Program
    {

        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; AutoResetEvent autoResetWork = &lt;span&gt;new&lt;/span&gt; AutoResetEvent(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; AutoResetEvent autoResetMain = &lt;span&gt;new&lt;/span&gt; AutoResetEvent(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; Main(&lt;span&gt;string&lt;/span&gt;&lt;span&gt;[] args)
        {

            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;开始，AutoResetEvent 同步&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);       

                &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; threadName = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程 1&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;         
                &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; t = &lt;span&gt;new&lt;/span&gt; Thread((() =&amp;gt; working(threadName, &lt;span&gt;10&lt;/span&gt;&lt;span&gt;)));

                t.Start();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;开始，第一次工作&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
 

            autoResetWork.WaitOne();&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;万事俱备只欠东风，事情卡在这里了，&lt;/span&gt;
&lt;span&gt;
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;第一次工作完成&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;主线程操作，准备发信号&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            Thread.Sleep(TimeSpan.FromSeconds(&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;));
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发信号，说明值已经被写进去了。这里的意思是说Set是一个发信号的方法。&lt;/span&gt;
&lt;span&gt;
            autoResetMain.Set();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;现在运行第二次工作。&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            autoResetWork.WaitOne();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;第二次工作完成&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            Console.Read();
        } 

        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; working(&lt;span&gt;string&lt;/span&gt; name,&lt;span&gt;int&lt;/span&gt;&lt;span&gt; seconds)
        {
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{0} 开始运行工作&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, name);
            Thread.Sleep(TimeSpan.FromSeconds(seconds));
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{0}  正在工作。。。。。。&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
              name);
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发信号，说明值已经被写进去了。这里的意思是说Set是一个发信号的方法。&lt;/span&gt;
&lt;span&gt;
            autoResetWork.Set();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;等待主线程完成工作，并发出信号&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            autoResetMain.WaitOne();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;主线程发来信号，开始第二次工作&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            Thread.Sleep(TimeSpan.FromSeconds(seconds));
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{0} 第二次工作正在进行中。。。。。&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, name);
            autoResetWork.Set();
        }
    }
}
 &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;3.程序运行结果，如下图。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/10343/201711/10343-20171101150418279-1847875723.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;         以上程序中，我们定义了两个AutoResetEvent实例。其中一个是从子线程往主线程发信号 ，另一个是主线程往子线程发信号。我们在构造AutoResetEvent时，传入了false，定义了这两个实例的初始状态unsignaled。这个状态下，任何线程调用这两个实例的WaitOne方法将会被阻塞，直到我们调用了Set方法。如果我们在构造的时候传入了true，则这两个实例的初始状态是singnaled，则线程调用WaitOne则会被立即处理。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;五、使用ManualResetEventSlim类&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1. 使用ManualResetEventSlim在线程间传递信号。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 2.代码如下&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections.Generic;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Linq;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Text;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt; System.Threading; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;引入线程&lt;/span&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Diagnostics; 

&lt;/span&gt;&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; ThreadSynchronousDemo
{
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Program
    {
        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; ManualResetEventSlim manuResetWork = &lt;span&gt;new&lt;/span&gt; ManualResetEventSlim(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);      

        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; Main(&lt;span&gt;string&lt;/span&gt;&lt;span&gt;[] args)
        {
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;开始，ManualResetEventSlim 同步&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);       

                &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; threadName = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程 1&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; threadName2 = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程 2&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
 

            &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; threadName3 = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程 3&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; t = &lt;span&gt;new&lt;/span&gt; Thread((() =&amp;gt; working(threadName, &lt;span&gt;3&lt;/span&gt;&lt;span&gt;)));
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; t2 = &lt;span&gt;new&lt;/span&gt; Thread((() =&amp;gt; working(threadName2, &lt;span&gt;6&lt;/span&gt;&lt;span&gt;)));

            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; t3 = &lt;span&gt;new&lt;/span&gt; Thread((() =&amp;gt; working(threadName3, &lt;span&gt;12&lt;/span&gt;&lt;span&gt;)));

            t.Start();
            t2.Start();
            t3.Start();
            Thread.Sleep(TimeSpan.FromSeconds(&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;));
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;开始，打开 线程工作大门&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            manuResetWork.Set(); &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发信号&lt;/span&gt;
            Thread.Sleep(TimeSpan.FromSeconds(&lt;span&gt;3&lt;/span&gt;&lt;span&gt;));
            manuResetWork.Reset();
           

            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程工作大门，关闭&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);         

            Thread.Sleep(TimeSpan.FromSeconds(&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;&lt;span&gt;));
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;打开线程工作大门第二次打开了&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            manuResetWork.Set(); &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;发信号&lt;/span&gt;
            Thread.Sleep(TimeSpan.FromSeconds(&lt;span&gt;3&lt;/span&gt;&lt;span&gt;));
            manuResetWork.Reset();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程工作大门，又关闭了&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            Console.Read();
        }

        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; working(&lt;span&gt;string&lt;/span&gt; name,&lt;span&gt;int&lt;/span&gt;&lt;span&gt; seconds)
        {

            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{0} 休息&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, name);
            Thread.Sleep(TimeSpan.FromSeconds(seconds));
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{0}  等待打开线程运行的大门&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
              name);
            manuResetWork.Wait();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;线程运行的大门打开了，{0} 进行工作&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, name);       

        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;3.程序运行结果，如下图。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/10343/201711/10343-20171101150504138-2059178676.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;      当主程序启动时，首先创建ManualResetEvenSlim类的一个实例，然后启动了三个线程，等待事件信号通知它们继续工作。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;      ManualResetEvenSlim的工作方式有点像人群通过大门，而AutoResetEvent事件像一个旋转门，一次只能通过一人。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;      ManualResetEvenSlim打开了大门，一直保持打开，直到调用了Reset方法。直到再次调用Set方法打开 大门。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;六、使用CountDownEvent类&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1. 使用CountDownEvent信号类来等待直到一定数量的操作完成。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.代码如下&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections.Generic;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Linq;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Text;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt; System.Threading; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;引入线程&lt;/span&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Diagnostics; 

&lt;/span&gt;&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; ThreadSynchronousDemo
{
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Program
    {
        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; CountdownEvent CountDownWork = &lt;span&gt;new&lt;/span&gt; CountdownEvent(&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);      

        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; Main(&lt;span&gt;string&lt;/span&gt;&lt;span&gt;[] args)
        {

            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;开始，CountdownEvent 同步&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);       

            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; t = &lt;span&gt;new&lt;/span&gt; Thread((() =&amp;gt; working(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;第 1 个工作线程任务&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;3&lt;/span&gt;&lt;span&gt;)));
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; t2 = &lt;span&gt;new&lt;/span&gt; Thread((() =&amp;gt; working(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;第 2 个工作线程任务&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;6&lt;/span&gt;&lt;span&gt;)));

            //&lt;/span&gt;&lt;span&gt;var t3 = new Thread((() =&amp;gt; working(&quot;第 3 个工作线程任务&quot;, 12)));&lt;/span&gt;
&lt;span&gt;            t.Start();
            t2.Start();
            //&lt;/span&gt;&lt;span&gt;t3.Start();&lt;/span&gt;
            Thread.Sleep(TimeSpan.FromSeconds(&lt;span&gt;5&lt;/span&gt;&lt;span&gt;));
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;开始，线程工作计数&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            CountDownWork.Wait();           

            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;计数完成，2个工作 已经完成！&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;如果把上面代码注释的第三个线程还原，释放对象，可以造成第三个线程的抛出错误&lt;/span&gt;
&lt;span&gt;
            CountDownWork.Dispose();     

            Console.Read();
        } 

        &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; working(&lt;span&gt;string&lt;/span&gt; message,&lt;span&gt;int&lt;/span&gt;&lt;span&gt; seconds)
        {
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;工作前休息 {0}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,DateTime.Now.Second);
            Thread.Sleep(TimeSpan.FromSeconds(seconds));
            Console.WriteLine(message);          

            CountDownWork.Signal();
            Console.WriteLine(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;发出计数信号， 工作已经完成一项&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);      

        }
    }
}

 &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;3.程序运行结果如下图。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/10343/201711/10343-20171101150526357-802183576.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;     程序启动时，创建了一个CountDownEven实例，在构造中指定了，当两个操作完成时给出信号。然后我们启动了两个线程进行工作，当第二个线程完成操作时，主线程从等待CountDownEvent的状态中返回并继续工作。这个类使用场景是，主线程需要等待多个线程完成工作之后，才能继续的情形。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;缺点：必须要等待指定数量的线程全部完成工作，否则就一直会等待，请确保使用CountDownEvent时，所有线程完成工作后，都要调用Signal方法。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;说明：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1)  把上面代码中注释的第三个线程的代码，还原则会出现以下错误。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/10343/201711/10343-20171101150542295-177565557.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;2) 如果把 第三个线程启用，同时把 CountDownWork.Dispose();注释，则会出现以下错误信息。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/10343/201711/10343-20171101150629123-976557768.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 01 Nov 2017 07:08:00 +0000</pubDate>
<dc:creator>DotNet菜园</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/chillsrc/p/7766589.html</dc:identifier>
</item>
<item>
<title>Machine-learning of  Andrew Ng(Stanford University) - Jasonhaven.D</title>
<link>http://www.cnblogs.com/jasonhaven/p/7765998.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/jasonhaven/p/7765998.html</guid>
<description>&lt;h3&gt;&lt;span&gt;1.基础概念       &lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;       机器学习是一门研究在非特定编程条件下让计算机采取行动的学科。最近二十年，机器学习为我们带来了自动驾驶汽车、实用的语音识别、高效的网络搜索，让我们对人类基因的解读能力大大提高。当今机器学习技术已经非常普遍，您很可能在毫无察觉情况下每天使用几十次。许多研究者还认为机器学习是人工智能（AI）取得进展的最有效途径。在本课程中，您将学习最高效的机器学习技术，了解如何使用这些技术，并自己动手实践这些技术。更重要的是，您将不仅将学习理论知识，还将学习如何实践，如何快速使用强大的技术来解决新问题。最后，您将了解在硅谷企业如何在机器学习和AI领域进行创新。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;        机器学习的基础是数学。数学并非是一个可选可不选的理论方法，而是不可或缺的支柱。如果你是一名计算机工程师，每天使用 UML、ORM、设计模式及其他软件工程工具／技术，那么请闭眼一秒钟，忘掉一切。这并不是说这些概念不重要，绝不是！但是机器学习需要一种不同的方法。如今 Python 如此流行的原因之一是其「原型设计速度」。在机器学习中，一种使用几行代码即可建模算法的语言绝对是必要的。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;        微积分、线性代数、概率论在机器学习几乎所有算法中不可或缺。如果你的数学背景很扎实，请跳过这一章节。如若不然，那么重新温习一下这些重要概念也不错。考虑到理论的数量，我并不建议大家从大部头开始。尽管一开始可以用它查询具体概念，但是初学者先关注简单的话题比较好。网上有很多好的在线资源（比如 Coursera、可汗学院或优达学城），实用且适合各种背景的人群。但是我建议从提纲之类的简明书籍上手，其中所有核心概念均被涉及，次要概念可在需要的时候自行查询。这种方法虽然不够系统，但却避免了这样的缺陷：大量晦涩概念使得没有扎实理论背景的人望而却步。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Recommend  for new：  &lt;a href=&quot;https://www.coursera.org/learn/machine-learning&quot; target=&quot;_blank&quot;&gt;https://www.coursera.org/learn/machine-learning&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;span&gt;2.学习&lt;/span&gt;&lt;span&gt;小结(ing)&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;1.&lt;a id=&quot;CategoryEntryList1_EntryStoryList_ctl00_Entries_TitleUrl_3&quot; class=&quot;entrylistItemTitle&quot; href=&quot;http://www.cnblogs.com/jasonhaven/p/7762349.html&quot;&gt;What is Machine Learning?&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.&lt;a id=&quot;CategoryEntryList1_EntryStoryList_ctl00_Entries_TitleUrl_2&quot; class=&quot;entrylistItemTitle&quot; href=&quot;http://www.cnblogs.com/jasonhaven/p/7764032.html&quot;&gt;Supervised Learning and Unsupervised Learning&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;3.&lt;a id=&quot;CategoryEntryList1_EntryStoryList_ctl00_Entries_TitleUrl_1&quot; class=&quot;entrylistItemTitle&quot; href=&quot;http://www.cnblogs.com/jasonhaven/p/7764410.html&quot;&gt;Model Representation and Cost Function&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;4.&lt;a id=&quot;CategoryEntryList1_EntryStoryList_ctl00_Entries_TitleUrl_0&quot; class=&quot;entrylistItemTitle&quot; href=&quot;http://www.cnblogs.com/jasonhaven/p/7765789.html&quot;&gt;Matrices and Vectors&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h2&gt; &lt;/h2&gt;
&lt;h2&gt;&lt;span&gt;3.应用场景&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;&lt;img class=&quot;aligncenter&quot; src=&quot;http://images.cnitblog.com/blog/673793/201412/221213379524716.png&quot; alt=&quot;&quot; width=&quot;473&quot; height=&quot;271&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;模式识别&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;span&gt;模式识别=机器学习。两者的主要区别在于前者是从工业界发展起来的概念，后者则主要源自计算机学科。在著名的《Pattern Recognition And Machine Learning》这本书中，Christopher M. Bishop在开头是这样说的“模式识别源自工业界，而机器学习来自于计算机学科。不过，它们中的活动可以被视为同一个领域的两个方面，同时在过去的10年间，它们都有了长足的发展”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;数据挖掘&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;span&gt;数据挖掘=机器学习+数据库。这几年数据挖掘的概念实在是太耳熟能详。几乎等同于炒作。但凡说数据挖掘都会吹嘘数据挖掘如何如何，例如从数据中挖出金子，以及将废弃的数据转化为价值等等。但是，我尽管可能会挖出金子，但我也可能挖的是“石头”啊。这个说法的意思是，数据挖掘仅仅是一种思考方式，告诉我们应该尝试从数据中挖掘出知识，但不是每个数据都能挖掘出金子的，所以不要神话它。一个系统绝对不会因为上了一个数据挖掘模块就变得无所不能(这是IBM最喜欢吹嘘的)，恰恰相反，一个拥有数据挖掘思维的人员才是关键，而且他还必须对数据有深刻的认识，这样才可能从数据中导出模式指引业务的改善。大部分数据挖掘中的算法是机器学习的算法在数据库中的优化。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;统计学习&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;span&gt;统计学习近似等于机器学习。统计学习是个与机器学习高度重叠的学科。因为机器学习中的大多数方法来自统计学，甚至可以认为，统计学的发展促进机器学习的繁荣昌盛。例如著名的支持向量机算法，就是源自统计学科。但是在某种程度上两者是有分别的，这个分别在于：统计学习者重点关注的是统计模型的发展与优化，偏数学，而机器学习者更关注的是能够解决问题，偏实践，因此机器学习研究者会重点研究学习算法在计算机上执行的效率与准确性的提升。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;计算机视觉&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;span&gt;计算机视觉=图像处理+机器学习。图像处理技术用于将图像处理为适合进入机器学习模型中的输入，机器学习则负责从图像中识别出相关的模式。计算机视觉相关的应用非常的多，例如百度识图、手写字符识别、车牌识别等等应用。这个领域是应用前景非常火热的，同时也是研究的热门方向。随着机器学习的新领域深度学习的发展，大大促进了计算机图像识别的效果，因此未来计算机视觉界的发展前景不可估量。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;语音识别&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;span&gt;语音识别=语音处理+机器学习。语音识别就是音频处理技术与机器学习的结合。语音识别技术一般不会单独使用，一般会结合自然语言处理的相关技术。目前的相关应用有苹果的语音助手siri等。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;自然语言处理&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;span&gt;自然语言处理=文本处理+机器学习。自然语言处理技术主要是让机器理解人类的语言的一门领域。在自然语言处理技术中，大量使用了编译原理相关的技术，例如词法分析，语法分析等等，除此之外，在理解这个层面，则使用了语义理解，机器学习等技术。作为唯一由人类自身创造的符号，自然语言处理一直是机器学习界不断研究的方向。按照百度机器学习专家余凯的说法“听与看，说白了就是阿猫和阿狗都会的，而只有语言才是人类独有的”。如何利用机器学习技术进行自然语言的的深度理解，一直是工业和学术界关注的焦点。&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;span&gt;4.推荐学习&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;机器学习词汇：&lt;a href=&quot;https://jiqizhixin.github.io/AI-Terminology-page/&quot; target=&quot;_blank&quot;&gt;https://jiqizhixin.github.io/AI-Terminology-page/&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p id=&quot;activity-name&quot; class=&quot;rich_media_title&quot;&gt;&lt;span&gt;香港科技大学TensorFlow课件分享：&lt;a href=&quot;https://mp.weixin.qq.com/s/GaK_iSTBl7B4LTdaOtiR_Q&quot; target=&quot;_blank&quot;&gt;https://mp.weixin.qq.com/s/GaK_iSTBl7B4LTdaOtiR_Q&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;rich_media_title&quot;&gt;&lt;span&gt;机器之心之机器学习路线：&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw%3D%3D&amp;amp;mid=2650730755&amp;amp;idx=1&amp;amp;sn=e67c5f5b8d84525f9ea9ef63a57caa89#wechat_redirect&quot; target=&quot;_blank&quot;&gt;https://mp.weixin.qq.com&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;27 个机器学习、数学、Python 速查表&lt;/span&gt;&lt;a href=&quot;http://blog.jobbole.com/112009/&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;http://blog.jobbole.com/112009/&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;rich_media_title&quot;&gt; &lt;/p&gt;
&lt;p class=&quot;rich_media_title&quot;&gt; &lt;/p&gt;
</description>
<pubDate>Wed, 01 Nov 2017 06:53:00 +0000</pubDate>
<dc:creator>Jasonhaven.D</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/jasonhaven/p/7765998.html</dc:identifier>
</item>
<item>
<title>Android插件化-RePlugin项目集成与使用 - codingblock</title>
<link>http://www.cnblogs.com/codingblock/p/7766365.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/codingblock/p/7766365.html</guid>
<description>&lt;p data-source-line=&quot;1&quot;&gt;&lt;strong&gt;前言：&lt;/strong&gt;前一段时间新开源了一种全面插件化的方案-- RePlugin，之前一种都在关注 DroidPlugin 并且很早也在项目中试用了，但最终没有投入到真正的生产环节，一方面是项目中没有特别需要插件化的需求，另一方面也考虑到 DroidPlugin 不是特别稳定，Android系统每更新一次 DroidPlugin 可能就会出现一些 Bug，毕竟 Hook 了 Android 原生的太多东西，系统一旦更新引发 Bug 是在所难免的。当然，这些并不能否认 DroidPlugin 的优秀，它的原理和思路值得我们深入探究、学习，前一段时间更新过几篇插件化的原理分析的文章（基于 DrodiPlugin 原理）学习过程中不得不叹服作者的思路和技术深度！前几篇小白也能看懂的插件化系列文章仍然会不定期更新，但目前我们可以先来学习学习 RePlugin，毕竟多学无害，也能互相参考他们的思路，比较优缺点。&lt;/p&gt;
&lt;p data-source-line=&quot;3&quot;&gt;RePlugin 是一套完整的、稳定的、适合全面使用的、占坑类插件化方案：&lt;/p&gt;
&lt;ul data-source-line=&quot;4&quot;&gt;&lt;li&gt;完整的：让插件运行起来“像单品那样”，支持大部分特性。&lt;/li&gt;
&lt;li&gt;稳定的：官方宣称，其框架奔溃率“万分之一”。&lt;/li&gt;
&lt;li&gt;适合全面使用的：其目的是让应用内的“所有功能皆为插件”。&lt;/li&gt;
&lt;li&gt;占坑类：以稳定为前提的 Manifest 占坑思路。&lt;/li&gt;
&lt;li&gt;插件化方案：基于 Android 原生 API 和语言来开发，充分利用原生特性。&lt;/li&gt;
&lt;/ul&gt;&lt;p data-source-line=&quot;10&quot;&gt;（以上定义引自官方wiki）&lt;/p&gt;
&lt;h3 id=&quot;一-集成主工程&quot; data-source-line=&quot;11&quot;&gt;一、集成主工程&lt;/h3&gt;
&lt;h4 id=&quot;1-在项目根目录的-buildgradle-下添加-replugin-host-gradle-依赖&quot; data-source-line=&quot;12&quot;&gt;1、在项目根目录的 build.gradle 下添加 RePlugin Host Gradle 依赖：&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;buildscript {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;    repositories {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;        jcenter()
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;    dependencies {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         classpath 'com.android.tools.build:gradle:2.3.3'
&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 1、添加RePlugin Host Gradle依赖&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt;         classpath 'com.qihoo360.replugin:replugin-host-gradle:2.2.1'
&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;2-在-appbuildgradle-下添加-replugin-host-library-依赖为了更清晰的表示出代码添加的位置将原有代码也一并贴出&quot; data-source-line=&quot;26&quot;&gt;2、在 app/build.gradle 下添加 RePlugin Host Library 依赖（为了更清晰的表示出代码添加的位置，将原有代码也一并贴出）：&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; apply plugin: 'com.android.application'
&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;android {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     compileSdkVersion 26
&lt;span&gt; 5&lt;/span&gt;     buildToolsVersion &quot;26.0.1&quot;
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    defaultConfig {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         applicationId &quot;cn.codingblock.repluginstudy&quot;
&lt;span&gt; 8&lt;/span&gt;         minSdkVersion 21
&lt;span&gt; 9&lt;/span&gt;         targetSdkVersion 26
&lt;span&gt;10&lt;/span&gt;         versionCode 1
&lt;span&gt;11&lt;/span&gt;         versionName &quot;1.0&quot;
&lt;span&gt;12&lt;/span&gt;         testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;
&lt;span&gt;13&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;    buildTypes {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;        release {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;             minifyEnabled &lt;span&gt;false&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt;             proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; 
&lt;span&gt;22&lt;/span&gt; apply plugin: 'replugin-host-gradle'&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 集成 RePlugin 添加的配置
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; 
&lt;span&gt;24&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 集成 RePlugin 添加的配置&lt;/span&gt;
&lt;span&gt;25&lt;/span&gt; &lt;span&gt;repluginHostConfig {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;     useAppCompat = &lt;span&gt;true&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 如果项目需要支持 AppComat，则需要将此配置置为 true
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 如果应用需要个性化配置坑位数量，则需要添加以下代码进行配置
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;    countNotTranslucentStandard = 6
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;    countNotTranslucentSingleTop = 2
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;    countNotTranslucentSingleTask = 3
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;    countNotTranslucentSingleInstance = 2&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; 
&lt;span&gt;34&lt;/span&gt; &lt;span&gt;dependencies {
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;     compile fileTree(dir: 'libs', include: ['*.jar'&lt;span&gt;])
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;     androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2'&lt;span&gt;, {
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;         exclude group: 'com.android.support', module: 'support-annotations'
&lt;span&gt;38&lt;/span&gt; &lt;span&gt;    })
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;     compile 'com.android.support:appcompat-v7:26.+'
&lt;span&gt;40&lt;/span&gt;     compile 'com.android.support.constraint:constraint-layout:1.0.2'
&lt;span&gt;41&lt;/span&gt;     compile 'com.qihoo360.replugin:replugin-host-lib:2.2.1' &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 集成 RePlugin 添加的配置&lt;/span&gt;
&lt;span&gt;42&lt;/span&gt;     testCompile 'junit:junit:4.12'
&lt;span&gt;43&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;73&quot;&gt;以上代码有三点需要注意：&lt;/p&gt;
&lt;ul data-source-line=&quot;74&quot;&gt;&lt;li&gt;需要将 apply plugin: 'replugin-host-gradle' 放在 android {...} 之后。&lt;/li&gt;
&lt;li&gt;如果项目需要支持 AppComat，则需要将 repluginHostConfig 的 userAppCompat 置为 true。&lt;/li&gt;
&lt;li&gt;如果应用需要个性化配置坑位数量，则需要在 repluginHostConfig 中添加以下代码进行配置：&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
countNotTranslucentStandard = 6
countNotTranslucentSingleTop = 2
countNotTranslucentSingleTask = 3
countNotTranslucentSingleInstance = 2
&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;3-让工程的-application-直接继承自-repluginapplication&quot; data-source-line=&quot;84&quot;&gt;3、让工程的 Application 直接继承自 RePluginApplication：&lt;/h4&gt;
&lt;pre data-source-line=&quot;86&quot;&gt;
 &lt;span class=&quot;cnblogs_code&quot;&gt;&lt;span&gt;1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyApplication &lt;span&gt;extends&lt;/span&gt; RePluginApplication { }&lt;/span&gt; 
&lt;/pre&gt;
&lt;p data-source-line=&quot;91&quot;&gt;当然，同时不要忘了在 AndroidManifest 对 MyApplication 的相关配置。&lt;/p&gt;
&lt;ul data-source-line=&quot;92&quot;&gt;&lt;li&gt;说明:有时候由于项目原有结构的需要，我们可能不能直接使用继承 RePluginApplication 的方式，这个问题看来 RePlugin 开发者也想到了，所以还特地多了一种选择，下面是项目的 Application 不继承 RePluginApplication 的方式：&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyApplication &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Application {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; attachBaseContext(Context base) {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.attachBaseContext(base);
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         RePlugin.App.attachBaseContext(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onCreate() {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.onCreate();
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;        RePlugin.App.onCreate();
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; 
&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onLowMemory() {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.onLowMemory();
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;        RePlugin.App.onLowMemory();
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; onTrimMemory(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; level) {
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.onTrimMemory(level);
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;        RePlugin.App.onTrimMemory(level);
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; 
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onConfigurationChanged(Configuration newConfig) {
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.onConfigurationChanged(newConfig);
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;        RePlugin.App.onConfigurationChanged(newConfig);
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;二-集成插件&quot; data-source-line=&quot;129&quot;&gt;二、集成插件&lt;/h3&gt;
&lt;p data-source-line=&quot;130&quot;&gt;新建一个工程做为插件APP，这里为了方便起见，直接在主工程中新建了一个 Module。&lt;/p&gt;
&lt;h4 id=&quot;1-同集成主工程类似在根目录的-buildgradle-添加-replugin-plugin-gradle-依赖若是单独创建插件工程则不需要添加注释1下面的代码&quot; data-source-line=&quot;131&quot;&gt;1、同集成主工程类似，在根目录的 build.gradle 添加 RePlugin Plugin Gradle 依赖（若是单独创建插件工程，则不需要添加注释1下面的代码）：&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath &lt;/span&gt;'com.android.tools.build:gradle:2.3.3'
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 1、添加RePlugin Host Gradle依赖(主工程用)&lt;/span&gt;
        classpath 'com.qihoo360.replugin:replugin-host-gradle:2.2.1'
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 2、添加RePlugin Plugin Gradle依赖(插件工程用)&lt;/span&gt;
        classpath 'com.qihoo360.replugin:replugin-plugin-gradle:2.2.1'&lt;span&gt;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;2-在-appbuildgradle-中添加-replugin-plugin-gradle-插件和-replugin-plugin-lib-依赖&quot; data-source-line=&quot;148&quot;&gt;2、在 app/build.gradle 中添加 replugin-plugin-gradle 插件和 replugin-plugin-lib 依赖:&lt;/h4&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
apply plugin: 'com.android.application'&lt;span&gt;

android {
    ...
}

apply plugin: &lt;/span&gt;'replugin-plugin-gradle' &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 集成 RePlugin 添加的配置&lt;/span&gt;
&lt;span&gt;
dependencies {
    compile fileTree(dir: &lt;/span&gt;'libs', include: ['*.jar'&lt;span&gt;])
    androidTestCompile(&lt;/span&gt;'com.android.support.test.espresso:espresso-core:2.2.2'&lt;span&gt;, {
        exclude group: &lt;/span&gt;'com.android.support', module: 'support-annotations'&lt;span&gt;
    })
    compile &lt;/span&gt;'com.android.support:appcompat-v7:26.+'&lt;span&gt;
    compile &lt;/span&gt;'com.android.support.constraint:constraint-layout:1.0.2'&lt;span&gt;
    compile &lt;/span&gt;'com.qihoo360.replugin:replugin-plugin-lib:2.2.1' &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 集成 RePlugin 添加的配置&lt;/span&gt;
    testCompile 'junit:junit:4.12'&lt;span&gt;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;三-管理插件&quot; data-source-line=&quot;171&quot;&gt;三、管理插件&lt;/h3&gt;
&lt;p data-source-line=&quot;173&quot;&gt;RePlugin 对插件定义两种方式一种是外置插件、一种是内置插件。&lt;/p&gt;
&lt;ul data-source-line=&quot;174&quot;&gt;&lt;li&gt;外置插件：即从网络下载或者从SD卡中获得的，以 .apk 结尾。&lt;/li&gt;
&lt;li&gt;内置插件：内置于 APP 之中，并随 APP 一并发版，需要将插件 apk 改成 .jar 结尾放入主程序的assets/plugins目录。&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;一外置插件的安装升级-启动-卸载&quot; data-source-line=&quot;176&quot;&gt;（一）外置插件的安装（升级）、启动、卸载&lt;/h4&gt;
&lt;ul data-source-line=&quot;177&quot;&gt;&lt;li&gt;安装插件：&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
PluginInfo pluginInfo = RePlugin.install(Environment.getExternalStorageDirectory().getPath().toString() + &quot;/plugin1.apk&quot;);
System.out.println(pluginInfo);
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;182&quot;&gt;同时别忘了添加文件读写的权限。 输出日下:&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;43&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
10-30 16:10:23.769 20280-20280/cn.codingblock.repluginstudy I/System.out: PInfo { &amp;lt;cn.codingblock.plugin1:1(4)&amp;gt; [APK] [DEX_EXTRACTED] processes=[] js={&quot;pkgname&quot;:&quot;cn.codingblock.plugin1&quot;,&quot;name&quot;:&quot;cn.codingblock.plugin1&quot;,&quot;low&quot;:10,&quot;high&quot;:10,&quot;ver&quot;:1,&quot;verv&quot;:2814792716779521,&quot;path&quot;:&quot;\/data\/user\/0\/cn.codingblock.repluginstudy\/app_p_a\/-347346251.jar&quot;,&quot;type&quot;:11,&quot;frm_ver&quot;:4} dex=/data/data/cn.codingblock.repluginstudy/app_p_od/-347346251.dex nlib=/data/data/cn.codingblock.repluginstudy/app_p_n/-347346251 }
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;188&quot;&gt;安装成功了！ （升级插件也是用 install() 方法，不可降级，同本版可覆盖安装）&lt;/p&gt;
&lt;ul data-source-line=&quot;190&quot;&gt;&lt;li&gt;启动插件&lt;/li&gt;
&lt;/ul&gt;&lt;p data-source-line=&quot;192&quot;&gt;先来看一下 RePlugin.java 中启动插件相关的源码:&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * 创建一个用来定向到插件组件的Intent &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; * &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt; * 推荐用法： &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt; * &amp;lt;code&amp;gt;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt; * Intent in = RePlugin.createIntent(&quot;clean&quot;, &quot;com.qihoo360.mobilesafe.clean.CleanActivity&quot;);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt; * &amp;lt;/code&amp;gt; &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt; * 当然，也可以用标准的Android创建方法： &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt; * &amp;lt;code&amp;gt;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt; * Intent in = new Intent(); &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt; * in.setComponent(new ComponentName(&quot;clean&quot;, &quot;com.qihoo360.mobilesafe.clean.CleanActivity&quot;));
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt; * &amp;lt;/code&amp;gt;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; pluginName 插件名
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; cls        目标全名
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 可以被RePlugin识别的Intent
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@since&lt;/span&gt;&lt;span&gt; 1.0.0
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Intent createIntent(String pluginName, String cls) {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;     Intent in = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Intent();
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    in.setComponent(createComponentName(pluginName, cls));
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; in;
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; 
&lt;span&gt;25&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt; &lt;span&gt; * 开启一个插件的Activity &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt; * 其中Intent的ComponentName的Key应为插件名（而不是包名），可使用createIntent方法来创建Intent对象
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; context Context对象
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; intent  要打开Activity的Intent，其中ComponentName的Key必须为插件名
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 插件Activity是否被成功打开？
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt; * FIXME 是否需要Exception来做？
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@see&lt;/span&gt;&lt;span&gt; #createIntent(String, String)
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@since&lt;/span&gt;&lt;span&gt; 1.0.0
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;36&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; startActivity(Context context, Intent intent) {
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; TODO 先用旧的开启Activity方案，以后再优化&lt;/span&gt;
&lt;span&gt;38&lt;/span&gt;     ComponentName cn =&lt;span&gt; intent.getComponent();
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (cn == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; TODO 需要支持Action方案&lt;/span&gt;
&lt;span&gt;41&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;     String plugin =&lt;span&gt; cn.getPackageName();
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt;     String cls =&lt;span&gt; cn.getClassName();
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; Factory.startActivityWithNoInjectCN(context, intent, plugin, cls, IPluginManager.PROCESS_AUTO);
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;241&quot;&gt;根据 RePlugin 的 startActivity() 和 createIntent() 方法注释中的示例可知，启动插件需要先用插件的名字和目标Activity的全路径创建一个 Intent,然后调用 RePlugin.startActviity() 启动即可:&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;38&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
Intent intent = RePlugin.createIntent(&quot;Plugin1&quot;, &quot;cn.codingblock.plugin1.MainActivity&quot;);
if (!RePlugin.startActivity(MainActivity.this, intent)) {
    Toast.makeText(mContext, &quot;启动失败&quot;, Toast.LENGTH_LONG).show();
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;248&quot;&gt;点击按钮，输出如下:&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;36&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
10-30 16:21:02.464 20280-20280/cn.codingblock.repluginstudy D/RePlugin.ws001: start activity: intent=Intent { cmp=Plugin1/cn.codingblock.plugin1.MainActivity } plugin=Plugin1 activity=cn.codingblock.plugin1.MainActivity process=-2147483648
10-30 16:21:02.464 20280-20280/cn.codingblock.repluginstudy D/RePlugin.ws001: start activity: intent=Intent { cmp=Plugin1/cn.codingblock.plugin1.MainActivity } plugin=Plugin1 activity=cn.codingblock.plugin1.MainActivity process=-2147483648 download=true
10-30 16:21:02.464 20280-20280/cn.codingblock.repluginstudy D/RePlugin.ws001: plugin=Plugin1 not found, start download ...
10-30 16:21:02.469 20280-20280/cn.codingblock.repluginstudy D/RePlugin.ws001: isNeedToDownload(): V5 file not exists. Plugin = Plugin1
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;255&quot;&gt;启动失败了！（插件名称确实是：Plugin1，而不是 plugin1 ）&lt;/p&gt;
&lt;p data-source-line=&quot;257&quot;&gt;把 ==createIntent() 方法的第一参数换成插件的包名 cn.codingblock.plugin1 ==试一试，居然可以了。&lt;/p&gt;
&lt;p data-source-line=&quot;259&quot;&gt;但是，注释总不会这样赤裸裸的坑我们吧！&lt;/p&gt;
&lt;ul data-source-line=&quot;261&quot;&gt;&lt;li&gt;卸载插件&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
RePlugin.uninstall(&quot;Plugin1&quot;);
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;265&quot;&gt;点击卸载，输入如下:&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;34&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
10-30 16:31:21.988 5006-5006/cn.codingblock.repluginstudy D/RePlugin.ws001: MP.pluginUninstall ... pluginName=Plugin1
10-30 16:31:21.988 5006-5006/cn.codingblock.repluginstudy D/RePlugin.ws001: Not installed. pluginName=Plugin1
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;270&quot;&gt;没卸载成功？哈哈，这个简单，原套路把参数换成包名，果然可以了:&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;45&quot;&gt;
&lt;pre class=&quot;brush:java;gutter:true;&quot;&gt;
10-30 16:41:46.179 10193-10193/cn.codingblock.repluginstudy D/RePlugin.ws001: MP.pluginUninstall ... pluginName=cn.codingblock.plugin1
10-30 16:41:46.202 10193-10193/cn.codingblock.repluginstudy D/RePlugin.ws001: sendIntent pr=cn.codingblock.repluginstudy intent=Intent { act=ACTION_UNINSTALL_PLUGIN (has extras) }
10-30 16:41:46.203 10193-10193/cn.codingblock.repluginstudy D/RePlugin.ws001: Clear plugin cache. pn=cn.codingblock.plugin1
10-30 16:41:46.204 10193-10193/cn.codingblock.repluginstudy D/RePlugin.ws001: removeInfo plugin table: info=PInfo { &amp;lt;cn.codingblock.plugin1:1(4)&amp;gt; [APK] processes=[] js={&quot;pkgname&quot;:&quot;cn.codingblock.plugin1&quot;,&quot;name&quot;:&quot;cn.codingblock.plugin1&quot;,&quot;low&quot;:10,&quot;high&quot;:10,&quot;ver&quot;:1,&quot;verv&quot;:2814792716779521,&quot;path&quot;:&quot;\/data\/user\/0\/cn.codingblock.repluginstudy\/app_p_a\/-347346251.jar&quot;,&quot;type&quot;:11,&quot;frm_ver&quot;:4,&quot;used&quot;:true} dex=/data/user/0/cn.codingblock.repluginstudy/app_p_od/-347346251.dex nlib=/data/user/0/cn.codingblock.repluginstudy/app_p_n/-347346251 } rc=true
10-30 16:41:46.204 10193-10193/cn.codingblock.repluginstudy D/RePlugin.ws001: cached filename: cn.codingblock.plugin1 -&amp;gt; null
10-30 16:41:46.275 10193-10263/cn.codingblock.repluginstudy V/RenderScript: 0xb34e8000 Launching thread(s), CPUs 4
&lt;/pre&gt;&lt;/div&gt;
&lt;p data-source-line=&quot;279&quot;&gt;启动插件那里毕竟在官方教程里面找不到，但是 Plugin.uninstall() 方法传入插件名即可这可是官方文档说的，这次不会是官方文档和源码注释合起伙来坑我们把？ 经过多次试验后，有个有趣的发现：对于启动插件创建 Intent 的createIntent() 方法和 卸载插件的 RePlugin.uninstall() 方法，如果项目是使用继承 RePluginApplication 方式的话，参数传包名才生效；如果不是继承的方式传插件名才生效！（本人是在一款小米3手机上试验的，由于并没有广泛测试，所以不保证其他手机也是这个套路）这真是奇了葩了！&lt;/p&gt;
&lt;p data-source-line=&quot;282&quot;&gt;卸载插件时有一点需要注意：如果插件正在运行，则不会立即卸载插件，而是将卸载诉求记录下来。直到所有“正在使用插件”的进程结束并重启后才会生效。（引自官方说明）&lt;/p&gt;
&lt;h4 id=&quot;二内置插件&quot; data-source-line=&quot;284&quot;&gt;（二）内置插件&lt;/h4&gt;
&lt;p data-source-line=&quot;285&quot;&gt;添加内置插件非常简单，首先在主工程的 assets 目录下创建一个 plugins 文件夹，然后将要作为插件的 apk 后缀名改成 .jar 并放入到新建的 plugins 文件夹下，剩下的事情就不用管了，交给 RePlugin 即可，也就说，框架会自动加载插件。&lt;/p&gt;
&lt;ul data-source-line=&quot;287&quot;&gt;&lt;li&gt;内置插件无需开发者安装，启动方式和外置插件一致，但不可删除。&lt;/li&gt;
&lt;li&gt;内置插件可通过 RePlugin.install() 升级(需要先将升级包下载好)，升级后等同于外置插件。&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;四-小结&quot; data-source-line=&quot;290&quot;&gt;四、小结&lt;/h3&gt;
&lt;p data-source-line=&quot;291&quot;&gt;初步体验了一下发现，虽然目前有可能会有那么一点坑需要踩一踩，在使用起来也不比 DroidPlugin 方便，需要在宿主和插件两端都要做集成工作。但总体明显发现，这次的插件化框架明显比以前那些的插件化框架资料更加的全面、丰富，而且从 wiki 上发现 RePlugin 团队充满了很大的热情在孜孜不倦维护、更新，并且计划明确，哪些功能在未来会添加、哪些功能在未来会被舍弃，一目了然，让我们更加看到了 RePlugin 美好的未来，我相信在未来的插件化领域即使 RePlugin 不能一家独大，也必然处于一个非常重要的地位！&lt;/p&gt;
</description>
<pubDate>Wed, 01 Nov 2017 06:49:00 +0000</pubDate>
<dc:creator>codingblock</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/codingblock/p/7766365.html</dc:identifier>
</item>
<item>
<title>django-rest-framework之序列化 - 前程明亮</title>
<link>http://www.cnblogs.com/0zcl/p/7765807.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/0zcl/p/7765807.html</guid>
<description>&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;前言：&lt;/span&gt;&lt;/strong&gt;昨天学习了rest-framework序列化方面的知识，故写了博客记录一下。官网:http://www.django-rest-framework.org/tutorial/1-serialization/#working-with-serializers。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;前后端分离&lt;/span&gt;&lt;/strong&gt;：前台的开发和后台的开发分离开。这个方案的实现就是要&lt;span&gt;借助API&lt;/span&gt;，API简单说就是开发人员提供编程接口被其他人调用，他们调用之后会返回数据供其使用。API的类型有多种，但是现在比较主流且实用的就是RESTful API。&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;getting-started&quot;&gt;&lt;span&gt;一、开始&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;Okay, we're ready to get coding. To get started, let's create a new project to work with.首先创建一个Django项目。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;cd ~&lt;span&gt;
django&lt;/span&gt;-&lt;span&gt;admin.py startproject tutorial
cd tutorial&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;Once that's done we can create an app that we'll use to create a simple Web API.接着创建一个APP&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;python manage.py startapp snippets&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;We'll need to add our new &lt;code&gt;snippets&lt;/code&gt; app and the &lt;code&gt;rest_framework&lt;/code&gt; app to &lt;code&gt;INSTALLED_APPS&lt;/code&gt;. Let's edit the &lt;code&gt;tutorial/settings.py&lt;/code&gt; file:修改全局配置文件。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;INSTALLED_APPS =&lt;span&gt; (
    ...
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'snippets.apps.SnippetsConfig'&lt;/span&gt;&lt;span&gt;,
)&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;Please note that if you're using Django &amp;lt;1.9, you need to replace &lt;code&gt;snippets.apps.SnippetsConfig&lt;/code&gt; with &lt;code&gt;snippets&lt;/code&gt;.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如果你使用的Django &amp;lt;1.9，则需要更换&lt;span&gt;&lt;code&gt;snippets.apps.SnippetsConfig为&lt;/code&gt;&lt;code&gt;snippets&lt;/code&gt;&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;_3&quot;&gt;&lt;span&gt;二、创建模型类&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;For the purposes of this tutorial we're going to start by creating a simple &lt;code&gt;Snippet&lt;/code&gt; model that is used to store code snippets(片段). Go ahead and edit the &lt;code&gt;snippets/models.py&lt;/code&gt; file.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们将首先创建一个&lt;code&gt;Snippet&lt;/code&gt;用于&lt;span&gt;存储代码片段的简单模型&lt;/span&gt;，编辑&lt;code&gt;snippets/models.py&lt;/code&gt;文件。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;from&lt;/span&gt; django.db &lt;span&gt;import&lt;/span&gt;&lt;span&gt; models

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Create your models here.&lt;/span&gt;

&lt;span&gt;#&lt;/span&gt;&lt;span&gt; pygments可以实现代码高亮　官网:http://pygments.org/&lt;/span&gt;
&lt;span&gt;from&lt;/span&gt; pygments.lexers &lt;span&gt;import&lt;/span&gt; get_all_lexers  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; lexers:词法分析器&lt;/span&gt;
&lt;span&gt;from&lt;/span&gt; pygments.styles &lt;span&gt;import&lt;/span&gt;&lt;span&gt; get_all_styles


LEXERS &lt;/span&gt;= [item &lt;span&gt;for&lt;/span&gt; item &lt;span&gt;in&lt;/span&gt; get_all_lexers() &lt;span&gt;if&lt;/span&gt; item[1&lt;span&gt;]]
LANGUAGE_CHOICES &lt;/span&gt;= sorted([(item[1][0], item[0]) &lt;span&gt;for&lt;/span&gt; item &lt;span&gt;in&lt;/span&gt;&lt;span&gt; LEXERS])
STYLE_CHOICES &lt;/span&gt;= sorted((item, item) &lt;span&gt;for&lt;/span&gt; item &lt;span&gt;in&lt;/span&gt;&lt;span&gt; get_all_styles())


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Snippet(models.Model):
    created &lt;/span&gt;= models.DateTimeField(auto_now_add=True)  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 自动添加创建时间&lt;/span&gt;
    title = models.CharField(max_length=100, blank=True, default=&lt;span&gt;''&lt;/span&gt;&lt;span&gt;)
    code &lt;/span&gt;=&lt;span&gt; models.TextField()
    linenos &lt;/span&gt;= models.BooleanField(default=&lt;span&gt;False)
    language &lt;/span&gt;= models.CharField(choices=LANGUAGE_CHOICES, default=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;python&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, max_length=100&lt;span&gt;)
    style &lt;/span&gt;= models.CharField(choices=STYLE_CHOICES, default=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;friendly&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, max_length=100&lt;span&gt;)

    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Meta:
        ordering &lt;/span&gt;= (&lt;span&gt;'&lt;/span&gt;&lt;span&gt;created&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,)  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 根据创建时间来排序&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;初始化并且同步到数据库:&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
&lt;span&gt;python manage.py makemigrations snippets
python manage.py migrate
&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;_4&quot;&gt;&lt;span&gt;三、创建序列化类&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;The first thing we need to get started on our Web API is to provide a way of serializing(序列化) and deserializing(反序列化) the snippet instances into representations such as &lt;code&gt;json&lt;/code&gt;. We can do this by declaring(声明) serializers that work very similar to Django's forms. &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;首先我要问你了，通常情况下，前端从调用后台API，API肯定需要返回数据给前端，那返回的数据是什么类型呢？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;目前主流用的比较多的是JSON，可能有少部分还在用XML。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;那我们在学习django-rest-framework时，有没有提供什么方法能够将数据实例信息自动转换为JSON？而且也可以将前端传给后台的JSON数据转换为python的数据类型(dict/list/set...)。当然有，&lt;span&gt;序列化器(serializers)&lt;/span&gt;可以实现。首先你得声明(引入)序列化器，请看下面这个例子：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; 用Web API的第一件事是提供一种将代码片段实例序列化和反序列化为表示形式的方法json。&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt; 我们可以通过声明与Django表单非常相似的序列化器来做到这一点。在snippets命名的目录中创建一个文件，&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt; serializers.py并添加以下内容&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; serializers
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; snippets.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Snippet, LANGUAGE_CHOICES, STYLE_CHOICES


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; SnippetSerializer(serializers.Serializer):
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; 序列化器类的第一部分定义了序列化/反序列化的字段。&lt;/span&gt;
    id = serializers.IntegerField(read_only=&lt;span&gt;True)
    title &lt;/span&gt;= serializers.CharField(required=False, allow_blank=True, max_length=100&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; 利用字段标志控制序列化器渲染到HTML页面时的的显示模板&lt;/span&gt;
    code = serializers.CharField(style={&lt;span&gt;'&lt;/span&gt;&lt;span&gt;base_template&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;textarea.html&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;})
    linenos &lt;/span&gt;= serializers.BooleanField(required=&lt;span&gt;False)
    language &lt;/span&gt;= serializers.ChoiceField(choices=LANGUAGE_CHOICES, default=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;python&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    style &lt;/span&gt;= serializers.ChoiceField(choices=STYLE_CHOICES, default=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;friendly&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; create(self, validated_data):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        The create() and update() methods define how fully fledged instances are created
        or modified when calling serializer.save()
        Create and return a new `Snippet` instance, given the validated data.
        给定经过验证的数据，创建并返回一个新的 Snippet 实例
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; Snippet.objects.create(**&lt;span&gt;validated_data)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; update(self, instance, validated_data):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Update and return an existing `Snippet` instance, given the validated data.
        给定经过验证的数据，更新并返回一个已经存在的 Snippet 实例
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        instance.title &lt;/span&gt;= validated_data.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;title&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, instance.title)
        instance.code &lt;/span&gt;= validated_data.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, instance.code)
        instance.linenos &lt;/span&gt;= validated_data.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;linenos&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, instance.linenos)
        instance.language &lt;/span&gt;= validated_data.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;language&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, instance.language)
        instance.style &lt;/span&gt;= validated_data.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;style&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, instance.style)
        instance.save()  &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; 更新&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; instance&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;序列化器类的第一部分定义了序列化/反序列化的字段。该&lt;code&gt;create()&lt;/code&gt;和&lt;code&gt;update()&lt;/code&gt;方法分别定义实例如何创建和更新。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;关于下面这行代码：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
&lt;span&gt;code = serializers.CharField(style={'base_template': 'textarea.html'})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;暂时需要知道的就是它的功能是控制序列化器渲染到HTML页面时的的显示模板，至于为什么要这样做，是因为这对于控制如何显示可浏览的API特别有用，这将在后面的文章中看到。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;实际上也可以通过使用&lt;span&gt;&lt;code&gt;ModelSerializer&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;来节省自己的时间&lt;/span&gt;&lt;span&gt;&lt;span&gt;，我们稍后会看到，接下来看看序列化器的具体作用。&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;_5&quot;&gt;&lt;span&gt;四、使用序列化器&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;在我们进一步了解之前，我们将熟悉使用我们新的Serializer类。我们进入Django shell：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
&lt;span&gt;python manage.py shell&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;接下来的操作就和学习Django的ORM时那样，创建并保存Snippet模型实例：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;from&lt;/span&gt; snippets.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Snippet
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; snippets.serializers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; SnippetSerializer
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.renderers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; JSONRenderer
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.parsers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; JSONParser

snippet &lt;/span&gt;= Snippet(code=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;foo = &quot;bar&quot;\n&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
snippet.save()

snippet &lt;/span&gt;= Snippet(code=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;print &quot;hello, world&quot;\n&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
snippet.save()&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;这个时候查看数据库就会发现相关的表中已经多了两行数据，就是我们刚才创建的数据： &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1038183/201711/1038183-20171101122545623-717389209.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们现在有几个片段实例可以玩。我们来看看序列化这些&lt;span&gt;实例之一&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;39&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
&lt;span&gt;serializer = SnippetSerializer(snippet)
serializer.data
# {'id': 2, 'title': u'', 'code': u'print &quot;hello, world&quot;\n', 'linenos': False, 'language': u'python', 'style': u'friendly'}
&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;At this point we've translated the model instance into Python native datatypes. &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;从上面的代码，可以看到，我们已经将model的实例信息转换为python原生的数据类型，即字典。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;To finalize the serialization process we render the data into &lt;code&gt;json&lt;/code&gt;.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;为了完成序列化过程，我们&lt;span&gt;将数据转换成&lt;code&gt;json&lt;/code&gt;&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;39&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
&lt;span&gt;content = JSONRenderer().render(serializer.data)
content
# '{&quot;id&quot;: 2, &quot;title&quot;: &quot;&quot;, &quot;code&quot;: &quot;print \\&quot;hello, world\\&quot;\\n&quot;, &quot;linenos&quot;: false, &quot;language&quot;: &quot;python&quot;, &quot;style&quot;: &quot;friendly&quot;}'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;这里已经出现了json格式，也就是说这个json格式的数据就是要展示在某个URL上，大概可以感觉到，等下我们在访问某个URL时，会返回上面这堆数据供你使用，这其实就完成了一个序列化的过程，也可以看出客户端的功能雏形。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;序列化是为了返回json格式的数据给客户端查看和使用数据，那么当客户端需要修改、增加或者删除数据时，就要把过程反过来了，也就是反序列化，把客户端提交的json格式的数据反序列化。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;反序列化&lt;/span&gt;是类似的。首先我们将一个流解析为Python本机数据类型...&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;from&lt;/span&gt; django.utils.six &lt;span&gt;import&lt;/span&gt;&lt;span&gt; BytesIO

stream &lt;/span&gt;=&lt;span&gt; BytesIO(content)
data &lt;/span&gt;= JSONParser().parse(stream)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;...then we restore those native datatypes into a fully populated object instance.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;先&lt;span&gt;检查数据是否有误&lt;/span&gt;，再保存数据：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;serializer = SnippetSerializer(data=&lt;span&gt;data)
&lt;span&gt;serializer.is_valid()
&lt;/span&gt;&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; True&lt;/span&gt;
&lt;span&gt;serializer.validated_data
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; OrderedDict([('title', ''), ('code', 'print &quot;hello, world&quot;\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])&lt;/span&gt;
&lt;span&gt;serializer.save()
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; &amp;lt;Snippet: Snippet object&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;这个时候查看数据库又多了一条数据：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1038183/201711/1038183-20171101133526373-1919897008.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;We can also serialize querysets instead of model instances. To do so we simply add a &lt;code&gt;many=True&lt;/code&gt; flag to the serializer arguments.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们也可以&lt;span&gt;序列化查询集&lt;/span&gt;而不是模型实例。为此，我们只需要为serializer参数添加一个&lt;span&gt;标志many=True&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;73&quot;&gt;
&lt;pre&gt;
&lt;span&gt;serializer = SnippetSerializer(Snippet.objects.all(), many=&lt;span&gt;True)
serializer.data
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; [OrderedDict([('id', 1), ('title', u''), ('code', u'foo = &quot;bar&quot;\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', u''), ('code', u'print &quot;hello, world&quot;\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', u''), ('code', u'print &quot;hello, world&quot;'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id=&quot;modelserializers&quot;&gt;&lt;span&gt;五、使用 ModelSerializers&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;在上面的SnippetSerializer类中，我们继承的是serializers.Serializer类，可以看到&lt;span&gt;SnippetSerializer类中有很多代码其实是和models.py中的Snippet模型类似一样的&lt;/span&gt;，所以这里我们可以改进一下。就像在Django中提供了Form类和ModelForm类一样，&lt;span&gt;django-rest-framework为我们提供了Serializer类和ModelSerializer类&lt;/span&gt;。利用它可以让我们的代码简洁很多，修改serializers.py：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Our SnippetSerializer class is replicating a lot of information that's also contained in the Snippet model.&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt; It would be nice if we could keep our code a bit more concise.&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; SnippetSerializer(serializers.ModelSerializer):
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Meta:
        model &lt;/span&gt;=&lt;span&gt; Snippet
        fields &lt;/span&gt;= (&lt;span&gt;'&lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;title&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;code&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;linenos&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;language&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;style&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;One nice property that serializers have is that you can inspect(检查/查看) all the fields in a serializer instance, by printing its representation. Open the Django shell with &lt;code&gt;python manage.py shell&lt;/code&gt;, then try the following:&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;序列化器具有的一个不错的属性是可以通过打印其表示来&lt;span&gt;检查序列化器实例中的所有字段&lt;/span&gt;。打开Django shell &lt;code&gt;python manage.py shell&lt;/code&gt;，然后尝试以下操作：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;54&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;from&lt;/span&gt; snippets.serializers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; SnippetSerializer
serializer &lt;/span&gt;=&lt;span&gt; SnippetSerializer()
&lt;/span&gt;&lt;span&gt;print&lt;/span&gt;&lt;span&gt;(repr(serializer))
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; SnippetSerializer():&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;    id = IntegerField(label='ID', read_only=True)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;    title = CharField(allow_blank=True, max_length=100, required=False)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;    code = CharField(style={'base_template': 'textarea.html'})&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;    linenos = BooleanField(required=False)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;    language = ChoiceField(choices=[('Clipper', 'FoxPro'), ('Cucumber', 'Gherkin'), ('RobotFramework', 'RobotFramework'), ('abap', 'ABAP'), ('ada', 'Ada')...&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;    style = ChoiceField(choices=[('autumn', 'autumn'), ('borland', 'borland'), ('bw', 'bw'), ('colorful', 'colorful')...&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;记住，ModelSerializer类不会做任何特别神奇的事情，它们只是创建序列化器类的快捷方式：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;一组自动确定的字段。&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;简单的默认实现create()和update()方法。&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;django&quot;&gt;&lt;span&gt;六、编写常规的Django视图&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;接下来要做的就是使用我们的新的Serializer类编写一些API视图。编辑snippets/views.py：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; django.shortcuts &lt;span&gt;import&lt;/span&gt;&lt;span&gt; render

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Create your views here.&lt;/span&gt;
&lt;span&gt;from&lt;/span&gt; django.http &lt;span&gt;import&lt;/span&gt;&lt;span&gt; HttpResponse, JsonResponse
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.views.decorators.csrf &lt;span&gt;import&lt;/span&gt;&lt;span&gt; csrf_exempt
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.renderers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; JSONRenderer
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.parsers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; JSONParser
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; snippets.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Snippet
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; snippets.serializers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; SnippetSerializer


@csrf_exempt
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; snippet_list(request):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    because we want to be able to POST to this view from clients
    that won't have a CSRF token we need to mark the view as csrf_exempt
    List all code snippets, or create a new snippet.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; request.method == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;GET&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
        snippets &lt;/span&gt;=&lt;span&gt; Snippet.objects.all()
        serializer &lt;/span&gt;= SnippetSerializer(snippets, many=&lt;span&gt;True)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; JsonResponse(serializer.data, safe=&lt;span&gt;False)

    &lt;/span&gt;&lt;span&gt;elif&lt;/span&gt; request.method == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;POST&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
        data &lt;/span&gt;=&lt;span&gt; JSONParser().parse(request)
        serializer &lt;/span&gt;= SnippetSerializer(data=&lt;span&gt;data)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; serializer.is_valid():
            serializer.save()
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; JsonResponse(serializer.data, status=201&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; JsonResponse(serializer.errors, status=400&lt;span&gt;)


@csrf_exempt
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; snippet_detail(request, pk):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Retrieve, update or delete a code snippet.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
        snippet &lt;/span&gt;= Snippet.objects.get(pk=&lt;span&gt;pk)
    &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; Snippet.DoesNotExist:
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; HttpResponse(status=404&lt;span&gt;)

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; request.method == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;GET&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
        serializer &lt;/span&gt;=&lt;span&gt; SnippetSerializer(snippet)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; JsonResponse(serializer.data)

    &lt;/span&gt;&lt;span&gt;elif&lt;/span&gt; request.method == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;PUT&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
        data &lt;/span&gt;=&lt;span&gt; JSONParser().parse(request)
        serializer &lt;/span&gt;= SnippetSerializer(snippet, data=&lt;span&gt;data)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; serializer.is_valid():
            serializer.save()
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; JsonResponse(serializer.data)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; JsonResponse(serializer.errors, status=400&lt;span&gt;)

    &lt;/span&gt;&lt;span&gt;elif&lt;/span&gt; request.method == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DELETE&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
        snippet.delete()
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; HttpResponse(status=204)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;上面的代码都比较好理解，定&lt;span&gt;义了不同http动作时后台不同的操作&lt;/span&gt;，在这里也体现了restful API的理念。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;because we want to be able to POST to this view from clients that won't have a CSRF token we need to mark the view as &lt;code&gt;csrf_exempt&lt;/code&gt;.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;因为我们希望能够从不具有CSRF令牌的客户端对此视图进行POST，因此我们需要给视图加个一个&lt;span&gt;装饰器&lt;/span&gt;&lt;span&gt;&lt;code&gt;csrf_exempt&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;为了让视图函数被调用，那当然需要设计一下url了，这里的处理和平时Django开发时是一样的。首先创建snippets/urls.py&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;from&lt;/span&gt; django.conf.urls &lt;span&gt;import&lt;/span&gt;&lt;span&gt; url
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; snippets &lt;span&gt;import&lt;/span&gt;&lt;span&gt; views

urlpatterns &lt;/span&gt;=&lt;span&gt; [
    url(r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;^snippets/$&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, views.snippet_list),
    url(r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;^snippets/(?P&amp;lt;pk&amp;gt;[0-9]+)/$&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, views.snippet_detail),
]&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;We also need to wire up the root urlconf, in the &lt;code&gt;tutorial/urls.py&lt;/code&gt; file, to include our snippet app's URLs.&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
&lt;span&gt;from django.conf.urls import url, include

urlpatterns = [
    url(r'^', include('snippets.urls')),
]
&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;api&quot;&gt;&lt;span&gt;七、对API进行测试&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;完成了上面那些工作后，就可以开始测试了，退出shell模式并启动服务器，根据我们刚才设计的url发送请求，需要先安装httpie模块：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;codehilite&quot; readability=&quot;11&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
&lt;span&gt;pip install httpie&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;然后在命令行窗口访问，效果如下： &lt;/span&gt;&lt;/p&gt;
&lt;img src=&quot;http://images2017.cnblogs.com/blog/1038183/201711/1038183-20171101135437685-1837373040.png&quot; alt=&quot;&quot; width=&quot;465&quot; height=&quot;490&quot;/&gt;&lt;p&gt;&lt;span&gt;也可以访问指定id的数据： &lt;/span&gt;&lt;/p&gt;
&lt;img src=&quot;http://images2017.cnblogs.com/blog/1038183/201711/1038183-20171101135445576-1179074385.png&quot; alt=&quot;&quot;/&gt;&lt;p&gt;&lt;span&gt; 当然了，也可以直接在浏览器查看，直接输入那个URL就可以了： &lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1038183/201711/1038183-20171101135507638-1279203267.png&quot; alt=&quot;&quot; width=&quot;1979&quot; height=&quot;87&quot;/&gt;&lt;/p&gt;

</description>
<pubDate>Wed, 01 Nov 2017 06:31:00 +0000</pubDate>
<dc:creator>前程明亮</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/0zcl/p/7765807.html</dc:identifier>
</item>
<item>
<title>linux云服务器常用设置 - 小火柴的蓝色理想</title>
<link>http://www.cnblogs.com/xiaohuochai/p/7749727.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/xiaohuochai/p/7749727.html</guid>
<description>&lt;h2&gt;前面的话&lt;/h2&gt;
&lt;p&gt;　　由于在云服务器上配置自己的网站，将Linux里的常用设置记录如下&lt;/p&gt;

&lt;h3&gt;更改shell&lt;/h3&gt;
&lt;p&gt;　　默认地， ubuntu系统默认的shell是dash，但更常用的shell是bash&lt;/p&gt;
&lt;p&gt;　　通过下面命令可以将dash更改为bash&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
dpkg-reconfigure dash
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后选&amp;lt;No&amp;gt;&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029154859508-848049823.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　执行ls -l /bin/sh命令，查看shell类型已经修改为bash&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
ls -l /bin/sh
&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029155155008-1787285342.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;

&lt;h3&gt;帐号权限&lt;/h3&gt;
&lt;p&gt;　　为了提高服务器安全性，需要设置一个高权限的账号来代替root执行常规操作&lt;/p&gt;
&lt;p&gt;　　首先，新建一个用户&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
useradd test
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　[注意]在centos系统下，使用useradd会默认在home目录下，新增一个与用户名同名的目录。如果是ubuntu系统，默认不创建目录，如果需要则添加-m参数&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
useradd test -m
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　设置用户密码&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
passwd test
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　将test用户添加到sudo组中，操作命令前加sudo命令，即可实现root权限&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
gpasswd -a test sudo
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后使用su test，即切换到test帐号下&lt;/p&gt;


&lt;h3&gt;无密码登录&lt;/h3&gt;
&lt;p&gt;　　SSH是网络上两台机器互联的一套协议，默认需要22端口&lt;/p&gt;
&lt;p&gt;　　使用ssh test@1.2.3.4可以以test用户名来登录1.2.3.4服务器，按下ctrl+d可以退出登录&lt;/p&gt;
&lt;p&gt;　　下面通过添加SSH key的方式来进行无密码登录&lt;/p&gt;
&lt;p&gt;　　首先，在本地机器上执行下列指令&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
$ ssh-keygen
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　会出现几个问题，都直接回车取默认值就可以了&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171028210529211-947365957.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171028210657461-361628123.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　id_rsa 是私钥，是要严格保密的，id_rsa.pub是公钥，需要上传到服务器的/home/test/.ssh/authorized_keys文件中&lt;/p&gt;
&lt;p&gt;　　可以手动拷贝文件，也进入本地的.ssh目录下，然后执行以下命令&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
ssh-copy-id test@&lt;span&gt;1.2&lt;/span&gt;.&lt;span&gt;3.4&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div readability=&quot;7&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029131923273-1204741965.png&quot; alt=&quot;&quot;/&gt;&lt;p&gt;　　这样，以后登录就不用再输入密码了&lt;/p&gt;
&lt;/div&gt;

&lt;h3&gt;配置git&lt;/h3&gt;
&lt;p&gt;　　一般地，服务器要从github等代码托管平台获取最新的代码，所以配置git是必不可少的操作&lt;/p&gt;
&lt;p&gt;　　首先，更新apt-get软件包的列表&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
apt-&lt;span&gt;get&lt;/span&gt; update
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　接下来，安装git&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
apt-&lt;span&gt;get&lt;/span&gt; install git
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　关于apt-get的常用命令如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
apt-&lt;span&gt;get&lt;/span&gt;&lt;span&gt; update #更新软件包列表
apt&lt;/span&gt;-&lt;span&gt;get&lt;/span&gt;&lt;span&gt; install packagename #安装一个新软件包
apt&lt;/span&gt;-&lt;span&gt;get&lt;/span&gt;&lt;span&gt; remove packagename #卸载一个已安装的软件包（保留配置文档）
apt&lt;/span&gt;-&lt;span&gt;get&lt;/span&gt; remove --&lt;span&gt;purge packagename #卸载一个已安装的软件包（删除配置文档）
apt&lt;/span&gt;-&lt;span&gt;get&lt;/span&gt;&lt;span&gt; autoremove packagename #删除包及其依赖的软件包
apt&lt;/span&gt;-&lt;span&gt;get&lt;/span&gt; autoremove --purge packagname #删除包及其依赖的软件包+配置文件
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后，就可以从git地址克隆代码了&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
git clone git@git.xxx/xxx.git
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　当代码有改动时，先进入项目目录，如mall，然后使用git pull即可获取最新的代码了&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
cd mall&lt;br/&gt;git pull
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;修改端口&lt;/h3&gt;
&lt;p&gt;　　默认地，SSH端口是22。将其修改为其他端口，可以缩小被扫描和猜测的概率，增加服务器安全性&lt;/p&gt;
&lt;p&gt;　　[注意]该操作要在root用户下进行，否则会出现一些不容易解决的问题&lt;/p&gt;
&lt;p&gt;　　1、修改/etc/ssh/sshd_config文件里面的port端口为1024以上的任意端口&lt;/p&gt;
&lt;div readability=&quot;7&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029200737898-1209024372.png&quot; alt=&quot;&quot;/&gt;&lt;p&gt;　　2、然后，执行下列命令重启ssh服务&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
sudo service ssh restart
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　3、在阿里云安全规则中添加2000端口&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029200904351-1927451256.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;

&lt;h3&gt;设置防火墙&lt;/h3&gt;
&lt;p&gt;　　在/etc目录下，新建iptables.up.rules文件，内容如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;*filter&lt;/span&gt;&lt;span&gt;#allow all connections
&lt;/span&gt;-A INPUT -m state --state ESTABLISHED,RELATED -&lt;span&gt;j ACCEPT

#allow &lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt; traffic
&lt;/span&gt;-A OUTPUT -&lt;span&gt;j ACCEPT

#allow http https
&lt;/span&gt;-A INPUT -p tcp --dport &lt;span&gt;443&lt;/span&gt; -&lt;span&gt;j ACCEPT

&lt;/span&gt;-A INPUT -p tcp --dport &lt;span&gt;80&lt;/span&gt; -&lt;span&gt;j ACCEPT

#allow ssh port login
&lt;/span&gt;-A INPUT -p tcp -m state --state NEW --dport &lt;span&gt;2000&lt;/span&gt; -&lt;span&gt;j ACCEPT

#allow ping
&lt;/span&gt;-A INPUT -p icmp -m icmp --icmp-type &lt;span&gt;8&lt;/span&gt; -&lt;span&gt;j ACCEPT

#log denied calls
&lt;/span&gt;-A INPUT -m limit --limit &lt;span&gt;5&lt;/span&gt;/min -j LOG --log-prefix &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;iptables denied:&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; --log-level &lt;span&gt;7&lt;/span&gt;&lt;span&gt;
&lt;br/&gt;#drop incoming sensitive connetions&lt;br/&gt;-A INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --set&lt;br/&gt;-A INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --update --seconds 60 --hitcount 150 -j DROP
#reject all other inbound
&lt;/span&gt;-A INPUT -&lt;span&gt;j REJECT
&lt;/span&gt;-A FORWARD -&lt;span&gt;j REJECT

COMMIT&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　接着，使用下列命令使防火墙规则生效&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
iptables-restore &amp;lt; /etc/iptables.up.rules
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　使用ufw status命令来查看防火墙状态，并使用ufw enable来开启防火墙&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029203522726-706463389.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　下面来设置防火墙开机自动启动，在/etc/network/if-up.d目录下，新建一个iptables脚本文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
vi /etc/network/&lt;span&gt;if&lt;/span&gt;-up.d/iptables
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　文件内容如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
#!/bin/&lt;span&gt;sh
iptables&lt;/span&gt;-restore /etc/iptables.up.rules
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　将该脚本文件赋予执行权限&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
chmod +x /etc/network/&lt;span&gt;if&lt;/span&gt;-up.d/iptables
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;配置nginx&lt;/h3&gt;
&lt;p&gt;　　如果服务器只需要放置一个网站程序，解析网站到服务器的网站，网站程序监听80端口就可以了。如果服务器有很多应用，借助nginx不仅可以实现端口的代理，还可以实现负载均衡&lt;/p&gt;
&lt;p&gt;　　首先，安装nginx&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
apt-&lt;span&gt;get&lt;/span&gt; install nginx
&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171029234510617-929312180.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　下面在/etc/nginx/conf.d下新建一个配置文件，命名为test-8081.conf，内容如下&lt;/p&gt;
&lt;p&gt;　　[注意]一般以域名-端口号来命名配置文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;upstream xiaohuochai {
        server &lt;/span&gt;&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;8081&lt;/span&gt;&lt;span&gt;;
}
server{
        listen &lt;/span&gt;&lt;span&gt;80&lt;/span&gt;&lt;span&gt;;
        server_name &lt;/span&gt;&lt;span&gt;&lt;span&gt;1.2.3.4&lt;/span&gt;&lt;/span&gt;&lt;span&gt;;
        location &lt;/span&gt;/&lt;span&gt; {
                proxy_set_header X&lt;/span&gt;-Real-&lt;span&gt;IP $remote_addr;
                proxy_set_header X&lt;/span&gt;-Forward-&lt;span&gt;For $proxy_add_x_forwarded_for;
                proxy_set_header Host $http_host;
                proxy_set_header X&lt;/span&gt;-Nginx-Proxy &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
                proxy_pass http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;test;&lt;/span&gt;
&lt;span&gt;                proxy_redirect off;

        }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　下面使用nginx -t来测试配置文件是否格式正确&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030023945511-161942930.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　如果不想让报文显示server的详细信息，需要将/etc/nginx/nginx.conf主配置文件中的server_tockens off前面的注释取消即可&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030024734590-2132862856.png&quot; alt=&quot;&quot;/&gt; &lt;/div&gt;
&lt;p&gt;　　接着，重启nginx服务&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
nginx -s reload
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;域名解析&lt;/h3&gt;
&lt;p&gt;　　一般地，使用dnspod.cn来进行域名解析。&lt;/p&gt;
&lt;p&gt;　　在原域名注册商设置dnspod的DNS解析&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt; f1g1ns1.dnspod.net
 f1g1ns2.dnspod.net&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030113133433-1837595474.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　在dnspod.cn的域名解析页面填入要解析的域名&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030113411355-1139893742.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　添加域名后，下面来添加记录即可&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030121810324-793691467.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;

&lt;h3&gt;PM2部署&lt;/h3&gt;
&lt;p&gt;　　【1】安装&lt;/p&gt;
&lt;p&gt;　　为了让nodejs程序常驻，也为了实现自动化部署，需要使用PM2。使用npm全局安装pm2&lt;/p&gt;
&lt;p&gt;　　[注意]一定要全局安装，否则pm2无法使用&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
cnpm install pm2 -g
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　pm2常用命令如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
 pm2 start app.js #启动app.js应用程序
 pm2 start app.js --watch # 当文件变化时自动重启应用
 pm2 list # 列表 PM2 启动的所有的应用程序
 pm2 monit # 显示每个应用程序的CPU和内存占用情况
 pm2 show [app-name] # 显示应用程序的所有信息
 pm2 logs # 显示所有应用程序的日志
 pm2 stop all # 停止所有的应用程序
 pm2 stop 0 # 停止 id为 0的指定应用程序
 pm2 restart all # 重启所有应用
 pm2 delete all # 关闭并删除所有应用
 pm2 delete 0 # 删除指定应用 id 0
 pm2 startup # 创建开机自启动命令
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　【2】部署&lt;/p&gt;
&lt;p&gt;　　[注意]官网有详细的部署流程，详细情况&lt;a href=&quot;http://pm2.keymetrics.io/docs/usage/deployment/&quot; target=&quot;_blank&quot;&gt;移步至此&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;　　首先，在服务器用户目录下，新建一个www目录，用于存放后端代码&lt;/p&gt;

&lt;p&gt;　　然后，在本地后端项目目录下，如/server，新建一个ecosystem.json文件，内容如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;apps&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; : [{
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;      : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mall&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;script&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;    : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;./bin/www&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;env&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;COMMON_VARIABLE&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
    },
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;env_production&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; : {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;NODE_ENV&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;production&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
    }
  }],
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;deploy&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; : {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;production&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; : {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;user&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;xxx&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;host&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : [&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1.2.3.4&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;],
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;port&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ref&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;  : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;origin/master&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;repo&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;git@git.coding.net:ehuo0123/mall.git&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;path&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/home/xxx/www/mall&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;post-deploy&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; : &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;source ~/.nvm/nvm.sh &amp;amp;&amp;amp; cd server &amp;amp;&amp;amp; cnpm install &amp;amp;&amp;amp; pm2 startOrRestart ecosystem.json --env production&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ssh_options&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;StrictHostKeyChecking=no&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;env&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;  : {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;NODE_ENV&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;production&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
      }
    }
  }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后，在本地git目录下，更新git&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;git add .
git commit &lt;/span&gt;-m &lt;span&gt;'&lt;/span&gt;&lt;span&gt;change ecosystem&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
git push origin master&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　接着，在本机的/server目录下，执行下列命令&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
pm2 deploy ecosystem.json production setup
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　出现如下标识，表示设置成功&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101133638654-2063872788.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　接着，使用如下代码，使服务器从git代码托管平台获取最新的代码，且使用pm2自动部署&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
pm2 deploy ecosystem.json production
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　出现如下代码，表示部署成功&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101134407857-1289254289.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;


&lt;h3&gt;mongodb设置&lt;/h3&gt;
&lt;p&gt;　　【1】修改mongodb的27017端口&lt;/p&gt;
&lt;p&gt;　　为了提高服务器的安装，修改mongodb数据库默认的27017端口，为其他端口，如20000&lt;/p&gt;
&lt;p&gt;　　打开/etc/mongod.conf文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
sudo vi /etc/mongod.conf
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　修改27017端口为20000&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101000153904-273774271.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　如果想让本地电脑访问mongodb服务器，则需要注释点bindIp，因为bindIp:127.0.0.1表示只允许主机访问，即只匀速服务器访问&lt;/p&gt;
&lt;p&gt;　　然后，重启mongod服务即可&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
sudo service mongod restart
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　【2】创建管理员&lt;/p&gt;
&lt;p&gt;　　下面为mongodb创建管理员及为每一个数据库创建一个用户&lt;/p&gt;
&lt;p&gt;　　首先，切换到admin数据库，创建管理员&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
db.createUser({user: &quot;admin&quot;,pwd: &quot;123456&quot;,roles:[{role: &quot;root&quot;,db: &quot;admin&quot;}]})
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后，验证管理员权限&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
db.auth(&quot;admin&quot;,&quot;123456&quot;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　接着，进入mall数据库，并为mall数据库创建一个mall用户&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
use mall;&lt;br/&gt;db.createUser({user: &quot;mall&quot;,pwd: &quot;123456&quot;,roles:[{role: &quot;dbOwner&quot;,db: &quot;mall&quot;}]})
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后在当前mall数据库下，对创建的用户进行权限认证&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030183455199-1315810377.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　更改mongob.conf里的内容&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;security:
    authorization: &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;enabled&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后，重启mongod服务&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
sudo service mongod restart
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　使用用户名和密码来登录mongo客户端&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
mongo 127.0.0.1:20000/mall -u mall -p 123456
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　【3】数据备份&lt;/p&gt;
&lt;p&gt;　　在用户目录下，建立backup目录，进入backup目录&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
&lt;span&gt;mkdir backup
cd backup&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　创建一个名称为backup.sh的脚本，来对数据库进行定时备份&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
#!/bin/&lt;span&gt;sh

backUpFolder=/home/xxx/&lt;span&gt;backup
date_now=`date +%Y_%m_%d_%H%&lt;span&gt;M`
backFileName=&lt;span&gt;mall_$date_now

cd $backUpFolder
mkdir -&lt;span&gt;p $backFileName

mongodump -h 127.0.0.1:20000 -d mall -u mall -p 123456 -&lt;span&gt;o $backFileName

tar zcvf $backFileName.tar.gz $backFileName

rm -rf $backFileName&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后在backup目录下，执行sh backup.sh命令来执行脚本文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
sh backup.sh
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　结果如下图所示&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101014310435-1975040286.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　输入date，可以查看当前系统时间&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101014339716-1578186520.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　下面来创建定时任务，输入crontab -e来开启定时任务，然后选择2&lt;/p&gt;
&lt;p&gt;　　[注意]一定要在root权限下设置，否则不生效&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
sudo crontab -e
&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201710/740839-20171030233208418-2080323268.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　在打开的nano编辑器中输入如下命令，表示在01:46分，执行如下脚本。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
46 01 * * * sh /home/xiaohuochai/backup/backup.sh
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　然后，按下ctrl+X，按下shif+Y，回车，即可完成定时任务的设置&lt;/p&gt;
&lt;p&gt;　　由下图可知，01:46分确实生成了一个包文件&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101014636138-1039509871.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;　　【4】上传到七牛云 &lt;/p&gt;
&lt;p&gt;　　下面将备份的包文件上传到七牛云进行存储&lt;/p&gt;
&lt;p&gt;　　1、首先，修改backup.sh文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
#!/bin/&lt;span&gt;sh

backUpFolder&lt;/span&gt;=/home/xxx/&lt;span&gt;backup
date_now&lt;/span&gt;=`date +%Y_%m_%d_%H%&lt;span&gt;M`
backFileName&lt;/span&gt;=&lt;span&gt;mall_$date_now

cd $backUpFolder
mkdir &lt;/span&gt;-&lt;span&gt;p $backFileName

mongodump &lt;/span&gt;-h &lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;20000&lt;/span&gt; -d mall -u mall -p &lt;span&gt;123456&lt;/span&gt; -&lt;span&gt;o $backFileName

tar zcvf $backFileName.tar.gz $backFileName

rm &lt;/span&gt;-&lt;span&gt;rf $backFileName

NODE_ENV&lt;/span&gt;=$backUpFolder@$backFileName node /home/xxx/backup/upload.js
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　2、在backup目录下，安装七牛模块&lt;/p&gt;
&lt;p&gt;　　[注意]一定要本地安装，而不能全局安装&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
npm install qiniu
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　3、在backup目录下，创建upload.js文件，内容如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt;var&lt;/span&gt; qiniu = require(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;qiniu&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; accessKey = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你的accesskey&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; secretKey = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;你的secrestkey&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; mac = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; qiniu.auth.digest.Mac(accessKey, secretKey);

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; bucket = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;存储空间的名称&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; options =&lt;span&gt; {
  scope: bucket,
};
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; putPolicy = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; qiniu.rs.PutPolicy(options);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; uploadToken=&lt;span&gt;putPolicy.uploadToken(mac);


&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; config = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; qiniu.conf.Config();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;不同的区域，取值不同，华东为z0&lt;/span&gt;
config.zone =&lt;span&gt; qiniu.zone.Zone_z0;

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; parts = process.env.NODE_ENV.split(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;@&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; key =  parts[&lt;span&gt;1&lt;/span&gt;] + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.tar.gz&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; localFile =  parts[&lt;span&gt;0&lt;/span&gt;] + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; +&lt;span&gt; key;

&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; formUploader = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; qiniu.form_up.FormUploader(config);
&lt;/span&gt;&lt;span&gt;var&lt;/span&gt; putExtra = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; qiniu.form_up.PutExtra();
formUploader.putFile(uploadToken, key, localFile, putExtra, function(respErr,
  respBody, respInfo) {
  &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (respErr) {
    &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt;&lt;span&gt; respErr;
  }
  &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (respInfo.statusCode == &lt;span&gt;200&lt;/span&gt;&lt;span&gt;) {
    console.log(respBody);
  } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
    console.log(respInfo.statusCode);
    console.log(respBody);
  }
});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　4、运行backup.sh文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
sudo sh ./backup.sh
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　5、查看七牛云，发现备份文件已经成功上传&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/740839/201711/740839-20171101024055388-31223788.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;



</description>
<pubDate>Wed, 01 Nov 2017 06:17:00 +0000</pubDate>
<dc:creator>小火柴的蓝色理想</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/xiaohuochai/p/7749727.html</dc:identifier>
</item>
<item>
<title>【机器学习实战】第11章 使用 Apriori 算法进行关联分析 - 片刻</title>
<link>http://www.cnblogs.com/jiangzhonglian/p/7766194.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/jiangzhonglian/p/7766194.html</guid>
<description>&lt;p&gt;&lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/images/11.Apriori/apachecn_apriori_homepage.jpg&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://github.com/apachecn/MachineLearning/raw/master/images/11.Apriori/apachecn_apriori_homepage.jpg&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;关联分析&lt;/h2&gt;
&lt;p&gt;关联分析是一种在大规模数据集中寻找有趣关系的任务。 这些关系可以有两种形式:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;频繁项集（frequent item sets）: 经常出现在一块的物品的集合。&lt;/li&gt;
&lt;li&gt;关联规则（associational rules）: 暗示两种物品之间可能存在很强的关系。&lt;/li&gt;
&lt;/ul&gt;&lt;h2&gt;相关术语&lt;/h2&gt;
&lt;ul readability=&quot;2.5&quot;&gt;&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;关联分析（关联规则学习): 从大规模数据集中寻找物品间的隐含关系被称作 &lt;code&gt;关联分析(associati analysis)&lt;/code&gt; 或者 &lt;code&gt;关联规则学习（association rule learning）&lt;/code&gt; 。 下面是用一个 &lt;code&gt;杂货店&lt;/code&gt; 例子来说明这两个概念，如下图所示:&lt;br/&gt;&lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/images/11.Apriori/apachecn_apriori_association_demo_1.jpg&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://github.com/apachecn/MachineLearning/raw/master/images/11.Apriori/apachecn_apriori_association_demo_1.jpg&quot; alt=&quot;关联分析示例1&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;频繁项集: {葡萄酒, 尿布, 豆奶} 就是一个频繁项集的例子。&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;关联规则: 尿布 -&amp;gt; 葡萄酒 就是一个关联规则。这意味着如果顾客买了尿布，那么他很可能会买葡萄酒。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;那么 &lt;code&gt;频繁&lt;/code&gt; 的定义是什么呢？怎么样才算频繁呢？ 度量它们的方法有很多种，这里我们来简单的介绍下支持度和可信度。&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;支持度: 数据集中包含该项集的记录所占的比例。例如上图中，{豆奶} 的支持度为 4/5。{豆奶, 尿布} 的支持度为 3/5。&lt;/li&gt;
&lt;li&gt;可信度: 针对一条诸如 {尿布} -&amp;gt; {葡萄酒} 这样具体的关联规则来定义的。这条规则的 &lt;code&gt;可信度&lt;/code&gt; 被定义为 &lt;code&gt;支持度({尿布, 葡萄酒})/支持度({尿布})&lt;/code&gt;，从图中可以看出 支持度({尿布, 葡萄酒}) = 3/5，支持度({尿布}) = 4/5，所以 {尿布} -&amp;gt; {葡萄酒} 的可信度 = 3/5 / 4/5 = 3/4 = 0.75。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;code&gt;支持度&lt;/code&gt; 和 &lt;code&gt;可信度&lt;/code&gt; 是用来量化 &lt;code&gt;关联分析&lt;/code&gt; 是否成功的一个方法。 假设想找到支持度大于 0.8 的所有项集，应该如何去做呢？ 一个办法是生成一个物品所有可能组合的清单，然后对每一种组合统计它出现的频繁程度，但是当物品成千上万时，上述做法就非常非常慢了。 我们需要详细分析下这种情况并讨论下 Apriori 原理，该原理会减少关联规则学习时所需的计算量。&lt;/p&gt;
&lt;h2&gt;Apriori 原理&lt;/h2&gt;
&lt;p&gt;假设我们一共有 4 个商品: 商品0, 商品1, 商品2, 商品3。 所有可能的情况如下:&lt;br/&gt;&lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/images/11.Apriori/apachecn_apriori_goods_all_1.jpg&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://github.com/apachecn/MachineLearning/raw/master/images/11.Apriori/apachecn_apriori_goods_all_1.jpg&quot; alt=&quot;4种商品的所有组合&quot;/&gt;&lt;/a&gt;&lt;br/&gt;如果我们计算所有组合的支持度，也需要计算 15 次。即 2^N - 1 = 2^4 - 1 = 15。&lt;br/&gt;随着物品的增加，计算的次数呈指数的形式增长 ...&lt;br/&gt;为了降低计算次数和时间，研究人员发现了一种所谓的 Apriori 原理，即某个项集是频繁的，那么它的所有子集也是频繁的。 例如，如果 {0, 1} 是频繁的，那么 {0}, {1} 也是频繁的。 该原理直观上没有什么帮助，但是如果反过来看就有用了，也就是说如果一个项集是 &lt;code&gt;非频繁项集&lt;/code&gt;，那么它的所有超集也是非频繁项集，如下图所示:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/images/11.Apriori/%E9%9D%9E%E9%A2%91%E7%B9%81%E9%A1%B9%E9%9B%86.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://github.com/apachecn/MachineLearning/raw/master/images/11.Apriori/%E9%9D%9E%E9%A2%91%E7%B9%81%E9%A1%B9%E9%9B%86.png&quot; alt=&quot;非频繁项集&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在图中我们可以看到，已知灰色部分 {2,3} 是 &lt;code&gt;非频繁项集&lt;/code&gt;，那么利用上面的知识，我们就可以知道 {0,2,3} {1,2,3} {0,1,2,3} 都是 &lt;code&gt;非频繁的&lt;/code&gt;。 也就是说，计算出 {2,3} 的支持度，知道它是 &lt;code&gt;非频繁&lt;/code&gt; 的之后，就不需要再计算 {0,2,3} {1,2,3} {0,1,2,3} 的支持度，因为我们知道这些集合不会满足我们的要求。 使用该原理就可以避免项集数目的指数增长，从而在合理的时间内计算出频繁项集。&lt;/p&gt;
&lt;p&gt;Apriori 算法优缺点&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;* 优点：易编码实现
* 缺点：在大数据集上可能较慢
* 适用数据类型：数值型 或者 标称型数据。
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Apriori 算法流程步骤：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;* 收集数据：使用任意方法。
* 准备数据：任何数据类型都可以，因为我们只保存集合。
* 分析数据：使用任意方法。
* 训练数据：使用Apiori算法来找到频繁项集。
* 测试算法：不需要测试过程。
* 使用算法：用语发现频繁项集以及物品之间的关联规则。
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2&gt;Apriori 算法的使用&lt;/h2&gt;
&lt;p&gt;前面提到，关联分析的目标包括两项: 发现 &lt;code&gt;频繁项集&lt;/code&gt; 和发现 &lt;code&gt;关联规则&lt;/code&gt;。 首先需要找到 &lt;code&gt;频繁项集&lt;/code&gt;，然后才能发现 &lt;code&gt;关联规则&lt;/code&gt;。&lt;br/&gt;&lt;code&gt;Apriori&lt;/code&gt; 算法是发现 &lt;code&gt;频繁项集&lt;/code&gt; 的一种方法。 Apriori 算法的两个输入参数分别是最小支持度和数据集。 该算法首先会生成所有单个物品的项集列表。 接着扫描交易记录来查看哪些项集满足最小支持度要求，那些不满足最小支持度要求的集合会被去掉。 燃尽后对生下来的集合进行组合以声场包含两个元素的项集。 接下来再重新扫描交易记录，去掉不满足最小支持度的项集。 该过程重复进行直到所有项集被去掉。&lt;/p&gt;
&lt;h3&gt;生成候选项集&lt;/h3&gt;
&lt;p&gt;下面会创建一个用于构建初始集合的函数，也会创建一个通过扫描数据集以寻找交易记录子集的函数， 数据扫描的伪代码如下:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;对数据集中的每条交易记录 tran&lt;/li&gt;
&lt;li&gt;对每个候选项集 can
&lt;ul&gt;&lt;li&gt;检查一下 can 是否是 tran 的子集: 如果是则增加 can 的计数值&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;对每个候选项集
&lt;ul&gt;&lt;li&gt;如果其支持度不低于最小值，则保留该项集&lt;/li&gt;
&lt;li&gt;返回所有频繁项集列表 以下是一些辅助函数。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h4&gt;加载数据集&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;18&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 加载数据集
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;loadDataSet():
    &lt;span class=&quot;pl-k&quot;&gt;return [[&lt;span class=&quot;pl-c1&quot;&gt;1, &lt;span class=&quot;pl-c1&quot;&gt;3, &lt;span class=&quot;pl-c1&quot;&gt;4], [&lt;span class=&quot;pl-c1&quot;&gt;2, &lt;span class=&quot;pl-c1&quot;&gt;3, &lt;span class=&quot;pl-c1&quot;&gt;5], [&lt;span class=&quot;pl-c1&quot;&gt;1, &lt;span class=&quot;pl-c1&quot;&gt;2, &lt;span class=&quot;pl-c1&quot;&gt;3, &lt;span class=&quot;pl-c1&quot;&gt;5], [&lt;span class=&quot;pl-c1&quot;&gt;2, &lt;span class=&quot;pl-c1&quot;&gt;5]]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;创建集合 C1。即对 dataSet 进行去重，排序，放入 list 中，然后转换所有的元素为 frozenset&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;15&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 创建集合 C1。即对 dataSet 进行去重，排序，放入 list 中，然后转换所有的元素为 frozenset
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;createC1(&lt;span class=&quot;pl-smi&quot;&gt;dataSet):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;createC1（创建集合 C1）
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        dataSet 原始数据集
&lt;span class=&quot;pl-s&quot;&gt;    Returns:
&lt;span class=&quot;pl-s&quot;&gt;        frozenset 返回一个 frozenset 格式的 list
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;

    C1 &lt;span class=&quot;pl-k&quot;&gt;= []
    &lt;span class=&quot;pl-k&quot;&gt;for transaction &lt;span class=&quot;pl-k&quot;&gt;in dataSet:
        &lt;span class=&quot;pl-k&quot;&gt;for item &lt;span class=&quot;pl-k&quot;&gt;in transaction:
            &lt;span class=&quot;pl-k&quot;&gt;if &lt;span class=&quot;pl-k&quot;&gt;not [item] &lt;span class=&quot;pl-k&quot;&gt;in C1:
                &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 遍历所有的元素，如果不在 C1 出现过，那么就 append
                C1.append([item])
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 对数组进行 `从小到大` 的排序
    &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'sort 前=&lt;span class=&quot;pl-pds&quot;&gt;', C1
    C1.sort()
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# frozenset 表示冻结的 set 集合，元素无改变；可以把它当字典的 key 来使用
    &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'sort 后=&lt;span class=&quot;pl-pds&quot;&gt;', C1
    &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'frozenset=&lt;span class=&quot;pl-pds&quot;&gt;', &lt;span class=&quot;pl-c1&quot;&gt;map(&lt;span class=&quot;pl-c1&quot;&gt;frozenset, C1)
    &lt;span class=&quot;pl-k&quot;&gt;return &lt;span class=&quot;pl-c1&quot;&gt;map(&lt;span class=&quot;pl-c1&quot;&gt;frozenset, C1)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;计算候选数据集 CK 在数据集 D 中的支持度，并返回支持度大于最小支持度（minSupport）的数据&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;16&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 计算候选数据集 CK 在数据集 D 中的支持度，并返回支持度大于最小支持度（minSupport）的数据
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;scanD(&lt;span class=&quot;pl-smi&quot;&gt;D, &lt;span class=&quot;pl-smi&quot;&gt;Ck, &lt;span class=&quot;pl-smi&quot;&gt;minSupport):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;scanD（计算候选数据集 CK 在数据集 D 中的支持度，并返回支持度大于最小支持度 minSupport 的数据）
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        D 数据集
&lt;span class=&quot;pl-s&quot;&gt;        Ck 候选项集列表
&lt;span class=&quot;pl-s&quot;&gt;        minSupport 最小支持度
&lt;span class=&quot;pl-s&quot;&gt;    Returns:
&lt;span class=&quot;pl-s&quot;&gt;        retList 支持度大于 minSupport 的集合
&lt;span class=&quot;pl-s&quot;&gt;        supportData 候选项集支持度数据
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;

    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# ssCnt 临时存放选数据集 Ck 的频率. 例如: a-&amp;gt;10, b-&amp;gt;5, c-&amp;gt;8
    ssCnt &lt;span class=&quot;pl-k&quot;&gt;= {}
    &lt;span class=&quot;pl-k&quot;&gt;for tid &lt;span class=&quot;pl-k&quot;&gt;in D:
        &lt;span class=&quot;pl-k&quot;&gt;for can &lt;span class=&quot;pl-k&quot;&gt;in Ck:
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# s.issubset(t)  测试是否 s 中的每一个元素都在 t 中
            &lt;span class=&quot;pl-k&quot;&gt;if can.issubset(tid):
                &lt;span class=&quot;pl-k&quot;&gt;if &lt;span class=&quot;pl-k&quot;&gt;not ssCnt.has_key(can):
                    ssCnt[can] &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;1
                &lt;span class=&quot;pl-k&quot;&gt;else:
                    ssCnt[can] &lt;span class=&quot;pl-k&quot;&gt;+= &lt;span class=&quot;pl-c1&quot;&gt;1
    numItems &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;float(&lt;span class=&quot;pl-c1&quot;&gt;len(D)) &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 数据集 D 的数量
    retList &lt;span class=&quot;pl-k&quot;&gt;= []
    supportData &lt;span class=&quot;pl-k&quot;&gt;= {}
    &lt;span class=&quot;pl-k&quot;&gt;for key &lt;span class=&quot;pl-k&quot;&gt;in ssCnt:
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 支持度 = 候选项（key）出现的次数 / 所有数据集的数量
        support &lt;span class=&quot;pl-k&quot;&gt;= ssCnt[key]&lt;span class=&quot;pl-k&quot;&gt;/numItems
        &lt;span class=&quot;pl-k&quot;&gt;if support &lt;span class=&quot;pl-k&quot;&gt;&amp;gt;= minSupport:
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 在 retList 的首位插入元素，只存储支持度满足频繁项集的值
            retList.insert(&lt;span class=&quot;pl-c1&quot;&gt;0, key)
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 存储所有的候选项（key）和对应的支持度（support）
        supportData[key] &lt;span class=&quot;pl-k&quot;&gt;= support
    &lt;span class=&quot;pl-k&quot;&gt;return retList, supportData&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;完整代码地址: &lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/src/python/11.Apriori/apriori.py&quot;&gt;https://github.com/apachecn/MachineLearning/blob/master/src/python/11.Apriori/apriori.py&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;组织完整的 Apriori 算法&lt;/h3&gt;
&lt;h4&gt;输入频繁项集列表 Lk 与返回的元素个数 k，然后输出所有可能的候选项集 Ck&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 输入频繁项集列表 Lk 与返回的元素个数 k，然后输出所有可能的候选项集 Ck
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;aprioriGen(&lt;span class=&quot;pl-smi&quot;&gt;Lk, &lt;span class=&quot;pl-smi&quot;&gt;k):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;aprioriGen（输入频繁项集列表 Lk 与返回的元素个数 k，然后输出候选项集 Ck。
&lt;span class=&quot;pl-s&quot;&gt;       例如: 以 {0},{1},{2} 为输入且 k = 2 则输出 {0,1}, {0,2}, {1,2}. 以 {0,1},{0,2},{1,2} 为输入且 k = 3 则输出 {0,1,2}
&lt;span class=&quot;pl-s&quot;&gt;       仅需要计算一次，不需要将所有的结果计算出来，然后进行去重操作
&lt;span class=&quot;pl-s&quot;&gt;       这是一个更高效的算法）
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        Lk 频繁项集列表
&lt;span class=&quot;pl-s&quot;&gt;        k 返回的项集元素个数（若元素的前 k-2 相同，就进行合并）
&lt;span class=&quot;pl-s&quot;&gt;    Returns:
&lt;span class=&quot;pl-s&quot;&gt;        retList 元素两两合并的数据集
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;
    
    retList &lt;span class=&quot;pl-k&quot;&gt;= []
    lenLk &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;len(Lk)
    &lt;span class=&quot;pl-k&quot;&gt;for i &lt;span class=&quot;pl-k&quot;&gt;in &lt;span class=&quot;pl-c1&quot;&gt;range(lenLk):
        &lt;span class=&quot;pl-k&quot;&gt;for j &lt;span class=&quot;pl-k&quot;&gt;in &lt;span class=&quot;pl-c1&quot;&gt;range(i&lt;span class=&quot;pl-k&quot;&gt;+&lt;span class=&quot;pl-c1&quot;&gt;1, lenLk):
            L1 &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;list(Lk[i])[: k&lt;span class=&quot;pl-k&quot;&gt;-&lt;span class=&quot;pl-c1&quot;&gt;2]
            L2 &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;list(Lk[j])[: k&lt;span class=&quot;pl-k&quot;&gt;-&lt;span class=&quot;pl-c1&quot;&gt;2]
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print '-----i=', i, k-2, Lk, Lk[i], list(Lk[i])[: k-2]
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print '-----j=', j, k-2, Lk, Lk[j], list(Lk[j])[: k-2]
            L1.sort()
            L2.sort()
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 第一次 L1,L2 为空，元素直接进行合并，返回元素两两合并的数据集
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# if first k-2 elements are equal
            &lt;span class=&quot;pl-k&quot;&gt;if L1 &lt;span class=&quot;pl-k&quot;&gt;== L2:
                &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# set union
                &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print 'union=', Lk[i] | Lk[j], Lk[i], Lk[j]
                retList.append(Lk[i] &lt;span class=&quot;pl-k&quot;&gt;| Lk[j])
    &lt;span class=&quot;pl-k&quot;&gt;return retList&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;找出数据集 dataSet 中支持度 &amp;gt;= 最小支持度的候选项集以及它们的支持度。即我们的频繁项集。&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 找出数据集 dataSet 中支持度 &amp;gt;= 最小支持度的候选项集以及它们的支持度。即我们的频繁项集。
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;apriori(&lt;span class=&quot;pl-smi&quot;&gt;dataSet, &lt;span class=&quot;pl-smi&quot;&gt;minSupport&lt;span class=&quot;pl-k&quot;&gt;=&lt;span class=&quot;pl-c1&quot;&gt;0.5):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;apriori（首先构建集合 C1，然后扫描数据集来判断这些只有一个元素的项集是否满足最小支持度的要求。那么满足最小支持度要求的项集构成集合 L1。然后 L1 中的元素相互组合成 C2，C2 再进一步过滤变成 L2，然后以此类推，知道 CN 的长度为 0 时结束，即可找出所有频繁项集的支持度。）
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        dataSet 原始数据集
&lt;span class=&quot;pl-s&quot;&gt;        minSupport 支持度的阈值
&lt;span class=&quot;pl-s&quot;&gt;    Returns:
&lt;span class=&quot;pl-s&quot;&gt;        L 频繁项集的全集
&lt;span class=&quot;pl-s&quot;&gt;        supportData 所有元素和支持度的全集
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# C1 即对 dataSet 进行去重，排序，放入 list 中，然后转换所有的元素为 frozenset
    C1 &lt;span class=&quot;pl-k&quot;&gt;= createC1(dataSet)
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 对每一行进行 set 转换，然后存放到集合中
    D &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;map(&lt;span class=&quot;pl-c1&quot;&gt;set, dataSet)
    &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'D=&lt;span class=&quot;pl-pds&quot;&gt;', D
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 计算候选数据集 C1 在数据集 D 中的支持度，并返回支持度大于 minSupport 的数据
    L1, supportData &lt;span class=&quot;pl-k&quot;&gt;= scanD(D, C1, minSupport)
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print &quot;L1=&quot;, L1, &quot;\n&quot;, &quot;outcome: &quot;, supportData

    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# L 加了一层 list, L 一共 2 层 list
    L &lt;span class=&quot;pl-k&quot;&gt;= [L1]
    k &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;2
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 判断 L 的第 k-2 项的数据长度是否 &amp;gt; 0。第一次执行时 L 为 [[frozenset([1]), frozenset([3]), frozenset([2]), frozenset([5])]]。L[k-2]=L[0]=[frozenset([1]), frozenset([3]), frozenset([2]), frozenset([5])]，最后面 k += 1
    &lt;span class=&quot;pl-k&quot;&gt;while (&lt;span class=&quot;pl-c1&quot;&gt;len(L[k&lt;span class=&quot;pl-k&quot;&gt;-&lt;span class=&quot;pl-c1&quot;&gt;2]) &lt;span class=&quot;pl-k&quot;&gt;&amp;gt; &lt;span class=&quot;pl-c1&quot;&gt;0):
        &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'k=&lt;span class=&quot;pl-pds&quot;&gt;', k, L, L[k&lt;span class=&quot;pl-k&quot;&gt;-&lt;span class=&quot;pl-c1&quot;&gt;2]
        Ck &lt;span class=&quot;pl-k&quot;&gt;= aprioriGen(L[k&lt;span class=&quot;pl-k&quot;&gt;-&lt;span class=&quot;pl-c1&quot;&gt;2], k) &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 例如: 以 {0},{1},{2} 为输入且 k = 2 则输出 {0,1}, {0,2}, {1,2}. 以 {0,1},{0,2},{1,2} 为输入且 k = 3 则输出 {0,1,2}
        &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'Ck&lt;span class=&quot;pl-pds&quot;&gt;', Ck

        Lk, supK &lt;span class=&quot;pl-k&quot;&gt;= scanD(D, Ck, minSupport) &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 计算候选数据集 CK 在数据集 D 中的支持度，并返回支持度大于 minSupport 的数据
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 保存所有候选项集的支持度，如果字典没有，就追加元素，如果有，就更新元素
        supportData.update(supK)
        &lt;span class=&quot;pl-k&quot;&gt;if &lt;span class=&quot;pl-c1&quot;&gt;len(Lk) &lt;span class=&quot;pl-k&quot;&gt;== &lt;span class=&quot;pl-c1&quot;&gt;0:
            &lt;span class=&quot;pl-k&quot;&gt;break
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# Lk 表示满足频繁子项的集合，L 元素在增加，例如: 
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# l=[[set(1), set(2), set(3)]]
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# l=[[set(1), set(2), set(3)], [set(1, 2), set(2, 3)]]
        L.append(Lk)
        k &lt;span class=&quot;pl-k&quot;&gt;+= &lt;span class=&quot;pl-c1&quot;&gt;1
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print 'k=', k, len(L[k-2])
    &lt;span class=&quot;pl-k&quot;&gt;return L, supportData&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;到这一步，我们就找出我们所需要的 &lt;code&gt;频繁项集&lt;/code&gt; 和他们的 &lt;code&gt;支持度&lt;/code&gt; 了，接下来再找出关联规则即可！&lt;/p&gt;
&lt;p&gt;完整代码地址: &lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/src/python/11.Apriori/apriori.py&quot;&gt;https://github.com/apachecn/MachineLearning/blob/master/src/python/11.Apriori/apriori.py&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;从频繁项集中挖掘关联规则&lt;/h2&gt;
&lt;p&gt;前面我们介绍了用于发现 &lt;code&gt;频繁项集&lt;/code&gt; 的 Apriori 算法，现在要解决的问题是如何找出 &lt;code&gt;关联规则&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;要找到 &lt;code&gt;关联规则&lt;/code&gt;，我们首先从一个 &lt;code&gt;频繁项集&lt;/code&gt; 开始。 我们知道集合中的元素是不重复的，但我们想知道基于这些元素能否获得其它内容。 某个元素或某个元素集合可能会推导出另一个元素。 从先前 &lt;code&gt;杂货店&lt;/code&gt; 的例子可以得到，如果有一个频繁项集 {豆奶,莴苣}，那么就可能有一条关联规则 “豆奶 -&amp;gt; 莴苣”。 这意味着如果有人买了豆奶，那么在统计上他会购买莴苣的概率比较大。 但是，这一条件反过来并不总是成立。 也就是说 “豆奶 -&amp;gt; 莴苣” 统计上显著，那么 “莴苣 -&amp;gt; 豆奶” 也不一定成立。&lt;/p&gt;
&lt;p&gt;前面我们给出了 &lt;code&gt;频繁项集&lt;/code&gt; 的量化定义，即它满足最小支持度要求。&lt;br/&gt;对于 &lt;code&gt;关联规则&lt;/code&gt;，我们也有类似的量化方法，这种量化指标称之为 &lt;code&gt;可信度&lt;/code&gt;。&lt;br/&gt;一条规则 A -&amp;gt; B 的可信度定义为 support(A | B) / support(A)。（注意: 在 python 中 | 表示集合的并操作，而数学书集合并的符号是 U）。&lt;br/&gt;&lt;code&gt;A | B&lt;/code&gt; 是指所有出现在集合 A 或者集合 B 中的元素。&lt;br/&gt;由于我们先前已经计算出所有 &lt;code&gt;频繁项集&lt;/code&gt; 的支持度了，现在我们要做的只不过是提取这些数据做一次除法运算即可。&lt;/p&gt;
&lt;h3&gt;一个频繁项集可以产生多少条关联规则呢？&lt;/h3&gt;
&lt;p&gt;如下图所示，给出的是项集 {0,1,2,3} 产生的所有关联规则:&lt;br/&gt;&lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/images/11.Apriori/apachecn_association_rule_demo_1.jpg&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://github.com/apachecn/MachineLearning/raw/master/images/11.Apriori/apachecn_association_rule_demo_1.jpg&quot; alt=&quot;关联规则网格示意图&quot;/&gt;&lt;/a&gt;&lt;br/&gt;与我们前面的 &lt;code&gt;频繁项集&lt;/code&gt; 生成一样，我们可以为每个频繁项集产生许多关联规则。&lt;br/&gt;如果能减少规则的数目来确保问题的可解析，那么计算起来就会好很多。&lt;br/&gt;通过观察，我们可以知道，如果某条规则并不满足 &lt;code&gt;最小可信度&lt;/code&gt; 要求，那么该规则的所有子集也不会满足 &lt;code&gt;最小可信度&lt;/code&gt; 的要求。&lt;br/&gt;如上图所示，假设 &lt;code&gt;123 -&amp;gt; 3&lt;/code&gt; 并不满足最小可信度要求，那么就知道任何左部为 {0,1,2} 子集的规则也不会满足 &lt;code&gt;最小可信度&lt;/code&gt; 的要求。 即 &lt;code&gt;12 -&amp;gt; 03&lt;/code&gt; , &lt;code&gt;02 -&amp;gt; 13&lt;/code&gt; , &lt;code&gt;01 -&amp;gt; 23&lt;/code&gt; , &lt;code&gt;2 -&amp;gt; 013&lt;/code&gt;, &lt;code&gt;1 -&amp;gt; 023&lt;/code&gt;, &lt;code&gt;0 -&amp;gt; 123&lt;/code&gt; 都不满足 &lt;code&gt;最小可信度&lt;/code&gt; 要求。&lt;/p&gt;
&lt;p&gt;可以利用关联规则的上述性质属性来减少需要测试的规则数目，跟先前 Apriori 算法的套路一样。&lt;br/&gt;以下是一些辅助函数:&lt;/p&gt;
&lt;h4&gt;计算可信度&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 计算可信度（confidence）
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;calcConf(&lt;span class=&quot;pl-smi&quot;&gt;freqSet, &lt;span class=&quot;pl-smi&quot;&gt;H
, &lt;span class=&quot;pl-smi&quot;&gt;supportData, &lt;span class=&quot;pl-smi&quot;&gt;brl, &lt;span class=&quot;pl-smi&quot;&gt;minConf&lt;span class=&quot;pl-k&quot;&gt;=&lt;span class=&quot;pl-c1&quot;&gt;0.7):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;calcConf（对两个元素的频繁项，计算可信度，例如： {1,2}/{1} 或者 {1,2}/{2} 看是否满足条件）
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        freqSet 频繁项集中的元素，例如: frozenset([1, 3])    
&lt;span class=&quot;pl-s&quot;&gt;        H 频繁项集中的元素的集合，例如: [frozenset([1]), frozenset([3])]
&lt;span class=&quot;pl-s&quot;&gt;        supportData 所有元素的支持度的字典
&lt;span class=&quot;pl-s&quot;&gt;        brl 关联规则列表的空数组
&lt;span class=&quot;pl-s&quot;&gt;        minConf 最小可信度
&lt;span class=&quot;pl-s&quot;&gt;    Returns:
&lt;span class=&quot;pl-s&quot;&gt;        prunedH 记录 可信度大于阈值的集合
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 记录可信度大于最小可信度（minConf）的集合
    prunedH &lt;span class=&quot;pl-k&quot;&gt;= []
    &lt;span class=&quot;pl-k&quot;&gt;for conseq &lt;span class=&quot;pl-k&quot;&gt;in H: &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 假设 freqSet = frozenset([1, 3]), H = [frozenset([1]), frozenset([3])]，那么现在需要求出 frozenset([1]) -&amp;gt; frozenset([3]) 的可信度和 frozenset([3]) -&amp;gt; frozenset([1]) 的可信度

        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print 'confData=', freqSet, H, conseq, freqSet-conseq
        conf &lt;span class=&quot;pl-k&quot;&gt;= supportData[freqSet]&lt;span class=&quot;pl-k&quot;&gt;/supportData[freqSet&lt;span class=&quot;pl-k&quot;&gt;-conseq] &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 支持度定义: a -&amp;gt; b = support(a | b) / support(a). 假设  freqSet = frozenset([1, 3]), conseq = [frozenset([1])]，那么 frozenset([1]) 至 frozenset([3]) 的可信度为 = support(a | b) / support(a) = supportData[freqSet]/supportData[freqSet-conseq] = supportData[frozenset([1, 3])] / supportData[frozenset([1])]
        &lt;span class=&quot;pl-k&quot;&gt;if conf &lt;span class=&quot;pl-k&quot;&gt;&amp;gt;= minConf:
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 只要买了 freqSet-conseq 集合，一定会买 conseq 集合（freqSet-conseq 集合和 conseq 集合是全集）
            &lt;span class=&quot;pl-c1&quot;&gt;print freqSet&lt;span class=&quot;pl-k&quot;&gt;-conseq, &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'--&amp;gt;&lt;span class=&quot;pl-pds&quot;&gt;', conseq, &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'conf:&lt;span class=&quot;pl-pds&quot;&gt;', conf
            brl.append((freqSet&lt;span class=&quot;pl-k&quot;&gt;-conseq, conseq, conf))
            prunedH.append(conseq)
    &lt;span class=&quot;pl-k&quot;&gt;return prunedH&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;递归计算频繁项集的规则&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;56&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 递归计算频繁项集的规则
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;rulesFromConseq(&lt;span class=&quot;pl-smi&quot;&gt;freqSet, &lt;span class=&quot;pl-smi&quot;&gt;H, &lt;span class=&quot;pl-smi&quot;&gt;supportData, &lt;span class=&quot;pl-smi&quot;&gt;brl, &lt;span class=&quot;pl-smi&quot;&gt;minConf&lt;span class=&quot;pl-k&quot;&gt;=&lt;span class=&quot;pl-c1&quot;&gt;0.7):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;rulesFromConseq
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        freqSet 频繁项集中的元素，例如: frozenset([2, 3, 5])    
&lt;span class=&quot;pl-s&quot;&gt;        H 频繁项集中的元素的集合，例如: [frozenset([2]), frozenset([3]), frozenset([5])]
&lt;span class=&quot;pl-s&quot;&gt;        supportData 所有元素的支持度的字典
&lt;span class=&quot;pl-s&quot;&gt;        brl 关联规则列表的数组
&lt;span class=&quot;pl-s&quot;&gt;        minConf 最小可信度
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# H[0] 是 freqSet 的元素组合的第一个元素，并且 H 中所有元素的长度都一样，长度由 aprioriGen(H, m+1) 这里的 m + 1 来控制
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 该函数递归时，H[0] 的长度从 1 开始增长 1 2 3 ...
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 假设 freqSet = frozenset([2, 3, 5]), H = [frozenset([2]), frozenset([3]), frozenset([5])]
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 那么 m = len(H[0]) 的递归的值依次为 1 2
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 在 m = 2 时, 跳出该递归。假设再递归一次，那么 H[0] = frozenset([2, 3, 5])，freqSet = frozenset([2, 3, 5]) ，没必要再计算 freqSet 与 H[0] 的关联规则了。
    m &lt;span class=&quot;pl-k&quot;&gt;= &lt;span class=&quot;pl-c1&quot;&gt;len(H[&lt;span class=&quot;pl-c1&quot;&gt;0])
    &lt;span class=&quot;pl-k&quot;&gt;if (&lt;span class=&quot;pl-c1&quot;&gt;len(freqSet) &lt;span class=&quot;pl-k&quot;&gt;&amp;gt; (m &lt;span class=&quot;pl-k&quot;&gt;+ &lt;span class=&quot;pl-c1&quot;&gt;1)):
        &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'freqSet******************&lt;span class=&quot;pl-pds&quot;&gt;', &lt;span class=&quot;pl-c1&quot;&gt;len(freqSet), m &lt;span class=&quot;pl-k&quot;&gt;+ &lt;span class=&quot;pl-c1&quot;&gt;1, freqSet, H, H[&lt;span class=&quot;pl-c1&quot;&gt;0]
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 生成 m+1 个长度的所有可能的 H 中的组合，假设 H = [frozenset([2]), frozenset([3]), frozenset([5])]
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 第一次递归调用时生成 [frozenset([2, 3]), frozenset([2, 5]), frozenset([3, 5])]
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 第二次 。。。没有第二次，递归条件判断时已经退出了
        Hmp1 &lt;span class=&quot;pl-k&quot;&gt;= aprioriGen(H, m&lt;span class=&quot;pl-k&quot;&gt;+&lt;span class=&quot;pl-c1&quot;&gt;1)
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 返回可信度大于最小可信度的集合
        Hmp1 &lt;span class=&quot;pl-k&quot;&gt;= calcConf(freqSet, Hmp1, supportData, brl, minConf)
        &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'Hmp1=&lt;span class=&quot;pl-pds&quot;&gt;', Hmp1
        &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'len(Hmp1)=&lt;span class=&quot;pl-pds&quot;&gt;', &lt;span class=&quot;pl-c1&quot;&gt;len(Hmp1), &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'len(freqSet)=&lt;span class=&quot;pl-pds&quot;&gt;', &lt;span class=&quot;pl-c1&quot;&gt;len(freqSet)
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 计算可信度后，还有数据大于最小可信度的话，那么继续递归调用，否则跳出递归
        &lt;span class=&quot;pl-k&quot;&gt;if (&lt;span class=&quot;pl-c1&quot;&gt;len(Hmp1) &lt;span class=&quot;pl-k&quot;&gt;&amp;gt; &lt;span class=&quot;pl-c1&quot;&gt;1):
            &lt;span class=&quot;pl-c1&quot;&gt;print &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'----------------------&lt;span class=&quot;pl-pds&quot;&gt;', Hmp1
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# print len(freqSet),  len(Hmp1[0]) + 1
            rulesFromConseq(freqSet, Hmp1, supportData, brl, minConf)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;生成关联规则&lt;/h4&gt;
&lt;div class=&quot;highlight highlight-source-python&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 生成关联规则
&lt;span class=&quot;pl-k&quot;&gt;def &lt;span class=&quot;pl-en&quot;&gt;generateRules(&lt;span class=&quot;pl-smi&quot;&gt;L, &lt;span class=&quot;pl-smi&quot;&gt;supportData, &lt;span class=&quot;pl-smi&quot;&gt;minConf&lt;span class=&quot;pl-k&quot;&gt;=&lt;span class=&quot;pl-c1&quot;&gt;0.7):
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;generateRules
&lt;span class=&quot;pl-s&quot;&gt;
&lt;span class=&quot;pl-s&quot;&gt;    Args:
&lt;span class=&quot;pl-s&quot;&gt;        L 频繁项集列表
&lt;span class=&quot;pl-s&quot;&gt;        supportData 频繁项集支持度的字典
&lt;span class=&quot;pl-s&quot;&gt;        minConf 最小置信度
&lt;span class=&quot;pl-s&quot;&gt;    Returns:
&lt;span class=&quot;pl-s&quot;&gt;        bigRuleList 可信度规则列表（关于 (A-&amp;gt;B+置信度) 3个字段的组合）
&lt;span class=&quot;pl-s&quot;&gt;    &lt;span class=&quot;pl-pds&quot;&gt;&quot;&quot;&quot;
    bigRuleList &lt;span class=&quot;pl-k&quot;&gt;= []
    &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 假设 L = [[frozenset([1]), frozenset([3]), frozenset([2]), frozenset([5])], [frozenset([1, 3]), frozenset([2, 5]), frozenset([2, 3]), frozenset([3, 5])], [frozenset([2, 3, 5])]]
    &lt;span class=&quot;pl-k&quot;&gt;for i &lt;span class=&quot;pl-k&quot;&gt;in &lt;span class=&quot;pl-c1&quot;&gt;range(&lt;span class=&quot;pl-c1&quot;&gt;1, &lt;span class=&quot;pl-c1&quot;&gt;len(L)):
        &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 获取频繁项集中每个组合的所有元素
        &lt;span class=&quot;pl-k&quot;&gt;for freqSet &lt;span class=&quot;pl-k&quot;&gt;in L[i]:
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 假设：freqSet= frozenset([1, 3]), H1=[frozenset([1]), frozenset([3])]
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 组合总的元素并遍历子元素，并转化为 frozenset 集合，再存放到 list 列表中
            H1 &lt;span class=&quot;pl-k&quot;&gt;= [&lt;span class=&quot;pl-c1&quot;&gt;frozenset([item]) &lt;span class=&quot;pl-k&quot;&gt;for item &lt;span class=&quot;pl-k&quot;&gt;in freqSet]
            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;# 2 个的组合，走 else, 2 个以上的组合，走 if
            &lt;span class=&quot;pl-k&quot;&gt;if (i &lt;span class=&quot;pl-k&quot;&gt;&amp;gt; &lt;span class=&quot;pl-c1&quot;&gt;1):
                rulesFromConseq(freqSet, H1, supportData, bigRuleList, minConf)
            &lt;span class=&quot;pl-k&quot;&gt;else:
                calcConf(freqSet, H1, supportData, bigRuleList, minConf)
    &lt;span class=&quot;pl-k&quot;&gt;return bigRuleList&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;到这里为止，通过调用 generateRules 函数即可得出我们所需的 &lt;code&gt;关联规则&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;分级法： 频繁项集-&amp;gt;关联规则
&lt;ul&gt;&lt;li&gt;1.首先从一个频繁项集开始，接着创建一个规则列表，其中规则右部分只包含一个元素，然后对这个规则进行测试。&lt;/li&gt;
&lt;li&gt;2.接下来合并所有剩余规则来创建一个新的规则列表，其中规则右部包含两个元素。&lt;/li&gt;
&lt;li&gt;如下图：&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/apachecn/MachineLearning/blob/master/images/11.Apriori/%E6%89%80%E6%9C%89%E5%8F%AF%E8%83%BD%E7%9A%84%E9%A1%B9%E9%9B%86%E7%BB%84%E5%90%88.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://github.com/apachecn/MachineLearning/raw/master/images/11.Apriori/%E6%89%80%E6%9C%89%E5%8F%AF%E8%83%BD%E7%9A%84%E9%A1%B9%E9%9B%86%E7%BB%84%E5%90%88.png&quot; alt=&quot;所有可能的项集组合&quot;/&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;最后： 每次增加频繁项集的大小，Apriori 算法都会重新扫描整个数据集，是否有优化空间呢？ 下一章：FP-growth算法等着你的到来&lt;/li&gt;
&lt;/ul&gt;&lt;hr/&gt;</description>
<pubDate>Wed, 01 Nov 2017 06:07:00 +0000</pubDate>
<dc:creator>片刻</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/jiangzhonglian/p/7766194.html</dc:identifier>
</item>
<item>
<title>RestServer 2.0 正式版发布 - devgis</title>
<link>http://www.cnblogs.com/devgis/p/7766167.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/devgis/p/7766167.html</guid>
<description>&lt;ol&gt;&lt;li&gt;使用许可&amp;amp;版权说明&lt;/li&gt;
&lt;/ol&gt;&lt;ol&gt;&lt;li&gt;在保持本软件完整的情况下可以将本软件用于任何商业用途。&lt;/li&gt;
&lt;li&gt;本软件可以自由传播，但是请保持软件相关文件和说明文档完整。&lt;/li&gt;
&lt;li&gt;未经许可不得将本软件反编译进行修改。&lt;/li&gt;
&lt;li&gt;如不同意以上许可请勿使用本软件。&lt;/li&gt;
&lt;/ol&gt;&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;关于RestServer RestServer是一个快捷的rest服务器，用于直接将数据库数据发布成json格式方便其他需要json格式数据的地方调用。此程序免费，代码有偿提供。1.0.0.22支持所有表数据返回以及表数据条件返回。&lt;/li&gt;
&lt;li&gt;使用环境&lt;/li&gt;
&lt;/ol&gt;&lt;ol&gt;&lt;li&gt;服务器:windows xp,7,8,10,windows server 2003,2008,2012。.&lt;/li&gt;
&lt;li&gt;.net FrameWork 4.0。&lt;/li&gt;
&lt;li&gt;数据库:oracle 9i,10g,11g,MSSql2000,2005,2008,2012,MySQL5以上。&lt;/li&gt;
&lt;/ol&gt;&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;RestServer配置使用&lt;/li&gt;
&lt;/ol&gt;&lt;ol readability=&quot;1&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;解压软件到相应目录。解压后主要有以下文件：&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;安装.net Framework4.0(去微软官方网站下载或者网络搜索即可。)&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;配置配置文件，配置文件在目录下RestServer.exe.config使用记事本打开即可进行编辑修改。只需修改configuration/appSettings配置节下面的内容（配置之前最好先进行复制备份，然后再进行修改），配置文件说明如下：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;1.1.0.35中增加&lt;/p&gt;
&lt;p&gt;a) HOSTNAME为当前主机名称,id地址或域名。 b) PORT为需要使用的端口，请使用系统没有用的否则会创建失败。 c) DBTYPE为数据库类型 必须为ORACLE,MSSQL或MYSQL，分别对应使用ORACLE数据库,MS SqlServer,MySQL数据库。 d) DBCONSTRING为数据库的链接内容 请参考下方样本按照DBTYPE类型进行配置。 e) DATATYPE为类型 支持JSON,JSONP。 f) JSONPHANDEL 设置类型为JSONP时需要配置此内容。 g) WRITELOG 为True时写日志 否则不写日志。 4) 启动软件注意win7以上系统包括Server 2008以上系统请使用右键管理员方式执行，否则会启动失败。启动成功后会有如下提示：&lt;/p&gt;
&lt;p&gt;表示服务已经启动成功。接下来我们就可以受用了。&lt;/p&gt;
&lt;ol start=&quot;5&quot;&gt;&lt;li&gt;开始使用 启动成功后就可以使用了。比如上一节配置了t_log和t_car两张表 这时候我们就可以在IE里边输入以下内容进行操作。&lt;/li&gt;
&lt;/ol&gt;&lt;ol readability=&quot;0.29447852760736&quot;&gt;&lt;li readability=&quot;0.31538461538462&quot;&gt;
&lt;p&gt;查询表中所有内容返回json,输入&lt;a href=&quot;http://localhost:9001/rest/t_car/query%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E7%BB%93%E6%9E%9C%EF%BC%9A&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/t_car/query我们就可以在浏览器中看到如下结果：&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;我们需要对标进行查询，比如carno=&quot;山A23392&quot;这时候我们可以进行如下查询：&lt;a href=&quot;http://localhost:9001/rest/t_car/query/carno=&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/t_car/query/carno=&lt;/a&gt; carno=&quot;山A23392&quot;这时浏览器中显示如下：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;当然这里边可以支持sql语句中的where语句进行组合查询。这里就不再做详细说明了。 3) 按列查找 字符类型查找如下：&lt;a href=&quot;http://localhost:9001/rest/T_TEST/name/'%E5%BC%A0%E4%B8%89&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/name/'张三&lt;/a&gt;' 查询结果：&lt;/p&gt;
&lt;p&gt;按照数值列等查找则值不需要’’如下： &lt;a href=&quot;http://localhost:9001/rest/T_TEST/id/1&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/id/1&lt;/a&gt; 查询结果如下：&lt;/p&gt;
&lt;p&gt;由于1.1.0.35以后支持JASONP 这时候返回结果类似如下：&lt;/p&gt;
&lt;ol start=&quot;6&quot;&gt;&lt;li&gt;2.0新增内容 支持Postgresql数据库(各scheme中表名勿重复) localhost:9001/rest/T_TEST/q 查询全部 eq:&lt;a href=&quot;http://localhost:9001/rest/T_TEST/q&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/q&lt;/a&gt; localhost:9001/rest/T_TEST/q/{where} 按条件查询 eq:&lt;a href=&quot;http://localhost:9001/rest/T_TEST/q/id='1&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/q/id='1&lt;/a&gt;' localhost:9001/rest/T_TEST/{colname}/{colvalue} 按列查询 eq:&lt;a href=&quot;http://localhost:9001/rest/T_TEST/id/'1&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/id/'1&lt;/a&gt;' localhost:9001/rest/T_TEST/q/p/{pagesize}/{pageindex} 所有数据分页 eq:&lt;a href=&quot;http://localhost:9001/rest/T_TEST/q/p/5/1&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/q/p/5/1&lt;/a&gt; localhost:9001/rest/T_TEST/q/p/{pagesize}/{pageindex}/{where} 按查询条件分页 eq:&lt;a href=&quot;http://localhost:9001/rest/T_TEST/q/p/10/1/id='1&quot; target=&quot;_blank&quot;&gt;http://localhost:9001/rest/T_TEST/q/p/10/1/id='1&lt;/a&gt;' *带{}为变量 需要输入相应值或者表达式(Where) 全部为get方式&lt;/li&gt;
&lt;li&gt;联系我们 查询所有以及按条件查询已经覆盖了现在互联网上所有的的查询内容需求，当然如果您需要更进一步的功能或者需要源码自己进行深入开发可以通过以下方式联系我： QQ:80163278 淘宝:&lt;a href=&quot;http://tbflyshop.taobao.com/&quot; target=&quot;_blank&quot;&gt;http://tbflyshop.taobao.com&lt;/a&gt; 或者发送电子邮件到&lt;a href=&quot;mailto:devgis@qq.com&quot; target=&quot;_blank&quot;&gt;devgis@qq.com&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;下载地址： &lt;/p&gt;
&lt;p&gt;百度网盘：http://pan.baidu.com/s/1gfGjVkJ&lt;/p&gt;
&lt;p&gt;github:https://github.com/devgis/RestServer&lt;/p&gt;
</description>
<pubDate>Wed, 01 Nov 2017 06:02:00 +0000</pubDate>
<dc:creator>devgis</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/devgis/p/7766167.html</dc:identifier>
</item>
</channel>
</rss>