<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>PV 动态供给 - 每天5分钟玩转 Docker 容器技术（153） - CloudMan</title>
<link>http://www.cnblogs.com/CloudMan6/p/8776073.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/CloudMan6/p/8776073.html</guid>
<description>&lt;p&gt;&lt;span&gt;前面的例子中，我们提前创建了 PV，然后通过 PVC 申请 PV 并在 Pod 中使用，这种方式叫做静态供给（Static Provision）。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;与之对应的是动态供给（Dynamical Provision），即如果没有满足 PVC 条件的 PV，会动态创建 PV。相比静态供给，动态供给有明显的优势：不需要提前创建 PV，减少了管理员的工作量，效率高。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;动态供给是通过 StorageClass 实现的，StorageClass 定义了如何创建 PV，下面是两个例子。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;StorageClass &lt;/span&gt;&lt;code&gt;&lt;span&gt;standard&lt;/span&gt;&lt;/code&gt;&lt;span&gt;：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/775365/201804/775365-20180410063347873-458117135.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;StorageClass &lt;/span&gt;&lt;code&gt;&lt;span&gt;slow&lt;/span&gt;&lt;/code&gt;&lt;span&gt;：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/775365/201804/775365-20180410063358974-1797565921.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;这两个 StorageClass 都会动态创建 AWS EBS，不同在于 &lt;/span&gt;&lt;code&gt;&lt;span&gt;standard&lt;/span&gt;&lt;/code&gt;&lt;span&gt; 创建的是 &lt;/span&gt;&lt;code&gt;&lt;span&gt;gp2&lt;/span&gt;&lt;/code&gt;&lt;span&gt; 类型的 EBS，而 &lt;/span&gt;&lt;code&gt;&lt;span&gt;slow&lt;/span&gt;&lt;/code&gt;&lt;span&gt; 创建的是 &lt;/span&gt;&lt;code&gt;&lt;span&gt;io1&lt;/span&gt;&lt;/code&gt;&lt;span&gt; 类型的 EBS。不同类型的 EBS 支持的参数可参考 AWS 官方文档。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;StorageClass 支持 &lt;/span&gt;&lt;code&gt;&lt;span&gt;Delete&lt;/span&gt;&lt;/code&gt;&lt;span&gt; 和 &lt;/span&gt;&lt;code&gt;&lt;span&gt;Retain&lt;/span&gt;&lt;/code&gt;&lt;span&gt; 两种 &lt;/span&gt;&lt;code&gt;&lt;span&gt;reclaimPolicy&lt;/span&gt;&lt;/code&gt;&lt;span&gt;，默认是 &lt;/span&gt;&lt;code&gt;&lt;span&gt;Delete&lt;/span&gt;&lt;/code&gt;&lt;span&gt;。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;与之前一样，PVC 在申请 PV 时，只需要指定 StorageClass 和容量以及访问模式，比如：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/775365/201804/775365-20180410063410017-1077432427.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;除了 AWS EBS，Kubernetes 支持其他多种动态供给 PV 的 Provisioner，完整列表请参考 &lt;/span&gt;&lt;a title=&quot;This link will take you away from steemit.com&quot; href=&quot;https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span&gt;https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;下一节以 MySQL 为例演示如何在项目中使用 PV 和 PVC。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;书籍：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1.《每天5分钟玩转Kubernetes》&lt;br/&gt;&lt;a href=&quot;https://item.jd.com/26225745440.html&quot;&gt;https://item.jd.com/26225745440.html&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.《每天5分钟玩转Docker容器技术》&lt;br/&gt;&lt;a href=&quot;https://item.jd.com/16936307278.html&quot;&gt;https://item.jd.com/16936307278.html&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;3.《每天5分钟玩转OpenStack》&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;a href=&quot;https://item.jd.com/12086376.html&quot;&gt;https://item.jd.com/12086376.html&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img title=&quot;https://i.imgsafe.org/68/68da21ce15.png&quot; src=&quot;https://image.ipaiban.com/upload-ueditor-image-20171205-1512465642434079417.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 10 Apr 2018 22:22:00 +0000</pubDate>
<dc:creator>CloudMan</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/CloudMan6/p/8776073.html</dc:identifier>
</item>
<item>
<title>Django REST framework+Vue 打造生鲜超市（四） - zhang_derek</title>
<link>http://www.cnblogs.com/derek1184405959/p/8768059.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/derek1184405959/p/8768059.html</guid>
<description>&lt;h2&gt;五、商品列表页&lt;/h2&gt;
&lt;h3&gt;&lt;span&gt;5.1.django的view实现商品列表页&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;（1）goods/view_base.py&lt;/p&gt;
&lt;p&gt;在goods文件夹下面新建view_base.py，为了区分django和django rest framework的view&lt;/p&gt;
&lt;p&gt;利用Django的view实现返回json数据&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; goods/view_base.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; django.views.generic &lt;span&gt;import&lt;/span&gt;&lt;span&gt; View
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; goods.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(View):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,request):
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;通过django的view实现商品列表页&lt;/span&gt;
        json_list =&lt;span&gt; []
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;获取所有商品&lt;/span&gt;
        goods =&lt;span&gt; Goods.objects.all()
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; good &lt;span&gt;in&lt;/span&gt;&lt;span&gt; goods:
            json_dict &lt;/span&gt;=&lt;span&gt; {}
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;获取商品的每个字段，键值对形式&lt;/span&gt;
            json_dict[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;] =&lt;span&gt; good.name
            json_dict[&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;category&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;] =&lt;span&gt; good.category.name
            json_dict[&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;market_price&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;] =&lt;span&gt; good.market_price
            json_list.append(json_dict)

        &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.http &lt;span&gt;import&lt;/span&gt;&lt;span&gt; HttpResponse
        &lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; json
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;返回json，一定要指定类型content_type='application/json'&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; HttpResponse(json.dumps(json_list),content_type=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;（2）MxShop/urls.py&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; goods.view_base &lt;span&gt;import&lt;/span&gt;&lt;span&gt; GoodsListView

urlpatterns &lt;/span&gt;=&lt;span&gt; [
   &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;商品列表页&lt;/span&gt;
    path(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;goods/&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,GoodsListView.as_view(),name=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;goods-list&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;访问http://127.0.0.1:8000/goods/  可以获取商品列表信息的json数据&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410010927207-1695615409.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;5.2.django的serializer序列化model&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;（1）&lt;/span&gt;model_to_dict&lt;/p&gt;
&lt;p&gt;&lt;span&gt;当字段比较多时，一个字段一个字段的提取很麻烦，可以用&lt;/span&gt;model_to_dict，将model整个转化为dict&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; goods/view_base.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; django.views.generic &lt;span&gt;import&lt;/span&gt;&lt;span&gt; View
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; goods.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(View):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,request):
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;通过django的view实现商品列表页&lt;/span&gt;
        json_list =&lt;span&gt; []
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;获取所有商品&lt;/span&gt;
        goods =&lt;span&gt; Goods.objects.all()
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; for good in goods:&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict = {}&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     #获取商品的每个字段，键值对形式&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict['name'] = good.name&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict['category'] = good.category.name&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict['market_price'] = good.market_price&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_list.append(json_dict)&lt;/span&gt;

        &lt;span&gt;from&lt;/span&gt; django.forms.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; model_to_dict
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; good &lt;span&gt;in&lt;/span&gt;&lt;span&gt; goods:
            json_dict &lt;/span&gt;=&lt;span&gt; model_to_dict(good)
            json_list.append(json_dict)

        &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.http &lt;span&gt;import&lt;/span&gt;&lt;span&gt; HttpResponse
        &lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; json
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;返回json，一定要指定类型content_type='application/json'&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; HttpResponse(json.dumps(json_list),content_type=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是这样有个问题，就是ImageFieldFile 和add_time字段不能序列化&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410011813083-1065608290.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; 如何才能将所有字段序列化呢？就要用到django的serializers&lt;/p&gt;
&lt;p&gt;（2）django serializer的用法&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; goods/view_base.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; django.views.generic &lt;span&gt;import&lt;/span&gt;&lt;span&gt; View
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; goods.models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(View):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get(self,request):
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;通过django的view实现商品列表页&lt;/span&gt;
        json_list =&lt;span&gt; []
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;获取所有商品&lt;/span&gt;
        goods =&lt;span&gt; Goods.objects.all()
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; for good in goods:&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict = {}&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     #获取商品的每个字段，键值对形式&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict['name'] = good.name&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict['category'] = good.category.name&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_dict['market_price'] = good.market_price&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;     json_list.append(json_dict)&lt;/span&gt;

        &lt;span&gt;import&lt;/span&gt;&lt;span&gt; json
        &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.core &lt;span&gt;import&lt;/span&gt;&lt;span&gt; serializers
        &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.http &lt;span&gt;import&lt;/span&gt;&lt;span&gt; JsonResponse

        json_data &lt;/span&gt;= serializers.serialize(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,goods)
        json_data &lt;/span&gt;=&lt;span&gt; json.loads(json_data)
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;In order to allow non-dict objects to be serialized set the safe parameter to False.&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; JsonResponse(json_data,safe=False)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410013319080-70734897.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;django的serializer虽然可以很简单实现序列化，但是有几个缺点&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;字段序列化定死的，要想重组的话非常麻烦&lt;/li&gt;
&lt;li&gt;从上面截图可以看出来，images保存的是一个相对路径，我们还需要补全路径，而这些drf都可以帮助我们做到&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;以上写了这么多只是为了引入django rest framework和简单介绍django的序列化用法，下面就是重点讲解django rest framework了&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;5.3.APIview方式实现商品列表页&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;（1）安装&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;pip install coreapi                         drf的文档支持&lt;/li&gt;
&lt;li&gt;pip install django-guardian           drf对象级别的权限支持&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;（2）配置def文档的url&lt;/p&gt;
&lt;p&gt;MxShop/urls.py&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; rest_framework.documentation &lt;span&gt;import&lt;/span&gt;&lt;span&gt; include_docs_urls

urlpatterns &lt;/span&gt;=&lt;span&gt; [
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;drf文档，title自定义&lt;/span&gt;
    path(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;docs&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,include_docs_urls(title=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;仙剑奇侠传&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)),
]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; （3）配置rest_framework&lt;/p&gt;
&lt;p&gt;settings.py中添加&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
INSTALLED_APPS =&lt;span&gt; [
&lt;/span&gt;&lt;span&gt;    '&lt;/span&gt;&lt;span&gt;rest_framework&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;MxShop/urls.py&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
urlpatterns =&lt;span&gt; [
    path(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;api-auth/&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,include(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.urls&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)),
]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;（4）goods文件夹下面新建serializers.py&lt;/p&gt;
&lt;p&gt;用drf的序列化实现商品列表页展示，代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; goods/serializers.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; serializers


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsSerializer(serializers.Serializer):
    name &lt;/span&gt;= serializers.CharField(required=True,max_length=100&lt;span&gt;)
    click_num &lt;/span&gt;= serializers.IntegerField(default=&lt;span&gt;0)
    goods_front_image &lt;/span&gt;= serializers.ImageField()
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;（5）goods/views.py&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; googd/views.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; rest_framework.views &lt;span&gt;import&lt;/span&gt;&lt;span&gt; APIView
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; goods.serializers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; GoodsSerializer
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; .models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.response &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Response


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(APIView):
    &lt;/span&gt;&lt;span&gt;'''&lt;/span&gt;&lt;span&gt;
    商品列表
    &lt;/span&gt;&lt;span&gt;'''&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; get(self,request,format=&lt;span&gt;None):
        goods &lt;/span&gt;=&lt;span&gt; Goods.objects.all()
        goods_serialzer &lt;/span&gt;= GoodsSerializer(goods,many=&lt;span&gt;True)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; Response(goods_serialzer.data)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410220418761-1122763924.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;h3&gt;&lt;span&gt;5.4.drf的Modelserializer实现商品列表页&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;上面是用Serializer实现的，需要自己手动添加字段，如果用Modelserializer，会更加的方便，直接用__all__就可以全部序列化&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; goods/serializers.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; serializers
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; .models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;Serializer实现商品列表页&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt; class GoodsSerializer(serializers.Serializer):&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;     name = serializers.CharField(required=True,max_length=100)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;     click_num = serializers.IntegerField(default=0)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;     goods_front_image = serializers.ImageField()&lt;/span&gt;

&lt;span&gt;#&lt;/span&gt;&lt;span&gt;ModelSerializer实现商品列表页&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsSerializer(serializers.ModelSerializer):
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Meta:
        model &lt;/span&gt;=&lt;span&gt; Goods
        fields &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;__all__&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410224303338-480352475.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; category只显示分类的id，Serialzer还可以嵌套使用，覆盖外键字段&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; goods/serializers.py&lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; serializers
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; .models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods,GoodsCategory

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;Serializer实现商品列表页&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt; class GoodsSerializer(serializers.Serializer):&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;     name = serializers.CharField(required=True,max_length=100)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;     click_num = serializers.IntegerField(default=0)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;     goods_front_image = serializers.ImageField()&lt;/span&gt;


&lt;span&gt;class&lt;/span&gt;&lt;span&gt; CategorySerializer(serializers.ModelSerializer):
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Meta:
        model &lt;/span&gt;=&lt;span&gt; GoodsCategory
        fields &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;__all__&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;


&lt;span&gt;#&lt;/span&gt;&lt;span&gt;ModelSerializer实现商品列表页&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsSerializer(serializers.ModelSerializer):
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;覆盖外键字段&lt;/span&gt;
    category =&lt;span&gt; CategorySerializer()
    &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Meta:
        model &lt;/span&gt;=&lt;span&gt; Goods
        fields &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;__all__&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410224653132-842965369.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;5.5.GenericView实现商品列表页&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;（1）mixins和generic一起用用&lt;/p&gt;
&lt;p&gt;GenericAPIView继承APIView，封装了很多方法，比APIView功能更强大&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('790725b6-686c-4cfd-8c0e-d7e98edeb0da')&quot; readability=&quot;51.5&quot;&gt;&lt;img id=&quot;code_img_closed_790725b6-686c-4cfd-8c0e-d7e98edeb0da&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_790725b6-686c-4cfd-8c0e-d7e98edeb0da&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('790725b6-686c-4cfd-8c0e-d7e98edeb0da',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_790725b6-686c-4cfd-8c0e-d7e98edeb0da&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;98&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GenericAPIView(views.APIView):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Base class for all other generic views.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; You'll need to either set these attributes,&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; or override `get_queryset()`/`get_serializer_class()`.&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; If you are overriding a view method, it is important that you call&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; `get_queryset()` instead of accessing the `queryset` property directly,&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; as `queryset` will get evaluated only once, and those results are cached&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; for all subsequent requests.&lt;/span&gt;
    queryset =&lt;span&gt; None
    serializer_class &lt;/span&gt;=&lt;span&gt; None

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; If you want to use object lookups other than pk, set 'lookup_field'.&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; For more complex lookup requirements override `get_object()`.&lt;/span&gt;
    lookup_field = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;pk&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    lookup_url_kwarg &lt;/span&gt;=&lt;span&gt; None

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; The filter backend classes to use for queryset filtering&lt;/span&gt;
    filter_backends =&lt;span&gt; api_settings.DEFAULT_FILTER_BACKENDS

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; The style to use for queryset pagination.&lt;/span&gt;
    pagination_class =&lt;span&gt; api_settings.DEFAULT_PAGINATION_CLASS

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_queryset(self):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Get the list of items for this view.
        This must be an iterable, and may be a queryset.
        Defaults to using `self.queryset`.

        This method should always be used rather than accessing `self.queryset`
        directly, as `self.queryset` gets evaluated only once, and those results
        are cached for all subsequent requests.

        You may want to override this if you need to provide different
        querysets depending on the incoming request.

        (Eg. return a list of items that is specific to the user)
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;assert&lt;/span&gt; self.queryset &lt;span&gt;is&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; None, (
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;'%s' should either include a `queryset` attribute, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
            &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;or override the `get_queryset()` method.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
            % self.&lt;span&gt;__class__&lt;/span&gt;.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;
        )

        queryset &lt;/span&gt;=&lt;span&gt; self.queryset
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; isinstance(queryset, QuerySet):
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Ensure queryset is re-evaluated on each request.&lt;/span&gt;
            queryset =&lt;span&gt; queryset.all()
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; queryset

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_object(self):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Returns the object the view is displaying.

        You may want to override this if you need to provide non-standard
        queryset lookups.  Eg if objects are referenced using multiple
        keyword arguments in the url conf.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        queryset &lt;/span&gt;=&lt;span&gt; self.filter_queryset(self.get_queryset())

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Perform the lookup filtering.&lt;/span&gt;
        lookup_url_kwarg = self.lookup_url_kwarg &lt;span&gt;or&lt;/span&gt;&lt;span&gt; self.lookup_field

        &lt;/span&gt;&lt;span&gt;assert&lt;/span&gt; lookup_url_kwarg &lt;span&gt;in&lt;/span&gt;&lt;span&gt; self.kwargs, (
            &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Expected view %s to be called with a URL keyword argument &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
            &lt;span&gt;'&lt;/span&gt;&lt;span&gt;named &quot;%s&quot;. Fix your URL conf, or set the `.lookup_field` &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
            &lt;span&gt;'&lt;/span&gt;&lt;span&gt;attribute on the view correctly.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; %&lt;span&gt;
            (self.&lt;/span&gt;&lt;span&gt;__class__&lt;/span&gt;.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;, lookup_url_kwarg)
        )

        filter_kwargs &lt;/span&gt;=&lt;span&gt; {self.lookup_field: self.kwargs[lookup_url_kwarg]}
        obj &lt;/span&gt;= get_object_or_404(queryset, **&lt;span&gt;filter_kwargs)

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; May raise a permission denied&lt;/span&gt;
&lt;span&gt;        self.check_object_permissions(self.request, obj)

        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; obj

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; get_serializer(self, *args, **&lt;span&gt;kwargs):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Return the serializer instance that should be used for validating and
        deserializing input, and for serializing output.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        serializer_class &lt;/span&gt;=&lt;span&gt; self.get_serializer_class()
        kwargs[&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;context&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;] =&lt;span&gt; self.get_serializer_context()
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; serializer_class(*args, **&lt;span&gt;kwargs)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_serializer_class(self):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Return the class to use for the serializer.
        Defaults to using `self.serializer_class`.

        You may want to override this if you need to provide different
        serializations depending on the incoming request.

        (Eg. admins get full serialization, others get basic serialization)
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;assert&lt;/span&gt; self.serializer_class &lt;span&gt;is&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; None, (
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;'%s' should either include a `serializer_class` attribute, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
            &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;or override the `get_serializer_class()` method.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
            % self.&lt;span&gt;__class__&lt;/span&gt;.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;
        )

        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; self.serializer_class

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_serializer_context(self):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Extra context provided to the serializer class.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;request&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: self.request,
            &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;format&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: self.format_kwarg,
            &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;view&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: self
        }

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; filter_queryset(self, queryset):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Given a queryset, filter it with whichever filter backend is in use.

        You are unlikely to want to override this method, although you may need
        to call it either from a list view, or from a custom `get_object`
        method if you want to apply the configured filtering backend to the
        default queryset.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;for&lt;/span&gt; backend &lt;span&gt;in&lt;/span&gt;&lt;span&gt; list(self.filter_backends):
            queryset &lt;/span&gt;=&lt;span&gt; backend().filter_queryset(self.request, queryset, self)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; queryset

    @property
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; paginator(self):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        The paginator instance associated with the view, or `None`.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt; hasattr(self, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;_paginator&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;):
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; self.pagination_class &lt;span&gt;is&lt;/span&gt;&lt;span&gt; None:
                self._paginator &lt;/span&gt;=&lt;span&gt; None
            &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
                self._paginator &lt;/span&gt;=&lt;span&gt; self.pagination_class()
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; self._paginator

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; paginate_queryset(self, queryset):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Return a single page of results, or `None` if pagination is disabled.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; self.paginator &lt;span&gt;is&lt;/span&gt;&lt;span&gt; None:
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; None
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; self.paginator.paginate_queryset(queryset, self.request, view=&lt;span&gt;self)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_paginated_response(self, data):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Return a paginated style `Response` object for the given output data.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;assert&lt;/span&gt; self.paginator &lt;span&gt;is&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; None
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; self.paginator.get_paginated_response(data)
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;GenericAPIView源码&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
用的时候需要定义queryset和serializer_class&lt;br/&gt;GenericAPIView里面默认为空
&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;queryset = None&lt;/li&gt;
&lt;li&gt;serializer_class = None&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ListModelMixin里面list方法帮我们做好了分页和序列化的工作，只要调用就好了&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('5436a613-2f93-411d-9a4b-22bbb55a1c24')&quot; readability=&quot;35&quot;&gt;&lt;img id=&quot;code_img_closed_5436a613-2f93-411d-9a4b-22bbb55a1c24&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_5436a613-2f93-411d-9a4b-22bbb55a1c24&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('5436a613-2f93-411d-9a4b-22bbb55a1c24',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_5436a613-2f93-411d-9a4b-22bbb55a1c24&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;65&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; ListModelMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    List a queryset.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; list(self, request, *args, **&lt;span&gt;kwargs):
        queryset &lt;/span&gt;=&lt;span&gt; self.filter_queryset(self.get_queryset())

        page &lt;/span&gt;=&lt;span&gt; self.paginate_queryset(queryset)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; page &lt;span&gt;is&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; None:
            serializer &lt;/span&gt;= self.get_serializer(page, many=&lt;span&gt;True)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; self.get_paginated_response(serializer.data)

        serializer &lt;/span&gt;= self.get_serializer(queryset, many=&lt;span&gt;True)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; Response(serializer.data)
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;ListModelMixin源码&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;实现如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; goods.serializers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; GoodsSerializer
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; .models &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Goods
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.response &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Response
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; mixins
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; generics


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(mixins.ListModelMixin,generics.GenericAPIView):
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;商品列表页&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    queryset &lt;/span&gt;=&lt;span&gt; Goods.objects.all()
    serializer_class &lt;/span&gt;=&lt;span&gt; GoodsSerializer

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; get(self,request,*args,**&lt;span&gt;kwargs):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; self.list(request,*args,**kwargs)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面的代码优化，可以直接继承ListAPIView，ListAPIView主要做了两件事:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ListAPIView(mixins.ListModelMixin,GenericAPIView)        继承了这两个类&lt;/li&gt;
&lt;li&gt;&lt;em&gt;写好了get方法&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410232120707-2129115345.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; 我们要获取商品列表页的信息，只要写三行代码就可以了&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(generics.ListAPIView):
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;商品列表页&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    queryset &lt;/span&gt;=&lt;span&gt; Goods.objects.all()
    serializer_class &lt;/span&gt;= GoodsSerializer
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;&lt;span&gt;5.6.添加分页功能&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;先看rest_framework/settings.py源码，里面可以找到如何配置：比如认证、权限和分页等等&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('1b06056b-0fde-4656-a8b2-1f84b3310a80')&quot; readability=&quot;92&quot;&gt;&lt;img id=&quot;code_img_closed_1b06056b-0fde-4656-a8b2-1f84b3310a80&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_1b06056b-0fde-4656-a8b2-1f84b3310a80&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('1b06056b-0fde-4656-a8b2-1f84b3310a80',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_1b06056b-0fde-4656-a8b2-1f84b3310a80&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;179&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
Settings for REST framework are all namespaced in the REST_FRAMEWORK setting.
For example your project's `settings.py` file might look like this:

REST_FRAMEWORK = {
    'DEFAULT_RENDERER_CLASSES': (
        'rest_framework.renderers.JSONRenderer',
        'rest_framework.renderers.TemplateHTMLRenderer',
    )
    'DEFAULT_PARSER_CLASSES': (
        'rest_framework.parsers.JSONParser',
        'rest_framework.parsers.FormParser',
        'rest_framework.parsers.MultiPartParser'
    )
}

This module provides the `api_setting` object, that is used to access
REST framework settings, checking for user settings first, then falling
back to the defaults.
&lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
&lt;span&gt;from&lt;/span&gt; &lt;span&gt;__future__&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; unicode_literals

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; importlib &lt;span&gt;import&lt;/span&gt;&lt;span&gt; import_module

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.conf &lt;span&gt;import&lt;/span&gt;&lt;span&gt; settings
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.test.signals &lt;span&gt;import&lt;/span&gt;&lt;span&gt; setting_changed
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; django.utils &lt;span&gt;import&lt;/span&gt;&lt;span&gt; six

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; ISO_8601

DEFAULTS &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Base API policies&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_RENDERER_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.renderers.JSONRenderer&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.renderers.BrowsableAPIRenderer&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    ),
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PARSER_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.parsers.JSONParser&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.parsers.FormParser&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.parsers.MultiPartParser&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    ),
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_AUTHENTICATION_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.authentication.SessionAuthentication&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.authentication.BasicAuthentication&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    ),
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PERMISSION_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.permissions.AllowAny&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    ),
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_THROTTLE_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (),
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_CONTENT_NEGOTIATION_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.negotiation.DefaultContentNegotiation&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_METADATA_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.metadata.SimpleMetadata&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_VERSIONING_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Generic view behavior&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PAGINATION_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_FILTER_BACKENDS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (),

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Schema&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_SCHEMA_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.schemas.AutoSchema&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Throttling&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_THROTTLE_RATES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;user&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;anon&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,
    },
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;NUM_PROXIES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Pagination&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;PAGE_SIZE&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Filtering&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;SEARCH_PARAM&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;search&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;ORDERING_PARAM&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;ordering&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Versioning&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_VERSION&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;ALLOWED_VERSIONS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;VERSION_PARAM&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Authentication&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;UNAUTHENTICATED_USER&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;django.contrib.auth.models.AnonymousUser&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;UNAUTHENTICATED_TOKEN&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: None,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; View configuration&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;VIEW_NAME_FUNCTION&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.views.get_view_name&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;VIEW_DESCRIPTION_FUNCTION&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.views.get_view_description&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Exception handling&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;EXCEPTION_HANDLER&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.views.exception_handler&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;NON_FIELD_ERRORS_KEY&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;non_field_errors&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Testing&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;TEST_REQUEST_RENDERER_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.renderers.MultiPartRenderer&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.renderers.JSONRenderer&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    ),
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;TEST_REQUEST_DEFAULT_FORMAT&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;multipart&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Hyperlink settings&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;URL_FORMAT_OVERRIDE&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;format&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;FORMAT_SUFFIX_KWARG&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;format&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;URL_FIELD_NAME&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;url&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Input and output formats&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DATE_FORMAT&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: ISO_8601,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DATE_INPUT_FORMATS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (ISO_8601,),

    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DATETIME_FORMAT&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: ISO_8601,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DATETIME_INPUT_FORMATS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (ISO_8601,),

    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;TIME_FORMAT&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: ISO_8601,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;TIME_INPUT_FORMATS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: (ISO_8601,),

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Encoding&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;UNICODE_JSON&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: True,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;COMPACT_JSON&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: True,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;STRICT_JSON&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: True,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;COERCE_DECIMAL_TO_STRING&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: True,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;UPLOADED_FILES_USE_URL&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: True,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Browseable API&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;HTML_SELECT_CUTOFF&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: 1000&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;HTML_SELECT_CUTOFF_TEXT&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;More than {count} items...&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,

    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Schemas&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;SCHEMA_COERCE_PATH_PK&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: True,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;SCHEMA_COERCE_METHOD_NAMES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;retrieve&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;read&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;destroy&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;delete&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    },
}


&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; List of settings that may be in string import notation.&lt;/span&gt;
IMPORT_STRINGS =&lt;span&gt; (
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_RENDERER_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PARSER_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_AUTHENTICATION_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PERMISSION_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_THROTTLE_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_CONTENT_NEGOTIATION_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_METADATA_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_VERSIONING_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PAGINATION_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_FILTER_BACKENDS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_SCHEMA_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;EXCEPTION_HANDLER&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;TEST_REQUEST_RENDERER_CLASSES&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;UNAUTHENTICATED_USER&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;UNAUTHENTICATED_TOKEN&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;VIEW_NAME_FUNCTION&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;VIEW_DESCRIPTION_FUNCTION&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
)


&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; List of settings that have been removed&lt;/span&gt;
REMOVED_SETTINGS =&lt;span&gt; (
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;PAGINATE_BY&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;PAGINATE_BY_PARAM&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;MAX_PAGINATE_BY&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
)


&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; perform_import(val, setting_name):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    If the given setting is a string import notation,
    then perform the necessary import or imports.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; val &lt;span&gt;is&lt;/span&gt;&lt;span&gt; None:
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; None
    &lt;/span&gt;&lt;span&gt;elif&lt;/span&gt;&lt;span&gt; isinstance(val, six.string_types):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; import_from_string(val, setting_name)
    &lt;/span&gt;&lt;span&gt;elif&lt;/span&gt;&lt;span&gt; isinstance(val, (list, tuple)):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; [import_from_string(item, setting_name) &lt;span&gt;for&lt;/span&gt; item &lt;span&gt;in&lt;/span&gt;&lt;span&gt; val]
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; val


&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; import_from_string(val, setting_name):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Attempt to import a class from a string representation.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Nod to tastypie's use of importlib.&lt;/span&gt;
        module_path, class_name = val.rsplit(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 1&lt;span&gt;)
        module &lt;/span&gt;=&lt;span&gt; import_module(module_path)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; getattr(module, class_name)
    &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; (ImportError, AttributeError) as e:
        msg &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Could not import '%s' for API setting '%s'. %s: %s.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; % (val, setting_name, e.&lt;span&gt;__class__&lt;/span&gt;.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;, e)
        &lt;/span&gt;&lt;span&gt;raise&lt;/span&gt;&lt;span&gt; ImportError(msg)


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; APISettings(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    A settings object, that allows API settings to be accessed as properties.
    For example:

        from rest_framework.settings import api_settings
        print(api_settings.DEFAULT_RENDERER_CLASSES)

    Any setting with string import paths will be automatically resolved
    and return the class, rather than the string literal.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(self, user_settings=None, defaults=None, import_strings=&lt;span&gt;None):
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; user_settings:
            self._user_settings &lt;/span&gt;= self.&lt;span&gt;__check_user_settings&lt;/span&gt;&lt;span&gt;(user_settings)
        self.defaults &lt;/span&gt;= defaults &lt;span&gt;or&lt;/span&gt;&lt;span&gt; DEFAULTS
        self.import_strings &lt;/span&gt;= import_strings &lt;span&gt;or&lt;/span&gt;&lt;span&gt; IMPORT_STRINGS
        self._cached_attrs &lt;/span&gt;=&lt;span&gt; set()

    @property
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; user_settings(self):
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt; hasattr(self, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;_user_settings&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;):
            self._user_settings &lt;/span&gt;= getattr(settings, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;REST_FRAMEWORK&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, {})
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; self._user_settings

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__getattr__&lt;/span&gt;&lt;span&gt;(self, attr):
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; attr &lt;span&gt;not&lt;/span&gt; &lt;span&gt;in&lt;/span&gt;&lt;span&gt; self.defaults:
            &lt;/span&gt;&lt;span&gt;raise&lt;/span&gt; AttributeError(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Invalid API setting: '%s'&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt; attr)

        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Check if present in user settings&lt;/span&gt;
            val =&lt;span&gt; self.user_settings[attr]
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; KeyError:
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Fall back to defaults&lt;/span&gt;
            val =&lt;span&gt; self.defaults[attr]

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Coerce import strings into classes&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; attr &lt;span&gt;in&lt;/span&gt;&lt;span&gt; self.import_strings:
            val &lt;/span&gt;=&lt;span&gt; perform_import(val, attr)

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Cache the result&lt;/span&gt;
&lt;span&gt;        self._cached_attrs.add(attr)
        setattr(self, attr, val)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; val

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__check_user_settings&lt;/span&gt;&lt;span&gt;(self, user_settings):
        SETTINGS_DOC &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;http://www.django-rest-framework.org/api-guide/settings/&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
        &lt;span&gt;for&lt;/span&gt; setting &lt;span&gt;in&lt;/span&gt;&lt;span&gt; REMOVED_SETTINGS:
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; setting &lt;span&gt;in&lt;/span&gt;&lt;span&gt; user_settings:
                &lt;/span&gt;&lt;span&gt;raise&lt;/span&gt; RuntimeError(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The '%s' setting has been removed. Please refer to '%s' for available settings.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt; (setting, SETTINGS_DOC))
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; user_settings

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; reload(self):
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; attr &lt;span&gt;in&lt;/span&gt;&lt;span&gt; self._cached_attrs:
            delattr(self, attr)
        self._cached_attrs.clear()
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; hasattr(self, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;_user_settings&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;):
            delattr(self, &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;_user_settings&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)


api_settings &lt;/span&gt;=&lt;span&gt; APISettings(None, DEFAULTS, IMPORT_STRINGS)


&lt;/span&gt;&lt;span&gt;def&lt;/span&gt; reload_api_settings(*args, **&lt;span&gt;kwargs):
    setting &lt;/span&gt;= kwargs[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;setting&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; setting == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;REST_FRAMEWORK&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
        api_settings.reload()


setting_changed.connect(reload_api_settings)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;rest_framework/settings源码&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410234220686-282787038.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; 添加分页功能，配置如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
REST_FRAMEWORK =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;分页&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;DEFAULT_PAGINATION_CLASS&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rest_framework.pagination.PageNumberPagination&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;每页显示的个数&lt;/span&gt;
    &lt;span&gt;'&lt;/span&gt;&lt;span&gt;PAGE_SIZE&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: 10&lt;span&gt;,
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180410234432213-1889719342.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;自定也分页功能&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; rest_framework.pagination &lt;span&gt;import&lt;/span&gt;&lt;span&gt; PageNumberPagination

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsPagination(PageNumberPagination):
    &lt;/span&gt;&lt;span&gt;'''&lt;/span&gt;&lt;span&gt;
    商品列表自定义分页
    &lt;/span&gt;&lt;span&gt;'''&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt;默认每页显示的个数&lt;/span&gt;
    page_size = 10
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt;可以动态改变每页显示的个数&lt;/span&gt;
    page_size_query_param = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;page_size&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt;页码参数&lt;/span&gt;
    page_query_param = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;page&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
    &lt;span&gt;#&lt;/span&gt;&lt;span&gt;最多能显示多少页&lt;/span&gt;
    max_page_size = 100


&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListView(generics.ListAPIView):
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;商品列表页&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;

    pagination_class &lt;/span&gt;= GoodsPagination    &lt;span&gt;#&lt;/span&gt;&lt;span&gt;分页&lt;/span&gt;
    queryset =&lt;span&gt; Goods.objects.all()
    serializer_class &lt;/span&gt;= GoodsSerializer
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;settings.py里面就不用设置了&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180411000155528-64984322.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;5.7.viewsets和router完成商品列表页&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;主要用到viewsets中的GenericViewSet&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180411001105006-1995511675.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;再看下ViewSerMixin源码&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('af42426f-8a6f-4d32-a071-b4b1bb0aacd9')&quot; readability=&quot;54&quot;&gt;&lt;img id=&quot;code_img_closed_af42426f-8a6f-4d32-a071-b4b1bb0aacd9&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_af42426f-8a6f-4d32-a071-b4b1bb0aacd9&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('af42426f-8a6f-4d32-a071-b4b1bb0aacd9',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_af42426f-8a6f-4d32-a071-b4b1bb0aacd9&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;103&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; ViewSetMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    This is the magic.

    Overrides `.as_view()` so that it takes an `actions` keyword that performs
    the binding of HTTP methods to actions on the Resource.

    For example, to create a concrete view binding the 'GET' and 'POST' methods
    to the 'list' and 'create' actions...

    view = MyViewSet.as_view({'get': 'list', 'post': 'create'})
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;

    @classonlymethod
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; as_view(cls, actions=None, **&lt;span&gt;initkwargs):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Because of the way class based views create a closure around the
        instantiated view, we need to totally reimplement `.as_view`,
        and slightly modify the view function that is created and returned.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt; The suffix initkwarg is reserved for displaying the viewset type.&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt; eg. 'List' or 'Instance'.&lt;/span&gt;
        cls.suffix =&lt;span&gt; None

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; The detail initkwarg is reserved for introspecting the viewset type.&lt;/span&gt;
        cls.detail =&lt;span&gt; None

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Setting a basename allows a view to reverse its action urls. This&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt; value is provided by the router through the initkwargs.&lt;/span&gt;
        cls.basename =&lt;span&gt; None

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; actions must not be empty&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; actions:
            &lt;/span&gt;&lt;span&gt;raise&lt;/span&gt; TypeError(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The `actions` argument must be provided when &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
                            &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;calling `.as_view()` on a ViewSet. For example &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
                            &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;`.as_view({'get': 'list'})`&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; sanitize keyword arguments&lt;/span&gt;
        &lt;span&gt;for&lt;/span&gt; key &lt;span&gt;in&lt;/span&gt;&lt;span&gt; initkwargs:
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; key &lt;span&gt;in&lt;/span&gt;&lt;span&gt; cls.http_method_names:
                &lt;/span&gt;&lt;span&gt;raise&lt;/span&gt; TypeError(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;You tried to pass in the %s method name as a &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
                                &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;keyword argument to %s(). Don't do that.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
                                % (key, cls.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;))
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; hasattr(cls, key):
                &lt;/span&gt;&lt;span&gt;raise&lt;/span&gt; TypeError(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%s() received an invalid keyword %r&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt; (
                    cls.&lt;/span&gt;&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;, key))

        &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; view(request, *args, **&lt;span&gt;kwargs):
            self &lt;/span&gt;= cls(**&lt;span&gt;initkwargs)
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; We also store the mapping of request methods to actions,&lt;/span&gt;
            &lt;span&gt;#&lt;/span&gt;&lt;span&gt; so that we can later set the action attribute.&lt;/span&gt;
            &lt;span&gt;#&lt;/span&gt;&lt;span&gt; eg. `self.action = 'list'` on an incoming GET request.&lt;/span&gt;
            self.action_map =&lt;span&gt; actions

            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Bind methods to actions&lt;/span&gt;
            &lt;span&gt;#&lt;/span&gt;&lt;span&gt; This is the bit that's different to a standard view&lt;/span&gt;
            &lt;span&gt;for&lt;/span&gt; method, action &lt;span&gt;in&lt;/span&gt;&lt;span&gt; actions.items():
                handler &lt;/span&gt;=&lt;span&gt; getattr(self, action)
                setattr(self, method, handler)

            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; hasattr(self, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;get&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;) &lt;span&gt;and&lt;/span&gt; &lt;span&gt;not&lt;/span&gt; hasattr(self, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;head&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;):
                self.head &lt;/span&gt;=&lt;span&gt; self.get

            self.request &lt;/span&gt;=&lt;span&gt; request
            self.args &lt;/span&gt;=&lt;span&gt; args
            self.kwargs &lt;/span&gt;=&lt;span&gt; kwargs

            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; And continue as usual&lt;/span&gt;
            &lt;span&gt;return&lt;/span&gt; self.dispatch(request, *args, **&lt;span&gt;kwargs)

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; take name and docstring from class&lt;/span&gt;
        update_wrapper(view, cls, updated=&lt;span&gt;())

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; and possible attributes set by decorators&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt; like csrf_exempt from dispatch&lt;/span&gt;
        update_wrapper(view, cls.dispatch, assigned=&lt;span&gt;())

        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; We need to set these on the view function, so that breadcrumb&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt; generation can pick out these bits of information from a&lt;/span&gt;
        &lt;span&gt;#&lt;/span&gt;&lt;span&gt; resolved URL.&lt;/span&gt;
        view.cls =&lt;span&gt; cls
        view.initkwargs &lt;/span&gt;=&lt;span&gt; initkwargs
        view.suffix &lt;/span&gt;= initkwargs.get(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;suffix&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, None)
        view.actions &lt;/span&gt;=&lt;span&gt; actions
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; csrf_exempt(view)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; initialize_request(self, request, *args, **&lt;span&gt;kwargs):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Set the `.action` attribute on the view, depending on the request method.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        request &lt;/span&gt;= super(ViewSetMixin, self).initialize_request(request, *args, **&lt;span&gt;kwargs)
        method &lt;/span&gt;=&lt;span&gt; request.method.lower()
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; method == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;options&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; This is a special case as we always provide handling for the&lt;/span&gt;
            &lt;span&gt;#&lt;/span&gt;&lt;span&gt; options method in the base `View` class.&lt;/span&gt;
            &lt;span&gt;#&lt;/span&gt;&lt;span&gt; Unlike the other explicitly defined actions, 'metadata' is implicit.&lt;/span&gt;
            self.action = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;metadata&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
        &lt;span&gt;else&lt;/span&gt;&lt;span&gt;:
            self.action &lt;/span&gt;=&lt;span&gt; self.action_map.get(method)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; request

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; reverse_action(self, url_name, *args, **&lt;span&gt;kwargs):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Reverse the action for the given `url_name`.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        url_name &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;%s-%s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; %&lt;span&gt; (self.basename, url_name)
        kwargs.setdefault(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;request&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, self.request)

        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; reverse(url_name, *args, **&lt;span&gt;kwargs)

    @classmethod
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_extra_actions(cls):
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
        Get the methods that are marked as an extra ViewSet `@action`.
        &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; [method &lt;span&gt;for&lt;/span&gt; _, method &lt;span&gt;in&lt;/span&gt; getmembers(cls, _is_extra_action)]
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;ViewSetMixin源码&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180411001704834-648442573.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt; ViewSets和Routers结合使用&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; MxShop/yrls.py&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; goods.views &lt;span&gt;import&lt;/span&gt;&lt;span&gt; GoodsListViewSet
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.routers &lt;span&gt;import&lt;/span&gt;&lt;span&gt; DefaultRouter

router &lt;/span&gt;=&lt;span&gt; DefaultRouter()

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;配置goods的url&lt;/span&gt;
router.register(r&lt;span&gt;'&lt;/span&gt;&lt;span&gt;goods&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, GoodsListViewSet)

urlpatterns &lt;/span&gt;=&lt;span&gt; [
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;商品列表页&lt;/span&gt;
    re_path(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;^&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, include(router.urls)),
]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;views.py&lt;/p&gt;
&lt;p&gt;必须定义一个默认的排序方式&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; GoodsListViewSet(mixins.ListModelMixin,viewsets.GenericViewSet):
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;商品列表页&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;

    &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 分页&lt;/span&gt;
    pagination_class =&lt;span&gt; GoodsPagination
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;这里必须要定义一个默认的排序,否则会报错&lt;/span&gt;
    queryset = Goods.objects.all().order_by(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    serializer_class &lt;/span&gt;= GoodsSerializer
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;&lt;span&gt;5.8.drf的APIView、GenericView、viewsets和router的原理分析&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;genericViewSet 是最高的一层&lt;/p&gt;
&lt;p&gt;往下&lt;/p&gt;
&lt;p&gt;&lt;span&gt;GenericViewSet（viewsets）     &lt;span&gt;----drf&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　GenericAPIView                  &lt;span&gt;---drf&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　APIView                        &lt;span&gt;---drf&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　　　View　　　　        &lt;span&gt;----django&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;这些view功能的不同，主要的是有mixin的存在&lt;/p&gt;

&lt;p&gt;&lt;span&gt;mixins总共有五种：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　CreateModelMixin&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　ListModelMixin&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　UpdateModelMixin&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　RetrieveModelMixin&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　DestoryModelMixin&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('6fefd17b-4f39-47ce-b78d-32a68e27d8a0')&quot; readability=&quot;50.5&quot;&gt;&lt;img id=&quot;code_img_closed_6fefd17b-4f39-47ce-b78d-32a68e27d8a0&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_6fefd17b-4f39-47ce-b78d-32a68e27d8a0&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('6fefd17b-4f39-47ce-b78d-32a68e27d8a0',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_6fefd17b-4f39-47ce-b78d-32a68e27d8a0&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;96&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
Basic building blocks for generic class based views.

We don't bind behaviour to http method handlers yet,
which allows mixin classes to be composed in interesting ways.
&lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
&lt;span&gt;from&lt;/span&gt; &lt;span&gt;__future__&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; unicode_literals

&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework &lt;span&gt;import&lt;/span&gt;&lt;span&gt; status
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.response &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Response
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; rest_framework.settings &lt;span&gt;import&lt;/span&gt;&lt;span&gt; api_settings


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; CreateModelMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Create a model instance.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; create(self, request, *args, **&lt;span&gt;kwargs):
        serializer &lt;/span&gt;= self.get_serializer(data=&lt;span&gt;request.data)
        serializer.is_valid(raise_exception&lt;/span&gt;=&lt;span&gt;True)
        self.perform_create(serializer)
        headers &lt;/span&gt;=&lt;span&gt; self.get_success_headers(serializer.data)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; Response(serializer.data, status=status.HTTP_201_CREATED, headers=&lt;span&gt;headers)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; perform_create(self, serializer):
        serializer.save()

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_success_headers(self, data):
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; {&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Location&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: str(data[api_settings.URL_FIELD_NAME])}
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; (TypeError, KeyError):
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; {}


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; ListModelMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    List a queryset.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; list(self, request, *args, **&lt;span&gt;kwargs):
        queryset &lt;/span&gt;=&lt;span&gt; self.filter_queryset(self.get_queryset())

        page &lt;/span&gt;=&lt;span&gt; self.paginate_queryset(queryset)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; page &lt;span&gt;is&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; None:
            serializer &lt;/span&gt;= self.get_serializer(page, many=&lt;span&gt;True)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; self.get_paginated_response(serializer.data)

        serializer &lt;/span&gt;= self.get_serializer(queryset, many=&lt;span&gt;True)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; Response(serializer.data)


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; RetrieveModelMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Retrieve a model instance.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; retrieve(self, request, *args, **&lt;span&gt;kwargs):
        instance &lt;/span&gt;=&lt;span&gt; self.get_object()
        serializer &lt;/span&gt;=&lt;span&gt; self.get_serializer(instance)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; Response(serializer.data)


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; UpdateModelMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Update a model instance.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; update(self, request, *args, **&lt;span&gt;kwargs):
        partial &lt;/span&gt;= kwargs.pop(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;partial&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, False)
        instance &lt;/span&gt;=&lt;span&gt; self.get_object()
        serializer &lt;/span&gt;= self.get_serializer(instance, data=request.data, partial=&lt;span&gt;partial)
        serializer.is_valid(raise_exception&lt;/span&gt;=&lt;span&gt;True)
        self.perform_update(serializer)

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; getattr(instance, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;_prefetched_objects_cache&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, None):
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; If 'prefetch_related' has been applied to a queryset, we need to&lt;/span&gt;
            &lt;span&gt;#&lt;/span&gt;&lt;span&gt; forcibly invalidate the prefetch cache on the instance.&lt;/span&gt;
            instance._prefetched_objects_cache =&lt;span&gt; {}

        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; Response(serializer.data)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; perform_update(self, serializer):
        serializer.save()

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; partial_update(self, request, *args, **&lt;span&gt;kwargs):
        kwargs[&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;partial&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;] =&lt;span&gt; True
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; self.update(request, *args, **&lt;span&gt;kwargs)


&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; DestroyModelMixin(object):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;
    Destroy a model instance.
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;
    &lt;span&gt;def&lt;/span&gt; destroy(self, request, *args, **&lt;span&gt;kwargs):
        instance &lt;/span&gt;=&lt;span&gt; self.get_object()
        self.perform_destroy(instance)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; Response(status=&lt;span&gt;status.HTTP_204_NO_CONTENT)

    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; perform_destroy(self, instance):
        instance.delete()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;mixins.py源码&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;以ListModelMixin为例：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1299879/201804/1299879-20180411012547847-939171349.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;如果不继承ListModelMixin的话，就无法将get和商品的列表关联起来，另外还有其中的分页等等，都无法实现。&lt;/p&gt;
&lt;p&gt;还有其它几个mixin（增删改查局部），这些功能都是mixin做的&lt;/p&gt;

&lt;p&gt; 我们一般都是用viewsets&lt;/p&gt;
&lt;p&gt;ViewSet类与View类其实几乎是相同的,但提供的是read或update这些操作,而不是get或put 等HTTP动作。同时，ViewSet为我们提供了默认的URL结构, 使得我们能更专注于API本身。&lt;/p&gt;
&lt;p&gt; Router提供了一种简单，快速，集成的方式来定义一系列的urls&lt;/p&gt;
&lt;p&gt;&lt;em id=&quot;__mceDel&quot;&gt; &lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;http://www.cnblogs.com/derek1184405959/p/8747961.html&quot;&gt;&lt;span&gt;Django REST framework+Vue 打造生鲜超市（三）&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;http://www.cnblogs.com/derek1184405959/p/8733578.html&quot;&gt;&lt;span&gt;Django REST framework+Vue 打造生鲜超市（二）&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;http://www.cnblogs.com/derek1184405959/p/8733194.html&quot;&gt;&lt;span&gt;Django REST framework+Vue 打造生鲜超市（一）&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Tue, 10 Apr 2018 17:45:00 +0000</pubDate>
<dc:creator>zhang_derek</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/derek1184405959/p/8768059.html</dc:identifier>
</item>
<item>
<title>Java并发编程：synchronized和锁优化 - butterfly100</title>
<link>http://www.cnblogs.com/butterfly100/p/8786856.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/butterfly100/p/8786856.html</guid>
<description>&lt;h2 id=&quot;1-使用方法&quot; data-anchor-id=&quot;9xpk&quot;&gt;&lt;span&gt;1. 使用方法&lt;/span&gt;&lt;/h2&gt;
&lt;p data-anchor-id=&quot;eu9a&quot;&gt;synchronized 是 java 中最常用的保证线程安全的方式，synchronized 的作用主要有三方面：&lt;/p&gt;
&lt;ol data-anchor-id=&quot;0r0b&quot;&gt;&lt;li&gt;确保线程互斥的访问代码块，同一时刻只有一个方法可以进入到临界区&lt;/li&gt;
&lt;li&gt;保证共享变量的修改能及时可见&lt;/li&gt;
&lt;li&gt;有效解决重排序问题&lt;/li&gt;
&lt;/ol&gt;&lt;p data-anchor-id=&quot;cuxz&quot;&gt;语义上来讲，synchronized主要有三种用法：&lt;/p&gt;
&lt;ol data-anchor-id=&quot;ebuq&quot;&gt;&lt;li&gt;修饰普通方法，锁的是当前对象实例（this）&lt;/li&gt;
&lt;li&gt;修饰静态方法，锁的是当前 Class 对象（静态方法是属于类，而不是对象）&lt;/li&gt;
&lt;li&gt;修饰代码块，锁的是括号里的对象&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;2-实现原理&quot; data-anchor-id=&quot;qfa2&quot;&gt;2. 实现原理&lt;/h2&gt;
&lt;h3 id=&quot;21-监视器锁&quot; data-anchor-id=&quot;pyrx&quot;&gt;2.1. 监视器锁&lt;/h3&gt;
&lt;p data-anchor-id=&quot;65w8&quot;&gt;synchronized 同步代码块的语义底层是基于对象内部的监视器锁（monitor），分别是使用 monitorenter 和 monitorexit 指令完成。其实 wait/notify 也依赖于 monitor 对象，所以其一般要在 synchronized 同步的方法或代码块内使用。monitorenter 指令在编译为字节码后插入到同步代码块的开始位置，monitorexit 指令在编译为字节码后插入到方法结束处和异常处。JVM 要保证每个 monitorenter 必须有对应的 moniorexit。&lt;/p&gt;
&lt;p data-anchor-id=&quot;65w8&quot;&gt;&lt;span&gt;monitorenter&lt;/span&gt;：每个对象都有一个监视器锁（monitor），当 monitor 被某个线程占用时就会处于锁定状态，线程执行 monitorenter 指令时尝试获得 monitor 的所有权，即尝试获取对象的锁。过程如下：&lt;/p&gt;
&lt;ol data-anchor-id=&quot;zb5u&quot;&gt;&lt;li&gt;如果 monitor 的进入数为0，则该线程进入 monitor，然后将进入数设置为1，该线程即为 monitor 的所有者；&lt;/li&gt;
&lt;li&gt;如果线程已经占有monitor，只是重新进入，则monitor的进入数+1；&lt;/li&gt;
&lt;li&gt;如果其他线程已经占用 monitor，则该线程处于阻塞状态，直至 monitor 的进入数为0，再重新尝试获得 monitor 的所有权&lt;/li&gt;
&lt;/ol&gt;&lt;p data-anchor-id=&quot;i7rw&quot;&gt;&lt;span&gt;monitorexit&lt;/span&gt;：执行 monitorexit 的线程必须是 objectref 所对应的 monitor 的所有者。执行指令时，monitor 的进入数减1，如果减1后进入数为0，则线程退出 monitor，不再是这个 monitor 的所有者，其他被这个 monitor 阻塞的线程可以尝试获取这个 monitor 的所有权。&lt;/p&gt;
&lt;p data-anchor-id=&quot;i7rw&quot;&gt; &lt;/p&gt;
&lt;h3 id=&quot;22-线程状态和状态转化&quot; data-anchor-id=&quot;o4iw&quot;&gt;2.2. 线程状态和状态转化&lt;/h3&gt;
&lt;p data-anchor-id=&quot;ni7u&quot;&gt;在 HotSpot JVM 中，monitor 由 ObjectMonitor 实现，其主要数据结构如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;ObjectMonitor() {
    _header       &lt;/span&gt;=&lt;span&gt; NULL;
    _count        &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;;      &lt;span&gt;//&lt;/span&gt;&lt;span&gt;记录个数&lt;/span&gt;
    _waiters      = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;,
    _recursions   &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
    _object       &lt;/span&gt;=&lt;span&gt; NULL;
    _owner        &lt;/span&gt;= NULL;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;持有monitor的线程&lt;/span&gt;
    _WaitSet      = NULL;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;处于wait状态的线程，会被加入到_WaitSet&lt;/span&gt;
    _WaitSetLock  = &lt;span&gt;0&lt;/span&gt;&lt;span&gt; ;
    _Responsible  &lt;/span&gt;=&lt;span&gt; NULL ;
    _succ         &lt;/span&gt;=&lt;span&gt; NULL ;
    _cxq          &lt;/span&gt;=&lt;span&gt; NULL ;
    FreeNext      &lt;/span&gt;=&lt;span&gt; NULL ;
    _EntryList    &lt;/span&gt;= NULL ;  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;处于等待锁block状态的线程，会被加入到该列表&lt;/span&gt;
    _SpinFreq     = &lt;span&gt;0&lt;/span&gt;&lt;span&gt; ;
    _SpinClock    &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt; ;
    OwnerIsThread &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt; ;
  }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ObjectMonitor 中有两个队列，&lt;span&gt;_WaitSet&lt;/span&gt; 和 &lt;span&gt;_EntryList&lt;/span&gt;，用来保存 ObjectWaiter 对象列表（每个等待锁的线程都会被封装成 ObjectWaiter 对象），&lt;span&gt;_owner&lt;/span&gt; 指向持有 ObjectMonitor 对象的线程。&lt;/p&gt;
&lt;ol data-anchor-id=&quot;n6pi&quot;&gt;&lt;li&gt;当多个线程同时访问一段同步代码时，首先会进入 _EntryList，等待锁处于阻塞状态。&lt;/li&gt;
&lt;li&gt;当线程获取到对象的 monitor 后进入 The Owner 区域，并把 ObjectMonitor 中的 _owner 变量设置为当前线程，同时 monitor 中的计数器 count 加1。&lt;/li&gt;
&lt;li&gt;若线程调用 wait() 方法，将释放当前持有的 monitor，_owner 变量恢复为 null，count 减1，同时该线程进入 _WaitSet 集合中等待被唤醒，处于 waiting 状态。&lt;/li&gt;
&lt;li&gt;若当前线程执行完毕，将释放 monitor 并复位变量的值，以便其他线程进入获取 monitor。&lt;/li&gt;
&lt;/ol&gt;&lt;p data-anchor-id=&quot;ni7u&quot;&gt;过程如下图所示：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/1278254/201804/1278254-20180411011622550-897592260.png&quot; alt=&quot;&quot; width=&quot;400&quot;/&gt;&lt;/p&gt;
&lt;h2 data-anchor-id=&quot;yh8o&quot;&gt; &lt;/h2&gt;
&lt;h2 id=&quot;3-锁优化&quot; data-anchor-id=&quot;yh8o&quot;&gt;3. 锁优化&lt;/h2&gt;
&lt;p data-anchor-id=&quot;3lod&quot;&gt;在 JDK1.6 之后，出现了各种锁优化技术，如轻量级锁、偏向锁、适应性自旋、锁粗化、锁消除等，这些技术都是为了在线程间更高效的解决竞争问题，从而提升程序的执行效率。&lt;/p&gt;
&lt;p data-anchor-id=&quot;swvs&quot;&gt;通过引入轻量级锁和偏向锁来减少重量级锁的使用。锁的状态总共分四种：无锁状态、偏向锁、轻量级锁和重量级锁。锁随着竞争情况可以升级，但锁升级后不能降级，意味着不能从轻量级锁状态降级为偏向锁状态，也不能从重量级锁状态降级为轻量级锁状态。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
无锁状态 → 偏向锁状态 → 轻量级锁 → 重量级锁
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;31-对象头&quot; data-anchor-id=&quot;vbrq&quot;&gt;3.1. 对象头&lt;/h3&gt;
&lt;p data-anchor-id=&quot;m1cd&quot;&gt;要理解轻量级锁和偏向锁的运行机制，还要从了解对象头（Object Header）开始。对象头分为两部分：&lt;/p&gt;
&lt;p data-anchor-id=&quot;7heh&quot;&gt;1、&lt;span&gt;Mark Word&lt;/span&gt;：存储对象自身的运行时数据，如：Hash Code，GC 分代年龄、锁信息。这部分数据在32位和64位的 JVM 中分别为 32bit 和 64bit。考虑空间效率，Mark Word 被设计为非固定的数据结构，以便在极小的空间内存储尽量多的信息，32bit的 Mark Word 如下图所示：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;7heh&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1278254/201804/1278254-20180411011820425-708937012.png&quot; alt=&quot;&quot; width=&quot;550&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;3h05&quot;&gt;2、存储指向方法区对象类型数据的指针，如果是数组对象的话，额外会存储数组的长度&lt;/p&gt;
&lt;h3 data-anchor-id=&quot;goek&quot;&gt; &lt;/h3&gt;
&lt;h3 id=&quot;32-重量级锁&quot; data-anchor-id=&quot;goek&quot;&gt;3.2. 重量级锁&lt;/h3&gt;
&lt;p data-anchor-id=&quot;9q8h&quot;&gt;monitor 监视器锁本质上是依赖操作系统的 Mutex Lock 互斥量 来实现的，我们一般称之为&lt;code&gt;重量级锁&lt;/code&gt;。因为 OS 实现线程间的切换需要从用户态转换到核心态，这个转换过程成本较高，耗时相对较长，因此 synchronized 效率会比较低。&lt;/p&gt;
&lt;p data-anchor-id=&quot;nea7&quot;&gt;重量级锁的锁标志位为'10'，指针指向的是 monitor 对象的起始地址，关于 monitor 的实现原理上文已经描述了。&lt;/p&gt;
&lt;h3 data-anchor-id=&quot;0w8g&quot;&gt; &lt;/h3&gt;
&lt;h3 id=&quot;33-轻量级锁&quot; data-anchor-id=&quot;0w8g&quot;&gt;3.3. 轻量级锁&lt;/h3&gt;
&lt;p data-anchor-id=&quot;10ne&quot;&gt;&lt;code&gt;轻量级锁&lt;/code&gt;是相对基于OS的互斥量实现的重量级锁而言的，它的本意是在没有多线程竞争的前提下，减少传统的重量级锁使用OS的互斥量而带来的性能消耗。&lt;/p&gt;
&lt;p data-anchor-id=&quot;mhjx&quot;&gt;轻量级锁提升性能的经验依据是：&lt;span&gt;&lt;code&gt;对于绝大部分锁，在整个同步周期内都是不存在竞争的&lt;/code&gt;&lt;/span&gt;。如果没有竞争，轻量级锁就可以使用 CAS 操作避免互斥量的开销，从而提升效率。&lt;/p&gt;
&lt;p data-anchor-id=&quot;mhjx&quot;&gt;&lt;strong&gt;轻量级锁的加锁过程：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;mhjx&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;1、线程在进入到同步代码块的时候，JVM 会先在当前线程的栈帧中建立一个名为锁记录（Lock Record）的空间，用于存储锁对象当前 Mark Word 的拷贝（官方称为 Displaced Mark Word），owner 指针指向对象的 Mark Word。此时堆栈与对象头的状态如图所示：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;mhjx&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1278254/201804/1278254-20180411012148294-467773713.png&quot; alt=&quot;&quot; width=&quot;400&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;1c2g&quot;&gt;2、JVM 使用 CAS 操作尝试将对象头中的 Mark Word 更新为指向 Lock Record 的指针。如果更新成功，则执行步骤3；更新失败，则执行步骤4&lt;/p&gt;
&lt;p data-anchor-id=&quot;xmvi&quot;&gt;3、如果更新成功，那么这个线程就拥有了该对象的锁，对象的 Mark Word 的锁状态为轻量级锁（标志位转变为'00'）。此时线程堆栈与对象头的状态如图所示：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;xmvi&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1278254/201804/1278254-20180411012256758-224864684.png&quot; alt=&quot;&quot; width=&quot;400&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;iplz&quot;&gt;4、如果更新失败，JVM 首先检查对象的 Mark Word 是否指向当前线程的栈帧&lt;/p&gt;
&lt;ul data-anchor-id=&quot;whq8&quot;&gt;&lt;li&gt;如果是，就说明当前线程已经拥有了该对象的锁，那就可以直接进入同步代码块继续执行&lt;/li&gt;
&lt;li&gt;如果不是，就说明这个锁对象已经被其他的线程抢占了，当前线程会尝试&lt;span&gt;自旋一定次数来获取锁&lt;/span&gt;。如果自旋一定次数 CAS 操作仍没有成功，那么&lt;span&gt;&lt;code&gt;轻量级锁&lt;/code&gt;就要升级为&lt;code&gt;重量级锁&lt;/code&gt;&lt;/span&gt;（锁的标志位转变为'10'），Mark Word 中存储的就是指向重量级锁的指针，后面等待锁的线程也就进入阻塞状态&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;轻量级锁的解锁过程：&lt;/strong&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;strong&gt; &lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;1、通过 CAS 操作用线程中复制的 Displaced Mark Word 中的数据替换对象当前的 Mark Word&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;2、如果替换成功，整个同步过程就完成了&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;3、如果替换失败，说明有其他线程尝试过获取该锁，那就在释放锁的同时，唤醒被挂起的线程&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3 data-anchor-id=&quot;vtgb&quot;&gt; &lt;/h3&gt;
&lt;h3 id=&quot;34-偏向锁&quot; data-anchor-id=&quot;vtgb&quot;&gt;3.4. 偏向锁&lt;/h3&gt;
&lt;p data-anchor-id=&quot;k2d7&quot;&gt;&lt;code&gt;轻量级锁&lt;/code&gt;是在无多线程竞争的情况下，使用 CAS 操作去消除互斥量；&lt;code&gt;偏向锁&lt;/code&gt;是在无多线程竞争的情况下，将这个同步都消除掉。&lt;/p&gt;
&lt;p data-anchor-id=&quot;skzd&quot;&gt;偏向锁提升性能的经验依据是：&lt;span&gt;&lt;code&gt;对于绝大部分锁，在整个同步周期内不仅不存在竞争，而且总由同一线程多次获得&lt;/code&gt;&lt;/span&gt;。偏向锁会偏向第一个获得它的线程，如果接下来的执行过程中，该锁没有被其他线程获取，则持有偏向锁的线程不需要再进行同步。这使得线程获取锁的代价更低。&lt;/p&gt;
&lt;p data-anchor-id=&quot;skzd&quot;&gt;&lt;strong&gt;偏向锁的获取过程：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;1、线程执行同步块，锁对象第一次被获取的时候，JVM 会将锁对象的 Mark Word 中的锁状态设置为偏向锁（锁标志位为'01'，是否偏向的标志位为'1'），同时通过 CAS 操作在 Mark Word 中记录获取到这个锁的线程的 ThreadID&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;2、如果 CAS 操作成功。持有偏向锁的线程每次进入和退出同步块时，只需测试一下 Mark Word 里是否存储着当前线程的 ThreadID。如果是，则表示线程已经获得了锁，而不需要额外花费 CAS 操作加锁和解锁&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;3、如果不是，则通过CAS操作竞争锁，竞争成功，则将 Mark Word 的 ThreadID 替换为当前线程的 ThreadID&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;&lt;strong&gt;偏向锁的释放过程：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;1、当一个线程已经持有偏向锁，而另外一个线程尝试竞争偏向锁时，CAS 替换 ThreadID 操作失败，则开始撤销偏向锁。偏向锁的撤销，需要等待原持有偏向锁的线程到达全局安全点（在这个时间点上没有字节码正在执行），暂停该线程，并检查其状态&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;2、如果原持有偏向锁的线程不处于活动状态或已退出同步代码块，则该线程释放锁。将对象头设置为无锁状态（锁标志位为'01'，是否偏向标志位为'0'）&lt;/p&gt;
&lt;p data-anchor-id=&quot;32ak&quot;&gt;3、如果原持有偏向锁的线程未退出同步代码块，则升级为轻量级锁（锁标志位为'00'）&lt;/p&gt;

&lt;h3 id=&quot;35-总结&quot; data-anchor-id=&quot;zhf5&quot;&gt;3.5. 总结&lt;/h3&gt;
&lt;p data-anchor-id=&quot;phsj&quot;&gt;偏向锁、轻量级锁、重量级锁之间的状态转换如图所示（概括上文描述的锁获取和释放的内容）：&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1278254/201804/1278254-20180411013000085-1325243793.png&quot; alt=&quot;&quot; width=&quot;1200&quot;/&gt;&lt;/p&gt;
&lt;p&gt;下面是这几种锁的比较：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1278254/201804/1278254-20180411013418476-1664257014.png&quot; alt=&quot;&quot; width=&quot;700&quot;/&gt;&lt;/p&gt;
&lt;h3 data-anchor-id=&quot;sq5h&quot;&gt; &lt;/h3&gt;
&lt;h3 id=&quot;36-其他优化&quot; data-anchor-id=&quot;sq5h&quot;&gt;3.6. 其他优化&lt;/h3&gt;
&lt;p data-anchor-id=&quot;sq5h&quot;&gt;&lt;strong&gt;1、适应性自旋&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;sq5h&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;code&gt;自旋锁&lt;/code&gt;&lt;/span&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;：互斥同步时，挂起和恢复线程都需要切换到内核态完成，这对性能并发带来了不少的压力。同时在许多应用上，共享数据的锁定状态只会持续很短的一段时间，为了这段较短的时间而去挂起和恢复线程并不值得。那么如果有多个线程同时并行执行，可以让后面请求锁的线程通过自旋（CPU忙循环执行空指令）的方式稍等一会儿，看看持有锁的线程是否会很快的释放锁，这样就不需要放弃&lt;/span&gt; &lt;span class=&quot;Apple-converted-space&quot;&gt;CPU 的执行时间了&lt;/span&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;fiic&quot;&gt;&lt;span&gt;&lt;code&gt;适应性自旋&lt;/code&gt;&lt;/span&gt;：在轻量级锁获取过程中，线程执行 CAS 操作失败时，需要通过自旋来获取重量级锁。如果锁被占用的时间比较短，那么自旋等待的效果就会比较好，而如果锁占用的时间很长，自旋的线程则会白白浪费 CPU 资源。解决这个问题的最简答的办法就是：指定自旋的次数，如果在限定次数内还没获取到锁（例如10次），就按传统的方式挂起线程进入阻塞状态。JDK1.6 之后引入了自适应性自旋的方式，如果在同一锁对象上，一线程自旋等待刚刚成功获得锁，并且持有锁的线程正在运行中，那么 JVM 会认为这次自旋也有可能再次成功获得锁，进而允许自旋等待相对更长的时间（例如100次）。另一方面，如果某个锁自旋很少成功获得，那么以后要获得这个锁时将省略自旋过程，以避免浪费 CPU。&lt;/p&gt;
&lt;p data-anchor-id=&quot;dmuk&quot;&gt;&lt;strong&gt;2、锁消除&lt;/strong&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&lt;strong&gt; &lt;/strong&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;dmuk&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;锁消除就是编译器运行时，对一些被检测到不可能存在共享数据竞争的锁进行消除。如果判断一段代码中，堆上的数据不会逃逸出去从而被其他线程访问到，则可以把他们当做栈上的数据对待，认为它们是线程私有的，不必要加锁。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt;&lt;span&gt; String concatString(String s1, String s2, String s3) {
    StringBuffer sb &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; StringBuffer();
    sb.append(&lt;/span&gt;&quot;a&quot;&lt;span&gt;);
    sb.append(&lt;/span&gt;&quot;b&quot;&lt;span&gt;);
    sb.append(&lt;/span&gt;&quot;c&quot;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; sb.toString();
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;在 StringBuffer.append() 方法中有一个同步代码块，锁就是sb对象，但 sb 的所有引用不会逃逸到 concatString() 方法外部，其他线程无法访问它。因此这里有锁，但是在即时编译之后，会被安全的消除掉，忽略掉同步而直接执行了。&lt;/p&gt;
&lt;p data-anchor-id=&quot;shmg&quot;&gt;&lt;strong&gt;3、锁粗化&lt;/strong&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p data-anchor-id=&quot;shmg&quot;&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;锁粗化就是&lt;/span&gt; &lt;span class=&quot;Apple-converted-space&quot;&gt;J&lt;/span&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;VM&lt;/span&gt; &lt;span class=&quot;Apple-converted-space&quot;&gt;检测到一串零碎的操作都对同一个对象加锁，则会把加锁同步的范围粗化到整个操作序列的外部。以上述 concatString() 方法为例，内部的 StringBuffer.append() 每次都会加锁，将会锁粗化，在第一次 append() 前至 最后一个 append() 后只需要加一次锁就可以了。&lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;4-参考&quot; data-anchor-id=&quot;pm0w&quot;&gt;4. 参考&lt;/h2&gt;
&lt;p data-anchor-id=&quot;ahxe&quot;&gt;&lt;a href=&quot;https://book.douban.com/subject/6522893/&quot; target=&quot;_blank&quot;&gt;《深入理解Java虚拟机》- 周志明&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;br/&gt;&lt;a href=&quot;https://blog.dreamtobe.cn/2015/11/13/java_synchronized/&quot; target=&quot;_blank&quot;&gt;Java Synchronised机制&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt; &lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/lykm02/p/4516777.html&quot; target=&quot;_blank&quot;&gt;Java synchronized 关键字的实现原理&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 10 Apr 2018 17:43:00 +0000</pubDate>
<dc:creator>butterfly100</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/butterfly100/p/8786856.html</dc:identifier>
</item>
<item>
<title>判断ssh远程命令是否执行结束 - 骏马金龙</title>
<link>http://www.cnblogs.com/f-ck-need-u/p/8785561.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/f-ck-need-u/p/8785561.html</guid>
<description>&lt;p&gt;注：这是一个没什么鸟用的功能。不过也算是一种拓展。&lt;/p&gt;
&lt;p&gt;通常在那些&quot;&lt;span&gt;&lt;strong&gt;一键化部署&lt;/strong&gt;&lt;/span&gt;&quot;的shell脚本中，可能需要使用ssh执行远程命令来实现一些简单的自动化，这些远程命令可能需要执行一段时间才能结束(如yum命令)。例如，远程ssh配置yum源，远程ssh安装软件包。&lt;/p&gt;
&lt;p&gt;为了让脚本实现&quot;并行&quot;执行，这个远程ssh命令往往还会加上&quot;-f&quot;选项使其进入后台执行。此时，如果后续的远程任务正好要依赖于这个命令已经执行完成，那么我们要判断前面的任务是否执行完成。例如，在配置软件的时候，必须先判断软件是否安装结束。&lt;/p&gt;
&lt;p&gt;判断的方式挺简单，只需判断这个ssh进程是否存在就可以了。例如：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[root&lt;span class=&quot;hljs-variable&quot;&gt;@node1&lt;/span&gt; ~]
[root&lt;span class=&quot;hljs-variable&quot;&gt;@node1&lt;/span&gt; ~]
[root&lt;span class=&quot;hljs-variable&quot;&gt;@node1&lt;/span&gt; ~]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;这样的方法没错，也能应付绝大多数情况，但如果有多个远程后台命令的ssh进程，就无法知道具体是哪个ssh进程。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;于是，可以采用另一种方法，将执行远程命令的ssh进程放进后台，再用&lt;code&gt;$!&lt;/code&gt;来获取最近的后台ssh进程。例如：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[root&lt;span class=&quot;hljs-variable&quot;&gt;@node1&lt;/span&gt; ~]
[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;hljs-number&quot;&gt;76115&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;76115&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;但这是错误的方法，如果你现在去查看ssh进程，你会发现进程号不是76115。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[root&lt;span class=&quot;hljs-variable&quot;&gt;@node1&lt;/span&gt; ~]
           |-ssh(&lt;span class=&quot;hljs-number&quot;&gt;76116&lt;/span&gt;)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;因为ssh在执行远程后台命令(加上&quot;-f&quot;选项)的时候，它自身会在建立ssh连接后再fork一个后台ssh进程用来执行远程命令。&lt;/p&gt;
&lt;p&gt;也就是说，&lt;span&gt;&lt;strong&gt;当ssh执行远程后台命令的时候，会有两个ssh进程&lt;/strong&gt;&lt;/span&gt;：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;第一个ssh进程是初始ssh进程，用于建立连接、发送要执行的命令、fork新的ssh进程等，当这些任务结束后，这个ssh进程会消逝；&lt;/li&gt;
&lt;li&gt;第二个ssh进程是第一个ssh进程fork出来的新进程(调试的结果将显示&quot;debug1: forking to background&quot;)，用来执行远程命令。它是后台进程，挂靠在init/systemd进程下。当远程命令执行结束时，这个后台ssh进程会消逝。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;注意，&lt;span&gt;&lt;strong&gt;只有使用了&quot;-f&quot;选项，第一个ssh进程才会fork新的后台ssh进程，因为前台的任务(没有使用&quot;-f&quot;)可以直接在第一个ssh进程上执行。&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;第二个后台ssh进程无法用&lt;code&gt;$!&lt;/code&gt;捕捉，&lt;code&gt;$!&lt;/code&gt;捕捉到的只是&lt;code&gt;&amp;amp;&lt;/code&gt;的后台，而对于&lt;code&gt;ssh ... &amp;amp;&lt;/code&gt;中的&quot;&amp;amp;&quot;来说，它是将ssh连接进程(即第一个ssh进程)置于后台，而不是将fork出来的ssh后台进程再放入后台。所以上面的&quot;echo $!&quot;的结果76115比后台ssh进程号76116要小。&lt;/p&gt;
&lt;p&gt;那么有什么好方法可以判断多个远程ssh进程中的每一个？没有好方法(我个人还没有想到)，只能通过比较愚笨的方式来实现判断：将每个后台ssh进程的pid号保存起来(存放到每个变量中，或数组中)。&lt;/p&gt;
&lt;p&gt;例如，有两个执行远程命令的ssh进程：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ssh &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.&lt;span class=&quot;hljs-number&quot;&gt;100.101&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;'sleep 50'&lt;/span&gt;
ssh_pid1=`ps x | awk &lt;span class=&quot;hljs-string&quot;&gt;'/ssh.*slee[p]/{print $1}'&lt;/span&gt; | tail -&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;`
ssh &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.&lt;span class=&quot;hljs-number&quot;&gt;100.101&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;'sleep 60'&lt;/span&gt;
ssh_pid2=`ps x | awk &lt;span class=&quot;hljs-string&quot;&gt;'/ssh.*slee[p]/{print $1}'&lt;/span&gt; | tail -&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;`


&lt;span class=&quot;hljs-built_in&quot;&gt;kill&lt;/span&gt; -&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$ssh_pid1&lt;/span&gt;
&lt;span class=&quot;hljs-built_in&quot;&gt;echo&lt;/span&gt; $?


&lt;span class=&quot;hljs-built_in&quot;&gt;kill&lt;/span&gt; -&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$ssh_pid2&lt;/span&gt;
&lt;span class=&quot;hljs-built_in&quot;&gt;echo&lt;/span&gt; $?
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;最后补上ssh连接或执行远程命令时，内部过程的详细信息。这些信息使用&lt;code&gt;ssh -vvv&lt;/code&gt;即可获取，此处给出的是筛选后的一小部分。&lt;/p&gt;
&lt;p&gt;当ssh建立连接或执行前台远程命令(没有使用&quot;-f&quot;选项)时:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;OpenSSH_6.6.1, OpenSSL &lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;.1e-fips &lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt; Feb &lt;span class=&quot;hljs-number&quot;&gt;2013&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Reading configuration data /etc/ssh/ssh_config
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: /etc/ssh/ssh_config line &lt;span class=&quot;hljs-number&quot;&gt;56&lt;/span&gt;: Applying options &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; *
&lt;span class=&quot;hljs-attribute&quot;&gt;debug2&lt;/span&gt;: &lt;span class=&quot;hljs-attribute&quot;&gt;ssh_connect&lt;/span&gt;: needpriv &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Connecting to &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101 [&lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101] port &lt;span class=&quot;hljs-number&quot;&gt;22.&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Connection established                          
.....................
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Authentication succeeded (publickey).
Authenticated to &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101 ([&lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101]:&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;).  
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: channel &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; [client-session]
&lt;span class=&quot;hljs-attribute&quot;&gt;debug3&lt;/span&gt;: &lt;span class=&quot;hljs-attribute&quot;&gt;ssh_session2_open&lt;/span&gt;: &lt;span class=&quot;hljs-attribute&quot;&gt;channel_new&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug2&lt;/span&gt;: channel &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;: send open                  
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Requesting &lt;span class=&quot;hljs-literal&quot;&gt;no&lt;/span&gt;-more-sessions&lt;span class=&quot;hljs-property&quot;&gt;@openssh&lt;/span&gt;.com
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Entering interactive session.         


[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]+  Stopped                 ssh -vvvv &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;当执行远程后台任务时(加上&quot;-f&quot;选项)：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[root&lt;span class=&quot;hljs-property&quot;&gt;@node1&lt;/span&gt; ~]
[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;hljs-number&quot;&gt;65570&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;65570&lt;/span&gt;                 
[root&lt;span class=&quot;hljs-property&quot;&gt;@node1&lt;/span&gt; ~]
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Reading configuration data /etc/ssh/ssh_config
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: /etc/ssh/ssh_config line &lt;span class=&quot;hljs-number&quot;&gt;56&lt;/span&gt;: Applying options &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; *
&lt;span class=&quot;hljs-attribute&quot;&gt;debug2&lt;/span&gt;: &lt;span class=&quot;hljs-attribute&quot;&gt;ssh_connect&lt;/span&gt;: needpriv &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Connecting to &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101 [&lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101] port &lt;span class=&quot;hljs-number&quot;&gt;22.&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Connection established.        
....................................
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Authentication succeeded (publickey).     
Authenticated to &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101 ([&lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.100.101]:&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;).
&lt;span class=&quot;hljs-attribute&quot;&gt;debug2&lt;/span&gt;: fd &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; setting O_NONBLOCK
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: channel &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; [client-session]
&lt;span class=&quot;hljs-attribute&quot;&gt;debug3&lt;/span&gt;: &lt;span class=&quot;hljs-attribute&quot;&gt;ssh_session2_open&lt;/span&gt;: &lt;span class=&quot;hljs-attribute&quot;&gt;channel_new&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug2&lt;/span&gt;: channel &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;: send open                 
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Requesting &lt;span class=&quot;hljs-literal&quot;&gt;no&lt;/span&gt;-more-sessions&lt;span class=&quot;hljs-property&quot;&gt;@openssh&lt;/span&gt;.com
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: forking to background             &lt;span&gt;&lt;strong/&gt;&lt;/span&gt;
&lt;span class=&quot;hljs-attribute&quot;&gt;debug1&lt;/span&gt;: Entering interactive session.     
&lt;span class=&quot;hljs-attribute&quot;&gt;debug2&lt;/span&gt;: callback start
......................................
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;a href=&quot;http://www.cnblogs.com/f-ck-need-u/p/7048359.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;回到Linux系列文章大纲：http://www.cnblogs.com/f-ck-need-u/p/7048359.html&lt;/span&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;strong&gt;&lt;a href=&quot;http://www.cnblogs.com/f-ck-need-u/p/7576137.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;回到网站架构系列文章大纲：http://www.cnblogs.com/f-ck-need-u/p/7576137.html&lt;/span&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;strong&gt;&lt;a href=&quot;http://www.cnblogs.com/f-ck-need-u/p/7586194.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;回到数据库系列文章大纲：http://www.cnblogs.com/f-ck-need-u/p/7586194.html&lt;/span&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;strong&gt;&lt;a href=&quot;http://www.cnblogs.com/f-ck-need-u/p/8785561.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;转载请注明出处：http://www.cnblogs.com/f-ck-need-u/p/8785561.html&lt;/span&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;注：若您觉得这篇文章还不错请点击右下角推荐，您的支持能激发作者更大的写作热情，非常感谢！&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 10 Apr 2018 16:29:00 +0000</pubDate>
<dc:creator>骏马金龙</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/f-ck-need-u/p/8785561.html</dc:identifier>
</item>
<item>
<title>nginx配置反向代理详细教程（windows版） - 千度&amp;</title>
<link>http://www.cnblogs.com/j-star/p/8785334.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/j-star/p/8785334.html</guid>
<description>&lt;p&gt;内容原创，如需转载，请注明地址：&lt;a href=&quot;http://www.cnblogs.com/j-star/p/8785334.html&quot; target=&quot;_blank&quot;&gt;http://www.cnblogs.com/j-star/p/8785334.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;　　Nginx是一款&lt;a href=&quot;https://baike.baidu.com/item/%E8%BD%BB%E9%87%8F%E7%BA%A7/10002835&quot; target=&quot;_blank&quot; data-lemmaid=&quot;10002835&quot;&gt;轻量级&lt;/a&gt;的&lt;a href=&quot;https://baike.baidu.com/item/Web/150564&quot; target=&quot;_blank&quot; data-lemmaid=&quot;150564&quot;&gt;Web&lt;/a&gt; 服务器/&lt;a href=&quot;https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86&quot; target=&quot;_blank&quot;&gt;反向代理&lt;/a&gt;服务器及&lt;a href=&quot;https://baike.baidu.com/item/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6&quot; target=&quot;_blank&quot;&gt;电子邮件&lt;/a&gt;（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少，&lt;a href=&quot;https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91&quot; target=&quot;_blank&quot;&gt;并发&lt;/a&gt;能力强。&lt;/p&gt;
&lt;p&gt;下面就详细的说一说如何用Nginx实现反向代理。&lt;/p&gt;
&lt;p&gt;首先：来做点准备工作，最少两个tomcat，另外设置两个域名并解析到本地ip（因为nginx是直接配置域名）&lt;/p&gt;
&lt;h3&gt;&lt;span&gt;（1）准备两个tomcat&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;分别设置两个tomcat的/conf/server.xml中的端口号，如下&lt;/p&gt;
&lt;p&gt;tomcat1端口号分别设置为：8205    8280   8209&lt;/p&gt;
&lt;p&gt;tomcat2端口号分别设置为：8215    8281   8219&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410231059247-1430769905.png&quot; alt=&quot;&quot; width=&quot;593&quot; height=&quot;61&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410231144342-381213453.png&quot; alt=&quot;&quot; width=&quot;592&quot; height=&quot;56&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;（2）添加测试内容&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;分别删除目录webapps下所有文件，新建一个文件夹ROOT，并在该目录下新建index.html&lt;/p&gt;
&lt;p&gt;内容可以设置为：这里是8280端口。（另一个：这里是8281端口。）&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;（3）启动两个tomcat&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410231843814-868184041.png&quot; alt=&quot;&quot; width=&quot;643&quot; height=&quot;123&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410231902086-260220155.png&quot; alt=&quot;&quot; width=&quot;645&quot; height=&quot;109&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;（4）分别访问两个tomcat下的项目&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;访问下面两个网址：&lt;/p&gt;
&lt;p&gt;127.0.0.1/8280&lt;/p&gt;
&lt;p&gt;127.0.0.1/8281&lt;/p&gt;
&lt;p&gt;如果能够访问到对应的index.html文件就说明tomcat配置且启动成功。&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;（5）设置两个域名并做解析&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;修改hosts文件，目的是为了设置2个域名， tomcat1.com和 tomcat2.com并且解析到本地ip：127.0.0.1&lt;/p&gt;
&lt;p&gt;路径：C:\Windows\System32\drivers\etc&lt;/p&gt;
&lt;p&gt;打开hosts文件，加上（如果修改后无法保存，可以把hosts文件复制到桌面，修改完成后再替换原有hosts文件）&lt;/p&gt;
&lt;p&gt;添加内容如下：&lt;/p&gt;
&lt;p&gt;127.0.0.1 tomcat1.com&lt;br/&gt;127.0.0.1 tomcat2.com&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410230452576-1860673179.png&quot; alt=&quot;&quot; width=&quot;721&quot; height=&quot;354&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;（6）测试域名是否解析成功&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;127.0.0.1/8280；127.0.0.1/8281分别修改为&lt;/p&gt;
&lt;p&gt;tomcat1.com:8280；tomcat2.com:8281&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410232836398-1884884751.png&quot; alt=&quot;&quot; width=&quot;442&quot; height=&quot;111&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180411005557862-1815085898.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;如果显示结果如上图所示，说明域名设置并解析成功。&lt;/p&gt;

&lt;p&gt;&lt;span&gt;下面开始正式配置Nginx服务器的方向代理。&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;span&gt;1. 下载、安装Nginx服务器&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;输入网址：&lt;a title=&quot;nginx下载地址&quot; href=&quot;http://nginx.org/en/download.html&quot; target=&quot;_blank&quot;&gt;http://nginx.org/en/download.html&lt;/a&gt; ，选个合适的版本，下载后解压到合适的路径。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410225042800-1789039503.png&quot; alt=&quot;&quot; width=&quot;725&quot; height=&quot;429&quot;/&gt;&lt;/p&gt;
&lt;p&gt;解压后，如图所示：nginx.exe可以直接运行，但是不建议。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180410225414269-938665370.png&quot; alt=&quot;&quot; width=&quot;727&quot; height=&quot;324&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;&lt;span&gt;2. 配置反向代理&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;打开/conf/nainx.conf文件，删除server{ …… }，或者注销掉&lt;/p&gt;
&lt;p&gt;重新添加server{  }&lt;/p&gt;
&lt;p&gt;listen:监听的端口号&lt;/p&gt;
&lt;p&gt;server_name: 访问域名&lt;/p&gt;
&lt;p&gt;location ：这里配置为/   直接匹配端口下的默认ROOT下的项目，location内容很广泛，&lt;/p&gt;
&lt;p&gt;参见：&lt;a title=&quot;location详细配置内容&quot; href=&quot;https://segmentfault.com/a/1190000009651161&quot; target=&quot;_blank&quot;&gt;https://segmentfault.com/a/1190000009651161&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;proxy_pass  ：为项目的实际访问地址&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;server {
        listen       &lt;/span&gt;80&lt;span&gt;; 
        server_name  tomcat1.com;
        #charset koi8&lt;/span&gt;-&lt;span&gt;r;
        #access_log  logs&lt;/span&gt;/&lt;span&gt;host.access.log  main;
        location  &lt;/span&gt;/&lt;span&gt; {
        proxy_pass   http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;127.0.0.1:8280;&lt;/span&gt;
&lt;span&gt;        index  index.html index.htm;
        }
    }
server {
        listen       &lt;/span&gt;80&lt;span&gt;;
        server_name  tomcat2.com;
        #charset koi8&lt;/span&gt;-&lt;span&gt;r;
        #access_log  logs&lt;/span&gt;/&lt;span&gt;host.access.log  main;
        location &lt;/span&gt;/&lt;span&gt; {
        proxy_pass   http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;127.0.0.1:8281;&lt;/span&gt;
&lt;span&gt;        index  index.html index.htm;
        }
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;&lt;span&gt;3.启动、关闭、重启Nginx服务器&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;打开cmd.exe运行命令。&lt;/p&gt;
&lt;p&gt;注意：一定要在nginx.exe文件所在的文件夹下操作。&lt;/p&gt;
&lt;h4&gt;（1）启动：&lt;/h4&gt;
&lt;p&gt;H:\nginx-1.12.2&amp;gt;start nginx&lt;/p&gt;
&lt;p&gt;或H:\nginx-1.12.2&amp;gt;nginx.exe&lt;/p&gt;
&lt;p&gt;注：建议使用第一种，第二种会使你的cmd窗口一直处于执行中，不能进行其他命令操作。&lt;/p&gt;

&lt;h4&gt;（2）停止：&lt;/h4&gt;
&lt;p&gt;H:\nginx-1.12.2&amp;gt;nginx.exe -s stop&lt;/p&gt;
&lt;p&gt;或H:\nginx-1.12.2&amp;gt;nginx.exe -s quit&lt;/p&gt;
&lt;p&gt;注：stop是快速停止nginx，可能并不保存相关信息；quit是完整有序的停止nginx，并保存相关信息。&lt;/p&gt;

&lt;h4&gt;（3）重新载入Nginx：&lt;/h4&gt;
&lt;p&gt;H:\nginx-1.12.2&amp;gt;nginx.exe -s reload&lt;/p&gt;
&lt;p&gt;当配置信息修改，需要重新载入这些配置时使用此命令。&lt;/p&gt;

&lt;h4&gt;（4）重新打开日志文件：&lt;/h4&gt;
&lt;p&gt;H:\nginx-1.12.2&amp;gt;nginx.exe -s reopen&lt;/p&gt;

&lt;h2&gt;&lt;span&gt;4. 测试是否配置成功&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;输入域名：tomcat1.com和tomcat2.com&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180411000107617-1261988564.png&quot; alt=&quot;&quot; width=&quot;479&quot; height=&quot;146&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1041657/201804/1041657-20180411001236742-638295818.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;如果输入域名后显示如上图，即为成功配置。&lt;/p&gt;

&lt;h2&gt;&lt;span&gt;5.可能会遇到的问题（进程关闭失败）&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;在使用的过程中，你可能会遇到一个很奇葩的问题，就是当关闭命令执行了无数遍，页面却还是可以直接用域名访问。&lt;/p&gt;
&lt;p&gt;这个时候就说明你的进程并没有真正关闭，我们可以用命令来查询一下：&lt;/p&gt;
&lt;p&gt;cmd中输入：netstat -an|find &quot;0:80&quot;&lt;/p&gt;
&lt;p&gt;如果有，说明真的没有关闭这个进程。没有，那就看看是不是浏览器缓存的问题。&lt;/p&gt;
&lt;p&gt;针对进程不能正常关闭，可以用如下命令来关闭：taskkill /F /IM nginx.exe &amp;gt; nul&lt;/p&gt;

&lt;p&gt;以上就是用nginx服务器做反向代理服务器的全部内容，如果对你有帮助，还请动动小手推荐一下。&lt;/p&gt;
&lt;p&gt;内容原创，如需转载，请注明地址：&lt;a href=&quot;http://www.cnblogs.com/j-star/p/8785334.html&quot; target=&quot;_blank&quot;&gt;http://www.cnblogs.com/j-star/p/8785334.html&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 10 Apr 2018 16:24:00 +0000</pubDate>
<dc:creator>千度&amp;</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/j-star/p/8785334.html</dc:identifier>
</item>
<item>
<title>[机器学习实战]K-近邻算法 - mantou叔叔</title>
<link>http://www.cnblogs.com/mantoudev/p/8785120.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/mantoudev/p/8785120.html</guid>
<description>&lt;h2 id=&quot;k-近邻算法概述k-nearest-neighborknn&quot;&gt;1. K-近邻算法概述(k-Nearest Neighbor，KNN)&lt;/h2&gt;
&lt;p&gt;K-近邻算法采用测量不同的特征值之间的距离方法进行分类。该方法的思路是：如果一个样本在特征空间中的k个最相似(即特征空间中最邻近)的样本中的大多数属于某一个类别，则该样本也属于这个类别。&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;优点&lt;/strong&gt;：精度高、对异常数据不敏感、无数据输入假定。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;缺点&lt;/strong&gt;：计算复杂度高、空间复杂度高。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;适用数据范围&lt;/strong&gt;：数值型和标称型。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;KNN工作原理&lt;/strong&gt;是：存在一个样本数据集合（训练样本集），并且样本集中每个数据都存在标签，即我们知道样本集中每一数据与所属分类的对应关系。输入没有标签的新数据后，将新数据每个特征与样本集中数据对应的特征进行比较，然后算法提取样本集中特征最相似的数据（最近邻）的分类标签。&lt;/p&gt;
&lt;p&gt;一般来说我们只选择样本数据集中前k个最相似的数据。通常k是不大于20的整数。最后选择k个最相似数据中出现次数最多的分类，作为新数据的分类。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;KNN的一般流程：

1.收集数据：可使用任何方法。
2.准备数据：距离计算所需要的数值，最好是结构化的数据格式。
3.分析数据：可使用任何方法。
4.训练算法：此步骤不适用与K-近邻算法
5.测试算法：计算错误率。
6.使用算法：首先需要输入样本数据和结构化的输出结果，然后运行k-近邻算法判定输入数据分别属于哪个分类，最后应用对计算出的分类执行后续的处理。&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;准备数据集&quot;&gt;2. 准备数据集&lt;/h2&gt;
&lt;p&gt;在构造完整的k-近邻算法之前，我们还需要编写一些基本的通用函数，新建KNN.py文件，新增以下代码：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#!/usr/bin/python
# -*- coding: UTF-8 -*-
from numpy import *

&quot;&quot;&quot;
函数说明:创建数据集

Parameters:
    无
Returns:
    group - 数据集
    labels - 分类标签
&quot;&quot;&quot;
def createDataSet():
    #四组二维特征
    group = array([[1.0, 1.1], [1.0, 1.0], [0, 0], [0, 0.1]])
    #四组特征的标签
    labels = ['A','B','C','D']
    return group, labels

if __name__ == '__main__':
    #创建数据集
    group, labels = createDataSet()
    #打印数据集
    print(group)
    print(labels)
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;k-近邻算法实现&quot;&gt;3. k-近邻算法实现&lt;/h2&gt;
&lt;p&gt;对未知类别属性的数据集中的每个点一次执行以下操作：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;计算已知类别数据集中的点与当前点之间的距离；&lt;/li&gt;
&lt;li&gt;按照距离增序排序；&lt;/li&gt;
&lt;li&gt;选取与当前点距离最近的k个点；&lt;/li&gt;
&lt;li&gt;决定这k个点所属类别的出现频率；&lt;/li&gt;
&lt;li&gt;返回前k个点出现频率最高的类别作为当前点的预测分类。&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code&gt;
# -*- coding: UTF-8 -*-
from numpy import *
import operator

&quot;&quot;&quot;
函数说明:kNN算法,分类器

Parameters:
    inX - 用于分类的数据(测试集)
    dataSet - 用于训练的数据(训练集)
    labes - 分类标签
    k - kNN算法参数,选择距离最小的k个点
Returns:
    sortedClassCount[0][0] - 分类结果
&quot;&quot;&quot;
def classify0(inX, dataSet, labels, k):
    #numpy函数shape[0]返回dataSet的行数
    dataSetSize = dataSet.shape[0]
    #在列向量方向上重复inX共1次(横向)，行向量方向上重复inX共dataSetSize次(纵向)
    diffMat = np.tile(inX, (dataSetSize, 1)) - dataSet
    #二维特征相减后平方
    sqDiffMat = diffMat**2
    #sum()所有元素相加，sum(0)列相加，sum(1)行相加
    sqDistances = sqDiffMat.sum(axis=1)
    #开方，计算出距离
    distances = sqDistances**0.5
    #返回distances中元素从小到大排序后的索引值
    sortedDistIndices = distances.argsort()
    #定一个记录类别次数的字典
    classCount = {}
    for i in range(k):
        #取出前k个元素的类别
        voteIlabel = labels[sortedDistIndices[i]]
        #dict.get(key,default=None),字典的get()方法,返回指定键的值,如果值不在字典中返回默认值。
        #计算类别次数
        classCount[voteIlabel] = classCount.get(voteIlabel,0) + 1
    #python3中用items()替换python2中的iteritems()
    #key=operator.itemgetter(1)根据字典的值进行排序
    #key=operator.itemgetter(0)根据字典的键进行排序
    #reverse降序排序字典
    sortedClassCount = sorted(classCount.iteritems(),key=operator.itemgetter(1),reverse=True)
    #返回次数最多的类别,即所要分类的类别
    return sortedClassCount[0][0]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;计算距离时直接使用了欧式距离公式，计算两个向量点之间的距离：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D191/sign=7bb3375e3c4e251fe6f7e0f19687c9c2/e7cd7b899e510fb335a3e2f3d533c895d1430c1f.jpg&quot; alt=&quot;image&quot;/&gt;&lt;/p&gt;
&lt;p&gt;计算完所有点之间的距离后，可以对数据按照从小到大的次序排序。然后，确定前k个距离最小元素所在的主要分类，输入k总是正整数；最后，将classCount字典分解为元组列表，然后按照第二个元素的次序对元组进行排序，最后返回发生频率最高的元素标签。&lt;/p&gt;
&lt;p&gt;预测数据所在分类：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; kNN.classify([0, 0], group, labels, 3)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;输出结果应该是B。&lt;/p&gt;
&lt;h2 id=&quot;测试分类器&quot;&gt;4. 测试分类器&lt;/h2&gt;
&lt;p&gt;为了测试分类器的效果，我们可以使用已知答案的数据，当然答案不能告诉分类器，检验分类器给出的结果是否符合预期结果。通过大量的测试数据，我们可以得到分类器的错误率——分类器给出错误结果的次数除以测试执行的总数。错误率是常用的评估方法，主要用于评估分类器在某个数据集上的执行效果。完美分类器的错误率为0，最差分类器的错误率是1.0，在这种情况下，分类器根本就无法找到一个正确答案。然而错误率几乎不会达到1.0，因为即使是随机猜测，也会有一定概率猜对的。因此，错误率一般存在一个上限，且具体的值会与各类型之间的比例关系直接相关。&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;[1]KNN维基百科：&lt;br/&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E6%9C%80%E8%BF%91%E9%84%B0%E5%B1%85%E6%B3%95&quot;&gt;https://zh.wikipedia.org/wiki/%E6%9C%80%E8%BF%91%E9%84%B0%E5%B1%85%E6%B3%95&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 10 Apr 2018 16:20:00 +0000</pubDate>
<dc:creator>mantou叔叔</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/mantoudev/p/8785120.html</dc:identifier>
</item>
<item>
<title>前端的事件流以及事件处理程序 - Hyacinth-zqz</title>
<link>http://www.cnblogs.com/Hyacinth-zqz/p/8761002.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Hyacinth-zqz/p/8761002.html</guid>
<description>&lt;p&gt;&lt;span&gt;&lt;strong&gt;一、事件流&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;　　1. 事件流：　　&lt;/p&gt;
&lt;p&gt;　　事件流描述的是从页面中接收事件的顺序。IE 的事件流是&lt;span&gt;事件冒泡流&lt;/span&gt;，Netscape 的事件流是&lt;span&gt;事件捕获流&lt;/span&gt;。&lt;/p&gt;

&lt;p&gt;　　2. 事件冒泡流：&lt;/p&gt;
&lt;p&gt;　　IE 的事件流叫事件冒泡，即事件开始时由最具体的元素（文档中嵌套层次最深的那个节点）接收，然后逐级向上传播到较为不具体的节点（文档）。&lt;/p&gt;
&lt;p&gt;　　若点击了页面中的某个div，则该click事件会按如图所示的顺序传播&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1330889/201804/1330889-20180409170519675-925379858.png&quot; alt=&quot;&quot; width=&quot;322&quot; height=&quot;246&quot;/&gt;&lt;/p&gt;
&lt;p&gt; 　　click首先在 div 元素上发生，而这个元素是我们点击的元素。之后，click事件沿DOM树向上传播，在每一级节点上都会发生，直至传播到document对象。&lt;/p&gt;

&lt;p&gt;　　3. 事件捕获流&lt;/p&gt;
&lt;p&gt;　　Netscape 的事件流叫事件捕获，事件捕获的思想是不太具体的节点应该更早接收到事件，而最具体的节点应该最后接收到事件。事件捕获的用意在于在事件到达预定目标之前捕获它。&lt;/p&gt;
&lt;p&gt;　　在事件捕获过程中，document对象首先接收到click事件，然后事件沿DOM树依次向下，一直传播到事件的具体目标，即 div 元素。捕获的顺序如图所示&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1330889/201804/1330889-20180409172702072-1794037761.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　4. DOM 事件流&lt;/p&gt;
&lt;p&gt;　　‘DOM2级事件’规定事件流包括三个阶段：&lt;span&gt;事件捕获阶段&lt;/span&gt;、&lt;span&gt;处于目标阶段&lt;/span&gt;和&lt;span&gt;事件冒泡阶段&lt;/span&gt;。首先发生的是事件捕获，为截获事件提供了机会。然后是实际的目标接收到事件。最后是冒泡阶段，在这个阶段对事件作出响应。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/1330889/201804/1330889-20180409173239971-1736163601.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;二、事件处理程序&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt; 　　响应某个事件的函数就叫事件处理程序（事件侦听器）。事件处理程序的名字以‘on’开头，所以click的事件处理程序是onclick，load的事件处理程序是onload。为事件制定处理程序有如下几种方式：&lt;/p&gt;
&lt;p&gt;　　（1）HTML 事件处理程序&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;=&quot;button&quot;&lt;/span&gt;&lt;span&gt; onclick&lt;/span&gt;&lt;span&gt;=&quot;alert('hello world')&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;2&lt;/span&gt; &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;=&quot;button&quot;&lt;/span&gt;&lt;span&gt; onclick&lt;/span&gt;&lt;span&gt;=&quot;handle()&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;3&lt;/span&gt; &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;script&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt;     &lt;span&gt;function&lt;/span&gt;&lt;span&gt; handle() {
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt; &lt;span&gt;        alert(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;hello world&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt; &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;script&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（2）DOM0级事件处理程序&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;var&lt;/span&gt; btn = document.getElementById('btn'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; btn.onclick = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　使用DOM0 级方法指定的事件处理程序被认为是元素的方法。因此，此时事件处理程序实在元素的作用域中运行，即程序中的this引用当前元素。例如：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;var&lt;/span&gt; btn = document.getElementById('btn'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; btn.onclick = &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     alert(&lt;span&gt;this&lt;/span&gt;.id);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;'btn'&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在事件处理程序中可以通过 this 访问元素的任何属性和方法，以这种方式添加的事件处理程序会在事件流的冒泡阶段被处理。&lt;/p&gt;
&lt;p&gt;　　删除通过 DOM0 级方法指定的事件处理程序，可将事件处理程序的属性值设为 null。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; btn.onclick = &lt;span&gt;null&lt;/span&gt;;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（3）DOM2 级事件处理程序&lt;/p&gt;
&lt;p&gt;　　DOM2 级事件有两个方法用于处理指定和删除事件处理程序的操作： &lt;span&gt;addEventListener()&lt;/span&gt; 和 &lt;span&gt;removeEventListener()&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;　　所有的 DOM 节点都包含这两个方法，并且都接收3个参数：要处理的事件名、作为事件处理程序的函数和一个布尔值。这个布尔值参数如果是 true，表示在捕获阶段调用事件处理程序；如果是 false，表示在冒泡阶段调用事件处理程序。&lt;/p&gt;
&lt;p&gt;　　&lt;span&gt;一般地，都是把事件处理程序添加都事件流的冒泡阶段，可以极大限度地兼容各种浏览器。最好只在需要在事件到达目标之前捕获它的时候将事件处理程序添加到捕获阶段。除非特殊需要，不建议在事件捕获阶段注册事件处理程序。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;var&lt;/span&gt; btn = document.getElementById('btn'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; btn.addEventListener('click', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; }, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 或者&lt;/span&gt;
&lt;span&gt;6&lt;/span&gt; &lt;span&gt;function&lt;/span&gt;&lt;span&gt; handle() {
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;8&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;9&lt;/span&gt; btn.addEventListener('click', handle, &lt;span&gt;false&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 　　使用 DOM2 级方法添加事件处理程序的好处在于可以添加多个事件处理程序，并且两个事件处理程序会按照添加他们的顺序依次出发。例如：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; btn.addEventListener('click', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; }, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; btn.addEventListener('click', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;     alert(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.id);
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; }, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;'hello world'&lt;/span&gt;
&lt;span&gt;8&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;'btn'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 　　通过 addEventListener() 添加的事件处理程序只能通过 removeEventListener() 移除，移除时传入的参数与添加处理程序使用的参数相同，这意味着通过addEventListener() 添加的匿名函数将无法移除。例如：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; btn.removeEventListener('click', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; }, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 无效&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　正确的用法是&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;function&lt;/span&gt;&lt;span&gt; handler() {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; btn.addEventListener('click', handler, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt; btn.removeEventListener('click', handler, &lt;span&gt;false&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 　　（4）IE事件处理程序&lt;/p&gt;
&lt;p&gt;　　在 IE 中提供了两个方法 attachEvent() 和 detachEvent()用于添加事件处理程序，都接受两个参数：事件处理程序名称和事件处理程序函数。由于 IE8 及更早版本只支持事件冒泡，因此addtachEvent 添加的事件处理程序都会被添加到冒泡阶段。用法如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;var&lt;/span&gt; btn = document.getElementById('btn'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; btn.attachEvent('onclick', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; })
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在使用 attachEvent() 的时候，事件处理程序是运行在全局作用域下，因此 this 指向的是 window 对象。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; btn.attachEvent('onclick', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;     alert(&lt;span&gt;this&lt;/span&gt; == window);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; true&lt;/span&gt;
&lt;span&gt;3&lt;/span&gt; })
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　attachEvent() 也可以为一个元素添加多个事件处理程序，只不过触发的顺序与添加的顺序相反。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; btn.attachEvent('onclick', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;     alert(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.id);
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; &lt;span&gt;})
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; btn.attachEvent('onclick', &lt;span&gt;function&lt;/span&gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; &lt;span&gt;})
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 'hello world'&lt;/span&gt;
&lt;span&gt;8&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 'btn'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　detachEvent 用于移除事件处理程序，需要的参数与 attachEvent() 添加时的一样，这也意味着添加的匿名函数不能被移除，正确用法如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;function&lt;/span&gt;&lt;span&gt; handler() {
&lt;/span&gt;2     alert('hello world'&lt;span&gt;);
&lt;/span&gt;3&lt;span&gt; }
&lt;/span&gt;4 btn.attachEvent('onclick'&lt;span&gt;, handler);
&lt;/span&gt;5 btn.detachEvent('onclick', handler);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;三、跨浏览器的事件处理程序&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;50&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;var&lt;/span&gt; EventUtil =&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     addHandler: &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(element, type, handler) {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt;(element.addEventListener) {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;             element.addEventListener(type, handler, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt;&lt;span&gt;(element.attachEvent) {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;             element.attachEvent('on' +&lt;span&gt; type, handler);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;             element['on' + type] =&lt;span&gt; handler;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;    },
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     removeHandler: &lt;span&gt;function&lt;/span&gt;&lt;span&gt;(element, type, handler) {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt;(element.removeEventListener) {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;             element.removeEventListener(type, handler, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt;&lt;span&gt;(element.detachEvent) {
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;             element.detachEvent('on' +&lt;span&gt; type, handler);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;             element['on' + type] = &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 使用方法&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt; &lt;span&gt;var&lt;/span&gt; btn = document.getElementById('btn'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt;function&lt;/span&gt;&lt;span&gt; handlerFn() {
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;     alert('hello world'&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;EventUtil.addHandler(btn, click, handlerFn);
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; EventUtil.removeHandler(btn, click, handlerFn);
&lt;/pre&gt;&lt;/div&gt;







</description>
<pubDate>Tue, 10 Apr 2018 16:14:00 +0000</pubDate>
<dc:creator>Hyacinth-zqz</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Hyacinth-zqz/p/8761002.html</dc:identifier>
</item>
<item>
<title>Lua编写wireshark插件初探——解析Websocket上的MQTT协议 - ASCII0x03</title>
<link>http://www.cnblogs.com/ascii0x03/p/8781643.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/ascii0x03/p/8781643.html</guid>
<description>&lt;p&gt;&lt;strong&gt;&lt;span&gt;一、背景&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;最近在做物联网流量分析时发现， App在使用MQTT协议时往往通过SSL+WebSocket+MQTT这种方式与服务器通信，在使用SSL中间人截获数据后，Wireshark不能自动解析出MQTT语义，只能解析到WebSocket层，如图所示。虽然在Data域中显示了去掉mask的WebSocket数据，但分析起来mqtt仍然很难受。所以打算写一个插件，利用wireshark自带的MQTT解析功能来分析Data部分的数据，而不是自己从头写一个完全新的解析器。注：很多教程是教如何添加一个新的协议，如设置协议的属性等，推荐参考【2】，本文主要梳理编写插件的条理。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/633834/201804/633834-20180410190233122-156102108.png&quot; alt=&quot;&quot; width=&quot;512&quot; height=&quot;322&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;二、Lua编写wireshark插件基础&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt; 有前辈介绍了用Lua写wireshark插件的基础教程，可以参考文末【1】【2】，这里再以自己的理解总结一下，因为实在没有一个文档让我有从入门到精通的感觉。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1. 首先需要知道解析器（Dissector）和post-dissectors的相关概念【3】&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;1）解析器（Dissector）是用来被wireshark调用解析数据包或部分数据包的，需要以Proto对象的形式注册后才能被wireshark调用。同时，我们还可以使用wireshark已经自带的解析器，注册一个解析器的例子代码如下所示。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;52&quot;&gt;
&lt;pre&gt;
&lt;span&gt;--&lt;/span&gt;&lt;span&gt; trivial protocol example&lt;/span&gt;&lt;span&gt;
--&lt;/span&gt;&lt;span&gt; declare our protocol&lt;br/&gt;--trival是协议名字，后面是说明，均需要在wireshark中唯一。&lt;br/&gt;&lt;/span&gt;
trivial_proto = Proto(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;trivial&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Trivial Protocol&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; create a function to dissect it&lt;/span&gt;
&lt;span&gt;function&lt;/span&gt;&lt;span&gt; trivial_proto.dissector(buffer,pinfo,tree)
    pinfo.cols.protocol &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;TRIVIAL&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
    &lt;span&gt;local&lt;/span&gt; subtree = tree:add(trivial_proto,buffer(),&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Trivial Protocol Data&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    subtree:add(buffer(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;2&lt;/span&gt;),&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The first two bytes: &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; .. buffer(&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;2&lt;/span&gt;&lt;span&gt;):uint())
    subtree &lt;/span&gt;= subtree:add(buffer(&lt;span&gt;2&lt;/span&gt;,&lt;span&gt;2&lt;/span&gt;),&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The next two bytes&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    subtree:add(buffer(&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;,&lt;span&gt;1&lt;/span&gt;),&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 3rd byte: &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; .. buffer(&lt;span&gt;2&lt;/span&gt;,&lt;span&gt;1&lt;/span&gt;&lt;span&gt;):uint())
    subtree:add(buffer(&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;,&lt;span&gt;1&lt;/span&gt;),&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 4th byte: &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; .. buffer(&lt;span&gt;3&lt;/span&gt;,&lt;span&gt;1&lt;/span&gt;&lt;span&gt;):uint())
&lt;/span&gt;&lt;span&gt;end&lt;/span&gt;
&lt;span&gt;--&lt;/span&gt;&lt;span&gt; load the udp.port table&lt;/span&gt;
udp_table = DissectorTable.get(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;udp.port&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; register our protocol to handle udp port 7777&lt;/span&gt;
udp_table:add(&lt;span&gt;7777&lt;/span&gt;,trivial_proto)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2）解析器注册分为很多种，可以使用函数&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;LineNumber&quot;&gt;&lt;span id=&quot;CA-a865416e4de75780a6429c9bd53c3e9cb63e6095_33&quot; class=&quot;LineAnchor&quot;&gt;&lt;span id=&quot;line-33-1&quot; class=&quot;anchor&quot;&gt;&lt;span class=&quot;ID&quot;&gt;register_postdissector(&lt;span class=&quot;ID&quot;&gt;trivial_proto)注册为postdissectors，即在所有解析器执行完后执行；也可以在&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;ID&quot;&gt;DissectorTable&lt;/span&gt;&lt;/span&gt;上注册，这样就可以使用wireshark自带的上一层协议解析后的结果。比如，协议TCP的解析表”tcp.port”包括http,smtp,ftp等。例如，你写的解析器想解析tcp端口7777上的某个协议，就使用下面的代码，而不必从tcp或者ip层开始解析。&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;--&lt;/span&gt;&lt;span&gt; load the udp.port table&lt;/span&gt;
udp_table = DissectorTable.get(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;udp.port&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; register our protocol to handle udp port 7777&lt;/span&gt;
udp_table:add(&lt;span&gt;7777&lt;/span&gt;,trivial_proto)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;LineNumber&quot;&gt;&lt;span id=&quot;CA-a865416e4de75780a6429c9bd53c3e9cb63e6095_33&quot; class=&quot;LineAnchor&quot;&gt;&lt;span id=&quot;line-33-1&quot; class=&quot;anchor&quot;&gt;&lt;span class=&quot;ID&quot;&gt;&lt;span class=&quot;ID&quot;&gt;这个功能非常强大。直观地，如果想解析WebSocket上的mqtt协议，可以这么写【6】（&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;LineNumber&quot;&gt;&lt;span id=&quot;CA-a865416e4de75780a6429c9bd53c3e9cb63e6095_33&quot; class=&quot;LineAnchor&quot;&gt;&lt;span id=&quot;line-33-1&quot; class=&quot;anchor&quot;&gt;&lt;span class=&quot;ID&quot;&gt;&lt;span class=&quot;ID&quot;&gt;但是不知什么原因我这么写一直无法成功解析。&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;）：&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;local&lt;/span&gt; mqtt_dissector = Dissector.get(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mqtt&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;local&lt;/span&gt; ws_dissector_table = DissectorTable.get(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ws.port&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
ws_dissector_table:add(&lt;/span&gt;&lt;span&gt;8083&lt;/span&gt;, mqtt_dissector)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过上面这段代码我们学习到，直接获得wireshark中解析器的方法Dissector.get，更多的方法可以参考官方文档11章【7】，比如我们如何获得已经支持的所有协议呢？mqtt协议的解析器关键字是大写还是小写？可以这么写【8】：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;local&lt;/span&gt; t =&lt;span&gt; Dissector.list()

&lt;/span&gt;&lt;span&gt;for&lt;/span&gt; _,name &lt;span&gt;in&lt;/span&gt; &lt;span&gt;ipairs&lt;/span&gt;(t) &lt;span&gt;do&lt;/span&gt;
    &lt;span&gt;print&lt;/span&gt;&lt;span&gt;(name)
&lt;/span&gt;&lt;span&gt;end&lt;/span&gt;

&lt;span&gt;--&lt;/span&gt;&lt;span&gt;查看所有支持的table&lt;/span&gt;
&lt;span&gt;local&lt;/span&gt; dt =&lt;span&gt; DissectorTable.list()

&lt;/span&gt;&lt;span&gt;for&lt;/span&gt; _,name &lt;span&gt;in&lt;/span&gt; &lt;span&gt;ipairs&lt;/span&gt;(dt) &lt;span&gt;do&lt;/span&gt;
    &lt;span&gt;print&lt;/span&gt;&lt;span&gt;(name)
&lt;/span&gt;&lt;span&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;3）被调用时，wireshark会传递给解析器三个参数：数据缓冲区(一个Tvb 对象【4】)、包的信息（&lt;a href=&quot;https://wiki.wireshark.org/LuaAPI/Pinfo#Pinfo&quot;&gt;Pinfo对象&lt;/a&gt;【5】）以及显示在图形化中的树形结构（&lt;a href=&quot;https://wiki.wireshark.org/LuaAPI/TreeItem&quot;&gt;TreeItem 对象&lt;/a&gt; ）。注意，理解这三个参数至关重要，同时注意它们不是Lua自身具有的数据类型，经常需要调用对象中的方法转换。通过这三个参数， 解析器就可以获得和修改包的相关信息。&lt;/p&gt;
&lt;p&gt;Tvb就是包的数据内容，可以像这样来提取内容。通常，我们需要提取出来包的内容当做字符串处理，或者提供字符串转换成Tvb来让解析器处理，这时候需要进行一些转换，如下代码所示【10】，详细可参考【9】。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;local&lt;/span&gt; b =&lt;span&gt; ByteArray.new(decipheredFrame)
&lt;/span&gt;&lt;span&gt;local&lt;/span&gt; bufFrame = ByteArray.tvb(b, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;My Tvb&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; Pinfo经常被解释为报文信息，个人理解简单的说就是给了按照图中这个条访问报文的接口，最常见的例子就是修改协议列名称或者info列显示的消息，如pinfo.cols.protocol = &quot;MQTT over Websocket&quot; ，更多的属性从参考文献【5】中可以获取。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://images2018.cnblogs.com/blog/633834/201804/633834-20180410214455711-1255350256.png&quot; alt=&quot;&quot; width=&quot;753&quot; height=&quot;57&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wiki.wireshark.org/LuaAPI/TreeItem&quot;&gt;TreeItem 对象&lt;/a&gt;表示报文解析树中的一个树节点，获得了这个就可以动态往图形化界面里添加节点。&lt;/p&gt;

&lt;p&gt;&lt;span&gt;2.调试与启用插件&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;启动&lt;/p&gt;
&lt;p&gt;wireshark在启动时会加载init.lua脚本， windows平台在wireshark安装目录下，linux在etc/wireshark下。想要执行我们写的插件，只需在该脚本最后加上dofile(&quot;.\\plugins\\mqttoverwebsocket.lua&quot;)来执行即可。重新加载Lua脚本的快捷键是&lt;strong&gt;Ctrl+Shift+L&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;调试&lt;/p&gt;
&lt;p&gt;若脚本有语法错误，wireshark图形界面在加载时会弹出提示；若有运行时错误，会在图形化的协议树中显示；wireshark还有一个Lua终端来执行编写的插件脚本、打印错误信息，通过“工具——Lua——console”打开，动态执行脚本通过“工具——Lua——evaluate”。注意看到输出需要使用wireshark提供的内置函数如debug(text)来输出【14】。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;三、实现解析Websocket上的MQTT协议&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 由于不明原因将mqtt协议解析器注册到ws.port或ws.protocol上仍然无法自动解析MQTT，所以我选择首先获得已经解析好去掉mask后的WebSocket的data字段，然后再将其转换成tvb到mqtt解析器中自动解析。获得包解析后内容的方法主要参考【11】和【12】中的解析树的例子，使用fieldinfo类与全局函数all_field_infos()来获得解析树的各个部分内容。&lt;/p&gt;
&lt;p&gt;由于传入mqtt解析器的tree就是这个包的树根，所以也会自动添加一个节点。最后取得了不错的效果。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/633834/201804/633834-20180410230707506-104314275.png&quot; alt=&quot;&quot; width=&quot;748&quot; height=&quot;397&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;53&quot;&gt;
&lt;pre&gt;
&lt;span&gt;do&lt;/span&gt;
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt; calling tostring() on random FieldInfo's can cause an error, so this func handles it&lt;/span&gt;
    &lt;span&gt;local&lt;/span&gt; &lt;span&gt;function&lt;/span&gt;&lt;span&gt; getstring(finfo)
        &lt;/span&gt;&lt;span&gt;local&lt;/span&gt; ok, val = &lt;span&gt;pcall&lt;/span&gt;(&lt;span&gt;tostring&lt;/span&gt;&lt;span&gt;, finfo)
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt; ok &lt;span&gt;then&lt;/span&gt; val = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;(unknown)&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &lt;span&gt;end&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; val
    &lt;/span&gt;&lt;span&gt;end&lt;/span&gt;
    
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt; Create a new dissector&lt;/span&gt;
    MQTToverWebsocket = Proto(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;MQTToverWebsocket&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;MQTT over Websocket&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    mqtt_dissector &lt;/span&gt;= Dissector.get(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mqtt&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; The dissector function&lt;/span&gt;
    &lt;span&gt;function&lt;/span&gt;&lt;span&gt; MQTToverWebsocket.dissector(buffer, pinfo, tree)
        &lt;/span&gt;&lt;span&gt;local&lt;/span&gt; fields =&lt;span&gt; { all_field_infos() }
        &lt;/span&gt;&lt;span&gt;local&lt;/span&gt; websocket_flag = &lt;span&gt;false&lt;/span&gt;
        &lt;span&gt;for&lt;/span&gt; i, finfo &lt;span&gt;in&lt;/span&gt; &lt;span&gt;ipairs&lt;/span&gt;(fields) &lt;span&gt;do&lt;/span&gt;
            &lt;span&gt;if&lt;/span&gt; (finfo.name == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;websocket&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;) &lt;span&gt;then&lt;/span&gt;&lt;span&gt;
                websocket_flag &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;
            &lt;span&gt;end&lt;/span&gt;
            &lt;span&gt;if&lt;/span&gt; (websocket_flag == &lt;span&gt;true&lt;/span&gt; &lt;span&gt;and&lt;/span&gt; finfo.name == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;) &lt;span&gt;then&lt;/span&gt;
                &lt;span&gt;local&lt;/span&gt; str1 =&lt;span&gt; getstring(finfo)
                &lt;/span&gt;&lt;span&gt;local&lt;/span&gt; str2 = &lt;span&gt;string.gsub&lt;/span&gt;(str1, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;)
                &lt;/span&gt;&lt;span&gt;local&lt;/span&gt; bufFrame =&lt;span&gt; ByteArray.tvb(ByteArray.new(str2))
                mqtt_dissector &lt;/span&gt;= Dissector.get(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mqtt&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
                &lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt;mqtt_dissector:call(finfo.source, pinfo, tree) #9 BUG&lt;/span&gt;
&lt;span&gt;                mqtt_dissector:call(bufFrame, pinfo, tree)
                &lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt;mqtt_dissector:call(finfo.value, pinfo, tree)&lt;/span&gt;
                websocket_flag = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;
                pinfo.cols.protocol &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;MQTT over Websocket&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
            &lt;span&gt;end&lt;/span&gt;
    &lt;span&gt;end&lt;/span&gt;
        
        &lt;span&gt;--&lt;/span&gt;&lt;span&gt;ws_dissector_table = DissectorTable.get(&quot;ws.port&quot;)&lt;/span&gt;
        &lt;span&gt;--&lt;/span&gt;&lt;span&gt;ws_dissector_table:add(&quot;443&quot;,mqtt_dissector)&lt;/span&gt;
    &lt;span&gt;end&lt;/span&gt;
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt; Register the dissector&lt;/span&gt;
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt;ws_dissector_table = DissectorTable.get(&quot;ws.port&quot;)&lt;/span&gt;
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt;ws_dissector_table:remove(443, mqtt_dissector)&lt;/span&gt;
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt;ws_dissector_table:add(443, MQTTPROTO)&lt;/span&gt;
    &lt;span&gt;--&lt;/span&gt;&lt;span&gt;ws_dissector_table:add_for_decode_as(mqtt_dissector)&lt;/span&gt;
&lt;span&gt;    register_postdissector(MQTToverWebsocket)
&lt;/span&gt;&lt;span&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;参考文献&lt;/p&gt;
&lt;p&gt;【1】http://www.cnblogs.com/zzqcn/p/4827251.html&lt;/p&gt;
&lt;p&gt;【2】https://mika-s.github.io/wireshark/lua/dissector/2017/11/04/creating-a-wireshark-dissector-in-lua-1.html&lt;/p&gt;
&lt;p&gt;【3】https://wiki.wireshark.org/Lua/Dissectors#Dissectors&lt;/p&gt;
&lt;p&gt;【4】https://wiki.wireshark.org/LuaAPI/Tvb#Tvb&lt;/p&gt;
&lt;p&gt;【5】https://wiki.wireshark.org/LuaAPI/Pinfo#Pinfo&lt;/p&gt;
&lt;p&gt;【6】https://ask.wireshark.org/question/1480/mqtt-over-websocket/&lt;/p&gt;
&lt;p&gt;【7】https://www.wireshark.org/docs/wsdg_html_chunked/lua_module_Proto.html#lua_class_Dissector&lt;/p&gt;
&lt;p&gt;【8】https://osqa-ask.wireshark.org/questions/32288/can-over-ethernet-lua-dissector&lt;/p&gt;
&lt;p&gt;【9】https://www.wireshark.org/docs/wsdg_html_chunked/lua_module_Tvb.html&lt;/p&gt;
&lt;p&gt;【10】https://osqa-ask.wireshark.org/questions/43013/conversion-of-string-into-userdata-type-like-wiresharks-buffer&lt;/p&gt;
&lt;p&gt;【11】https://www.wireshark.org/docs/wsdg_html_chunked/lua_module_Field.html#lua_class_Field&lt;/p&gt;
&lt;p&gt;【12】https://wiki.wireshark.org/Lua&lt;/p&gt;
&lt;p&gt;【13】https://wiki.wireshark.org/Lua/Examples#View_Packet_Tree_of_Fields.2FFieldInfo&lt;/p&gt;
&lt;p&gt;【14】https://wiki.wireshark.org/LuaAPI/Utils&lt;/p&gt;

&lt;p&gt;By ascii0x03， 2018/4/10，转载请注明出处&lt;/p&gt;
</description>
<pubDate>Tue, 10 Apr 2018 15:59:00 +0000</pubDate>
<dc:creator>ASCII0x03</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/ascii0x03/p/8781643.html</dc:identifier>
</item>
<item>
<title>数据结构：数组、链表、栈、队列的理解 - 纪莫</title>
<link>http://www.cnblogs.com/jimoer/p/8783604.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/jimoer/p/8783604.html</guid>
<description>&lt;h2&gt;解释定义&lt;/h2&gt;
&lt;h3&gt;数据结构：&lt;/h3&gt;
&lt;p&gt;数据结构是指相互之间存在一种或多种特定关系的&lt;a href=&quot;https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%85%83%E7%B4%A0&quot; target=&quot;_blank&quot;&gt;数据元素&lt;/a&gt;的集合。再简单描述一下：数据结构就是描述对象间逻辑关系的学科。&lt;/p&gt;
&lt;p&gt;如果还是不太清楚下面会举例说明的。&lt;/p&gt;
&lt;h3&gt;数据存储结构：&lt;/h3&gt;
&lt;p&gt;简单的讲就是数据在计算机中的存储方式。&lt;/p&gt;
&lt;p&gt;常用的数据存储方式有两种：顺序存储，非顺序存储。顺序存储就是把数据存储在一块联系的存储介质（硬盘或内存等）中。反之就是非顺序存储咯。Java中的数组就是典型的顺序存储，链表就是非顺序存储。数组存储数据时会开辟出一块联系内存，按顺序存储。链表先不会开辟出一块内存来，而是只需要知道下一个节点存储的位置，就能把所以的数据连起来了。所以单向链表的最后一个节点是指向Null的。&lt;/p&gt;
&lt;h4&gt;数组、链表、栈和队列是最基本的数据结构，任何程序语言都会涉及到其中的一种或多种。&lt;/h4&gt;

&lt;h2&gt;数组&lt;/h2&gt;
&lt;p&gt;数组是数据结构中很基本的结构，很多编程语言都内置数组。&lt;/p&gt;
&lt;p&gt;在java中当创建数组时会在内存中划分出一块连续的内存，然后当有数据进入的时候会将数据按顺序的存储在这块连续的内存中。当需要读取数组中的数据时，需要提供数组中的索引，然后数组根据索引将内存中的数据取出来，返回给读取程序。在Java中并不是所有的数据都能存储到数组中，只有相同类型的数据才可以一起存储到数组中。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180410233420469-136207805.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;所有的数据结构都支持几个基本操作：读取、插入、删除。&lt;/p&gt;
&lt;p&gt;因为数组在存储数据时是按顺序存储的，存储数据的内存也是连续的，所以他的特点就是&lt;strong&gt;寻址读取数据比较容易，插入和删除比较困难&lt;/strong&gt;。简单解释一下为什么，在读取数据时，只需要告诉数组要从哪个位置（索引）取数据就可以了，数组会直接把你想要的位置的数据取出来给你。插入和删除比较困难是因为这些存储数据的内存是连续的，要插入和删除就需要变更整个数组中的数据的位置。举个例子：一个数组中编号0-&amp;gt;1-&amp;gt;2-&amp;gt;3-&amp;gt;4这五个内存地址中都存了数组的数据，但现在你需要往4中插入一个数据，那就代表着从4开始，后面的所有内存中的数据都要往后移一个位置。这可是很耗时的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180410235302025-1349081730.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;链表&lt;/h2&gt;
&lt;p&gt;在java中创建链表的过程和创建数组的过程不同，不会先划出一块连续的内存。因为链表中的数据并不是连续的，链表在存储数据的内存中有两块区域，一块区域用来存储数据，一块区域用来记录下一个数据保存在哪里（指向下一个数据的指针）。当有数据进入链表时候，会根据指针找到下一个存储数据的位置，然后把数据保存起来，然后再指向下一个存储数据的位置。这样链表就把一些碎片空间利用起来了，虽然链表是线性表，但是并不会按线性的顺序存储数据。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180411000452953-1129652310.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;由于链表是以这种方式保存数据，所以链表在插入和删除时比较容易，插入数据时比较麻烦。举个例子：一个链表中0-&amp;gt;1-&amp;gt;2-&amp;gt;3-&amp;gt;4这五个内存地址中都存了数据，现在需要往2中插入一条数据，那么只需要更改1号和2号中记录下一个数据的位置就行了，对其他数据没有影响。删除一条数据与插入类似，很高效。但是如果是想要在链表其中取出一条数据，就需要从0号开始一个一个的找，直到找到想要的那条数据为止。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180411001615441-1434137071.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;链表中插入&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180411001629346-4744607.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;链表中删除&lt;/p&gt;
&lt;h2&gt;栈&lt;/h2&gt;
&lt;p&gt;栈是一种先进后出的数据结构，数组和链表都可以生成栈。当数据进入到栈时会按照规则压入到栈的底部，再次进入的数据会压在第一次的数据上面，以此类推。&lt;/p&gt;
&lt;p&gt;在取出栈中的数据的时候会先取出最上面的数据，所以是先进后出。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180411002303541-2091341224.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;由于数组和链表都可以组成栈，所以操作特点就需要看栈是由数组还是链表生成的了，然后就会继承相应的操作特点。&lt;/p&gt;
&lt;h2&gt;队列&lt;/h2&gt;
&lt;p&gt;队列是一种先进先出的数据结构，数组和链表也都可以生成队列。当数据进入到队列中时也是先进入的在下面后进入的再上面，但是出队列的时候是先从下面出，然后才是上面的数据出，最晚进入的队列的，最后出。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/772743/201804/772743-20180411002830886-860645714.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;举个简单的例子：可以把栈和队列看成是两根管子，这两根管子是用来存储数据的，有可能是数组生成的也有可能是链表生成的，栈的这根管子有一头是封死的，所以像这个管子放数据只能从一个口进，拿出数据的时候也只能从这一个口拿出来。而队列这根管子呢两个口都是敞开的，一个口负责进数据，另一个口负责出数据，所以从一进口先进去的数据，在出口处会先被拿出来。&lt;/p&gt;
&lt;p&gt;另外栈和队列其实是可以互相转换的。后续再把代码的例子补上，太晚了，先写到这吧。&lt;/p&gt;

</description>
<pubDate>Tue, 10 Apr 2018 15:55:00 +0000</pubDate>
<dc:creator>纪莫</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/jimoer/p/8783604.html</dc:identifier>
</item>
<item>
<title>2018年东北农业大学春季校赛 解题报告 - jlbcljb</title>
<link>http://www.cnblogs.com/jlbcljb/p/8784650.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/jlbcljb/p/8784650.html</guid>
<description>&lt;pre readability=&quot;7&quot;&gt;
对于4的情况，设4个点为A,B,C,D&lt;br/&gt;第一个集合元素为 A,B&lt;br/&gt;第二个集合元素为C,D&lt;br/&gt;连接的边为AC,AD,BC,BD&lt;br/&gt;此时为最大情况，所以答案为4&lt;p&gt;题面说的挺高大上的，其实就是求平均数相乘一下因为尽量保证两个集合边数尽可能接近，如果一个集合有&lt;span lang=&quot;EN-US&quot;&gt;n/2条边，另外一个集合就是&lt;span lang=&quot;EN-US&quot;&gt;n-n/2条边，相乘就是结果&lt;/span&gt;&lt;/span&gt;
&lt;/p&gt;&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; #include &amp;lt;bits/stdc++.h&amp;gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;using&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; std;
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; main(&lt;span&gt;void&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     ios::sync_with_stdio(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;    cin.tie(NULL);
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     unsigned &lt;span&gt;long&lt;/span&gt; &lt;span&gt;long&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; ans;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; t, n;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &amp;amp;&lt;span&gt;t);
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt; (t--&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &amp;amp;&lt;span&gt;n);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (n &amp;lt; &lt;span&gt;2&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;             cout &amp;lt;&amp;lt; &lt;span&gt;0&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;             &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (n % &lt;span&gt;2&lt;/span&gt; == &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;             ans = (n / &lt;span&gt;2&lt;/span&gt;) * (n / &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt;             ans = (n / &lt;span&gt;2&lt;/span&gt; + &lt;span&gt;1&lt;/span&gt;) * (n / &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;         cout &amp;lt;&amp;lt; ans &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;G wyh的考核&lt;/h2&gt;
&lt;p&gt;时间限制：C/C++ 1秒，其他语言2秒&lt;br/&gt;空间限制：C/C++ 262144K，其他语言524288K&lt;br/&gt;64bit IO Format: %lld&lt;/p&gt;
&lt;h2&gt;题目描述&lt;/h2&gt;
&lt;div class=&quot;subject-describe&quot; readability=&quot;21.5&quot;&gt;
&lt;div readability=&quot;22&quot;&gt;
&lt;p&gt;wyh非常喜欢lol游戏，一天，他听说学校要选拔lol队员，他非常高兴的就去了，选拔规则是，一共有N个评委，每个评委根据线上对线能力和打团能力给出一个[0,M]之间的一个整数作为分数，然后取平均值，wyh学长非常好奇，他想知道有多少种这样的情况： &lt;/p&gt;
&lt;p&gt;平均分等于其中某一位评委给的分数&lt;/p&gt;
&lt;p&gt;例如2个评委，给打的分数都是1分，那么此时平均分是1分，即等于第一个评委的分数，又等于第二个评委的分数，这样答案是2 &lt;/p&gt;
&lt;p&gt;但是由于每个评委打的分都是在[0,M]之间，所以会有很多种情况。 &lt;/p&gt;
&lt;p&gt;现在请你帮助你们wyh学长数一下有多少种这样的情况，由于结果会很大，请你对1000000007取余 &lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;输入描述:&lt;/h2&gt;
&lt;pre&gt;
输入第一行一个整数T（1&amp;lt;=T&amp;lt;=110）&lt;br/&gt;接下来有T组测试数据，对于每组测试数据输入2个数n和M(2&amp;lt;=n&amp;lt;=60,1&amp;lt;=M&amp;lt;=200)，代表有n个评委，每个评委的分数都在[0,M]之间的一个整数
&lt;/pre&gt;
&lt;h2&gt;输出描述:&lt;/h2&gt;
&lt;pre&gt;
对于每组测试数据，输出对应答案
&lt;/pre&gt;
&lt;div class=&quot;question-oi&quot;&gt;
&lt;p&gt;示例1&lt;/p&gt;
&lt;div class=&quot;question-oi-bd&quot;&gt;


&lt;div class=&quot;question-oi-mod&quot; readability=&quot;7.5&quot;&gt;
&lt;h2&gt;说明&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot; readability=&quot;10&quot;&gt;

&lt;p&gt;样例解释：&lt;/p&gt;
&lt;p&gt;对于样例有以下几种打分情况是符合要求的&lt;/p&gt;

&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;/&gt;&lt;p&gt;容斥法&lt;/p&gt;
&lt;p&gt;其中每种情况相等的可能性都是三个，比如0分的时候，平均分和第一位、第二位、第三位都相等，所以是3中情况，1的时候也同理，所以答案为6&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;我们首先枚举均分是多少，然后就知道剩下n-1个人的总分了&lt;/p&gt;
&lt;p&gt;然后我们首先考虑剩下的n-1个人里面都选（0-没有上限）的方案数，即隔板法可求&lt;/p&gt;
&lt;p&gt;然后再减去一个是（m+1到上限），（n-2）个（0-没有上限）&lt;/p&gt;
&lt;p&gt;然后再加上两个个是（m+1到上限），（n-3）个（0-没有上限）&lt;/p&gt;
&lt;p&gt;然后再减去三个个是（m+1到上限），（n-4）个（0-没有上限）&lt;/p&gt;
&lt;p&gt;……&lt;/p&gt;
&lt;p&gt;即容斥一下即可求得答案&lt;/p&gt;
&lt;p&gt;效率n*m&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;H wyh的吃鸡&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;时间限制：C/C++ 1秒，其他语言2秒&lt;br/&gt;空间限制：C/C++ 262144K，其他语言524288K&lt;br/&gt;64bit IO Format: %lld&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;最近吃鸡游戏非常火，你们wyh学长也在玩这款游戏，这款游戏有一个非常重要的过程，就是要跑到安全区内，否则就会中毒持续消耗血量，我们这个问题简化如下 &lt;/span&gt;&lt;/p&gt;
&lt;div readability=&quot;13&quot;&gt;
&lt;p&gt;假设地图为n*n的一个图，图中有且仅有一块X的联通快代表安全区域，有一个起点S代表缩圈的时候的起点，图中C代表的是车（保证车的数量小于等于100），标记为.的代表空地，可以任意通过，O代表障碍物不能通过。每次没有车的时候2s可以走一个格（只能走自己的上下左右4个方向），有车的话时间为1s走一个格 &lt;/p&gt;
&lt;p&gt;现在告诉你最多能坚持的时间为t秒，问你在t秒内（含t秒）能否从s点到达安全区域，能的话输出YES，并且输出最短时间，不能的话输出NO &lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;输入描述:&lt;/h2&gt;
&lt;pre&gt;
输入第一行一个整数T(1&amp;lt;=T&amp;lt;=10)&lt;br/&gt;接下来有T组测试数据，每组测试数据输入2个数n和k(1&amp;lt;=n&amp;lt;=100,1&amp;lt;=k&amp;lt;=10^9)&lt;br/&gt;接下来n行，每行n个字符，代表对应的n*n的地图，每个字符都是上面的一种，并且保证只有一个起点，只有一块安全区域。
&lt;/pre&gt;
&lt;h2&gt;输出描述:&lt;/h2&gt;
&lt;pre&gt;
对于每组测试数据，先输出能否到达，能的话输出YES，然后换行输出最短时间，如果不能的话直接输出NO
&lt;/pre&gt;
&lt;div class=&quot;question-oi&quot;&gt;
&lt;p&gt;示例1&lt;/p&gt;
&lt;div class=&quot;question-oi-bd&quot;&gt;
&lt;div class=&quot;question-oi-mod&quot; readability=&quot;6&quot;&gt;
&lt;h2&gt;输入&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
3
2 3
.X
S.
2 3
.X
SC
2 4
.X
S.
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;question-oi-mod&quot;&gt;
&lt;h2&gt;输出&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot;&gt;
&lt;pre&gt;
NO
YES
3
YES
4
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;pre&gt;
两次 BFS 第一次不考虑车求最短路，第二次从终点向起点BFS 两次vis的和为坐车的结果
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;66&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  1&lt;/span&gt; #include &amp;lt;bits/stdc++.h&amp;gt;
&lt;span&gt;  2&lt;/span&gt; &lt;span&gt;#define&lt;/span&gt; LL long long
&lt;span&gt;  3&lt;/span&gt; &lt;span&gt;using&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; std;
&lt;/span&gt;&lt;span&gt;  4&lt;/span&gt; &lt;span&gt;#define&lt;/span&gt; maxn 107
&lt;span&gt;  5&lt;/span&gt; &lt;span&gt;char&lt;/span&gt;&lt;span&gt; a[maxn][maxn];
&lt;/span&gt;&lt;span&gt;  6&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; vis1[maxn][maxn],vis2[maxn][maxn];
&lt;/span&gt;&lt;span&gt;  7&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; mx[]={&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;1&lt;/span&gt;,-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;};
&lt;/span&gt;&lt;span&gt;  8&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; my[]={&lt;span&gt;1&lt;/span&gt;,-&lt;span&gt;1&lt;/span&gt;,&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;0&lt;/span&gt;&lt;span&gt;};
&lt;/span&gt;&lt;span&gt;  9&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; n;
&lt;/span&gt;&lt;span&gt; 10&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt;&lt;span&gt; node
&lt;/span&gt;&lt;span&gt; 11&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 12&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; x,y,t;
&lt;/span&gt;&lt;span&gt; 13&lt;/span&gt; &lt;span&gt;}f,ne;
&lt;/span&gt;&lt;span&gt; 14&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; t0;
&lt;/span&gt;&lt;span&gt; 15&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; bfs1(&lt;span&gt;int&lt;/span&gt; x,&lt;span&gt;int&lt;/span&gt;&lt;span&gt; y)
&lt;/span&gt;&lt;span&gt; 16&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 17&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; i,j;
&lt;/span&gt;&lt;span&gt; 18&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;1&lt;/span&gt;;i&amp;lt;=n;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 19&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(j=&lt;span&gt;1&lt;/span&gt;;j&amp;lt;=n;j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 20&lt;/span&gt;             vis1[i][j]=-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 21&lt;/span&gt;     f.x=&lt;span&gt;x;
&lt;/span&gt;&lt;span&gt; 22&lt;/span&gt;     f.y=&lt;span&gt;y;
&lt;/span&gt;&lt;span&gt; 23&lt;/span&gt;     f.t=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 24&lt;/span&gt;     vis1[x][y]=&lt;span&gt;f.t;
&lt;/span&gt;&lt;span&gt; 25&lt;/span&gt;     queue &amp;lt;node&amp;gt;&lt;span&gt; q;
&lt;/span&gt;&lt;span&gt; 26&lt;/span&gt; &lt;span&gt;    q.push(f);
&lt;/span&gt;&lt;span&gt; 27&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt;(!&lt;span&gt;q.empty())
&lt;/span&gt;&lt;span&gt; 28&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 29&lt;/span&gt;         f=&lt;span&gt;q.front();
&lt;/span&gt;&lt;span&gt; 30&lt;/span&gt; &lt;span&gt;        q.pop();
&lt;/span&gt;&lt;span&gt; 31&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;&lt;span&gt;4&lt;/span&gt;;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 32&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 33&lt;/span&gt;             ne=&lt;span&gt;f;
&lt;/span&gt;&lt;span&gt; 34&lt;/span&gt;             ne.x+=&lt;span&gt;mx[i];
&lt;/span&gt;&lt;span&gt; 35&lt;/span&gt;             ne.y+=&lt;span&gt;my[i];
&lt;/span&gt;&lt;span&gt; 36&lt;/span&gt;             ne.t+=&lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 37&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;(ne.x&amp;gt;=&lt;span&gt;1&lt;/span&gt;&amp;amp;&amp;amp;ne.x&amp;lt;=n&amp;amp;&amp;amp;ne.y&amp;gt;=&lt;span&gt;1&lt;/span&gt;&amp;amp;&amp;amp;ne.y&amp;lt;=n&amp;amp;&amp;amp;a[ne.x][ne.y]!=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;O&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&amp;amp;&amp;amp;vis1[ne.x][ne.y]==-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 38&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 39&lt;/span&gt;                 vis1[ne.x][ne.y]=&lt;span&gt;ne.t;
&lt;/span&gt;&lt;span&gt; 40&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt;(a[ne.x][ne.y]==&lt;span&gt;'&lt;/span&gt;&lt;span&gt;X&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;) 
&lt;/span&gt;&lt;span&gt; 41&lt;/span&gt;                     t0=&lt;span&gt;min(t0,ne.t);
&lt;/span&gt;&lt;span&gt; 42&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt; 
&lt;span&gt; 43&lt;/span&gt; &lt;span&gt;                    q.push(ne);
&lt;/span&gt;&lt;span&gt; 44&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 45&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 46&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 47&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 48&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; bfs2()
&lt;/span&gt;&lt;span&gt; 49&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 50&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; i,j;
&lt;/span&gt;&lt;span&gt; 51&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;1&lt;/span&gt;;i&amp;lt;=n;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 52&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(j=&lt;span&gt;1&lt;/span&gt;;j&amp;lt;=n;j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 53&lt;/span&gt;             vis2[i][j]=-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 54&lt;/span&gt;     queue &amp;lt;node&amp;gt;&lt;span&gt; q;
&lt;/span&gt;&lt;span&gt; 55&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;1&lt;/span&gt;;i&amp;lt;=n;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 56&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 57&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(j=&lt;span&gt;1&lt;/span&gt;;j&amp;lt;=n;j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 58&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 59&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;(a[i][j]==&lt;span&gt;'&lt;/span&gt;&lt;span&gt;X&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 60&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 61&lt;/span&gt;                 f.x=&lt;span&gt;i;
&lt;/span&gt;&lt;span&gt; 62&lt;/span&gt;                 f.y=&lt;span&gt;j;
&lt;/span&gt;&lt;span&gt; 63&lt;/span&gt;                 f.t=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 64&lt;/span&gt;                 vis2[i][j]=&lt;span&gt;f.t;
&lt;/span&gt;&lt;span&gt; 65&lt;/span&gt; &lt;span&gt;                q.push(f);
&lt;/span&gt;&lt;span&gt; 66&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 67&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 68&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 69&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt;(!&lt;span&gt;q.empty())
&lt;/span&gt;&lt;span&gt; 70&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 71&lt;/span&gt;         f=&lt;span&gt;q.front();
&lt;/span&gt;&lt;span&gt; 72&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;printf(&quot;(%d,%d,%d) &quot;,f.x,f.y,f.t);&lt;/span&gt;
&lt;span&gt; 73&lt;/span&gt; &lt;span&gt;        q.pop();
&lt;/span&gt;&lt;span&gt; 74&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;&lt;span&gt;4&lt;/span&gt;;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 75&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 76&lt;/span&gt;             ne=&lt;span&gt;f;
&lt;/span&gt;&lt;span&gt; 77&lt;/span&gt;             ne.x+=&lt;span&gt;mx[i];
&lt;/span&gt;&lt;span&gt; 78&lt;/span&gt;             ne.y+=&lt;span&gt;my[i];
&lt;/span&gt;&lt;span&gt; 79&lt;/span&gt;             ne.t++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 80&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;(ne.x&amp;gt;=&lt;span&gt;1&lt;/span&gt;&amp;amp;&amp;amp;ne.x&amp;lt;=n&amp;amp;&amp;amp;ne.y&amp;gt;=&lt;span&gt;1&lt;/span&gt;&amp;amp;&amp;amp;ne.y&amp;lt;=n&amp;amp;&amp;amp;a[ne.x][ne.y]!=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;O&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&amp;amp;&amp;amp;vis2[ne.x][ne.y]==-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 81&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 82&lt;/span&gt;                 vis2[ne.x][ne.y]=&lt;span&gt;ne.t;
&lt;/span&gt;&lt;span&gt; 83&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt;(a[ne.x][ne.y]==&lt;span&gt;'&lt;/span&gt;&lt;span&gt;C&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 84&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 85&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt;(vis1[ne.x][ne.y]!=-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 86&lt;/span&gt;                         t0=min(t0,ne.t+&lt;span&gt;vis1[ne.x][ne.y]);
&lt;/span&gt;&lt;span&gt; 87&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 88&lt;/span&gt; &lt;span&gt;                q.push(ne);
&lt;/span&gt;&lt;span&gt; 89&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 90&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 91&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 92&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 93&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; main()
&lt;/span&gt;&lt;span&gt; 94&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 95&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; t;
&lt;/span&gt;&lt;span&gt; 96&lt;/span&gt;     scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&amp;amp;&lt;span&gt;t);
&lt;/span&gt;&lt;span&gt; 97&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt;(t--&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 98&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 99&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt;&lt;span&gt; k,i,j,x,y;
&lt;/span&gt;&lt;span&gt;100&lt;/span&gt;         scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&amp;amp;n,&amp;amp;&lt;span&gt;k);
&lt;/span&gt;&lt;span&gt;101&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;1&lt;/span&gt;;i&amp;lt;=n;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;102&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;103&lt;/span&gt;             scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,a[i]+&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;104&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt;(j=&lt;span&gt;1&lt;/span&gt;;j&amp;lt;=n;j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;105&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;106&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt;(a[i][j]==&lt;span&gt;'&lt;/span&gt;&lt;span&gt;S&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;107&lt;/span&gt;                     x=i,y=&lt;span&gt;j;
&lt;/span&gt;&lt;span&gt;108&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;109&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;110&lt;/span&gt;         t0=1e9+&lt;span&gt;7&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;111&lt;/span&gt; &lt;span&gt;        bfs1(x,y);
&lt;/span&gt;&lt;span&gt;112&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;(t0==1e9+&lt;span&gt;7&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;113&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;114&lt;/span&gt;             printf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;NO\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;115&lt;/span&gt;             &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;116&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;117&lt;/span&gt; &lt;span&gt;        bfs2();
&lt;/span&gt;&lt;span&gt;118&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;(t0&amp;gt;&lt;span&gt;k)
&lt;/span&gt;&lt;span&gt;119&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;120&lt;/span&gt;             printf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;NO\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;121&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;122&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;123&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;124&lt;/span&gt;             printf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;YES\n%d\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,t0);
&lt;/span&gt;&lt;span&gt;125&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;126&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;127&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;128&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 class=&quot;subject-item-title&quot;&gt;I wyh的物品&lt;/h2&gt;
&lt;p&gt;时间限制：C/C++ 5秒，其他语言10秒&lt;br/&gt;空间限制：C/C++ 262144K，其他语言524288K&lt;br/&gt;64bit IO Format: %lld&lt;/p&gt;
&lt;h2 class=&quot;subject-item-title&quot;&gt;题目描述&lt;/h2&gt;
&lt;div class=&quot;subject-describe&quot; readability=&quot;13&quot;&gt;
&lt;div readability=&quot;9&quot;&gt;
&lt;p&gt;wyh学长现在手里有n个物品，这n个物品的重量和价值都告诉你，然后现在让你从中选取k个，问你在所有可能选取的方案中，最大的单位价值为多少（单位价值为选取的k个物品的总价值和总重量的比值）&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;输入描述:&lt;/h2&gt;
&lt;pre&gt;
输入第一行一个整数T(1&amp;lt;=T&amp;lt;=10)&lt;br/&gt;接下来有T组测试数据，对于每组测试数据，第一行输入两个数n和k(1&amp;lt;=k&amp;lt;=n&amp;lt;=100000)&lt;br/&gt;接下来有n行，每行两个是a和b，代表这个物品的重量和价值
&lt;/pre&gt;
&lt;h2&gt;输出描述:&lt;/h2&gt;
&lt;pre&gt;
对于每组测试数据，输出对应答案，结果保留两位小数
&lt;/pre&gt;
&lt;div class=&quot;question-oi&quot;&gt;
&lt;p&gt;示例1&lt;/p&gt;
&lt;div class=&quot;question-oi-bd&quot;&gt;
&lt;div class=&quot;question-oi-mod&quot;&gt;
&lt;h2&gt;输入&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot;&gt;
&lt;pre&gt;
1
3 2
2 2
5 3
2 1
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;question-oi-mod&quot; readability=&quot;16&quot;&gt;
&lt;h2&gt;说明&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
对于样例来说，我们选择第一个物品和第三个物品，达到最优目的&lt;/pre&gt;
&lt;p&gt;这道题目是一道&lt;span lang=&quot;EN-US&quot;&gt;0-1分数规划求最优值。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;方法是一个二分搜索&lt;span lang=&quot;EN-US&quot;&gt;+贪心的题目。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;出这道题目就是告诉大家二分不仅可以查找，还可以搜索一个更优值。&lt;/p&gt;
&lt;p&gt;要使得单位重量的价值最大，则其最大不超过单个中最大的单位重量的价值，最小当然不小于&lt;span lang=&quot;EN-US&quot;&gt;0.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;那么我们就这一在&lt;span lang=&quot;EN-US&quot;&gt;0--最大单位重量的价值中间找一个值&lt;span lang=&quot;EN-US&quot;&gt;ans，使得&lt;span lang=&quot;EN-US&quot;&gt;ans为满足题目条件的最大值。如果满足条件，则可以找更大的。设置一个条件。既二分搜索、&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;从&lt;span lang=&quot;EN-US&quot;&gt;n个物品中找&lt;span lang=&quot;EN-US&quot;&gt;k个使得&lt;span lang=&quot;EN-US&quot;&gt;k个的价值和&lt;span lang=&quot;EN-US&quot;&gt;/质量和&lt;span lang=&quot;EN-US&quot;&gt;&amp;gt;=ans&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;为了使得&lt;span lang=&quot;EN-US&quot;&gt;ans尽可能的大，那么这里就要贪心选择。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; #include&amp;lt;bits/stdc++.h&amp;gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;using&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; std;
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;#define&lt;/span&gt; INF 1000010
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;#define&lt;/span&gt; eps 1e-4
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;double&lt;/span&gt; w[&lt;span&gt;100005&lt;/span&gt;],v[&lt;span&gt;100005&lt;/span&gt;&lt;span&gt;];
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;double&lt;/span&gt; y[&lt;span&gt;100005&lt;/span&gt;];&lt;span&gt;//&lt;/span&gt;&lt;span&gt;v-x*w&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;double&lt;/span&gt;&lt;span&gt; max_ave;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; n,k;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; &lt;span&gt;get&lt;/span&gt;(&lt;span&gt;double&lt;/span&gt;&lt;span&gt; x)
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; i;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;double&lt;/span&gt; sum=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;n;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;         y[i]=v[i]-x*&lt;span&gt;w[i];
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;     sort(y,y+&lt;span&gt;n);
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;k;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;         sum+=y[n-i-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;];
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; sum&amp;gt;=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; bin()
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;     &lt;span&gt;double&lt;/span&gt;&lt;span&gt; low,high,mid;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;     low=&lt;span&gt;0.0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;     high=&lt;span&gt;INF;
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt;(&lt;span&gt;int&lt;/span&gt; i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;&lt;span&gt;100&lt;/span&gt;;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;         mid=(low+high)/&lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;(&lt;span&gt;get&lt;/span&gt;&lt;span&gt;(mid))
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;             low=&lt;span&gt;mid;
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt; high=&lt;span&gt;mid;
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;     printf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%.2lf\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,high);
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; main()
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; i;
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; tot;
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;     cin&amp;gt;&amp;gt;&lt;span&gt;tot;
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt;(tot--&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;         scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d%d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&amp;amp;n,&amp;amp;&lt;span&gt;k);
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;n;i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;             scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%lf%lf&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&amp;amp;w[i],&amp;amp;&lt;span&gt;v[i]);
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; &lt;span&gt;        bin();
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; &lt;span&gt;    }    
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 class=&quot;subject-item-title&quot;&gt;J wyh的问题&lt;/h2&gt;
&lt;p&gt;时间限制：C/C++ 2秒，其他语言4秒&lt;br/&gt;空间限制：C/C++ 262144K，其他语言524288K&lt;br/&gt;64bit IO Format: %lld&lt;/p&gt;
&lt;h2 class=&quot;subject-item-title&quot;&gt;题目描述&lt;/h2&gt;
&lt;div class=&quot;subject-describe&quot; readability=&quot;14.5&quot;&gt;
&lt;div readability=&quot;10&quot;&gt;
&lt;p&gt;我国现在能源消耗非常严重，现在政府有这样一个工作，每天早上都需要把一些路灯关掉，但是他们想让在关闭的过程中所消耗的能源是最少的，负责路灯关闭的工作人员以1m/s的速度进行行走，假设关闭路灯的时候不需要花费任何的时间，请你编写一个程序，计算在给定路灯位置和每个路灯的消耗能源的多少，求出当所有路灯关闭的时候所需要的最少能量&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;输入描述:&lt;/h2&gt;
&lt;pre&gt;
多组测试数据循环输入&lt;br/&gt;每组测试数据第一行：N表示路灯的数量 （2&amp;lt;=N &amp;lt;=1000）&lt;br/&gt;第二行：V表示开始关灯的路灯号码。 （1&amp;lt;=V&amp;lt;=N）&lt;br/&gt;接下来的N行中，每行包含两个用空格隔开的整数D和W，用来描述每盏灯的参数&lt;br/&gt;D表示该路灯到原点的距离 (用米为单位来表示)，&lt;br/&gt;W表示灯泡的功率，即每秒该灯泡所消耗的能量数。（0&amp;lt;=D&amp;lt;=1000，0&amp;lt;=W&amp;lt;=1000）&lt;br/&gt;路灯按照顺序给出，起始位置的那盏灯不算消耗的电能里面
&lt;/pre&gt;
&lt;h2&gt;输出描述:&lt;/h2&gt;
&lt;pre&gt;
输出一个整数，即消耗能量之和的最小值。
&lt;/pre&gt;
&lt;div class=&quot;question-oi&quot;&gt;
&lt;p&gt;示例1&lt;/p&gt;
&lt;div class=&quot;question-oi-bd&quot;&gt;
&lt;div class=&quot;question-oi-mod&quot;&gt;
&lt;h2&gt;输入&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot;&gt;
&lt;pre&gt;
4
3
2 2
5 8
6 1
8 7
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;question-oi-mod&quot; readability=&quot;17&quot;&gt;
&lt;h2&gt;说明&lt;/h2&gt;
&lt;div class=&quot;question-oi-cont&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
对于样例，我一开始在第三个路灯的位置，即在6位置&lt;br/&gt;第1s的时候去5把第二盏灯关闭，消耗电能8&lt;br/&gt;然后去第四盏灯，第四盏灯亮的时间是4s 所以消耗电能28&lt;br/&gt;最后去关第一盏灯第一盏灯亮的时间是10s 所以消耗电能20&lt;br/&gt;最后总和为8+28+20=56&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;关灯的人要么是去左边关灯，或者是去右边关灯，也即要关闭的下一个路灯要么是从已关闭路段的左端过去的，要么是从已关闭的路段的右端过去的，定义：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span lang=&quot;EN-US&quot;&gt;DP[i][j][0]&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;表示&lt;span lang=&quot;EN-US&quot;&gt;i到&lt;span lang=&quot;EN-US&quot;&gt;j的路灯都已经关闭，人在路灯&lt;span lang=&quot;EN-US&quot;&gt;i的位置，此时已经消耗的最小电能&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span lang=&quot;EN-US&quot;&gt;DP[i][j][1]&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;表示&lt;span lang=&quot;EN-US&quot;&gt;i到&lt;span lang=&quot;EN-US&quot;&gt;j的路灯都已经关闭，人在路灯&lt;span lang=&quot;EN-US&quot;&gt;j的位置，此时已经消耗的最小电能&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;则状态转移式：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span lang=&quot;EN-US&quot;&gt;DP[i][j][0] = min(DP[i+1][j][0]+[i+1,j]&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;路段以外未关闭路灯在人从&lt;span lang=&quot;EN-US&quot;&gt;i+1走的&lt;span lang=&quot;EN-US&quot;&gt;i期间消耗的电能，&lt;span lang=&quot;EN-US&quot;&gt;DP[i+1][j][1]+[i+1,j]路段以外未关闭路灯在人从&lt;span lang=&quot;EN-US&quot;&gt;j走到&lt;span lang=&quot;EN-US&quot;&gt;i期间消耗的电能&lt;span lang=&quot;EN-US&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span lang=&quot;EN-US&quot;&gt;DP[i][j][1] = min(DP[i][j-1][0]+[i,j-1]&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;路段以外未关闭路灯在人从&lt;span lang=&quot;EN-US&quot;&gt;i走到&lt;span lang=&quot;EN-US&quot;&gt;j期间消耗的电能，&lt;span lang=&quot;EN-US&quot;&gt;DP[i][j-1][1]+[i,j-1]路段以外未关闭路灯在人从&lt;span lang=&quot;EN-US&quot;&gt;j-1走到&lt;span lang=&quot;EN-US&quot;&gt;j期间消耗的电能&lt;span lang=&quot;EN-US&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;50&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; #include &amp;lt;bits/stdc++.h&amp;gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;#define&lt;/span&gt; LEN 1001
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;#define&lt;/span&gt; min(a,b) ((a&amp;lt;b)?(a):(b))
&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DP[LEN][LEN][&lt;span&gt;2&lt;/span&gt;&lt;span&gt;];
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; bw[LEN][LEN];
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; D[LEN];
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; W[LEN];
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; main()
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt; N,V,tw=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt;&lt;span&gt; i,j,t;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt;(scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d %d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&amp;amp;N,&amp;amp;V)!=&lt;span&gt;EOF)
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;        tw = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;        memset(bw, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;sizeof&lt;/span&gt;&lt;span&gt;(bw));
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;        &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;1&lt;/span&gt;; i&amp;lt;=N; ++&lt;span&gt;i)
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;       {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;          scanf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d %d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&amp;amp;D[i],&amp;amp;&lt;span&gt;W[i]); 
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;          tw +=&lt;span&gt; W[i];
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;       }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;        &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;1&lt;/span&gt;; i&amp;lt;=N; ++&lt;span&gt;i)
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;       {
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;           &lt;span&gt;for&lt;/span&gt;(j=i; j&amp;lt;=N; ++&lt;span&gt;j)
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; &lt;span&gt;          {
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;               bw[i][j] = bw[i][j-&lt;span&gt;1&lt;/span&gt;] +&lt;span&gt; W[j];
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;          }
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;       }
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;        
&lt;span&gt;31&lt;/span&gt;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;初始化&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt;        &lt;span&gt;for&lt;/span&gt;(i=V-&lt;span&gt;1&lt;/span&gt;; i&amp;gt;&lt;span&gt;0&lt;/span&gt;; --&lt;span&gt;i)
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;       {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;           DP[i][V][&lt;span&gt;0&lt;/span&gt;] = DP[i+&lt;span&gt;1&lt;/span&gt;][V][&lt;span&gt;0&lt;/span&gt;]+(tw-bw[i+&lt;span&gt;1&lt;/span&gt;][V])*(D[i+&lt;span&gt;1&lt;/span&gt;]-&lt;span&gt;D[i]);
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;           DP[i][V][&lt;span&gt;1&lt;/span&gt;] = DP[i][V][&lt;span&gt;0&lt;/span&gt;] + (tw-bw[i][V])*(D[V]-&lt;span&gt;D[i]);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;       } 
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;        &lt;span&gt;for&lt;/span&gt;(j=V+&lt;span&gt;1&lt;/span&gt;; j&amp;lt;=N; ++&lt;span&gt;j)
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;       {
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;           DP[V][j][&lt;span&gt;1&lt;/span&gt;] = DP[V][j-&lt;span&gt;1&lt;/span&gt;][&lt;span&gt;1&lt;/span&gt;] + (tw-bw[V][j-&lt;span&gt;1&lt;/span&gt;])*(D[j]-D[j-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;]);
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;           DP[V][j][&lt;span&gt;0&lt;/span&gt;] = DP[V][j][&lt;span&gt;1&lt;/span&gt;] + (tw-bw[V][j])*(D[j]-&lt;span&gt;D[V]); 
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; &lt;span&gt;       }
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;        
&lt;span&gt;43&lt;/span&gt;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;DP&lt;/span&gt;
&lt;span&gt;44&lt;/span&gt;        &lt;span&gt;for&lt;/span&gt;(i=V-&lt;span&gt;1&lt;/span&gt;; i&amp;gt;&lt;span&gt;0&lt;/span&gt;; i--&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; &lt;span&gt;       {
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;           &lt;span&gt;for&lt;/span&gt;(j=V+&lt;span&gt;1&lt;/span&gt;; j&amp;lt;=N; ++&lt;span&gt;j)
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; &lt;span&gt;          {
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;              DP[i][j][&lt;span&gt;0&lt;/span&gt;] = min(DP[i+&lt;span&gt;1&lt;/span&gt;][j][&lt;span&gt;0&lt;/span&gt;]+(tw-bw[i+&lt;span&gt;1&lt;/span&gt;][j])*(D[i+&lt;span&gt;1&lt;/span&gt;]-&lt;span&gt;D[i]), 
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;                                DP[i+&lt;span&gt;1&lt;/span&gt;][j][&lt;span&gt;1&lt;/span&gt;]+(tw-bw[i+&lt;span&gt;1&lt;/span&gt;][j])*(D[j]-&lt;span&gt;D[i]));
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;              DP[i][j][&lt;span&gt;1&lt;/span&gt;] = min(DP[i][j-&lt;span&gt;1&lt;/span&gt;][&lt;span&gt;0&lt;/span&gt;]+(tw-bw[i][j-&lt;span&gt;1&lt;/span&gt;])*(D[j]-&lt;span&gt;D[i]), 
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;                                DP[i][j-&lt;span&gt;1&lt;/span&gt;][&lt;span&gt;1&lt;/span&gt;]+(tw-bw[i][j-&lt;span&gt;1&lt;/span&gt;])*(D[j]-D[j-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;]));
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt; &lt;span&gt;          }
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt; &lt;span&gt;       }
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;        printf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, min(DP[&lt;span&gt;1&lt;/span&gt;][N][&lt;span&gt;0&lt;/span&gt;], DP[&lt;span&gt;1&lt;/span&gt;][N][&lt;span&gt;1&lt;/span&gt;&lt;span&gt;]));
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
<pubDate>Tue, 10 Apr 2018 15:40:00 +0000</pubDate>
<dc:creator>jlbcljb</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/jlbcljb/p/8784650.html</dc:identifier>
</item>
</channel>
</rss>