<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>JAVA基础-JDBC二（常用的开源工具） - 阿拉巴洞</title>
<link>http://www.cnblogs.com/0813lichenyu/p/8007522.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/0813lichenyu/p/8007522.html</guid>
<description>&lt;hr/&gt;
&lt;p&gt;　　在实际的开发应用中，我们常常会对数据库进行大量的高并发的访问，而最原始的连接和操作方式并不能满足这种大量的访问&lt;br/&gt;，程序员为了追求更方便、更快捷、更科学安全的开发。第三方的工具类和Dao层的框架就应运而生了。DBCP连接池、和C3P0连&lt;br/&gt;接池就是2个常见的开源数据库连接池。&lt;br/&gt;　　在与数据库进行交互的过程中，获得连接”和“释放资源”是非常消耗系统资源的两个过程，为了解决此类性能问题，通常情况&lt;br/&gt;我们采用连接池技术，来共享连接Connection。这样我们就不需要每次都创建连接、释放连接了，这些操作都交给了连接池。用的&lt;br/&gt;时候从连接池里拿出来，用完了在给他放回去，下次使用时还可以接着用。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1234932/201712/1234932-20171208231956577-1590173180.png&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;　　同数据库的链接规范（JDBC）一样,java为数据库连接池也提供了一套规范（接口）- javax.sql.DataSource，各个厂商需要&lt;br/&gt;让自己的连接池实现这个接口。这样就方便了应用程序的扩展和我们的使用。&lt;/p&gt;
&lt;h2&gt;（一）DBCP连接池&lt;/h2&gt;
&lt;p&gt;　　DBCP连接池他是一个开源的连接池，属于Apache家族的一员，为Tomcat的内置连接池（自己的土，自己的地...）&lt;br/&gt;1、导入炸包&lt;br/&gt;　　使用第三方工具类的第一件事就是导入jar包，然后Build Patch一下，为了方便jar包的管理（另一方面满足于强迫症患者的&lt;br/&gt;整理欲望）一般都在工程下新建一个lib文件夹用来存放炸包。&lt;br/&gt;　　需要导入的jar包：&lt;br/&gt;　　* commons-dbcp-1.4.jar&lt;br/&gt;　　* commons-pool-1.5.6.jar&lt;/p&gt;
&lt;h2&gt;2、DBCP连接池的使用&lt;/h2&gt;
&lt;p&gt;　　连接数据库的操作是一个频繁使用，代码重复的操作，可以将其抽取成一个工具类。&lt;br/&gt;　　Java为数据库连接池也提供了一套规范接口：DataSource，它是java中提供的连接池，作为 DriverManager 工具的替代项。&lt;br/&gt;而DBCP包则提供了DataSource接口的实现类 - BasicDataSource类。&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;  栗子：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; JdbcUtils {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;定义一个连接池&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; BasicDataSource bd = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; BasicDataSource();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;工具类，私有他的无参构造&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt;&lt;span&gt; JdbcUtils() {
&lt;/span&gt;&lt;span&gt;super&lt;/span&gt;&lt;span&gt;();
}
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;使用静态代码块进行连接池的属性配置 
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;静态代码块是随着类的加载而加载的且只加载一次（节省资源）&lt;/span&gt;
&lt;span&gt;static&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
* 必须设置的项
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置mySQL的驱动&lt;/span&gt;
bd.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置要连接数据库的URL&lt;/span&gt;
bd.setUrl(&quot;jdbc:mysql://localhost:3306/mydb&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置用户名&lt;/span&gt;
bd.setUsername(&quot;root&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置数据库密码&lt;/span&gt;
bd.setPassword(&quot;root&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
* 选择设置的项，不设置的话会有默认值跟着
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt;初始化连接数&lt;/span&gt;
bd.setInitialSize(10&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;最大连接数&lt;/span&gt;
bd.setMaxActive(15&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;最大空闲连接数&lt;/span&gt;
bd.setMaxIdle(6&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;最小空闲连接数&lt;/span&gt;
bd.setMinIdle(3&lt;span&gt;);
}
&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
* 获取连接池对象
* &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; bd 连接池
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; DataSource getDataSource() {
&lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; bd;
}
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;（二）C3P0连接池&lt;/h2&gt;
&lt;p&gt;　　C3P0是一个开源的JDBC连接池，它实现了数据源和JNDI绑定，支持JDBC3规范和JDBC2的标准扩展。目前使用它的开源项目有&lt;br/&gt;Hibernate，Spring等。（百度百科）&lt;br/&gt;　　C3P0连接池有自动回收空闲连接的功能，而DBCP没有自动回收空闲连接的功能。&lt;br/&gt;1、导入jar包&lt;br/&gt;　　同DBCP的使用步骤一样，第一步要导入相关的jar包：&lt;br/&gt;　　c3p0-0.9.1.2.jar&lt;br/&gt;2、C3P0连接池的使用&lt;br/&gt;　　通过查看帮助文档（doc目录下的index.html文件里边有个快速入门）发现C3P0可以通过手动或者配置文件的方式使用。&lt;/p&gt;
&lt;p&gt;&lt;br/&gt; 　　 * 通过手动进行配置&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; main(String[] args) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 获得C3P0连接池对象&lt;/span&gt;
ComboPooledDataSource source = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ComboPooledDataSource();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 设置驱动&lt;/span&gt;
source.setDriverClass(&quot;com.mysql.jdbc.Driver&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 设置连接库的路径&lt;/span&gt;
source.setJdbcUrl(&quot;jdbc:mysql:///mydb&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 设置用户名&lt;/span&gt;
source.setUser(&quot;root&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 设置密码&lt;/span&gt;
source.setPassword(&quot;root&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过连接池创建一个QueryRunner对象&lt;/span&gt;
QueryRunner runner = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner(source);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 测试&lt;/span&gt;
String sql = &quot;SELECT * FROM users&quot;&lt;span&gt;;
List&lt;/span&gt;&amp;lt;Object[]&amp;gt; list = runner.query(sql, &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ArrayListHandler());
&lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; (Object[] objects : list) {
&lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; (Object object : objects) {
System.out.print(object &lt;/span&gt;+ &quot; &quot;&lt;span&gt;);
}
System.out.println();
}
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;　　* 通过配置文件进行配置&lt;br/&gt;　　C3P0连接池支持.xml和属性文件.properties的文件配置，当然了他对其配置文件的名字和里边的文件也有一定的要求（搞一个别&lt;br/&gt;的名他就不认识了），XML配置文件的名字一定是c3p0-config.xml，属性配置文件的名字一定是c3p0.properties.默认情况下C3P0连接&lt;br/&gt;池就会找类加载路径下的c3p0-config.xml进行解析。c3p0-config.xml配置文件除了一些链接数据库的一些必要属性外也可以配置一些&lt;br/&gt;连接池其他的属性：最小池里的数量，最大池里的数量等。具体的属性配置可以百度或者阅读开发文档。&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;　　栗子：&lt;br/&gt;  * c3p0-config.xml配置文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;c3p0-config&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;default-config&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;driverClass&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;com.mysql.jdbc.Driver&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;jdbcUrl&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;jdbc:mysql:///mydb&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;user&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;root&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;property &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;password&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;root&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;property&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;default-config&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;c3p0-config&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;br/&gt;  * C3P0的工具类&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; C3p0Utils {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 定义一个c3p0连接池&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; ComboPooledDataSource source;
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 定义一个连接对象&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Connection connection;

&lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; C3p0Utils() {
&lt;/span&gt;&lt;span&gt;super&lt;/span&gt;&lt;span&gt;();
}

&lt;/span&gt;&lt;span&gt;static&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 初始化连接池&lt;/span&gt;
source = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ComboPooledDataSource();
&lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 获得一个连接&lt;/span&gt;
connection =&lt;span&gt; source.getConnection();
} &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; TODO Auto-generated catch block&lt;/span&gt;
&lt;span&gt;e.printStackTrace();
}
}

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt;&lt;span&gt; Connection getConnection() {
&lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; connection;
}
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　通过代码演示可以看到通过配置文件的方式还是非常方便的，后期维护的话只要改相关的配置文件就可以了，xml作为配置文件便于&lt;br/&gt;我们的阅读，所以推荐使用c3p0-config.xml配置文件。&lt;/p&gt;

&lt;p&gt;　　使用原生的JDBC进行开发，你会发现代码冗余过多，使用麻烦，极度不爽。而工具类的出现就是为了简化我们的开发。DBUtils是&lt;br/&gt;apache commons组件一个成员，使用DBUtils工具类首先要导入相关的jar包 - commons-dbutils-1.6.jar。&lt;br/&gt;　　DBUtils封装并简化了JDBC操作，减少了相关代码的书写、它一共有3个核心的部分组成：&lt;br/&gt;　　* QueryRunner提供对sql语句操作的API。&lt;br/&gt;　　* ResultSetHandler接口提供了执行完sql语句后怎样封装结果集。&lt;br/&gt;　　* DbUtils工具类提供了关闭相关资源和处理事物的方法。&lt;br/&gt;1、QueryRunner核心类&lt;br/&gt;　　* new QueryRunner() ，无参构造，使用无参构造时，调用update，query方法时需要传入Connection对象&lt;br/&gt;　　* update(Connection conn, String sql, Object... params) ，用来完成表数据的增加、删除、更新操作。&lt;br/&gt;　　* query(Connection conn, String sql, ResultSetHandler&amp;lt;T&amp;gt; rsh, Object... params) ，用来完成表数据的查询操作。&lt;br/&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;　　* new QueryRunner(DataSource ds) ，带参构造，使用带参构造时调用update，query方法无需要传入Connection对象&lt;br/&gt;　　* update(String sql, Object... params) ，用来完成表数据的增加、删除、更新操作。&lt;br/&gt;　　* query(String sql, ResultSetHandler&amp;lt;T&amp;gt; rsh, Object... params) ，用来完成表数据的查询操作。&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;　　栗子：&lt;br/&gt;  * 无参构造的update方法&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
* 增加操作
* &lt;/span&gt;&lt;span&gt;@throws&lt;/span&gt;&lt;span&gt; SQLException
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; method01() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; SQLException {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过工具类获得连接&lt;/span&gt;
Connection connection =&lt;span&gt; JdbcUtilsConfig.getConnection();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 获得QueryRunner对象&lt;/span&gt;
QueryRunner runner = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 编写sql语句&lt;/span&gt;
String insert = &quot;INSERT INTO sort(sname,sprice,sdesc) VALUES(?,?,?)&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 执行update方法，也可以将数据存到Object数组里然后传入数组，返回值为影响的行数&lt;/span&gt;
&lt;span&gt;int&lt;/span&gt; update = runner.update(connection, insert, &quot;家具&quot;, 1000, &quot;很好用&quot;&lt;span&gt;);
System.out.println(update);
}

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
* 更新操作
* 
* &lt;/span&gt;&lt;span&gt;@throws&lt;/span&gt;&lt;span&gt; SQLException
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; method02() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; SQLException {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过工具类获得连接&lt;/span&gt;
Connection connection =&lt;span&gt; JdbcUtilsConfig.getConnection();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 获得QueryRunner对象&lt;/span&gt;
QueryRunner runner = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 编写sql语句&lt;/span&gt;
String s = &quot;UPDATE sort SET sname=?,sprice=?,sdesc=? WHERE sid=4&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 执行update方法&lt;/span&gt;
runner.update(connection, s, &quot;花卉&quot;, 100, &quot;买给你爱的人&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;安静的关闭&lt;/span&gt;
&lt;span&gt;DbUtils.closeQuietly(connection);
}

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
* 删除操作
* 
* &lt;/span&gt;&lt;span&gt;@throws&lt;/span&gt;&lt;span&gt; SQLException
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; method03() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; SQLException {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过工具类获得连接&lt;/span&gt;
Connection connection =&lt;span&gt; JdbcUtilsConfig.getConnection();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 创建一个QueryRunner对象，用来完成SQL语句的执行&lt;/span&gt;
QueryRunner qr = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 执行SQL语句&lt;/span&gt;
String sql = &quot;DELETE FROM zhangwu WHERE name = ?&quot;&lt;span&gt;;
Object[] params &lt;/span&gt;= { &quot;股票收入&quot;&lt;span&gt; };
&lt;/span&gt;&lt;span&gt;int&lt;/span&gt; line =&lt;span&gt; qr.update(connection, sql, params);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 结果集的处理，影响的行数&lt;/span&gt;
System.out.println(&quot;line=&quot; +&lt;span&gt; line);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;　　* 有参构造的query方法&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; main(String[] args) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过工具类获得连接池对象&lt;/span&gt;
DataSource dataSource =&lt;span&gt; C3p0Utils.getDataSource();
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 通过连接池创建一个QueryRunner对象&lt;/span&gt;
QueryRunner runner = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner(dataSource);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 编写sql语句&lt;/span&gt;
String sql = &quot;SELECT * FROM users&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 执行query方法传入ArrayListHandler返回集合&lt;/span&gt;
List&amp;lt;Object[]&amp;gt; list = runner.query(sql, &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ArrayListHandler());
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 遍历集合&lt;/span&gt;
&lt;span&gt;for&lt;/span&gt;&lt;span&gt; (Object[] objects : list) {
&lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; (Object object : objects) {
System.out.print(object &lt;/span&gt;+ &quot; &quot;&lt;span&gt;);
}
System.out.println();
}
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2、ResultSetHandler结果集处理类&lt;br/&gt;　　* ArrayHandler 将结果集中的第一条记录封装到一个Object[]数组中，数组中的每一个元素就是这条记录的值。&lt;br/&gt;　　* ArrayListHandler 将结果集中的每一条记录都封装到一个Object[]数组中，将这些数组在封装到List集合中。&lt;br/&gt;　　* BeanHandler 将结果集中第一条记录封装到一个指定的javaBean中。&lt;br/&gt;　　* BeanListHandler 将结果集中每一条记录封装到指定的javaBean中，将这些javaBean在封装到List集合中。&lt;br/&gt;　　* ColumnListHandler 将结果集中指定的列的字段值，封装到一个List集合中。&lt;br/&gt;　　* ScalarHandler 它是用于单数据。例如sql中的聚合函数SUM(),Count()等。&lt;br/&gt;　　* MapHandler 将结果集第一行封装到Map集合中,Key 列名, Value 该列数据，可以配合工具类&lt;br/&gt;BeanUtils.populate(Bean bean, Map map);一起使用方便数据的封装。&lt;br/&gt;　　* MapListHandler 将结果集第一行封装到Map集合中,Key 列名, Value 该列数据,Map集合存储到List集合。&lt;/p&gt;&lt;p&gt;　　常用Handler举例:&lt;br/&gt;  *BeanHandler的栗子：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 商品详情查询
     * 
     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; pid
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; product
     * &lt;/span&gt;&lt;span&gt;@throws&lt;/span&gt;&lt;span&gt; Exception
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Override
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Product findByPid(String pid) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;通过连接池创建QueryRunner对象&lt;/span&gt;
        QueryRunner queryRunner = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner(C3p0Utils.getDataSourse());
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;根据传入的商品ID编写sql语句&lt;/span&gt;
        String sql = &quot;SELECT * FROM product WHERE pid=?&quot;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;传入sql语句和BeanHandler结果集返回商品Bean&lt;/span&gt;
        Product product = queryRunner.query(sql, &lt;span&gt;new&lt;/span&gt; BeanHandler&amp;lt;Product&amp;gt;(Product.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;), pid);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; product;
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;  * ScalarHandler的栗子：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
    &lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 商品总数查询
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; totalCount
     * &lt;/span&gt;&lt;span&gt;@throws&lt;/span&gt;&lt;span&gt; Exception
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Override
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Integer findAdmintotalCount() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        QueryRunner queryRunner &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner(C3p0Utils.getDataSourse());
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;pflag字段为是否下架&lt;/span&gt;
        String sql = &quot;SELECT COUNT(*) FROM product WHERE pflag=?&quot;&lt;span&gt;;
        Long totalCount &lt;/span&gt;= (Long) queryRunner.query(sql, &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ScalarHandler(),Product.UN_FLAG);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;将Long转换成Integer类型返回&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; totalCount.intValue();
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;  * BeanListHandler的栗子：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 根据类别查询商品
     * 
     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; cid 商品ID
     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; beginPage 起始页
     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; pageSize 每页显示的条数
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; list
     * &lt;/span&gt;&lt;span&gt;@throws&lt;/span&gt;&lt;span&gt; Exception
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Override
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; List&amp;lt;Product&amp;gt; findPageByCid(String cid, Integer beginPage, Integer pageSize) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        QueryRunner queryRunner &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; QueryRunner(C3p0Utils.getDataSourse());
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;分页查询&lt;/span&gt;
        String sql = &quot;SELECT * FROM product WHERE cid=? AND pflag=? LIMIT ?,?&quot;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;BeanListHandler里泛型要写你查询实体Bean类型，传入参数为Bean.class&lt;/span&gt;
        List&amp;lt;Product&amp;gt; list = queryRunner.query(sql, &lt;span&gt;new&lt;/span&gt; BeanListHandler&amp;lt;Product&amp;gt;(Product.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;), cid, Product.UN_FLAG,
                beginPage, pageSize);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;返回结合&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; list;
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;3、DbUtils工具类&lt;br/&gt;　　此类提供了关闭相关资源和处理事物的方法：&lt;br/&gt;　　* DbUtils.closeQuietly() 安静的关闭资源。&lt;/p&gt;
</description>
<pubDate>Fri, 08 Dec 2017 15:39:00 +0000</pubDate>
<dc:creator>阿拉巴洞</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/0813lichenyu/p/8007522.html</dc:identifier>
</item>
<item>
<title>【MySQL疑难杂症】如何将树形结构存储在数据库中（方案一、Adjacency List） - 弗兰克的猫</title>
<link>http://www.cnblogs.com/mfrank/p/7992709.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/mfrank/p/7992709.html</guid>
<description>&lt;p&gt;　　今天来看看一个比较头疼的问题，如何在数据库中存储树形结构呢？&lt;/p&gt;
&lt;p&gt;　　像mysql这样的关系型数据库，比较适合存储一些类似表格的扁平化数据，但是遇到像树形结构这样有深度的人，就很难驾驭了。&lt;/p&gt;
&lt;p&gt;　　举个栗子：现在有一个要存储一下公司的人员结构，大致层次结构如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1043143/201712/1043143-20171208075002066-467711169.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;　　（画个图真不容易。。）&lt;/p&gt;
&lt;p&gt;　　那么怎么存储这个结构？并且要获取以下信息：&lt;/p&gt;
&lt;p&gt;　　1.查询小天的直接上司。&lt;/p&gt;
&lt;p&gt;　　2.查询老宋管理下的直属员工。&lt;/p&gt;
&lt;p&gt;　　3.查询小天的所有上司。&lt;/p&gt;
&lt;p&gt;　　4.查询老王管理的所有员工。&lt;/p&gt;

&lt;p&gt;方案一、(Adjacency List)只存储当前节点的父节点信息。&lt;/p&gt;
&lt;p&gt;　　CREATE TABLE Employees(&lt;br/&gt;　　eid int,&lt;br/&gt;　　ename VARCHAR(100),&lt;br/&gt;        position VARCHAR(100),&lt;br/&gt;　　parent_id int&lt;br/&gt;　　)&lt;/p&gt;
&lt;p&gt;　　记录信息简单粗暴，那么现在存储一下这个结构信息：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/1043143/201712/1043143-20171206122527238-22221215.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　好的，现在开始进入回答环节：&lt;/p&gt;
&lt;p&gt;　　1.查询小天的直接上司：&lt;/p&gt;
&lt;p&gt; 　　SELECT e2.eid,e2.ename FROM employees e1,employees e2 WHERE e1.parent_id=e2.eid AND e1.ename='小天';&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/1043143/201712/1043143-20171206123531800-1704084680.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　2.查询老宋管理下的直属员工：&lt;/p&gt;
&lt;p&gt;　　SELECT e1.eid,e1.ename FROM employees e1,employees e2 WHERE e1.parent_id=e2.eid AND e2.ename='老宋';&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/1043143/201712/1043143-20171206134257675-1536893060.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　3.查询小天的所有上司。&lt;/p&gt;
&lt;p&gt;　　这里肯定没法直接查，只能用循环进行循环查询，先查直接上司，再查直接上司的直接上司，依次循环，这样麻烦的事情，还是得先建立一个存储过程：&lt;/p&gt;
&lt;p&gt;　　睁大眼睛看仔细了，接下来是骚操作环节：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
CREATE DEFINER=`root`@`localhost` FUNCTION `getSuperiors`(`uid` &lt;span&gt;int&lt;/span&gt;) RETURNS varchar(1000&lt;span&gt;) CHARSET gb2312
BEGIN
    DECLARE superiors VARCHAR(&lt;/span&gt;1000) DEFAULT ''&lt;span&gt;;
    DECLARE sTemp INTEGER DEFAULT uid;
    DECLARE tmpName VARCHAR(&lt;/span&gt;20&lt;span&gt;);

    WHILE (sTemp&lt;/span&gt;&amp;gt;0&lt;span&gt;) DO
        SELECT parent_id into sTemp FROM employees where eid &lt;/span&gt;=&lt;span&gt; sTemp;
        SELECT ename into tmpName FROM employees where eid &lt;/span&gt;=&lt;span&gt; sTemp;
        IF(sTemp&lt;/span&gt;&amp;gt;0&lt;span&gt;)THEN
            SET superiors &lt;/span&gt;= concat(tmpName,','&lt;span&gt;,superiors);
        END IF;
    END WHILE;
        SET superiors &lt;/span&gt;= LEFT(superiors,CHARACTER_LENGTH(superiors)-1&lt;span&gt;);
    RETURN superiors;
END&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　这一段存储过程可以查询子节点的所有父节点，来试验一下　&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1043143/201712/1043143-20171208212316062-363509535.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　好的，骚操作完成。&lt;/p&gt;
&lt;p&gt;　　显然，这样。获取子节点的全部父节点的时候很麻烦。。&lt;/p&gt;
&lt;p&gt;　　4.查询老王管理的所有员工。&lt;/p&gt;
&lt;p&gt;　　思路如下：先获取所有父节点为老王id的员工id，然后将员工姓名加入结果列表里，在调用一个神奇的查找函数，即可进行神奇的查找：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;CREATE DEFINER=`root`@`localhost` FUNCTION `getSubordinate`(`uid` int) RETURNS varchar(2000) CHARSET gb2312&lt;br/&gt;BEGIN   &lt;br/&gt;DECLARE str varchar(1000);  &lt;br/&gt;DECLARE cid varchar(100);&lt;br/&gt;DECLARE result VARCHAR(1000);&lt;br/&gt;DECLARE tmpName VARCHAR(100);&lt;br/&gt;SET str = '$';   &lt;br/&gt;SET cid = CAST(uid as char(10));   &lt;br/&gt;WHILE cid is not null DO   &lt;br/&gt;SET str = concat(str, ',', cid); &lt;br/&gt;SELECT group_concat(eid) INTO cid FROM employees where FIND_IN_SET(parent_id,cid);         &lt;br/&gt;END WHILE;&lt;br/&gt;SELECT GROUP_CONCAT(ename) INTO result FROM employees WHERE FIND_IN_SET(parent_id,str);&lt;br/&gt;RETURN result;   &lt;br/&gt;END&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　看神奇的结果：&lt;/p&gt;
&lt;p&gt;　&lt;img src=&quot;http://images2017.cnblogs.com/blog/1043143/201712/1043143-20171208215809609-35443566.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　虽然搞出来了，但说实话，真是不容易。。。&lt;/p&gt;
&lt;p&gt;　　这种方法的优点是存储的信息少，查直接上司和直接下属的时候很方便，缺点是多级查询的时候很费劲。所以当只需要用到直接上下级关系的时候，用这种方法还是不错的，可以节省很多空间。后续还会介绍其它存储方案，并没有绝对的优劣之分，适用场合不同而已。&lt;/p&gt;
&lt;p&gt;　　本篇至此告一段落，欢迎大家继续关注。&lt;/p&gt;

</description>
<pubDate>Fri, 08 Dec 2017 15:34:00 +0000</pubDate>
<dc:creator>弗兰克的猫</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/mfrank/p/7992709.html</dc:identifier>
</item>
<item>
<title>Python测试开发之函数 - 大王king</title>
<link>http://www.cnblogs.com/bettywang/p/8007482.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/bettywang/p/8007482.html</guid>
<description>&lt;p&gt;对于初学者而言，感觉函数还是不是很好理解，尤其是当写一个脚本，或者是写一个算法，认为可能for循环就已经可以解决的问题为什么还要用函数来实现呢？&lt;/p&gt;
&lt;p&gt;今天就来说一下函数的优点，其实函数的最大优点就是可重用，一个函数实现后可以被其他不同的脚本来调用，这也就是体现了代码的重用性。&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;函数的定义：def 函数名():，在定义函数时，一定要用关键字def开头，然后紧接着是函数名，括号里是要传的的参数，当然也可不传，最后面是个冒号：&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;　　　　def add(x,y):&lt;/p&gt;
&lt;p&gt;　　　　    return x+y&lt;/p&gt;
&lt;p&gt;　　这就是一个最简单的函数&lt;/p&gt;
&lt;p&gt;　　2.函数的返回值：Python中自定义的函数如果有return，则返回实际的结果，如果没有返回值，则返回None，这是Python与其他语言的区别之一&lt;/p&gt;
&lt;p&gt;　　3.函数的调用：在定义好一个函数后，如果要实现函数的功能，一定要对其进行引用，不然函数体是不会被执行的，调用的方法也很简单，就是函数名和需要的参数即可&lt;/p&gt;
&lt;p&gt;　　例如上边add函数的调用： add(2,3)即可返回5&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208224925312-1449265746.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　注意：此处如果传入两个字符串也是OK的，这也是Python的特殊之处，他会根据传入的值来进行相应操作，如果传入的是两个数字，则进行相加，如果是两个字符串则进行拼接，但是此处必须传入的类型一致，否则会报错，所以可以根据你的需要进行处理，如果要做特定的实现可以用isinstance来判断一下类型，来达到自己想要的效果。&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208225224327-109737613.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208225430952-2140282177.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　4.函数的传参：函数的参数分为按值传递和按地址传递。按值传递是将不可变的参数传递给函数，按地址传递是将可变的参数传递给函数。此处的可变参数与不可变参数是相对内存地址而言的，如果传入的是字符串、元祖、数字，是不可变对象，就是按值传递，为什么说是不可变的，例如如果将a=1这样一个变量传递给函数，那么就是说将1的内存地址传给函数，那么计算机给1分配过内存地址后就不会在变化，所以说在函数体内对a做的任何操作都不会影响函数体外a的值，来看一个例子就会比较好理解了：&lt;/p&gt;
&lt;p&gt;a =1&lt;/p&gt;
&lt;p&gt;def print_sth(s):&lt;br/&gt;s=s+1&lt;br/&gt;return s&lt;/p&gt;
&lt;p&gt;print print_sth(a)&lt;br/&gt;print a&lt;/p&gt;
&lt;p&gt;　　执行结果：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208230244109-1571135690.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　下面我们来看一下原理：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208230358171-1568692633.png&quot; alt=&quot;&quot;/&gt;这就是按值传递的原理，当函数体内对a进行加1操作，实际是指向另一个内存地址了，用id()就可以查看内存地址&lt;/p&gt;
&lt;p&gt;　　5.看了按值传递的原理，按引用传递应该就好理解了，按引用传递就是传递一些可变参数，例如list、dict等，先来看一下他们的内存地址的变化：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208230734062-724908715.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　可以看到当你在对一个list进行操作时，它指向的内存地址实际是没有变化的，所以说当传递可变参数时，函数体内对变量的操作是会影响函数体外的变量的，看一个例子就更明白了：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208230959624-1210886023.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　现在对函数的按值传递和按引用传递参数应该非常了解了吧。&lt;/p&gt;
&lt;p&gt;　　6.可变参数的表示：*args表示传入的是一个元祖，**args表示传入的是一个字典，在实际使用中当不确定要传入多少个参数时，就可以使用这种方法：&lt;/p&gt;
&lt;p&gt;　　def func(a,*args):&lt;/p&gt;
&lt;p&gt;　　　　for i in args:&lt;/p&gt;
&lt;p&gt;　　　　　　a +=i&lt;/p&gt;
&lt;p&gt;　　　　return a&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208231507077-419128949.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　你会发现，你传递几个参数都不会出问题，这就是可变参数的好处，然后看一下**args吧：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/823210/201712/823210-20171208232056484-1211491551.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;　　看完这些，你是否对函数有了很大理解，现在应该感觉函数可以实现很多你想要实现的功能吧，这可不仅仅是几个for循环就能实现的哦，赶快学学函数吧，这也是后面写好代码的基础。&lt;/p&gt;




</description>
<pubDate>Fri, 08 Dec 2017 15:26:00 +0000</pubDate>
<dc:creator>大王king</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/bettywang/p/8007482.html</dc:identifier>
</item>
<item>
<title>利用python web框架django实现py-faster-rcnn demo实例 - JiangWu</title>
<link>http://www.cnblogs.com/deeplearning1314/p/8007300.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/deeplearning1314/p/8007300.html</guid>
<description>&lt;p&gt;&lt;strong&gt;操作系统、编程环境及其他：&lt;/strong&gt; window7  cpu  python2.7  pycharm5.0  django1.8x&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;说明&lt;/strong&gt;：本blog要解决的问题是利用Python的web框架，将faster-rcnn的demo程序以网页形式展现出来，简而言之是基于B-S架构的编程，直观地以网页形式展示目标检测的功能。由于本人才疏学浅，暂时未能习得Django精髓与Python编程精髓，虽然功能实现了，但以本人的要求来看，实现还是略为粗糙的，编程基本功正在加强中。这也是我一直追求的模样，我希望成为一个兼具理论和技能的研究生。本blog不具备较强的理论性，东拼西凑的Django上传、显示图片机制，以及一些为图省事拍脑袋想出的编程小技巧，但至少本blog具备较强的实践性。理论部分待我空下来了，系统学习Django框架后另行补充。我会回头来学好Django，大概是导师某天带着我去看一个老师写的Django工程，我被密密麻麻的代码震撼了，这大抵是原因。最后，如果读者在复现实验时认为本文有疏漏不对的地方，请在博客园私信联系我改正，谢谢！&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;感谢&lt;/strong&gt;：特别感谢负责的导师，本人陋习太多，正在改正，比如拖延症、强迫症···如果不是导师一次次催我，一次次耐心地为我讲解代码、工作机制，以及上面提到的带着我求助Django编程方面比较专业的老师，我可能要花更久的时间来做好这项小任务。真诚地感谢这种督促，我会更加努力，少说话，多做事，丰富个人的学习和生活。除此之外，我还要感谢同济大学的俊杰兄，在python编程方面给了我很多指导，甚至为一个未曾谋面的我请教其师兄相关Django的问题。只记得那天完成这个小任务，我内心很有成就感，慢慢加油吧。毕竟是个小任务，不在此一一感谢那些在乎我关心我的人了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;上一篇blog被多个技术网站转载并且未署名和来源，部分评论我看不到恢复不了，如有问题交流请在博客园上评论区联系我，如果看到了我一般会回，共同提高。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不说太多废话了，切入正题！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;要完成上述提及的小任务，主要需要以下几个步骤：Django环境的搭建、弄懂Django文件上传机制、对faster rcnn demo程序的适应性修改&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在讲解前，首先看下本文任务实现的效果：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;首先启动服务器，返回一个网址： &lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;http://127.0.0.1:8000/&lt;/a&gt; 即本主机地址 （模拟网页，本机同时是服务器、后台和用户）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215605187-2128337066.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;然后，我们可以登录上面给出的地址&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215619577-1194969366.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;接着，我们输入相关内容，点击ok&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215635406-1816249665.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;等待网页返回处理后的结果（实例图片是俺美丽的女朋友）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215657874-2097608135.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我们可以看到此时的后台程序是在执行相关代码的&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215711531-678809096.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;效果看完了，接着我们开始介绍，如果想复现实验，请按本人写作顺序看懂后依次进行。&lt;/p&gt;

&lt;p&gt;一、Django环境的搭建&lt;/p&gt;
&lt;p&gt;提供一个网址： &lt;a href=&quot;https://code.ziqiangxuetang.com/django/django-tutorial.html&quot;&gt;https://code.ziqiangxuetang.com/django/django-tutorial.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;以本人Windows7系统为例看Django环境搭建2.1.2部分应该就会了，建议选Django1.8版本便于学习，这个网址的作者也是这么建议的。&lt;/p&gt;
&lt;p&gt;建议自主学习本网址Django视图与网址部分，半小时就能理解。大致能对新建Django工程、工程目录下都有什么文件、以及主要的一些文件如views.py、urls.py的作用有个清晰的理解，这些内容还是静静地看这个网址的讲解，后面我也会提及一部分，但是为避免出错不会过分提及。以下是本人安装Django的笔记，大略可以参考一下。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215746468-1657327066.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;二、本文Django工程上传文件机制&lt;/p&gt;
&lt;p&gt;参考blog链接：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/fnng/p/3740274.html&quot;&gt;http://www.cnblogs.com/fnng/p/3740274.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上述网址中是基于deepin linux 2013、python 2.7、Django 1.6.2环境来实现的，根据本人window7 Django1.8因此需要做部分修改，结合参考blog具体以下面所讲为主。&lt;/p&gt;
&lt;p&gt;（1）创建项目与应用&lt;/p&gt;
&lt;p&gt;这部分内容在”一”中所给网址中讲解的非常清楚，我的django工程地址：E:\deep learning\py-faster-rcnn-master\tools\，首先cmd模式下cd到你想放置的路径，然后输入django-admin.py startproject mysite2 创建一个名为mysite2的Django工程，接着cd到mysite2的路径   cd mysite2，在项目下创建一个disk应用   python manage.py startapp disk，这时，可以在相应位置看到新建的Django工程，以及可以看到类似于下面的Django工程目录结构。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215947015-1141841520.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208215954812-1854176482.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220005656-290381820.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（2）设计model（数据库）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220035718-1575978291.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;后面执行上传图片操作时，会将图片传至upload文件夹内。&lt;/p&gt;
&lt;p&gt;（3）数据库同步&lt;/p&gt;
&lt;p&gt;cmd模式下cd 到Django工程mysite2（第一级的mysite2）下，依次敲入以下命令（由于本人版本不同所以与上述blog中略有不同），按提示操作python manage.py  syncdb，python manage.py  makemigration，python manage.py  migrate，正常情况下，cmd窗口应该会显示以下内容：（忽略我这里设置的路径，我刚开始默认存在c盘的，为了方便工作我后来直接拷贝整个Django工程到e盘相关路径下也是能正常工作的）&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220153781-439379734.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;同时可以在mysite2中看到一些和数据库有关的文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220208468-423983593.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220218749-1097644393.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（4）创建视图函数    按下面截图要求修改views.py视图函数&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220247968-1988993390.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（5）创建模板文件&lt;/p&gt;
&lt;p&gt;先在mysite2/disk/目录下创建templates文件夹，接着在mysite2/disk/templates/目录下创建register.html 文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220313343-485466393.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220320781-1140547606.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;不用按参考blog中提到的设置模板路径，Django1.8版能够自动找到&lt;/p&gt;
&lt;p&gt;（6）设置URL&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220353843-159665431.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;（7）启动服务&lt;/p&gt;
&lt;p&gt;Cmd模式下cd到Django工程mysite2（第一级mysite2）的路径，输入命令Python manage.py  runserver  启动服务器，有可能会抛出相应错误，具体解决办法见参考blog，正常成功情况下应显示如下界面，并能上传图片到自己新建的upload文件夹。(upload文件夹需要新建，路径参考下面截图)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220428327-662513199.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220434702-1454535346.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220445218-431867047.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;至此，本文任务实现了一小部分，需要弄明白这里Django文件上传的机制。Django最主要的几个文件大概是urls.py、views.py、html、models.py文件，在这里我简要介绍一下上述代码的执行过程（读者可先不进行此步实验、文末我会给出完整的代码云盘链接）&lt;/p&gt;
&lt;p&gt;首先，我们来看urls.py文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220507249-439482762.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;重点看我标注的这一句，urls文件指明了当用户访问登录返回的网址时需要执行的函数，这句表示当用户访问&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;http://127.0.0.1:8000/&lt;/a&gt; 时要执行views.py中定义的register函数&lt;/p&gt;
&lt;p&gt;接着我们看一下html文件内容&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220524968-134723487.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;学过html一些概念的人应该能读懂这段，但是这里有句{{uf.as_p}}让人很难理解意思，uf是建立的user数据库，具体理论我说不清，但是这里是填充一些内容的，怎么知道的呢？当显示登录界面时，请在浏览器工具栏—工具----查看源代码可以看到网页信息如下，比较上下区别，就可以弄懂啦！&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220539187-136411124.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我们接下来关注views.py视图函数，这里面定义了一些Django工程中的核心函数，我们后续也是要将demo代码添加进来的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220602437-1147131675.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;在这里我主要想讲解一下这段代码的执行顺序，当我们输入网址登录网页时，这时request.method还不是post方式，所以执行的是else下的代码，返回了一个html文件，并且在原始文件中{{uf.as_p}}填充了uf的一些输入要求，比如type，这可以在上面的源文件中看到。render_to_response() 的第一个参数必须是要使用的模板名称。 如果要给定第二个参数，那么该参数必须是为该模板创建 Context 时所使用的字典。之后，当我们输入了username、选择的图片后点击OK，这时变成post方式，执行if语句，返回httpresponse对象，显示upload ok，这时文件夹upload里就会保存刚才上传的图片。至此upload的form表单方式上传文件机制介绍完了，实际上还有更简单的文件上传机制，比如文件流的方式，只是当时我没调通，所以没有细究。除此以外，将选择的图片经过demo处理后需要再在网页上显示处理结果，这里我投机取巧找到一个文件流的显示方式，具体见代码，返回了一个httpresponse对象。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220627906-1357247555.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;以上只是为了讲解Django的文件上传显示机制，具体全部代码、代码执行过程以及本人投机取巧的地方将在后面代码注解中给出。&lt;/p&gt;
&lt;p&gt;三、本文faster rcnn demo程序的适应性局部修改与关键地方讲解&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot;&gt;&lt;span&gt;现在服务器、后台能够接受到用户传来的图片，所以我们很自然的想到下一步任务就是把&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;demo&lt;/span&gt;&lt;span&gt;的关键处理代码拷贝到&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;Django&lt;/span&gt;&lt;span&gt;工程下的&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;views.py&lt;/span&gt;&lt;span&gt;文件。拷贝过来，当然需要修改一些地方，&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;faster_rcnn&lt;/span&gt;&lt;span&gt;的模块调用要理顺。首先需要将&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;E:\deep learning\py-faster-rcnn-master\tools&lt;/span&gt;&lt;span&gt;中的&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;_init_paths.py&lt;/span&gt;&lt;span&gt;文件修改成如下图，并拷贝到如下路径，主要是为了使添加上述代码后的&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;views.py&lt;/span&gt;&lt;span&gt;执行时能找到&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;faster_rcnn&lt;/span&gt;&lt;span&gt;的相关文件，为方便处理，我直接给出了相应模块、&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;py&lt;/span&gt;&lt;span&gt;文件的完整路径。其中&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;osp.join&lt;/span&gt;&lt;span&gt;函数是个拼接路径函数，路径的正确格式也是我打断点调试才知道的。&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot;&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220852062-2028243122.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220901546-1286870550.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;接下来，让我们来看最后的完整地views.py文件，具体代码关键注解部分请看文末给出的完整代码云盘链接。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220938671-1728121591.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220946765-1352602609.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208220955999-462256233.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208221005031-1600577693.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208221012327-1527406096.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208221021765-881988911.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1196287/201712/1196287-20171208221029437-1206738043.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;关于views.py，我想在这里补充一下我投机取巧的地方，一是一些关键地方，比如模型文件、图片等的路径我直接给出了完整路径，并且代码修改的很粗糙。另外，利用form表单上传图片我在后台不知道如何取相应的图片，所以我采用的方法是：由于我知道图片会保存在upload文件夹里，每�&lt;/p&gt;
</description>
<pubDate>Fri, 08 Dec 2017 14:14:00 +0000</pubDate>
<dc:creator>JiangWu</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/deeplearning1314/p/8007300.html</dc:identifier>
</item>
<item>
<title>Serverless无服务应用架构纵横谈 - windfic</title>
<link>http://www.cnblogs.com/windfic/p/7941998.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/windfic/p/7941998.html</guid>
<description>&lt;p&gt;&lt;span&gt;Serverless无服务应用架构纵横谈&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;一、Serverless是啥&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;自从互联网兴起以来，Server就成了网络的核心部件。所以围绕Server的生意圈，也发展得如火如荼。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;从最早的电信托管，到虚拟机，到现在的Serverless，形成了几大阵容：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1、IaaS（基础设施即服务：Infrastructure as a Service）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2、PaaS（平台即服务：Platform as a Service）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;3、SaaS（软件即服务：Software as a Service）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;IaaS是包硬不包软，面对集成商，PaaS是包硬包软不包工，面对开发者，SaaS是全包，面对消费者。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/569097/201712/569097-20171201133733727-522783597.jpg&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;三大阵营都在不断演进中，互相取长补短，甚至模糊了彼此的界限。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;PaaS最新的发展就是：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1、BaaS（后端即服务：Backend as a Service）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2、Faas（函数即服务：Functions as a Service）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这两种架构被称为Severless&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;BaaS与FaaS这两种架构被称为Severless，并非对开发者而言，是对服务商而言，没有一直运行的定制服务存在，不占用服务商的计算资源。&lt;/span&gt;&lt;span&gt;同共享单车有些类似，是计算机分时租赁方式，按次按时计价。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;BaaS并不存放客户代码，只提供通用的逻辑，产品的逻辑都需要在富客户端完成。&lt;/span&gt;&lt;span&gt;这些通用的逻辑为所有客户共享，因而不浪费服务商的计算资源，也就可以做到按API调用次数计算费用。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;以前叫我们把二层的富客户端都改成三层瘦客户端，现在搞个共享数据库，又叫我们改成富客户端。横竖赚钱。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/569097/201712/569097-20171201135836977-589725889.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;span&gt;而FaaS存放客户代码，当访问时，调入相关资源，开始运行，运行完成后，卸载所有开销。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;嘶~~~，听起来耳熟。靠，这不就是PHP吗？！我是不是发现了什么~~&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;二、Serverless凭啥&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;看来BaaS和FaaS都是新瓶装旧酒，那么Serverless凭啥流行，又是不是未来？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Facebook 于2013年花费了 8500 万美元收购了主流的BaaS平台 Parse 。由于 Parse 一直以来未能为 Facebook 提供预期的营收，Facebook 决定一年后将其正式关闭，并将其代码开源。Facebook这不差钱的行为，直接为整个行业蒙上了阴影。可以说直接逼死了某些跟风者。 &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;搭个共享数据库赚钱的想法基本破灭后，行业都纷纷压宝FaaS。那么FaaS的前景如何?&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;虽然FaaS是BaaS的“升级版”，并且与流行的微服务架构相吻合。但是无法改变它有强制所有程序按PHP方式运行这样一个可怕的设定。&lt;/span&gt;&lt;span&gt;而这个无奈的设定所解决的是导致先行者AppEngine举步维艰的病根，那就是大量进程占用服务商过多的资源而不怎么赚钱。&lt;/span&gt;&lt;span&gt;所以FaaS这个扭曲版AppEngine对于服务商来说是一剂良药，但是未必会是行业的未来。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;这些年随着Docker平台的发展，启停一个容器的成本已经接近于启停一个进程。将AppEngine平台上的侦听进程都去掉，用一个统一的WebServer来侦听路由，当访问到来时，启动容器，运行，停止容器。这和PHP的做法一模一样，不过是把PHP.exe换成了Docker容器罢了。&lt;/span&gt;&lt;span&gt;&lt;span&gt;同一个思路，换一个环境，马上从落后变成了先进。可以你想像，FaaS是降低成本的利器，也一定会占有一部分低端市场。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;但是，PHP也没有像FaaS一样强制要求所有服务达到函数这个级别，一步到位的确有点匪夷所思。函数也非FaaS最好的包装形式，不如像PHP直接对应到一个文件上。在我看来，现有FaaS平台的行为模式，只适合推广PHP，能够与PHP生态很好地对接，而其它语言则有不可调和的矛盾。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;看了一下开源框架Fission的源码，想出一个兼容其它语言的方案，以Python语言为例。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;要求Flask程序实现2个接口，原有的程序不加任何修改即可在FaaS框架下运行了，/register接口载入所有Route，并返回所有绑定规则，FaaS框架只需要把Route表合并就可以一次性创建所有Route。不必要一条一条调用fission function create与fission route add了。Http 请求来时调用/specialize接口，根据endpoint（即函数名）载入代码，实现FaaS功能。把框架接口开放给程序，能够实现最大的兼容现有框架，如果不放心，可以调用/specialize?endpoint=echo&amp;amp;echo=hello，来验证程序是否支持FaaS平台即可。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; flask &lt;span&gt;import&lt;/span&gt;&lt;span&gt; Flask, request

app &lt;/span&gt;= Flask(&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;)

userfunc &lt;/span&gt;=&lt;span&gt; None

@app.route(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/register&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, methods=[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;POST&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;])
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; register():
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; 引入所有Routes，并返回所有Rules&lt;/span&gt;
    &lt;span&gt;from&lt;/span&gt; .main &lt;span&gt;import&lt;/span&gt;&lt;span&gt; main as main_blueprint
    app.register_blueprint(main_blueprint) 
    
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; jsonify(app.url_map._rules_by_endpoint)
    

@app.route(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/specialize&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, methods=[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;POST&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;])
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; load():
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; 特化载入，只载入单个endpoint&lt;/span&gt;
    body =&lt;span&gt; request.get_json()
    name &lt;/span&gt;= body[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;endpoint&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
    
    &lt;/span&gt;&lt;span&gt;global&lt;/span&gt;&lt;span&gt; userfunc
    userfunc &lt;/span&gt;=&lt;span&gt; imp.load_source(name)
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;三、Serverless有啥&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Serverless平台一般分为如下三类：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;1. 公有云&lt;/span&gt;&lt;span&gt;S&lt;/span&gt;&lt;span&gt;everless&lt;/span&gt;&lt;span&gt;平台：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;A. AWS Lambda、B. Microsoft Azure Functions、&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;C. Google Cloud Functions、D. Webtask、E. Syncano&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2. 私有云Severless框架：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;A. &lt;a href=&quot;http://fission.io/&quot; target=&quot;_blank&quot;&gt;Fission&lt;/a&gt; （Kubernetes）、B. &lt;a href=&quot;https://fabric8.io/&quot; target=&quot;_blank&quot;&gt;Funktion&lt;/a&gt; （Kubernetes）、&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;C. &lt;a href=&quot;http://kubeless.io/&quot; target=&quot;_blank&quot;&gt;Kubeless&lt;/a&gt; （Kubernetes）、D. &lt;a href=&quot;http://www.galacticfog.com/&quot; target=&quot;_blank&quot;&gt;Gestalt&lt;/a&gt; （DC/OS）、&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;E. &lt;a href=&quot;http://openwhisk.incubator.apache.org/&quot; target=&quot;_blank&quot;&gt;IBM OpenWhisk&lt;/a&gt; （Docker）、F. &lt;a href=&quot;http://www.iron.io/&quot; target=&quot;_blank&quot;&gt;Iron Functions&lt;/a&gt; （Docker，Swarm， Kubernetes）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;3.Serverless平台的包装框架：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;A. &lt;a href=&quot;https://serverless.com/&quot; target=&quot;_blank&quot;&gt;Serverless&lt;/a&gt;（&lt;span&gt;Node，&lt;/span&gt;大多数平台）、B. &lt;a href=&quot;http://apex.run/&quot; target=&quot;_blank&quot;&gt;Apex&lt;/a&gt;（&lt;span&gt;Go，&lt;/span&gt;AWS）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;C. &lt;a href=&quot;https://www.zappa.io/&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Zappa&lt;/span&gt;&lt;/a&gt;&lt;span&gt;（Python，AWS）、D. &lt;/span&gt;&lt;a href=&quot;https://github.com/aws/chalice&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Chalice&lt;/span&gt;&lt;/a&gt;&lt;span&gt;（Python，AWS）&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;E. &lt;a href=&quot;https://claudiajs.com/&quot; target=&quot;_blank&quot;&gt;Claudia.js&lt;/a&gt;（&lt;span&gt;Node&lt;/span&gt;&lt;span&gt;，AWS）F. &lt;/span&gt;&lt;a href=&quot;https://github.com/jorgebastida/gordon&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Gordon&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/a&gt;&lt;span&gt;（Python，AWS）&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;四、Serverless干啥&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1、AWS Lambda的包装框架Zappa，可以使用Flask,Django等框架。功能看下图可知：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/569097/201712/569097-20171201153431789-1840570181.gif&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2、Fission是一个Serverless开源框架。可以看看它都干了啥。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Fission是基于Kubernetes的，而Kubernetes是基于Docker的容器集群管理系统。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Kubernetes的内容太丰富，简单说来，实体对象有若干节点（Node）包含若干Pod，Pod又包含若干容器（Container），通过Pod上的标签（Label）组合成服务（Service）。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;zwnr&quot;&gt;&lt;img src=&quot;https://images2018.cnblogs.com/blog/569097/201712/569097-20171203101509522-674447216.png&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;zwnr&quot; readability=&quot;13&quot;&gt;
&lt;p&gt;&lt;span&gt; Master包含如下组件：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;apiserver：&lt;/strong&gt;作为kubernetes系统的入口，封装了核心对象的增删改查操作。它维护的REST对象将持久化到etcd。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;etcd&lt;/strong&gt;：分布式强一致性的key/value存储&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;scheduler：&lt;/strong&gt;负责集群的资源调度，为新建的pod分配机器。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;controller-manager：&lt;/strong&gt;负责执行各种控制器，目前有两类：&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;endpoint-controller：&lt;/strong&gt;定期关联service和pod(关联信息由endpoint对象维护)，保证service到pod的映射总是最新的。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;replication-controller：&lt;/strong&gt;定期关联replicationController和pod，保证replicationController定义的复制数量与实际运行pod的数量总是一致的。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;Slave Node（称为Minion）包含如下组件：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;kubelet：&lt;/strong&gt;负责管控docker容器，如启动/停止、监控运行状态等。它会定期从etcd获取分配到本机的pod，并根据pod信息启动或停止相应的容器。同时，它也会接收apiserver的HTTP请求，汇报pod的运行状态。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;proxy：&lt;/strong&gt;负责为pod提供代理。它会定期从etcd获取所有的service，并根据service信息创建代理。当某个客户pod要访问其他pod时，访问请求会经过本机proxy做转发。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;docker&lt;/strong&gt;：docker容器引擎&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span&gt;Fission简单说来，就是一个Web应用，Go语言编写，使用gorilla框架。不过它的模板引擎替换成了Kubernetes中的Service。使用k8s.io/client-go/kubernetes接口来操控（k8s就是Kubernetes）。&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;zwnr&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/569097/201712/569097-20171201214824276-16617020.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/span&gt;

&lt;/div&gt;

</description>
<pubDate>Fri, 08 Dec 2017 13:16:00 +0000</pubDate>
<dc:creator>windfic</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/windfic/p/7941998.html</dc:identifier>
</item>
<item>
<title>SolrJ 复杂查询 高亮显示 - ITDragon龙</title>
<link>http://www.cnblogs.com/itdragon/p/8007144.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/itdragon/p/8007144.html</guid>
<description>&lt;p&gt;上一章搭建了Solr服务器和导入了商品数据，本章通过SolrJ去学习Solr在企业中的运用。笔者最先是通过公司的云客服系统接触的Solr，几百万的留言秒秒钟就查询并高亮显示，不同的广告员还可以只检索自己所属国家的留言。瞬间就跪拜在Solr的石榴裙下。现在看来其实就是 q + fq + lg 的用法。通过本章内容你将会学习到Solr分词配置；SolrJ的复杂查询和关键字高亮语法；Solr各版本之间SolrJ的语法差异；Solr7与Spring的整合等使用技能。&lt;/p&gt;
&lt;p&gt;需求：搜索栏输入关键字全文检索商品，选择类目或价格区间筛选商品，选择价格排序商品。&lt;br/&gt;技术：SolrJ，Spring，SpringMVC&lt;br/&gt;说明：通过本章内容你将会学习到Solr分词配置；SolrJ的复杂查询和关键字高亮语法；Solr各版本之间SolrJ的语法差异；Solr7与Spring的整合；搜索商品开发思路；本教程页面来源网络，笔者做了简单的修改，仅供学习使用。关注文章底部微信公众号领红包哦！&lt;br/&gt;源码：见文章底部&lt;br/&gt;项目结构：&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/806956/201712/806956-20171208143732140-1877938523.png&quot; alt=&quot;项目结构&quot;/&gt;&lt;/p&gt;
&lt;p&gt;效果图：&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/806956/201712/806956-20171207150652066-1482693600.png&quot; alt=&quot;效果图&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;solr分词配置&quot;&gt;Solr分词配置&lt;/h2&gt;
&lt;p&gt;solr7 安装部署：&lt;a href=&quot;http://www.cnblogs.com/itdragon/p/7995040.html&quot; class=&quot;uri&quot;&gt;http://www.cnblogs.com/itdragon/p/7995040.html&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[tomtop926@localhost lib]$ll IK*
-rw-rw-r--. 1 tomtop926 tomtop926 1165908 Dec  6 15:06 IKAnalyzer2012FF_u1.jar
[tomtop926@localhost lib]$cd ../classes/
[tomtop926@localhost classes]$ll
total 16
-rw-rw-r--. 1 tomtop926 tomtop926  168 Dec  6 15:08 ext_stopword.dic
-rw-rw-r--. 1 tomtop926 tomtop926  419 Dec  6 15:07 IKAnalyzer.cfg.xml
-rw-r--r--. 1 tomtop926 tomtop926 1421 Dec  5 12:09 log4j.properties
-rw-rw-r--. 1 tomtop926 tomtop926   12 Dec  6 15:08 mydict.dic
[tomtop926@localhost classes]$cd 
[tomtop926@localhost ~]$vim solr/apache-tomcat-8.5/solrhome/new_core/conf/managed-schema
&amp;lt;fieldType name=&quot;text_ik&quot; class=&quot;solr.TextField&quot;&amp;gt;
  &amp;lt;analyzer type=&quot;index&quot;&amp;gt;
    &amp;lt;tokenizer class=&quot;org.apache.lucene.analysis.ik.IKTokenizerFactory&quot; useSmart=&quot;true&quot;/&amp;gt;
  &amp;lt;/analyzer&amp;gt;
  &amp;lt;analyzer type=&quot;query&quot;&amp;gt;
    &amp;lt;tokenizer class=&quot;org.apache.lucene.analysis.ik.IKTokenizerFactory&quot; useSmart=&quot;true&quot;/&amp;gt;
  &amp;lt;/analyzer&amp;gt;
&amp;lt;/fieldType&amp;gt;
......
&amp;lt;field name=&quot;product_catalog&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
&amp;lt;field name=&quot;product_catalog_name&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
&amp;lt;field name=&quot;product_description&quot; type=&quot;text_ik&quot; indexed=&quot;true&quot; stored=&quot;false&quot;/&amp;gt;
&amp;lt;field name=&quot;product_name&quot; type=&quot;text_ik&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
&amp;lt;field name=&quot;product_picture&quot; type=&quot;string&quot; indexed=&quot;false&quot; stored=&quot;true&quot;/&amp;gt;
&amp;lt;field name=&quot;product_price&quot; type=&quot;pfloat&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
&amp;lt;field name=&quot;product_keywords&quot; type=&quot;text_ik&quot; multiValued=&quot;true&quot; indexed=&quot;true&quot; stored=&quot;false&quot;/&amp;gt;
&amp;lt;copyField source=&quot;product_description&quot; dest=&quot;product_keywords&quot;/&amp;gt;
&amp;lt;copyField source=&quot;product_name&quot; dest=&quot;product_keywords&quot;/&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;第一步：将IKAnalyzer2012.jar导入到tomcat/webapps/solr/WEB-INF/lib目录下&lt;br/&gt;第二步：将ext_stopword.dic（停用词词典），IKAnalyzer.cfg.xml（配置文件），mydict.dic（自定义词典） 导入到tomcat/webapps/solr/WEB-INF/classes&lt;br/&gt;第三步：编辑managed-schema 文件，配置中文分析器&lt;br/&gt;第四步：并配置业务域（solr字段），给product_description，product_name设置中文分词并放在product_keywords目标域中。下一章会重点介绍schema文件。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/806956/201712/806956-20171208203208093-121981392.png&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;solrj-单元测试&quot;&gt;SolrJ 单元测试&lt;/h2&gt;
&lt;p&gt;在采用Solr实现全文检索功能时，我们需对Solr的java客户端SolrJ语法有一定的了解。这里创建 SolrJTest.java 类测试SolrJ的连接，查询，过滤，排序，分页，高亮等功能，以及索引的维护。&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;23&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package com.itdragon.test;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;import java.io.IOException;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.ArrayList;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.HashMap;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.List;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.Map;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.SolrQuery;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.SolrQuery.ORDER;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.SolrServerException;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.impl.HttpSolrClient;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.response.QueryResponse;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.common.SolrDocument;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.common.SolrDocumentList;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.common.SolrInputDocument;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.common.params.MapSolrParams;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.junit.Test;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt; SolrJTest {
    
    &lt;span class=&quot;co&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * 不同Solr 版本之间创建连接方式不同&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * Solr4 ： SolrServer solrServer = new HttpSolrServer(&quot;http://localhost:8080/solr&quot;);  &lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * Solr5 ：HttpSolrClient solrClient = new HttpSolrClient(&quot;http://localhost:8080/solr/new_core&quot;);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * Solr7 ：HttpSolrClient solrClient = new HttpSolrClient.Builder(&quot;http://localhost:8080/solr/new_core&quot;).build();&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * &lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * SolrQuery 对应的api接口&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * q : setQuery&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * fq : addFilterQuery&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * sort : setSort&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * start : setStart(0);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * rows : setRows(10);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * fl : setFields&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     * &lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;     */&lt;/span&gt;
    
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;static&lt;/span&gt; String BASE_SOLR_URL = &lt;span class=&quot;st&quot;&gt;&quot;http://localhost:8080/solr/new_core&quot;&lt;/span&gt;;
    
    &lt;span class=&quot;co&quot;&gt;// solrJ 基础用法&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;queryDocumentBasic&lt;/span&gt;() &lt;span class=&quot;kw&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;co&quot;&gt;// 创建连接&lt;/span&gt;
        HttpSolrClient solrClient = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; HttpSolrClient.&lt;span class=&quot;fu&quot;&gt;Builder&lt;/span&gt;(BASE_SOLR_URL).&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;();
        
        &lt;span class=&quot;co&quot;&gt;/* 不推荐&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        Map&amp;lt;String, String&amp;gt; queryParamMap = new HashMap&amp;lt;String, String&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        // 封装查询参数&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        queryParamMap.put(&quot;q&quot;, &quot;*:*&quot;);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        // 添加到SolrParams对象&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        MapSolrParams query = new MapSolrParams(queryParamMap);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        */&lt;/span&gt;
        
        &lt;span class=&quot;co&quot;&gt;// 设置查询条件&lt;/span&gt;
        SolrQuery query = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;SolrQuery&lt;/span&gt;();
        query.&lt;span class=&quot;fu&quot;&gt;setQuery&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;*:*&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 执行查询&lt;/span&gt;
        QueryResponse response = solrClient.&lt;span class=&quot;fu&quot;&gt;query&lt;/span&gt;(query);
        &lt;span class=&quot;co&quot;&gt;// 获取doc文档&lt;/span&gt;
        SolrDocumentList documents = response.&lt;span class=&quot;fu&quot;&gt;getResults&lt;/span&gt;();
        System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;共查询到记录：&quot;&lt;/span&gt; + documents.&lt;span class=&quot;fu&quot;&gt;getNumFound&lt;/span&gt;());
        &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; (SolrDocument solrDocument : documents) {
            System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;ID : &quot;&lt;/span&gt; + solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;) + &lt;span class=&quot;st&quot;&gt;&quot; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; Name : &quot;&lt;/span&gt; + solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;));
        }
    }
    
    &lt;span class=&quot;co&quot;&gt;// solrJ 的复杂查询&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;queryDocument&lt;/span&gt;() &lt;span class=&quot;kw&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;co&quot;&gt;// 创建连接&lt;/span&gt;
        HttpSolrClient solrClient = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; HttpSolrClient.&lt;span class=&quot;fu&quot;&gt;Builder&lt;/span&gt;(BASE_SOLR_URL).&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;();
        SolrQuery query = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;SolrQuery&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;// 设置查询条件&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setQuery&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name:街头原木电话亭&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 设置分页信息&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setStart&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;setRows&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 设置排序&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setSort&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;, ORDER.&lt;span class=&quot;fu&quot;&gt;desc&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 设置显示的Field的域集合,即设置那些值有返回值&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setFields&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id,product_name&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 设置默认域&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;df&quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&quot;product_keywords&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 设置高亮信息&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setHighlight&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;addHighlightField&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;setHighlightSimplePre&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;&amp;lt;em&amp;gt;&quot;&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;setHighlightSimplePost&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;&amp;lt;/em&amp;gt;&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 执行查询&lt;/span&gt;
        QueryResponse response = solrClient.&lt;span class=&quot;fu&quot;&gt;query&lt;/span&gt;(query);
        &lt;span class=&quot;co&quot;&gt;// 获取doc文档&lt;/span&gt;
        SolrDocumentList documents = response.&lt;span class=&quot;fu&quot;&gt;getResults&lt;/span&gt;();
        System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;共查询到记录：&quot;&lt;/span&gt; + documents.&lt;span class=&quot;fu&quot;&gt;getNumFound&lt;/span&gt;());
        &lt;span class=&quot;co&quot;&gt;// 获取高亮显示信息&lt;/span&gt;
        Map&amp;lt;String, Map&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&amp;gt; highlighting = response.&lt;span class=&quot;fu&quot;&gt;getHighlighting&lt;/span&gt;();
        &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; (SolrDocument doc : documents) {
            System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(doc.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;));
            List&amp;lt;String&amp;gt; hightDocs = highlighting.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(doc.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;)).&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;);
            &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (hightDocs != &lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt;)
                System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;高亮显示的商品名称：&quot;&lt;/span&gt; + hightDocs.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;));
            &lt;span class=&quot;kw&quot;&gt;else&lt;/span&gt; {
                System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(doc.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;));
            }
        }
    }
    
    &lt;span class=&quot;co&quot;&gt;// 添加索引&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;addDocuments&lt;/span&gt;() &lt;span class=&quot;kw&quot;&gt;throws&lt;/span&gt; SolrServerException, IOException {
        HttpSolrClient solrClient = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; HttpSolrClient.&lt;span class=&quot;fu&quot;&gt;Builder&lt;/span&gt;(BASE_SOLR_URL).&lt;span class=&quot;fu&quot;&gt;withConnectionTimeout&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;10000&lt;/span&gt;)
                .&lt;span class=&quot;fu&quot;&gt;withSocketTimeout&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;60000&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;// 创建一个文档对象&lt;/span&gt;
        SolrInputDocument document = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;SolrInputDocument&lt;/span&gt;();
        document.&lt;span class=&quot;fu&quot;&gt;addField&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&quot;add-001&quot;&lt;/span&gt;);
        document.&lt;span class=&quot;fu&quot;&gt;addField&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&quot;ITDragon-Solr7系列博客&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 将文档对象写入到索引库中&lt;/span&gt;
        solrClient.&lt;span class=&quot;fu&quot;&gt;add&lt;/span&gt;(document);
        &lt;span class=&quot;co&quot;&gt;// 提交&lt;/span&gt;
        solrClient.&lt;span class=&quot;fu&quot;&gt;commit&lt;/span&gt;();
    }
    
    &lt;span class=&quot;co&quot;&gt;// 更新的逻辑：先通过id将直接的数据删掉，然后再创建，所以update 和 create 是同一代码&lt;/span&gt;
    
    &lt;span class=&quot;co&quot;&gt;// 删除/批量删除索引&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;deleteDocument&lt;/span&gt;() &lt;span class=&quot;kw&quot;&gt;throws&lt;/span&gt; SolrServerException, IOException {
        HttpSolrClient solrClient = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; HttpSolrClient.&lt;span class=&quot;fu&quot;&gt;Builder&lt;/span&gt;(BASE_SOLR_URL).&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;//solrClient.deleteById(&quot;add-001&quot;); 通过id删除&lt;/span&gt;
        &lt;span class=&quot;co&quot;&gt;/* 批量删除&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        ArrayList&amp;lt;String&amp;gt; ids = new ArrayList&amp;lt;String&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        ids.add(&quot;1&quot;);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        ids.add(&quot;2&quot;);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        solrClient.deleteById(ids);&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;        */&lt;/span&gt;
        solrClient.&lt;span class=&quot;fu&quot;&gt;deleteByQuery&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id:add-001&quot;&lt;/span&gt;); &lt;span class=&quot;co&quot;&gt;// 通过查询条件删除&lt;/span&gt;
        solrClient.&lt;span class=&quot;fu&quot;&gt;commit&lt;/span&gt;();
    }
    
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;solrj-web项目&quot;&gt;SolrJ Web项目&lt;/h2&gt;
&lt;h3 id=&quot;项目构建思路&quot;&gt;项目构建思路&lt;/h3&gt;
&lt;p&gt;单元测试通过后，说明核心技术已经掌握，现在开始搭建web项目实现需求。通过Maven 搭建MVC web项目。&lt;br/&gt;第一步：导入SolrJ的jar包，新增用于方便管理 Spring整合Solr的 xml文件。&lt;br/&gt;第二步：创建商品Product实体类。为了方便前端分页显示，将查询的商品实体类集合，查询的商品总数，总页数，当前页封装到实体类SearchProductResult中。&lt;br/&gt;第三步：为了方便管理SolrJ核心方法。创建SolrSearchDao接口，并实现查询接口，传入的参数是SolrQuery，不添加任何业务逻辑。&lt;br/&gt;第四步：创建用于处理业务的ProductService接口，并实现高可用查询接口。负责拼接查询条件实现业务逻辑。&lt;br/&gt;第五步：为了提高ProductService 查询接口的可用性，新增枚举类FilterQueryKey，管理复杂查询的key。&lt;br/&gt;第六步：Controller层新增ProductController类，负责接收，返回参数并跳转页面。&lt;br/&gt;第七步：页面展示，通过c:forEach 遍历查询结果，fmt:formatNumber格式化价格，以及负责查询的form表单。&lt;/p&gt;
&lt;h3 id=&quot;配置文件&quot;&gt;配置文件&lt;/h3&gt;
&lt;p&gt;Maven 项目核心文件 pom.xml ，导入solrj jar，Solr7对应的SolrJ版本是 7.1.0&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;8&quot;&gt;
&lt;pre class=&quot;sourceCode xml&quot;&gt;
&lt;code class=&quot;sourceCode xml&quot;&gt;&lt;span class=&quot;kw&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.solr&lt;span class=&quot;kw&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;solr-solrj&lt;span class=&quot;kw&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;7.1.0&lt;span class=&quot;kw&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Spring 整合Solr 配置文件 applicationContext-solr.xml&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode xml&quot;&gt;
&lt;code class=&quot;sourceCode xml&quot;&gt;&lt;span class=&quot;kw&quot;&gt;&amp;lt;?xml&lt;/span&gt; version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;&lt;span class=&quot;kw&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;&amp;lt;beans&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; xmlns=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.springframework.org/schema/beans&quot;&lt;/span&gt;
&lt;span class=&quot;ot&quot;&gt;    xmlns:context=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.springframework.org/schema/context&quot;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; xmlns:p=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.springframework.org/schema/p&quot;&lt;/span&gt;
&lt;span class=&quot;ot&quot;&gt;    xmlns:aop=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.springframework.org/schema/aop&quot;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; xmlns:tx=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.springframework.org/schema/tx&quot;&lt;/span&gt;
&lt;span class=&quot;ot&quot;&gt;    xmlns:xsi=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;
&lt;span class=&quot;ot&quot;&gt;    xsi:schemaLocation=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd&lt;/span&gt;
&lt;span class=&quot;st&quot;&gt;    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&lt;/span&gt;
&lt;span class=&quot;st&quot;&gt;    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd&lt;/span&gt;
&lt;span class=&quot;st&quot;&gt;    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;co&quot;&gt;&amp;lt;!-- 配置SolrServer对象 --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;co&quot;&gt;&amp;lt;!-- 单机版 --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;&amp;lt;bean&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; id=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;httpSolrClient&quot;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; class=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;org.apache.solr.client.solrj.impl.HttpSolrClient&quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;kw&quot;&gt;&amp;lt;constructor-arg&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; name=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;builder&quot;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; value=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;${SOLR.SERVER.URL}&quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
     
    &lt;span class=&quot;kw&quot;&gt;&amp;lt;bean&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; id=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;solrSearchDaoImpl&quot;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt; class=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;com.itdragon.solr.service.impl.SolrSearchDaoImpl&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;&amp;lt;/beans&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;资源文件 resource.properties&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;SOLR.SERVER.URL=http://localhost:8080/solr/new_core&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;实体类&quot;&gt;实体类&lt;/h3&gt;
&lt;p&gt;这里有三个文件，一个是商品类 Product.java ，一个是返回参数封装类 SearchProductResult.java ，一个是管理查询key的枚举类FilterQueryKey.java&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;11&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package com.itdragon.mapper.pojo;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.beans.Field;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt; Product {
    
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; String id;              &lt;span class=&quot;co&quot;&gt;// 商品编号&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; String name;            &lt;span class=&quot;co&quot;&gt;// 商品名称&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; String catalog_name;    &lt;span class=&quot;co&quot;&gt;// 商品分类名称&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; Float price;            &lt;span class=&quot;co&quot;&gt;// 价格&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; Long number;            &lt;span class=&quot;co&quot;&gt;// 数量&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; String picture;         &lt;span class=&quot;co&quot;&gt;//图片名称&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;@Field&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; String description;     &lt;span class=&quot;co&quot;&gt;// 商品描述&lt;/span&gt;

    &lt;span class=&quot;co&quot;&gt;// get,set 方法省略&lt;/span&gt;

}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;import java.util.List;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt; SearchProductResult {

    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; List&amp;lt;Product&amp;gt; productList;  &lt;span class=&quot;co&quot;&gt;// 商品列表&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; Long recordCount;   &lt;span class=&quot;co&quot;&gt;// 商品总数&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; Integer pageCount;  &lt;span class=&quot;co&quot;&gt;// 总页数&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; Integer curPage;    &lt;span class=&quot;co&quot;&gt;// 当前页&lt;/span&gt;

    &lt;span class=&quot;co&quot;&gt;// get,set 方法省略&lt;/span&gt;

}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;12&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package com.itdragon.mapper.pojo;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;enum&lt;/span&gt; FilterQueryKey {
    
    &lt;span class=&quot;fu&quot;&gt;PRICE&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;price&quot;&lt;/span&gt;), &lt;span class=&quot;co&quot;&gt;// 价格&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;CATALOG_NAME&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;catalog_name&quot;&lt;/span&gt;), &lt;span class=&quot;co&quot;&gt;// 类目名&lt;/span&gt;
    &lt;span class=&quot;fu&quot;&gt;SORT&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt;); &lt;span class=&quot;co&quot;&gt;// 价格排序&lt;/span&gt;
    
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; String value;

    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;FilterQueryKey&lt;/span&gt;(String value) {
        &lt;span class=&quot;kw&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt; = value;
    }

    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;() {
        &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; value;
    }

    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;static&lt;/span&gt; FilterQueryKey &lt;span class=&quot;fu&quot;&gt;fromValue&lt;/span&gt;(String v) {
        &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; (FilterQueryKey c: FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;values&lt;/span&gt;()) {
            &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (c.&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;equals&lt;/span&gt;(v)) {
                &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; c;
            }
        }
        &lt;span class=&quot;kw&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; IllegalArgumentException(v);
    }

}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;dao-层&quot;&gt;Dao 层&lt;/h3&gt;
&lt;p&gt;提供了SolrJ的查询接口及其实现类 SolrSearchDaoImpl.java ，这里不要有任何业务相关的代码。这里需要注意关键词高亮显示。在Solr管理页面分析高亮返回的机构，以方便获取对应的值。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/806956/201712/806956-20171208203514671-1833561617.png&quot; alt=&quot;高亮的结构&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;12&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package com.itdragon.solr.service.impl;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;import java.util.ArrayList;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.List;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.Map;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.commons.collections.CollectionUtils;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.SolrQuery;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.impl.HttpSolrClient;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.response.QueryResponse;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.common.SolrDocument;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.common.SolrDocumentList;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.beans.factory.annotation.Autowired;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.mapper.pojo.Product;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.mapper.pojo.SearchProductResult;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.solr.service.SolrSearchDao;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt; SolrSearchDaoImpl &lt;span class=&quot;kw&quot;&gt;implements&lt;/span&gt; SolrSearchDao {
    
    &lt;span class=&quot;fu&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; HttpSolrClient httpSolrClient;

    &lt;span class=&quot;fu&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; SearchProductResult &lt;span class=&quot;fu&quot;&gt;search&lt;/span&gt;(SolrQuery query) &lt;span class=&quot;kw&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;co&quot;&gt;// 返回值对象&lt;/span&gt;
        SearchProductResult result = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;SearchProductResult&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;// 根据查询条件查询索引库&lt;/span&gt;
        System.&lt;span class=&quot;fu&quot;&gt;out&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;println&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;solr Query : &quot;&lt;/span&gt; + query);
        QueryResponse queryResponse = httpSolrClient.&lt;span class=&quot;fu&quot;&gt;query&lt;/span&gt;(query);
        &lt;span class=&quot;co&quot;&gt;// 获取查询结果&lt;/span&gt;
        SolrDocumentList solrDocumentList = queryResponse.&lt;span class=&quot;fu&quot;&gt;getResults&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;// 获取查询结果总数量&lt;/span&gt;
        result.&lt;span class=&quot;fu&quot;&gt;setRecordCount&lt;/span&gt;(solrDocumentList.&lt;span class=&quot;fu&quot;&gt;getNumFound&lt;/span&gt;());
        &lt;span class=&quot;co&quot;&gt;// 初始化返回结果商品列表&lt;/span&gt;
        List&amp;lt;Product&amp;gt; products = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
        &lt;span class=&quot;co&quot;&gt;// 获取高亮显示数据&lt;/span&gt;
        Map&amp;lt;String, Map&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&amp;gt; highlighting = queryResponse.&lt;span class=&quot;fu&quot;&gt;getHighlighting&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;// 遍历查询结果&lt;/span&gt;
        &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; (SolrDocument solrDocument : solrDocumentList) {
            Product product = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;Product&lt;/span&gt;();
            product.&lt;span class=&quot;fu&quot;&gt;setId&lt;/span&gt;((String) solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;));
            &lt;span class=&quot;co&quot;&gt;// 获取高亮显示的集合&lt;/span&gt;
            List&amp;lt;String&amp;gt; hightNames = highlighting.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;id&quot;&lt;/span&gt;)).&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;);
            String pName = CollectionUtils.&lt;span class=&quot;fu&quot;&gt;isNotEmpty&lt;/span&gt;(hightNames)? hightNames.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) : (String) solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;);
            product.&lt;span class=&quot;fu&quot;&gt;setName&lt;/span&gt;(pName);
            product.&lt;span class=&quot;fu&quot;&gt;setPicture&lt;/span&gt;((String) solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_picture&quot;&lt;/span&gt;));
            product.&lt;span class=&quot;fu&quot;&gt;setPrice&lt;/span&gt;((&lt;span class=&quot;dt&quot;&gt;float&lt;/span&gt;) solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_price&quot;&lt;/span&gt;));
            product.&lt;span class=&quot;fu&quot;&gt;setCatalog_name&lt;/span&gt;((String) solrDocument.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_category_name&quot;&lt;/span&gt;));
            products.&lt;span class=&quot;fu&quot;&gt;add&lt;/span&gt;(product);
        }
        result.&lt;span class=&quot;fu&quot;&gt;setProductList&lt;/span&gt;(products);
        &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; result;
    }

}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;service-层&quot;&gt;Service 层&lt;/h3&gt;
&lt;p&gt;提供了根据业务需求逻辑查询商品的接口及其实现类 ProductServiceImpl.java&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;16&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package com.itdragon.service.impl;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;import java.util.Map;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.commons.lang3.StringUtils;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.SolrQuery;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.apache.solr.client.solrj.SolrQuery.ORDER;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.beans.factory.annotation.Autowired;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.stereotype.Service;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.mapper.pojo.FilterQueryKey;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.mapper.pojo.SearchProductResult;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.service.ProductService;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.solr.service.SolrSearchDao;&lt;/span&gt;

&lt;span class=&quot;fu&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt; ProductServiceImpl &lt;span class=&quot;kw&quot;&gt;implements&lt;/span&gt; ProductService {
    
    &lt;span class=&quot;fu&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; SolrSearchDao solrSearchDao;

    &lt;span class=&quot;fu&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; SearchProductResult &lt;span class=&quot;fu&quot;&gt;search&lt;/span&gt;(String queryString, Map&amp;lt;String, String&amp;gt; filterQueryMap, Integer page, Integer rows) &lt;span class=&quot;kw&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;co&quot;&gt;// 创建查询对象&lt;/span&gt;
        SolrQuery query = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;SolrQuery&lt;/span&gt;();
        &lt;span class=&quot;co&quot;&gt;// 设置查询条件&lt;/span&gt;
        queryString = StringUtils.&lt;span class=&quot;fu&quot;&gt;isEmpty&lt;/span&gt;(queryString)? &lt;span class=&quot;st&quot;&gt;&quot;*:*&quot;&lt;/span&gt; : queryString;
        query.&lt;span class=&quot;fu&quot;&gt;setQuery&lt;/span&gt;(queryString);
        &lt;span class=&quot;co&quot;&gt;// 设置复杂查询条件&lt;/span&gt;
        &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt; != filterQueryMap.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;CATALOG_NAME&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;())) {
            query.&lt;span class=&quot;fu&quot;&gt;addFilterQuery&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_catalog_name:&quot;&lt;/span&gt; + filterQueryMap.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;CATALOG_NAME&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;()));
        }
        &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt; != filterQueryMap.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;PRICE&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;())) {
            String price = filterQueryMap.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;PRICE&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;());
            query.&lt;span class=&quot;fu&quot;&gt;addFilterQuery&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_price:[&quot;&lt;/span&gt; + price.&lt;span class=&quot;fu&quot;&gt;split&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;-&quot;&lt;/span&gt;)[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;] + &lt;span class=&quot;st&quot;&gt;&quot; TO &quot;&lt;/span&gt; + price.&lt;span class=&quot;fu&quot;&gt;split&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;-&quot;&lt;/span&gt;)[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] + &lt;span class=&quot;st&quot;&gt;&quot;]&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt; != filterQueryMap.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;SORT&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;())) {
            String priceSort = filterQueryMap.&lt;span class=&quot;fu&quot;&gt;get&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;SORT&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;());
            query.&lt;span class=&quot;fu&quot;&gt;setSort&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_price&quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&quot;1&quot;&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;equals&lt;/span&gt;(priceSort) ? ORDER.&lt;span class=&quot;fu&quot;&gt;desc&lt;/span&gt; : ORDER.&lt;span class=&quot;fu&quot;&gt;asc&lt;/span&gt;);
        }
        &lt;span class=&quot;co&quot;&gt;// 设置分页&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setStart&lt;/span&gt;((page - &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) * rows); &lt;span class=&quot;co&quot;&gt;// 当前页面开始下标&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setRows&lt;/span&gt;(rows);
        &lt;span class=&quot;co&quot;&gt;// 设置默认搜素域&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;df&quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&quot;product_keywords&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 设置高亮显示&lt;/span&gt;
        query.&lt;span class=&quot;fu&quot;&gt;setHighlight&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;true&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;addHighlightField&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;product_name&quot;&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;setHighlightSimplePre&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;&amp;lt;em style=&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;color:red&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;gt;&quot;&lt;/span&gt;);
        query.&lt;span class=&quot;fu&quot;&gt;setHighlightSimplePost&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;&amp;lt;/em&amp;gt;&quot;&lt;/span&gt;);
        &lt;span class=&quot;co&quot;&gt;// 执行查询&lt;/span&gt;
        SearchProductResult searchResult = solrSearchDao.&lt;span class=&quot;fu&quot;&gt;search&lt;/span&gt;(query);
        &lt;span class=&quot;co&quot;&gt;// 计算查询结果总页数&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;long&lt;/span&gt; recordCount = searchResult.&lt;span class=&quot;fu&quot;&gt;getRecordCount&lt;/span&gt;();
        &lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; pageCount = (&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt;) (recordCount % rows &amp;gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;? (recordCount / rows) + &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt; : (recordCount / rows));
        searchResult.&lt;span class=&quot;fu&quot;&gt;setPageCount&lt;/span&gt;(pageCount);
        searchResult.&lt;span class=&quot;fu&quot;&gt;setCurPage&lt;/span&gt;(page);
        
        &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; searchResult;
    }

}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;controller-层&quot;&gt;Controller 层&lt;/h3&gt;
&lt;p&gt;实现主页初始化和检索功能&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package com.itdragon.controller;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;import java.util.HashMap;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import java.util.Map;&lt;/span&gt;

&lt;span class=&quot;kw&quot;&gt;import org.apache.commons.lang3.StringUtils;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.beans.factory.annotation.Autowired;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.stereotype.Controller;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.ui.Model;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.web.bind.annotation.RequestMapping;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import org.springframework.web.bind.annotation.RequestParam;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.mapper.pojo.FilterQueryKey;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.mapper.pojo.SearchProductResult;&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;import com.itdragon.service.ProductService;&lt;/span&gt;

&lt;span class=&quot;fu&quot;&gt;@Controller&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt; ProductController {
    
    &lt;span class=&quot;fu&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kw&quot;&gt;private&lt;/span&gt; ProductService searchService;
    
    &lt;span class=&quot;fu&quot;&gt;@RequestMapping&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;/&quot;&lt;/span&gt;)
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;fu&quot;&gt;showIndex&lt;/span&gt;(Model model) {
        SearchProductResult searchResult;
        &lt;span class=&quot;kw&quot;&gt;try&lt;/span&gt; {
            searchResult = searchService.&lt;span class=&quot;fu&quot;&gt;search&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;*:*&quot;&lt;/span&gt;, &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;(), &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;12&lt;/span&gt;);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;result&quot;&lt;/span&gt;, searchResult);
        } &lt;span class=&quot;kw&quot;&gt;catch&lt;/span&gt; (Exception e) {
            e.&lt;span class=&quot;fu&quot;&gt;printStackTrace&lt;/span&gt;();
        }
        &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&quot;index&quot;&lt;/span&gt;;
    }
    
    &lt;span class=&quot;fu&quot;&gt;@RequestMapping&lt;/span&gt;(value=&lt;span class=&quot;st&quot;&gt;&quot;/query&quot;&lt;/span&gt;)
    &lt;span class=&quot;kw&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;fu&quot;&gt;search&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;@RequestParam&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;queryString&quot;&lt;/span&gt;)String query, 
            &lt;span class=&quot;fu&quot;&gt;@RequestParam&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;catalog_name&quot;&lt;/span&gt;) String catalog_name, 
            &lt;span class=&quot;fu&quot;&gt;@RequestParam&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;price&quot;&lt;/span&gt;) String price,
            &lt;span class=&quot;fu&quot;&gt;@RequestParam&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt;) String sort,
            &lt;span class=&quot;fu&quot;&gt;@RequestParam&lt;/span&gt;(defaultValue=&lt;span class=&quot;st&quot;&gt;&quot;1&quot;&lt;/span&gt;)Integer page, 
            &lt;span class=&quot;fu&quot;&gt;@RequestParam&lt;/span&gt;(defaultValue=&lt;span class=&quot;st&quot;&gt;&quot;12&quot;&lt;/span&gt;)Integer rows, Model model) {
        SearchProductResult searchResult = &lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;kw&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;co&quot;&gt;// 拼接复杂的查询语句&lt;/span&gt;
            Map&amp;lt;String, String&amp;gt; filterQueryMap = &lt;span class=&quot;kw&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
            &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (StringUtils.&lt;span class=&quot;fu&quot;&gt;isNotBlank&lt;/span&gt;(catalog_name)) {
                filterQueryMap.&lt;span class=&quot;fu&quot;&gt;put&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;CATALOG_NAME&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;(), catalog_name);
            }
            &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (StringUtils.&lt;span class=&quot;fu&quot;&gt;isNotBlank&lt;/span&gt;(price)) {
                filterQueryMap.&lt;span class=&quot;fu&quot;&gt;put&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;PRICE&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;(), price);
            }
            &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (StringUtils.&lt;span class=&quot;fu&quot;&gt;isNotBlank&lt;/span&gt;(sort)) {
                filterQueryMap.&lt;span class=&quot;fu&quot;&gt;put&lt;/span&gt;(FilterQueryKey.&lt;span class=&quot;fu&quot;&gt;SORT&lt;/span&gt;.&lt;span class=&quot;fu&quot;&gt;getValue&lt;/span&gt;(), sort);
            }
            searchResult = searchService.&lt;span class=&quot;fu&quot;&gt;search&lt;/span&gt;(query, filterQueryMap, page, rows);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;result&quot;&lt;/span&gt;, searchResult);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;queryString&quot;&lt;/span&gt;, query);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;catalog_name&quot;&lt;/span&gt;, catalog_name);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;price&quot;&lt;/span&gt;, price);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt;, sort);
            model.&lt;span class=&quot;fu&quot;&gt;addAttribute&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;page&quot;&lt;/span&gt;, page);
        } &lt;span class=&quot;kw&quot;&gt;catch&lt;/span&gt; (Exception e) {
            e.&lt;span class=&quot;fu&quot;&gt;printStackTrace&lt;/span&gt;();
        }
        &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&quot;index&quot;&lt;/span&gt;; 
    }

}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;view-层&quot;&gt;View 层&lt;/h3&gt;
&lt;p&gt;实现点击搜索框进行查询，点击类目筛选查询，点击价格区间查询，点击价格排序，查询结果回显，分页的功能。&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;20&quot;&gt;
&lt;pre class=&quot;sourceCode java&quot;&gt;
&lt;code class=&quot;sourceCode java&quot;&gt;&amp;lt;%@ page language=&lt;span class=&quot;st&quot;&gt;&quot;java&quot;&lt;/span&gt; contentType=&lt;span class=&quot;st&quot;&gt;&quot;text/html; charset=UTF-8&quot;&lt;/span&gt; pageEncoding=&lt;span class=&quot;st&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;%&amp;gt;
&amp;lt;%@ taglib prefix=&lt;span class=&quot;st&quot;&gt;&quot;c&quot;&lt;/span&gt; uri=&lt;span class=&quot;st&quot;&gt;&quot;http://java.sun.com/jsp/jstl/core&quot;&lt;/span&gt;%&amp;gt;
&amp;lt;%@ taglib prefix=&lt;span class=&quot;st&quot;&gt;&quot;fmt&quot;&lt;/span&gt; uri=&lt;span class=&quot;st&quot;&gt;&quot;http://java.sun.com/jsp/jstl/fmt&quot;&lt;/span&gt; %&amp;gt;
......省略
&amp;lt;script type=&lt;span class=&quot;st&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;
    &lt;span class=&quot;co&quot;&gt;// 关键字查询&lt;/span&gt;
    function &lt;span class=&quot;fu&quot;&gt;query&lt;/span&gt;() {
        &lt;span class=&quot;co&quot;&gt;//执行关键词查询时清空过滤条件&lt;/span&gt;
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;catalog_name&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;&quot;&lt;/span&gt;;
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;price&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;&quot;&lt;/span&gt;;
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;page&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;&quot;&lt;/span&gt;;
        &lt;span class=&quot;fu&quot;&gt;queryList&lt;/span&gt;();
    }
    &lt;span class=&quot;co&quot;&gt;// 表单提交&lt;/span&gt;
    function &lt;span class=&quot;fu&quot;&gt;queryList&lt;/span&gt;() {
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;actionForm&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;submit&lt;/span&gt;();
    }
    &lt;span class=&quot;co&quot;&gt;// 特殊值查询&lt;/span&gt;
    function &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(key, value) {
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(key).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;=value;
        &lt;span class=&quot;fu&quot;&gt;queryList&lt;/span&gt;();
    }
    &lt;span class=&quot;co&quot;&gt;// 排序&lt;/span&gt;
    function &lt;span class=&quot;fu&quot;&gt;sort&lt;/span&gt;() {
        var s = document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;;
        &lt;span class=&quot;kw&quot;&gt;if&lt;/span&gt; (s != &lt;span class=&quot;st&quot;&gt;&quot;1&quot;&lt;/span&gt;) {
            s = &lt;span class=&quot;st&quot;&gt;&quot;1&quot;&lt;/span&gt;;
        } &lt;span class=&quot;kw&quot;&gt;else&lt;/span&gt; {
            s = &lt;span class=&quot;st&quot;&gt;&quot;0&quot;&lt;/span&gt;;
        }
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt; = s;
        &lt;span class=&quot;fu&quot;&gt;queryList&lt;/span&gt;();
    }
    &lt;span class=&quot;co&quot;&gt;// 翻页&lt;/span&gt;
    function &lt;span class=&quot;fu&quot;&gt;changePage&lt;/span&gt;(p) {
        var curpage = Number(document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;page&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt;);
        curpage = curpage + p;
        document.&lt;span class=&quot;fu&quot;&gt;getElementById&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&quot;page&quot;&lt;/span&gt;).&lt;span class=&quot;fu&quot;&gt;value&lt;/span&gt; = curpage;
        &lt;span class=&quot;fu&quot;&gt;queryList&lt;/span&gt;();
    }
&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;root61&quot;&lt;/span&gt;&amp;gt;
......省略
&amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;o-header-2013&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;w&quot;&lt;/span&gt; id=&lt;span class=&quot;st&quot;&gt;&quot;header-2013&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;logo-2013&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;ld&quot;&lt;/span&gt;&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;#&quot;&lt;/span&gt; hidefocus=&lt;span class=&quot;st&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&amp;lt;b&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;img src=&lt;span class=&quot;st&quot;&gt;&quot;&quot;&lt;/span&gt; width=&lt;span class=&quot;st&quot;&gt;&quot;270&quot;&lt;/span&gt; height=&lt;span class=&quot;st&quot;&gt;&quot;60&quot;&lt;/span&gt; alt=&lt;span class=&quot;st&quot;&gt;&quot;Logo&quot;&lt;/span&gt;&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
        &amp;lt;!--logo end--&amp;gt;
        &amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;search-2013&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;i-search ld&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;ul id=&lt;span class=&quot;st&quot;&gt;&quot;shelper&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;hide&quot;&lt;/span&gt;&amp;gt;&amp;lt;/ul&amp;gt;
                &amp;lt;form id=&lt;span class=&quot;st&quot;&gt;&quot;actionForm&quot;&lt;/span&gt; action=&lt;span class=&quot;st&quot;&gt;&quot;/query&quot;&lt;/span&gt; method=&lt;span class=&quot;st&quot;&gt;&quot;POST&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;form&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;input type=&lt;span class=&quot;st&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;text&quot;&lt;/span&gt; accesskey=&lt;span class=&quot;st&quot;&gt;&quot;s&quot;&lt;/span&gt; name=&lt;span class=&quot;st&quot;&gt;&quot;queryString&quot;&lt;/span&gt; id=&lt;span class=&quot;st&quot;&gt;&quot;key&quot;&lt;/span&gt; value=&lt;span class=&quot;st&quot;&gt;&quot;${queryString}&quot;&lt;/span&gt;
                        autocomplete=&lt;span class=&quot;st&quot;&gt;&quot;off&quot;&lt;/span&gt; onkeydown=&lt;span class=&quot;st&quot;&gt;&quot;javascript:if(event.keyCode==13) {query()}&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;input type=&lt;span class=&quot;st&quot;&gt;&quot;button&quot;&lt;/span&gt; value=&lt;span class=&quot;st&quot;&gt;&quot;搜索&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;button&quot;&lt;/span&gt; onclick=&lt;span class=&quot;st&quot;&gt;&quot;query()&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;/div&amp;gt;
                &amp;lt;input type=&lt;span class=&quot;st&quot;&gt;&quot;hidden&quot;&lt;/span&gt; name=&lt;span class=&quot;st&quot;&gt;&quot;catalog_name&quot;&lt;/span&gt; id=&lt;span class=&quot;st&quot;&gt;&quot;catalog_name&quot;&lt;/span&gt; value=&lt;span class=&quot;st&quot;&gt;&quot;${catalog_name}&quot;&lt;/span&gt;/&amp;gt; 
                &amp;lt;input type=&lt;span class=&quot;st&quot;&gt;&quot;hidden&quot;&lt;/span&gt; name=&lt;span class=&quot;st&quot;&gt;&quot;price&quot;&lt;/span&gt; id=&lt;span class=&quot;st&quot;&gt;&quot;price&quot;&lt;/span&gt; value=&lt;span class=&quot;st&quot;&gt;&quot;${price}&quot;&lt;/span&gt;/&amp;gt; 
                &amp;lt;input type=&lt;span class=&quot;st&quot;&gt;&quot;hidden&quot;&lt;/span&gt; name=&lt;span class=&quot;st&quot;&gt;&quot;page&quot;&lt;/span&gt; id=&lt;span class=&quot;st&quot;&gt;&quot;page&quot;&lt;/span&gt; value=&lt;span class=&quot;st&quot;&gt;&quot;${result.curPage}&quot;&lt;/span&gt;/&amp;gt; 
                &amp;lt;input type=&lt;span class=&quot;st&quot;&gt;&quot;hidden&quot;&lt;/span&gt; name=&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt; id=&lt;span class=&quot;st&quot;&gt;&quot;sort&quot;&lt;/span&gt; value=&lt;span class=&quot;st&quot;&gt;&quot;${sort}&quot;&lt;/span&gt;/&amp;gt; 
                &amp;lt;/form&amp;gt;
            &amp;lt;/div&amp;gt;
            &amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;hotwords&quot;&lt;/span&gt;&amp;gt;&amp;lt;/div&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;!--search end--&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;!--header end--&amp;gt;
    ......省略
&amp;lt;/div&amp;gt;
&amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;w&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;breadcrumb&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;strong&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;服饰内衣&amp;lt;/a&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;span&amp;gt;&amp;amp;nbsp;&amp;amp;gt;&amp;amp;nbsp;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;女装&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;amp;gt;&amp;amp;nbsp;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;T恤&amp;lt;/a&amp;gt;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;w main&quot;&lt;/span&gt;&amp;gt;
&amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;right-extra&quot;&lt;/span&gt;&amp;gt;
&amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;select&quot;&lt;/span&gt; clstag=&lt;span class=&quot;st&quot;&gt;&quot;thirdtype|keycount|thirdtype|select&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;m&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;mt&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;h1&amp;gt;T恤 -&amp;lt;strong&amp;gt;&amp;amp;nbsp;商品筛选&amp;lt;/strong&amp;gt;&amp;lt;/h1&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;!-- 类目查询和价格区间查询 --&amp;gt;
    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;mc attrs&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;div data-id=&lt;span class=&quot;st&quot;&gt;&quot;100001&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;brand-attr&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;attr&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;a-key&quot;&lt;/span&gt;&amp;gt;商品类别：&amp;lt;/div&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;a-values&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;v-tabs&quot;&lt;/span&gt;&amp;gt;
                        &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;tabcon&quot;&lt;/span&gt;&amp;gt;
                            &amp;lt;div&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('catalog_name', '幽默杂货')&quot;&lt;/span&gt;&amp;gt;幽默杂货&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
                            &amp;lt;div&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('catalog_name', '时尚卫浴')&quot;&lt;/span&gt;&amp;gt;时尚卫浴&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
                            &amp;lt;div&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('catalog_name', '另类文体')&quot;&lt;/span&gt;&amp;gt;另类文体&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
                            &amp;lt;div&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('catalog_name', '创意相架')&quot;&lt;/span&gt;&amp;gt;创意相架&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
                            &amp;lt;div&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('catalog_name', '巧妙收纳')&quot;&lt;/span&gt;&amp;gt;巧妙收纳&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;
                        &amp;lt;/div&amp;gt;
                    &amp;lt;/div&amp;gt;
                &amp;lt;/div&amp;gt;
            &amp;lt;/div&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div data-id=&lt;span class=&quot;st&quot;&gt;&quot;100002&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;prop-attrs&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;attr&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;a-key&quot;&lt;/span&gt;&amp;gt;价格：&amp;lt;/div&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;a-values&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;v-fold&quot;&lt;/span&gt;&amp;gt;
                        &amp;lt;ul &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;f-list&quot;&lt;/span&gt;&amp;gt;
                            &amp;lt;li&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('price','0-9')&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;dv&quot;&gt;0-9&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
                            &amp;lt;li&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('price','10-29')&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;dv&quot;&gt;10-29&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
                            &amp;lt;li&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('price','30-49')&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;dv&quot;&gt;30-49&lt;/span&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
                            &amp;lt;li&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:filter('price','50-*')&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;dv&quot;&gt;50&lt;/span&gt;以上&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
                        &amp;lt;/ul&amp;gt;
                    &amp;lt;/div&amp;gt;
                &amp;lt;/div&amp;gt;
            &amp;lt;/div&amp;gt;
        &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;!-- 价格排序，分页 --&amp;gt;
&amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;filter&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;cls&quot;&lt;/span&gt;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;fore1&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;dl &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;order&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;dt&amp;gt;排序：&amp;lt;/dt&amp;gt;
            &amp;lt;dd&amp;gt;&amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:sort()&quot;&lt;/span&gt;&amp;gt;价格&amp;lt;/a&amp;gt;&amp;lt;b&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/dd&amp;gt;
        &amp;lt;/dl&amp;gt;
        &amp;lt;dl &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;activity&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;dd&amp;gt;&amp;lt;/dd&amp;gt;
        &amp;lt;/dl&amp;gt;
        &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;pagin pagin-m&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;span &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;text&quot;&lt;/span&gt;&amp;gt;&amp;lt;i&amp;gt;${result.&lt;span class=&quot;fu&quot;&gt;curPage&lt;/span&gt; }&amp;lt;/i&amp;gt;/${result.&lt;span class=&quot;fu&quot;&gt;pageCount&lt;/span&gt; }&amp;lt;/span&amp;gt;
            &amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:changePage(-1)&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;prev&quot;&lt;/span&gt;&amp;gt;上一页&amp;lt;b&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/a&amp;gt;
            &amp;lt;a href=&lt;span class=&quot;st&quot;&gt;&quot;javascript:changePage(1)&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;next&quot;&lt;/span&gt;&amp;gt;下一页&amp;lt;b&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/a&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;total&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;span&amp;gt;共&amp;lt;strong&amp;gt;${result.&lt;span class=&quot;fu&quot;&gt;recordCount&lt;/span&gt; }&amp;lt;/strong&amp;gt;个商品
            &amp;lt;/span&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;span &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;clr&quot;&lt;/span&gt;&amp;gt;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;!--核心代码，商品列表开始--&amp;gt;
&amp;lt;div id=&lt;span class=&quot;st&quot;&gt;&quot;plist&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;m plist-n7 plist-n8 prebuy&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;ul &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;list-h&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;c:forEach var=&lt;span class=&quot;st&quot;&gt;&quot;item&quot;&lt;/span&gt; items=&lt;span class=&quot;st&quot;&gt;&quot;${result.productList }&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;li pid=&lt;span class=&quot;st&quot;&gt;&quot;${item.id }&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;lh-wrap&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;p-img&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;a target=&lt;span class=&quot;st&quot;&gt;&quot;_blank&quot;&lt;/span&gt; href=&lt;span class=&quot;st&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;
                        &amp;lt;img width=&lt;span class=&quot;st&quot;&gt;&quot;220&quot;&lt;/span&gt; height=&lt;span class=&quot;st&quot;&gt;&quot;282&quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;err-product&quot;&lt;/span&gt; src=&lt;span class=&quot;st&quot;&gt;&quot;/images/${item.picture}&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;/a&amp;gt;
                &amp;lt;/div&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;p-name&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;a target=&lt;span class=&quot;st&quot;&gt;&quot;_blank&quot;&lt;/span&gt; href=&lt;span class=&quot;st&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;${item.&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt; }&amp;lt;/a&amp;gt;
                &amp;lt;/div&amp;gt;
                &amp;lt;div &lt;span class=&quot;kw&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;st&quot;&gt;&quot;p-price&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;strong&amp;gt;￥&amp;lt;fmt:formatNumber value=&lt;span class=&quot;st&quot;&gt;&quot;${item.price}&quot;&lt;/span&gt; maxFractionDigits=&lt;span class=&quot;st&quot;&gt;&quot;2&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;/div&amp;gt;
            &amp;lt;/div&amp;gt;
        &amp;lt;/li&amp;gt;
        &amp;lt;/c:forEach&amp;gt;
    &amp;lt;/ul&amp;gt;
&amp;lt;/div&amp;gt;
......省略
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;Solr的中文分词器，虽然已经停更了，但是免费。&lt;/li&gt;
&lt;li&gt;SolrJ连接solr全文检索服务器，实现查询，拦截，排序，分页，高亮等功能。&lt;/li&gt;
&lt;li&gt;Spring整合SolrJ实现电商商品页面检索，筛选，分页功能。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;源码：&lt;a href=&quot;https://github.com/ITDragonBlog/daydayup/tree/master/Solr/ssm-solr&quot; class=&quot;uri&quot;&gt;https://github.com/ITDragonBlog/daydayup/tree/master/Solr/ssm-solr&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;到这里SolrJ 复杂查询 高亮显示就结束了。有什么不对的地方请指出，最后感谢阅读！如果觉得文章不错，麻烦点一下&quot;推荐&quot;&lt;/p&gt;
</description>
<pubDate>Fri, 08 Dec 2017 13:08:00 +0000</pubDate>
<dc:creator>ITDragon龙</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/itdragon/p/8007144.html</dc:identifier>
</item>
<item>
<title>自动微分方法(auto diff) - Wanna_Go</title>
<link>http://www.cnblogs.com/wxshi/p/8007106.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/wxshi/p/8007106.html</guid>
<description>&lt;p&gt;学习机器学习的同学在学习过程中会经常遇到一个问题，那就是对目标函数进行求微分，线性回归这类简单的就不说、复杂的如神经网络类那些求导过程的&lt;code&gt;酸爽&lt;/code&gt;。像我还是那种比较粗心的人往往有十&lt;code&gt;导&lt;/code&gt;九错，所以说自动求导就十分有必要了，本文主要介绍几种求导的方式。假设我们的函数为&lt;span class=&quot;math inline&quot;&gt;\(f(x,y)=x^2y+y+2\)&lt;/span&gt;，目标是求出偏导&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{x}}\)&lt;/span&gt;和&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{y}}\)&lt;/span&gt;。求导的方式主要分为以下几种&lt;/p&gt;
&lt;h3 id=&quot;手动求导法manual-differentiation&quot;&gt;手动求导法(Manual Differentiation)&lt;/h3&gt;
&lt;p&gt;首先准备一张纸和一支笔，根据上学时候学到的求导法则，开始计算。最终得到的结果&lt;br/&gt;&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{x}}=2xy\)&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{y}}=x^2+1\)&lt;/span&gt;&lt;br/&gt;上面这个小例子比较简单，口算即可得到答案，但如果方程比较复杂那就难说了。幸好有自动求导的方法，例如符号求导方法。&lt;/p&gt;
&lt;h3 id=&quot;符号求解法symbolic-differentiation&quot;&gt;符号求解法(Symbolic Differentiation)&lt;/h3&gt;
&lt;p&gt;符号求导是根据一些求导法则，进行求导。例如我们大学高数学习的&lt;span class=&quot;math inline&quot;&gt;\((uv)\prime=u'v+v'u\)&lt;/span&gt;，&lt;span class=&quot;math inline&quot;&gt;\((u+v)'=u'+v'\)&lt;/span&gt;，&lt;span class=&quot;math inline&quot;&gt;\((\frac{u}{v})'=\frac{u'v-v'u}{v^2}\)&lt;/span&gt;等等，下图是&lt;span class=&quot;math inline&quot;&gt;\(g(x,y)=5+xy\)&lt;/span&gt;的符号求导工作流程。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/702365/201712/702365-20171208205536296-10021585.png&quot;/&gt;&lt;br/&gt;原公式在图的左边，求导公式在图的右半部分，求导的过程是先求叶子节点，自下向上。最终对节点进行见之得到求导结果&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{g}}{\partial{x}}=y\)&lt;/span&gt;，这个例子固然简单，但是对于一个更复杂的公式，那么求导符号图将会十分的庞大(表达式膨胀)，另外对于一些变化的公式（&lt;code&gt;硬代码&lt;/code&gt;）这种方法就无能为力了：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def fun(a,b):
    z=0
    for i in range(100):
        z = a * np.cos(z + i) + z * np.sin(b - i)
    return z&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;数值求导法numerical-differentiation&quot;&gt;数值求导法(Numerical Differentiation)&lt;/h3&gt;
&lt;p&gt;导数的定义是当自变量的增量趋于零时，因变量的增量与自变量的增量之商的极限。&lt;/p&gt;
&lt;p&gt;其中&lt;span class=&quot;math inline&quot;&gt;\(\varepsilon\)&lt;/span&gt;是一个无穷小的数，所以我们可以计算在x=3,y=4这一点对x的偏导数，&lt;span class=&quot;math inline&quot;&gt;\(f'(x=3,y)=\frac{f(3+\varepsilon,4)-f(3,4)}{\varepsilon}\)&lt;/span&gt;，对应的代码如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def f(x, y):
    return x**2*y + y + 2 
def derivative(f, x, y, x_eps, y_eps):
    return (f(x + x_eps, y + y_eps) - f(x, y)) / (x_eps + y_eps) 
df_dx = derivative(f, 3, 4, 0.00001, 0)
df_dy = derivative(f, 3, 4, 0, 0.00001) 
&amp;gt;&amp;gt;print(df_dx) 
24.000039999805264 
&amp;gt;&amp;gt;print(df_dy)  
10.000000000331966 &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;通过上面的结果我们发现，得出的结果不是十分的精确，并且在对x和y求偏导的整个过程中，至少需要计算3次&lt;span class=&quot;math inline&quot;&gt;\(f()\)&lt;/span&gt;，也就是说如果有1000个参数，那么至少需要计算1001次&lt;span class=&quot;math inline&quot;&gt;\(f()\)&lt;/span&gt;，在神经网络中，参数巨多，这样计算效率会比较差。不过这种方法常被用到进行检验得到的求导结果是否正确。&lt;/p&gt;
&lt;h3 id=&quot;前向自动求导法forward-mode-autodiff&quot;&gt;前向自动求导法(Forward-Mode Autodiff)&lt;/h3&gt;
&lt;p&gt;前向求导是依赖于数值求导和符号求导的一种求解方法，给定公式&lt;span class=&quot;math inline&quot;&gt;\(a+{\varepsilon}b\)&lt;/span&gt;，这种被称作&lt;code&gt;dual number&lt;/code&gt;,其中&lt;code&gt;a&lt;/code&gt;和&lt;code&gt;b&lt;/code&gt;是实数，&lt;span class=&quot;math inline&quot;&gt;\(\varepsilon\)&lt;/span&gt;是一个无穷小的数，并且&lt;span class=&quot;math inline&quot;&gt;\({\varepsilon}^2=0\)&lt;/span&gt;，举个栗子，&lt;span class=&quot;math inline&quot;&gt;\(42 + 24\varepsilon\)&lt;/span&gt;，我们可以把它看成&lt;code&gt;42.00000000...24&lt;/code&gt;的数值.我们可以通过这种方法&lt;code&gt;(42.0,24.0)&lt;/code&gt;来表示，dual number满足以下的运算法则：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1.&lt;span class=&quot;math inline&quot;&gt;\(\lambda(a+b\varepsilon) = a\varepsilon + b{\lambda}\varepsilon\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;2.&lt;span class=&quot;math inline&quot;&gt;\((a+b\varepsilon)+(c+d\varepsilon) = (a+c)+(b+d)\varepsilon\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;3.&lt;span class=&quot;math inline&quot;&gt;\((a+b\varepsilon)\times(c+d\varepsilon) = ac+(ad+bc)\varepsilon+(bd){\varepsilon}^2=ac+(ad+bc)\varepsilon\)&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;还有一点就是&lt;span class=&quot;math inline&quot;&gt;\(h(a+b\varepsilon)=h(a)+b{\times}h'(a)\varepsilon\)&lt;/span&gt;。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/702365/201712/702365-20171208205401046-1701261197.png&quot;/&gt;&lt;br/&gt;上图给出了使用前向求导方法计算出&lt;span class=&quot;math inline&quot;&gt;\(f(x,y)\)&lt;/span&gt;在x=3，y=4这一点&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{x}}(3,4)\)&lt;/span&gt;的偏导，同理求出&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{y}}(3,4)\)&lt;/span&gt;,图中的思路很清晰就不赘述。前向求导方法相对数值求导来说准确率较高，当和数值求导方法一样如果参数过多的时候效率会比较差，因为这种方法需要遍历整个图。&lt;/p&gt;
&lt;h3 id=&quot;逆向自动求导法reverse-mode-atuodiff&quot;&gt;逆向自动求导法(Reverse-Mode Atuodiff)&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;TensorFlow&lt;/code&gt;采用的是逆向自动求导方法，该方法首先正向遍历整个图，计算出每个节点的值；然后逆向(从上到下)遍历整个图，计算出节点的偏导值，步骤如下图所示；节点内蓝色的数值表示正向计算出的结果，为了方便表达，我们从下到上，从左到右依次标注为&lt;span class=&quot;math inline&quot;&gt;\(n_1\)&lt;/span&gt;到&lt;span class=&quot;math inline&quot;&gt;\(n_7\)&lt;/span&gt;，可以看到最后的值&lt;span class=&quot;math inline&quot;&gt;\(n_7\)&lt;/span&gt;(顶部节点)为42。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/702365/201712/702365-20171208205424249-73510226.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;在逆向求导过程中使用链式求导方法：&lt;br/&gt;&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{x}}=\frac{\partial{f}}{\partial{n_i}}{\times}\frac{\partial{n_i}}{\partial{x}}\)&lt;/span&gt;&lt;br/&gt;先看节点&lt;span class=&quot;math inline&quot;&gt;\(n_7\)&lt;/span&gt;，作为输出节点&lt;span class=&quot;math inline&quot;&gt;\(f=n_7\)&lt;/span&gt;，所以导数值为&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{n_7}}=1\)&lt;/span&gt;,&lt;br/&gt;接着向下计算&lt;span class=&quot;math inline&quot;&gt;\(n_5\)&lt;/span&gt;，&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{n_5}}=\frac{\partial{f}}{\partial{n_7}}{\times}\frac{\partial{n_7}}{\partial{n_5}}\)&lt;/span&gt;，上一步计算出&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{n_7}}=1\)&lt;/span&gt;，现在我们只需要计算&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{n_7}}{\partial{n_5}}\)&lt;/span&gt;，从图中我们知道&lt;span class=&quot;math inline&quot;&gt;\(n_7=n_5+n_6\)&lt;/span&gt;，可以得出&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{x}}=1\)&lt;/span&gt;。所以&lt;span class=&quot;math inline&quot;&gt;\(\frac{\partial{f}}{\partial{n_5}}=1\)&lt;/span&gt;，接下来的步骤可以看上面的图，这里就不赘述了。&lt;br/&gt;逆向自动求导法这种方法十分强大且准确率较高，尤其是有却多的输入。这种发方法仅需要正向和逆向遍历一次即可，这种方法更强大的地方在于能够解决&lt;code&gt;符号求解法&lt;/code&gt;中&lt;code&gt;硬代码&lt;/code&gt;的问题。&lt;/p&gt;
</description>
<pubDate>Fri, 08 Dec 2017 12:55:00 +0000</pubDate>
<dc:creator>Wanna_Go</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/wxshi/p/8007106.html</dc:identifier>
</item>
<item>
<title>移动端经常出现的兼容问题 - 空一座旧城，守一个旧人</title>
<link>http://www.cnblogs.com/yinxingen/p/8006995.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/yinxingen/p/8006995.html</guid>
<description>&lt;h2 id=&quot;移动端-经常出现的兼容问题&quot;&gt;移动端 经常出现的兼容问题&lt;/h2&gt;
&lt;h3 id=&quot;安卓浏览器看背景图片有些设备会模糊&quot;&gt;1.安卓浏览器看背景图片，有些设备会模糊&lt;/h3&gt;
&lt;p&gt;因为手机分辨率太小，如果按照分辨率来显示网页，字会非常小，安卓手机devicePixoRadio比较乱，有1.5的，有2的也有3的。想让图片在手机里显示更为清晰，必须使用2x的背景图来代替img标签（一般情况下都是2倍的），或者指定background-size:contain;都可以&lt;/p&gt;
&lt;h3 id=&quot;防止手机中页面放大和缩小&quot;&gt;2.防止手机中页面放大和缩小&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;11&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;meta name&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;viewport&quot;&lt;/span&gt; content&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0&quot;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;上下拉动滚动条时卡顿慢&quot;&gt;3.上下拉动滚动条时卡顿、慢&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;
body&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;overflow&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;scrolling&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;touch&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
    overflow&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;scrolling&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;touch&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Android3+和iOSi5+支持CSS3的新属性为overflow-scrolling&lt;/p&gt;
&lt;h3 id=&quot;长时间按住页面出现闪退&quot;&gt;4.长时间按住页面出现闪退&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;element&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;touch&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;callout&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;none&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;iphone及ipad下输入框默认内阴影&quot;&gt;5.iphone及ipad下输入框默认内阴影&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;element&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;appearance&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;none&lt;span class=&quot;op&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;ios和android下触摸元素时出现半透明灰色遮罩&quot;&gt;6.ios和android下触摸元素时出现半透明灰色遮罩&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;element&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;tap&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;highlight&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;rgba&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;设置alpha值为0就可以去除本透明灰色遮罩，备注：transparent的属性值在android下无效。&lt;/p&gt;
&lt;h3 id=&quot;active兼容处理-即-伪类active失效&quot;&gt;7.active兼容处理 即 伪类：active失效&lt;/h3&gt;
&lt;p&gt;方法一：body添加ontouchstart&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;body ontouchstart&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;方法二：js给document绑定touchstart或touchend事件&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;style&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;
a&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;dt&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;#&lt;span class=&quot;dv&quot;&gt;000&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
a&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;active&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;dt&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;#fff&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;/style&amp;gt;&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;lt;a href=foo&amp;gt;bar&amp;lt;/a&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;va&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;addEventListentener&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'touchstart'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;{},&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;false&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
)
&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;px边框&quot;&gt;8.1px边框&lt;/h3&gt;
&lt;p&gt;在移动端中，如果给元素设置一个像素的边框的话，那么在手机上看起来是会比一个像素粗的。&lt;/p&gt;
&lt;p&gt;解决方法：使用伪类元素模拟边框，使用transform缩放&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;8&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;    .&lt;span class=&quot;at&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;::&lt;/span&gt;after&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; block&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;%;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; 1px&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; #&lt;span class=&quot;dv&quot;&gt;333&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; absolute&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;bottom&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;scaleY&lt;/span&gt;(&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;)
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;webkit-mask兼容处理&quot;&gt;9.webkit mask兼容处理&lt;/h3&gt;
&lt;p&gt;某些低端手机不支持css3mask，可以选择性的进降级处理&lt;br/&gt;比如可以使用js判断来引用不同class：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;8&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'WebkitMask'&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;documnet&lt;/span&gt;.&lt;span class=&quot;va&quot;&gt;documentElement&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;style&lt;/span&gt;)&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;at&quot;&gt;alert&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'支持 mask'&lt;/span&gt;)
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;at&quot;&gt;alert&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'不支持 mask'&lt;/span&gt;)
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;旋转屏幕是字体大小调整的问题&quot;&gt;10.旋转屏幕是，字体大小调整的问题&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;18&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;html&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;body&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;form&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;fieldset&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;p&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;div&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h1&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h2&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h3&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h4&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h5&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;h6&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;text&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;size&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;adjust&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;%;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;transiton闪屏&quot;&gt;11.transiton闪屏&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;9&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;co&quot;&gt;//设置内联的元素在3D空间如何呈现：保留3D&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;transform&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;style&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;preserve&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;3D&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;//设置进行转换的元素的背面在面对用户时是否课件：隐藏&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;webkit&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;backface&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;visibility&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;hidden&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;圆角bug&quot;&gt;12.圆角bug&lt;/h3&gt;
&lt;p&gt;某些Android手机圆角失效 background-clip:padding-box;&lt;/p&gt;
&lt;h3 id=&quot;click的300ms延迟问题&quot;&gt;13.click的300ms延迟问题&lt;/h3&gt;
&lt;p&gt;在移动端中，click事件是生效的，但是，点击之后会有300ms的延迟响应&lt;/p&gt;
&lt;p&gt;原因：safari是最早做出这个机制的，因为在移动端里，浏览器需要等待一段时间来判断此次用户操作是单击还是双击，所以就有click300ms的延迟机制，Android也很快就有了&lt;/p&gt;
&lt;ol readability=&quot;-1&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;不用click，用自定义事件tap&lt;/p&gt;
tap是需要自定义的：如果用户执行了touchstart在很短的时间又触发了touchend,且两次的距离很小，而且不能&lt;br/&gt;&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;引入fastclick库来解决&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;响应式图片&quot;&gt;14.响应式图片&lt;/h3&gt;
&lt;p&gt;在移动端中，图片的处理应该是很谨慎的，假设有一张图片本身的尺寸是X宽，设置和包裹它的div一样宽，如果是div宽度小于图片宽度没有问题，但是如果div宽度大于图片的宽度，图片被拉伸失真&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;解决方法：让图片最大只能是自己的宽度&lt;/code&gt;
&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;    img&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
        max&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;%;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; block&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;dt&quot;&gt;margin&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; auto&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;点透bug的产生&quot;&gt;15.点透bug的产生&lt;/h3&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;div id&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&quot;haorooms&quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;点头事件测试&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;&amp;lt;a href=&quot;www.jb51.net&quot;&amp;gt;www.jb51.net&amp;lt;/a&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;div是绝对定位的蒙层，并且z-index高于a。而a标签是页面中的一个链接，我们给div绑定tap事件：&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;8&quot;&gt;
&lt;pre class=&quot;sourceCode javascript&quot;&gt;
&lt;code class=&quot;sourceCode javascript&quot;&gt;&lt;span class=&quot;at&quot;&gt;$&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'#haorooms'&lt;/span&gt;).&lt;span class=&quot;at&quot;&gt;on&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'tap'&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;function&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;at&quot;&gt;$&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;'#haorooms'&lt;/span&gt;).&lt;span class=&quot;at&quot;&gt;hide&lt;/span&gt;()&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;)&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们点击蒙层时div正常消失，但是当我们在a标签上点击蒙层时，发现a链接被触发，这就是所谓的点透事件。&lt;/p&gt;
&lt;p&gt;原因：&lt;br/&gt;touchstart早于touchend早于click。即click的触发是由延迟的，这个时间大概在300ms左右，也就是说我们tap触发之后蒙层隐藏。此时click还没有触发，300ms之后由于蒙层隐藏，我们的click触发到了下面的a链接。&lt;/p&gt;
&lt;p&gt;解决：&lt;/p&gt;
&lt;p&gt;1.尽量都使用touch事件来替换click事件。例如用touchend事件（推荐）&lt;br/&gt;2.用fastclick&lt;br/&gt;3.用preventDefault阻止a标签的click&lt;br/&gt;4.延迟一定的事件（300ms+）来处理事件（不推荐）&lt;/p&gt;
</description>
<pubDate>Fri, 08 Dec 2017 12:17:00 +0000</pubDate>
<dc:creator>空一座旧城，守一个旧人</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/yinxingen/p/8006995.html</dc:identifier>
</item>
<item>
<title>【java提高】---HashMap解析(一) - 雨点的名字</title>
<link>http://www.cnblogs.com/qdhxhz/p/8006927.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qdhxhz/p/8006927.html</guid>
<description>&lt;h2&gt;HashMap解析(一)&lt;/h2&gt;
&lt;p&gt;        平时一直再用hashmap并没有稍微深入的去了解它，自己花点时间想往里面在深入一点，发现它比arraylist难理解很多，好多东西目前还不太能理解等以后自己知识更加丰富在过来理解。&lt;/p&gt;
&lt;p&gt;      数据结构中有数组和链表来实现对数据的存储，但这两者基本上是两个极端。&lt;/p&gt;
&lt;p&gt;    &lt;strong&gt;数组：&lt;/strong&gt;数组存储区间是连续的，占用内存严重，故空间复杂的很大。但数组的二分查找时间复杂度小，为O(1)；数组的特点是：&lt;strong&gt;寻址容易，插入和删除困难；&lt;/strong&gt;&lt;/p&gt;
&lt;p id=&quot;WizKMOutline_1383296103993559&quot;&gt;    &lt;strong&gt;链表&lt;/strong&gt;：链表存储区间离散，占用内存比较宽松，故空间复杂度很小，但时间复杂度很大，达O（N）&lt;strong&gt;。&lt;/strong&gt;链表的特点是：&lt;strong&gt;寻址困难，插入和删除容易&lt;/strong&gt;。   &lt;/p&gt;
&lt;p id=&quot;HashMap的数据结构&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;HashMap的数据结构&lt;/strong&gt;&lt;/span&gt;                                                                            &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;    &lt;/strong&gt;HashMap实际上是一个“链表散列”的数据结构，即数组和链表的结合体。看下面图；来理解：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1090617/201712/1090617-20171208190940609-1371126464.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;        从上图中可以看出，HashMap底层就是一个数组结构，只数组中的每一项又是一个链表。当新建一个HashMap的时候，就会初始化一个数组。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;transient&lt;/span&gt;&lt;span&gt; Entry[] table;
 
&lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; Entry&amp;lt;K,V&amp;gt; &lt;span&gt;implements&lt;/span&gt; Map.Entry&amp;lt;K,V&amp;gt;&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;final&lt;/span&gt;&lt;span&gt; K key;
    V value;
    Entry&lt;/span&gt;&amp;lt;K,V&amp;gt;&lt;span&gt; next;
    &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; hash;
    ……
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;       可以看出，Entry就是数组中的元素，每个 Map.Entry 其实就是一个key-value对，它持有一个指向下一个元素的引用，这就构成了链表。&lt;/p&gt;
&lt;p id=&quot;HashMap的存取实现&quot;&gt;&lt;span&gt;&lt;strong&gt;HashMap的存取实现                                                           &lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p id=&quot;存储&quot;&gt;&lt;span&gt;&lt;strong&gt;存储&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt;&lt;span&gt; V put(K key, V value) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; HashMap允许存放null键和null值。
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 当key为null时，调用putForNullKey方法，将value放置在数组第一个位置。  &lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; (key == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; putForNullKey(value);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 根据key的keyCode重新计算hash值。&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; hash =&lt;span&gt; hash(key.hashCode());
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 搜索指定hash值在对应table中的索引。&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; i =&lt;span&gt; indexFor(hash, table.length);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 如果 i 索引处的 Entry 不为 null，通过循环不断遍历 e 元素的下一个元素。&lt;/span&gt;
    &lt;span&gt;for&lt;/span&gt; (Entry&amp;lt;K,V&amp;gt; e = table[i]; e != &lt;span&gt;null&lt;/span&gt;; e =&lt;span&gt; e.next) {
        Object k;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (e.hash == hash &amp;amp;&amp;amp; ((k = e.key) == key ||&lt;span&gt; key.equals(k))) {
            V oldValue &lt;/span&gt;=&lt;span&gt; e.value;
            e.value &lt;/span&gt;=&lt;span&gt; value;
            e.recordAccess(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; oldValue;
        }
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 如果i索引处的Entry为null，表明此处还没有Entry。&lt;/span&gt;
    modCount++&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 将key、value添加到i索引处。&lt;/span&gt;
&lt;span&gt;    addEntry(hash, key, value, i);
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;        从上面的源代码中可以看出：当我们往HashMap中put元素的时候，先根据key的hashCode重新计算hash值，根据hash值得到这个元素在数组中的位置（即下标）， 如果数组该位置上已经存放有其他元素了，那么在这个位置上的元素将以链表的形式存放，新加入的放在链头，最先加入的放在链尾。如果数组该位置上没有元素，就直接将该元素放到此数组中的该位置上。&lt;/p&gt;
&lt;p&gt;ddEntry(hash, key, value, i)方法根据计算出的hash值，将key-value对放在数组table的i索引处。addEntry 是 HashMap 提供的一个包访问权限的方法，代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt;void&lt;/span&gt; addEntry(&lt;span&gt;int&lt;/span&gt; hash, K key, V value, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; bucketIndex) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 获取指定 bucketIndex 索引处的 Entry  &lt;/span&gt;
    Entry&amp;lt;K,V&amp;gt; e =&lt;span&gt; table[bucketIndex];
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 将新创建的 Entry 放入 bucketIndex 索引处，并让新的 Entry 指向原来的 Entry  &lt;/span&gt;
    table[bucketIndex] = &lt;span&gt;new&lt;/span&gt; Entry&amp;lt;K,V&amp;gt;&lt;span&gt;(hash, key, value, e);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 如果 Map 中的 key-value 对的数量超过了极限&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; (size++ &amp;gt;=&lt;span&gt; threshold)
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 把 table 对象的长度扩充到原来的2倍。&lt;/span&gt;
        resize(2 *&lt;span&gt; table.length);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;        当系统决定存储HashMap中的key-value对时，完全没有考虑Entry中的value，仅仅只是根据key来计算并决定每个Entry的存储位置。我们完全可以把 Map 集合中的 value 当成 key 的附属，当系统决定了 key 的存储位置之后，value 随之保存在那里即可。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;读取&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt;&lt;span&gt; V get(Object key) {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (key == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; getForNullKey();
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; hash =&lt;span&gt; hash(key.hashCode());
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (Entry&amp;lt;K,V&amp;gt; e =&lt;span&gt; table[indexFor(hash, table.length)];
        e &lt;/span&gt;!= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        e &lt;/span&gt;=&lt;span&gt; e.next) {
        Object k;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (e.hash == hash &amp;amp;&amp;amp; ((k = e.key) == key ||&lt;span&gt; key.equals(k)))  
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; e.value;
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;        有了上面存储时的hash算法作为基础，理解起来这段代码就很容易了。从上面的源代码中可以看出：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;        从HashMap中get元素时，首先计算key的hashCode，找到数组中对应位置的某一元素，然后通过key的equals方法在对应位置的链表中找到需要的元素。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;归纳&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;        简单地说，HashMap 在底层将 key-value 当成一个整体进行处理，这个整体就是一个 Entry 对象。HashMap 底层采用一个 Entry[] 数组来保存所有的 key-value 对，&lt;/p&gt;
&lt;p&gt;当需要存储一个 Entry 对象时，会根据hash算法来决定其在数组中的存储位置，在根据equals方法决定其在该数组位置上的链表中的存储位置；当需要取出一个Entry时，&lt;/p&gt;
&lt;p&gt;也会根据hash算法找到其在数组中的存储位置，再根据equals方法从该位置上的链表中取出该Entry。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;hashmap源码解读                                                                                      &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;       &lt;span&gt;&lt;span&gt;HashMap&lt;/span&gt;&lt;span&gt;有两个参数影响其性能：&lt;span&gt;&lt;strong&gt;&lt;span&gt;初始容量&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;和&lt;span&gt;&lt;strong&gt;加载因子&lt;/strong&gt;&lt;/span&gt;。默认初始容量是&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;&lt;span&gt;，加载因子是&lt;/span&gt;&lt;span&gt;0.75&lt;/span&gt;&lt;span&gt;。容量是哈希表中桶&lt;/span&gt;&lt;span&gt;(Entry&lt;/span&gt;&lt;span&gt;数组&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;的数量，初始容量只是哈希表在创建时的容量。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot;&gt;&lt;span&gt;&lt;span&gt;加载因子是哈希表在其容量自动增加之前可以达到多满的一种尺度。当哈希表中的条目数超出了加载因子与当前容量的乘积时，通过调用&lt;/span&gt; rehash &lt;span&gt;方法将容量翻倍。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot;&gt;&lt;span&gt;       HashMap&lt;span&gt;中定义的成员变量如下：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
 
&lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_INITIAL_CAPACITY = 16;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 默认初始容量为16，必须为2的幂  &lt;/span&gt;
  
&lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; MAXIMUM_CAPACITY = 1 &amp;lt;&amp;lt; 30;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 最大容量为2的30次方  &lt;/span&gt;
  
&lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;float&lt;/span&gt; DEFAULT_LOAD_FACTOR = 0.75f;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 默认加载因子0.75  &lt;/span&gt;
    
&lt;span&gt;transient&lt;/span&gt; Entry&amp;lt;K,V&amp;gt;[] table;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Entry数组，哈希表，长度必须为2的幂  &lt;/span&gt;
  
&lt;span&gt;transient&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; size;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 已存元素的个数  &lt;/span&gt;
  
&lt;span&gt;int&lt;/span&gt; threshold;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 下次扩容的临界值，size&amp;gt;=threshold就会扩容  &lt;/span&gt;
  
&lt;span&gt;final&lt;/span&gt; &lt;span&gt;float&lt;/span&gt; loadFactor;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 加载因子  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;HashMap一共重载了4个构造方法，分别为：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;strong&gt;&lt;a href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;HashMap&lt;/a&gt;&lt;/strong&gt;()&lt;/code&gt;&lt;br/&gt;&lt;span&gt;          构造一个具有默认初始容量 (16) 和默认加载因子 (0.75) 的空 &lt;/span&gt;&lt;tt&gt;HashMap&lt;/tt&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;strong&gt;&lt;a href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;HashMap&lt;/a&gt;&lt;/strong&gt;(int initialCapacity)&lt;/code&gt;&lt;br/&gt;&lt;span&gt;          &lt;span&gt;构造一个带指定初始容量和默认加载因子 (0.75) 的空 &lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;tt&gt;HashMap&lt;/tt&gt;&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;strong&gt;&lt;a href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;HashMap&lt;/a&gt;&lt;/strong&gt;(int initialCapacity, float loadFactor)&lt;/code&gt;&lt;br/&gt;&lt;span&gt;         &lt;span&gt; 构造一个带指定初始容量和加载因子的空 &lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;tt&gt;HashMap&lt;/tt&gt;&lt;span&gt;。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;strong&gt;&lt;a href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;HashMap&lt;/a&gt;&lt;/strong&gt;(&lt;a title=&quot;java.util 中的接口&quot; href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;Map&lt;/a&gt;&amp;lt;? extends&lt;a title=&quot;HashMap 中的类型参数&quot; href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;K&lt;/a&gt;,? extends&lt;a title=&quot;HashMap 中的类型参数&quot; href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot; target=&quot;_blank&quot;&gt;V&lt;/a&gt;&amp;gt; m)&lt;/code&gt;&lt;br/&gt;&lt;span&gt;         &lt;span&gt; 构造一个映射关系与指定 &lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;tt&gt;Map&lt;/tt&gt;&lt;span&gt; 相同的 &lt;/span&gt;&lt;tt&gt;HashMap&lt;/tt&gt;&lt;span&gt;。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;看一下第三个构造方法源码，其它构造方法最终调用的都是它。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; HashMap(&lt;span&gt;int&lt;/span&gt; initialCapacity, &lt;span&gt;float&lt;/span&gt;&lt;span&gt; loadFactor) {  
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 参数判断，不合法抛出运行时异常  &lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; (initialCapacity &amp;lt; 0&lt;span&gt;)  
        &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; IllegalArgumentException(&quot;Illegal initial capacity: &quot; +&lt;span&gt;  
                                           initialCapacity);  
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (initialCapacity &amp;gt;&lt;span&gt; MAXIMUM_CAPACITY)  
        initialCapacity &lt;/span&gt;=&lt;span&gt; MAXIMUM_CAPACITY;  
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (loadFactor &amp;lt;= 0 ||&lt;span&gt; Float.isNaN(loadFactor))  
        &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; IllegalArgumentException(&quot;Illegal load factor: &quot; +&lt;span&gt;  
                                           loadFactor);  
  
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Find a power of 2 &amp;gt;= initialCapacity  
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 这里需要注意一下  &lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; capacity = 1&lt;span&gt;;  
    &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (capacity &amp;lt;&lt;span&gt; initialCapacity)  
        capacity &lt;/span&gt;&amp;lt;&amp;lt;= 1&lt;span&gt;;  
  
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 设置加载因子  &lt;/span&gt;
    &lt;span&gt;this&lt;/span&gt;.loadFactor =&lt;span&gt; loadFactor;  
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 设置下次扩容临界值  &lt;/span&gt;
    threshold = (&lt;span&gt;int&lt;/span&gt;)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1&lt;span&gt;);  
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 初始化哈希表  &lt;/span&gt;
    table = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Entry[capacity];  
    useAltHashing &lt;/span&gt;= sun.misc.VM.isBooted() &amp;amp;&amp;amp;&lt;span&gt;  
            (capacity &lt;/span&gt;&amp;gt;=&lt;span&gt; Holder.ALTERNATIVE_HASHING_THRESHOLD);  
    init();  
}  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这篇博客就到这里为止了。&lt;/p&gt;
&lt;p&gt;        附大牛博客：&lt;a href=&quot;http://blog.csdn.net/ghsau/article/details/16843543&quot;&gt;HashMap深度解析(一)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;                             &lt;a href=&quot;http://blog.csdn.net/ghsau/article/details/16890151&quot;&gt;HashMap深度解析(二)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;                            &lt;a href=&quot;http://blog.csdn.net/jeffleo/article/details/54946424&quot; target=&quot;_blank&quot;&gt;Java容器（四）：HashMap（Java 7）的实现原理&lt;/a&gt;               &lt;/p&gt;
&lt;p&gt;                            &lt;a href=&quot;http://www.importnew.com/25049.html&quot; target=&quot;_blank&quot;&gt;图解集合 4 ：HashMap&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;水滴石穿，成功的速度一定要超过父母老去的速度！ 少尉【5】&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt; &lt;/p&gt;

</description>
<pubDate>Fri, 08 Dec 2017 11:45:00 +0000</pubDate>
<dc:creator>雨点的名字</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/qdhxhz/p/8006927.html</dc:identifier>
</item>
<item>
<title>【基础中的基础】引用类型和值类型，以及引用传递和值传递 - 自由飞</title>
<link>http://www.cnblogs.com/freeflying/p/8005959.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/freeflying/p/8005959.html</guid>
<description>&lt;p&gt;&lt;span&gt;一直在博客园怼人，非常惭愧。所以郑重决定：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;好好写一篇干货，然后再接着怼人。&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这是&lt;a href=&quot;http://17bang.ren/Problem/227&quot; target=&quot;_blank&quot;&gt;一起帮&lt;/a&gt;上&lt;a href=&quot;http://17bang.ren/User/537&quot; target=&quot;_blank&quot;&gt;陈百万&lt;/a&gt;同学的求助，讲了一会之后，我觉得很有些普世价值，干脆就发到园子来。面向小白，高手轻拍。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;我们从最简单的说起（基础知识，懂的同学直接往下拉），直接上代码：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
        static int amount;
        static void AddTV(int amount)
        {
            amount++;
            Console.WriteLine(&quot;方法中，amount=&quot;+amount);
        }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后，我们将参数amout传入AddTV()方法，希望能让其+1&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
            amount = 10;
            AddTV(amount);
            Console.WriteLine(&quot;AddTV(amount)执行之后，amount=&quot; + amount);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 那么执行的结果呢？&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208152736452-631623057.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;amount的数量并没有发生变化。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;为什么没有变呢？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这是最入门的知识，通常的解释是：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;amount是int类型，&lt;/span&gt;int是值类型，所以当它作为参数时，传递给方法的是它的一个副本（复制品），因此方法中改变的是它的副本的值，amount本身并没有改变。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;OK，这完全没有问题。而且，如果想改变的值，就需要加 &lt;span&gt;ref&lt;/span&gt; 关键字，如下所示：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
        static void AddTV(ref int amount)
        {
            amount++;
            Console.WriteLine(&quot;方法中，amount=&quot;+amount);
        }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;大家自己跑一下，看看结果有什么不一样。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这叫做参数的引用传递。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;这是最基础的知识，非常清晰。好的，&lt;span&gt;接着，C#是面向对象的语言嘛，我们要引入一个对象。&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
    public class House
    {
        public int TVAmount { get; set; }
    }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然后，我们把House对象作为参数传递，值传递，不带ref的。如下所示：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;34&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
        static void AddTV(House house)
        {
            house.TVAmount++;
            Console.WriteLine(&quot;方法中，house.TVAmount=&quot; + house.TVAmount);
        }


            House house = new House();
            AddTV(house);
            Console.WriteLine(&quot;AddTV(house)执行之后，house.TVAmount=&quot; + house.TVAmount);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;执行之后你会发现：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208153848015-198892622.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;咦？house.TVAmount的值变了耶！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;为什么呢？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;有的同学听到的解释是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;House是对象，是引用类型，引用类型作为参数传递到方法中，它的值会被方法改变。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;有些同学，哦！记住了：&lt;span&gt;值类型传进去不变，引用类型传进去要变，但值类型引用传递又要变……虽然有点绕，但死背下来也行。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;但有的同学就开始开始抛问题了：（这种同学特别值得表扬！安利一篇我的文章：&lt;a href=&quot;http://17bang.ren/Article/17&quot; target=&quot;_blank&quot;&gt;&lt;span class=&quot;text-primary&quot;&gt;讲课这些天（五）怎么才能把代码写好？&lt;/span&gt;&lt;/a&gt;）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;值类型的引用传递，和引用类型的值传递，效果都一样，那他们有什么区别呢？&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Good question！&lt;/p&gt;
&lt;p&gt;&lt;span&gt;实际上，死背上面的，是会出问题的，我还是用代码展示一下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
        static void AddTV(House house)
        {
            house = new House();
            house.TVAmount++;
            Console.WriteLine(&quot;方法中，house.TVAmount=&quot; + house.TVAmount);
        }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样写，眼尖的同学一眼就能看出差别：这一次方法体内多了一个：house = new House();&lt;/p&gt;
&lt;p&gt;不要以为这是抽风啊，实际的开发代码中，各种各样的原因，很多时候都确实会在方法体内重新new一个参数实例的。&lt;/p&gt;
&lt;p&gt;那运行结果怎么样的呢？&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208161623843-995563755.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;怎么样？！引用类型也不好使了？现在，是不是&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208161946234-2093133520.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;不像JavaScript到处都是bug和设计缺陷（是的，日常黑js一百年，&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;/&gt;），C#是一门严谨清晰的语言，不会有什么“灵异”事件。现象和你的想法不一致，一定是你的想法出了问题。&lt;/p&gt;
&lt;p&gt;所以，要真正地弄明白这里面的道道，我们还是要回到原点：&lt;/p&gt;

&lt;p&gt;&lt;span&gt;首先的首先，看看这代码，你真的明白是什么意思么：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
            House house 
                = 
                new House();
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我为什么要写成三行？&lt;/p&gt;
&lt;p&gt;因为这其实是三个过程：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;House house 这是声明了一个变量&lt;/li&gt;
&lt;li&gt;new House() 这是生成了一个对象&lt;/li&gt;
&lt;li&gt;= 把 house 和 new House() &lt;strong&gt;关联&lt;/strong&gt;起来&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;注意，注意我用的是“&lt;strong&gt;关联&lt;/strong&gt;”，很多人喜欢说“赋值”，甚至“等于”，这就容易造成我们理解上的误区。&lt;/p&gt;
&lt;p&gt;为了理解这种关联，我画了一幅图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208164010671-1730182482.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;观察这幅图，house和New House，是不同的数据储存。事实上，在house里面，有一个记录了new Houuse()存储位置的“引用”（reference，这个英文单词有助于我们理解）。所以，当我们house.TVAmount的时候，是通过house找到new House()，然后得到new House()的数据进行操作。&lt;/p&gt;
&lt;p&gt;不知道大家能不能明白这一点？&lt;/p&gt;
&lt;p&gt;作为对比，我们来看看值类型是怎么样子的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208164443718-1157787773.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;整个这一块都是int i，int i 里面就直接的存储了10这个数据，没有引用，int i里直接存放数值10，所以叫做“值类型”。&lt;/p&gt;

&lt;p&gt;好了，理解了上面的概念之后，我们回头来看方法参数。&lt;/p&gt;
&lt;p&gt;C#的说法非常的清晰，只看有没有 &lt;span&gt;ref&lt;/span&gt; 关键字：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;不带ref的，一定是“值传递”&lt;/li&gt;
&lt;li&gt;带ref的，一定是“引用传递”&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;和传递的是什么类型的参数，半毛钱关系没有。&lt;/p&gt;
&lt;p&gt;关键是，你要知道：&lt;strong&gt;当参数为引用类型时，传递的不是对象（new House()），而是对象的引用(house)&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;所以，&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;如果是值传递，传递的是 &lt;strong&gt;对象引用的&lt;/strong&gt; 副本&lt;/li&gt;
&lt;li&gt;如果是引用传递，传递的是 &lt;strong&gt;对象引用&lt;/strong&gt; 本身&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;什么叫做对象引用的副本呢？还是给一幅图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208171516765-2048117433.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; 明白了吧？作为参数的house的副本，还是指向的New House对象，所以，在方法体中使用：house.TVAmount++，最终修改的还是原来的new House()里面的值。&lt;/p&gt;

&lt;p&gt;但是，当你在方法体中：house = new House(); 你实际上就干了件啥事呢？&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208172122546-731412336.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;然后，你再：house.TVAmount++，改变的是新的House对象的值啊！（请结合英文单词 new 来理解这一点）&lt;/p&gt;
&lt;p&gt;所以，原来的 house 引用指向的对象，就根本没有发生改变。&lt;/p&gt;

&lt;p&gt;希望你仍然还保持着清醒的头脑，没有被我弄晕，O(∩_∩)O~&lt;/p&gt;
&lt;p&gt;这样我们就可以接着往下走。那假如我们既要保留方法体内的：house = new House(); 又要通过方法，改变传入对象的值，我应该怎么办呢？&lt;/p&gt;
&lt;p&gt;……&lt;/p&gt;
&lt;p&gt;干脆留作思考题吧？ o(￣┰￣*)ゞ &lt;/p&gt;
&lt;p&gt;请同学们在理解原理的基础上自己去写一写，跑一跑，仔细的体会体会。&lt;/p&gt;

&lt;p&gt;最后，为了更清晰直观的看到所谓“对象的引用”的变化，我给大家一个神器：在调试时使用一元运算符 &lt;span&gt;&lt;strong&gt;&amp;amp;&lt;/strong&gt; &lt;span&gt;来查看变量的内存地址：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208173151952-1873322523.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/49387/201712/49387-20171208173316781-1499505406.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;好了，自己折腾去吧！&lt;/p&gt;
&lt;p&gt;enjoy it。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;周末发帖，送给爱学习的同学们！&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span&gt;+++++++++++++++++++++++++++++++&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;最后，悄悄的说一句：我们的 &lt;a href=&quot;http://17bang.ren/&quot; target=&quot;_blank&quot;&gt;一起帮&lt;/a&gt; 有了好多新功能，不想去看一看？&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 08 Dec 2017 09:51:00 +0000</pubDate>
<dc:creator>自由飞</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/freeflying/p/8005959.html</dc:identifier>
</item>
</channel>
</rss>