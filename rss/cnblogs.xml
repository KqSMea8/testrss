<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>图片圆角并居中显示解决方案 - 海角在眼前</title>
<link>http://www.cnblogs.com/lovesong/p/10015829.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/lovesong/p/10015829.html</guid>
<description>&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1、图片圆角显示&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;例如（非常简单）：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HTML：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;img &lt;/span&gt;&lt;span&gt;src&lt;/span&gt;&lt;span&gt;=&quot;mao.png&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CSS：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;img&lt;/span&gt;{&lt;span&gt;
    border-radius&lt;/span&gt;:&lt;span&gt; 10px&lt;/span&gt;;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果图片只为圆角，这种方式确实没问题，但如果还要加上居中的效果，这种方式就有问题，下面会说明。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2、图片居中显示（铺满父容器且不变形）&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;效果图如下：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/555379/201811/555379-20181125151507555-2039278657.png&quot; alt=&quot;&quot; width=&quot;350px;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;PS：为了实现上图居中的效果，单靠CSS是不行的，还需要JS处理。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;例如：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HTML：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;rd-box&quot;&lt;/span&gt;&lt;span&gt; style&lt;/span&gt;&lt;span&gt;=&quot;width:200px;height:200px;overflow:hidden;&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;    &amp;lt;&lt;/span&gt;&lt;span&gt;img &lt;/span&gt;&lt;span&gt;src&lt;/span&gt;&lt;span&gt;=&quot;mao.png&quot;&lt;/span&gt;&lt;span&gt; onload&lt;/span&gt;&lt;span&gt;=&quot;centerThisImg(this, 200, 200)&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CSS：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;.rd-box&lt;/span&gt;{&lt;span&gt;
    position&lt;/span&gt;:&lt;span&gt; relative&lt;/span&gt;;&lt;span&gt;
    display&lt;/span&gt;:&lt;span&gt; inline-block&lt;/span&gt;;&lt;span&gt;
    border-radius&lt;/span&gt;:&lt;span&gt; 10px&lt;/span&gt;;
}&lt;span&gt;
.rd-box img&lt;/span&gt;{&lt;span&gt;
    display&lt;/span&gt;:&lt;span&gt; block&lt;/span&gt;;&lt;span&gt;
    border-radius&lt;/span&gt;:&lt;span&gt; 10px&lt;/span&gt;;   
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;JS：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt;图片自适应填充，并居中显示。&lt;/span&gt;
&lt;span&gt;function&lt;/span&gt;&lt;span&gt; centerThisImg(el, maxWidth, maxHeight){
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; $img =&lt;span&gt; $(el),
        img &lt;/span&gt;= $img[0&lt;span&gt;];
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; imgHeight =&lt;span&gt; img.naturalHeight,
        imgWidth &lt;/span&gt;=&lt;span&gt; img.naturalWidth,
        finalWidth,
        finalHeight,
        tsffix &lt;/span&gt;= ''&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; rm = maxWidth /&lt;span&gt; maxHeight,
        r &lt;/span&gt;= imgWidth /&lt;span&gt; imgHeight;

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(r &amp;lt;&lt;span&gt; rm){
        finalWidth &lt;/span&gt;=&lt;span&gt; maxWidth;
        finalHeight &lt;/span&gt;= maxWidth /&lt;span&gt; r;
        tsffix &lt;/span&gt;= 'translateY(-' + (finalHeight - maxHeight) / 2 + 'px)'&lt;span&gt;;
    } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
        finalHeight &lt;/span&gt;=&lt;span&gt; maxHeight;
        finalWidth &lt;/span&gt;= maxHeight *&lt;span&gt; r;
        tsffix &lt;/span&gt;= 'translateX(-' + (finalWidth - maxWidth) / 2 + 'px)'&lt;span&gt;;
    }
    $img.css({width: finalWidth, height: finalHeight, transform: tsffix});
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;PS：&lt;span&gt;图片的长宽是不定的，为了让图片不变形的铺满父容器，需要重新计算图片长宽，并计算居中需要位移的距离。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;从这一点就可以看到我说的问题，在CSS中我是加上圆角的样式，但实际上却没有圆角效果。&lt;/p&gt;
&lt;p&gt;这是因为当我们把图片居中（不变形）时，我们看到的现在居中的四角，其实是图片中间部位，真正图片的四角早在不可见的地方。&lt;/p&gt;
&lt;p&gt;所以，想让居中的图片再有圆角效果，得另外想办法。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3、遮挡法模拟出圆角&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;我们可以用四个内凹三角形，遮挡在图片四角上（居中后的），让人误以为是图片圆角了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;例如（结合居中的完整代码）：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;&lt;img id=&quot;code_img_closed_c6a05aac-7223-4ec4-8cb4-acc502dfa7e9&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_c6a05aac-7223-4ec4-8cb4-acc502dfa7e9&quot; class=&quot;code_img_opened&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_c6a05aac-7223-4ec4-8cb4-acc502dfa7e9&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;83&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;!&lt;/span&gt;&lt;span&gt;DOCTYPE html&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;html&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;head &lt;/span&gt;&lt;span&gt;lang&lt;/span&gt;&lt;span&gt;=&quot;en&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;meta &lt;/span&gt;&lt;span&gt;charset&lt;/span&gt;&lt;span&gt;=&quot;UTF-8&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;title&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;正方形居中显示并且圆角&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;title&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;style&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;span&gt;
        img&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            height&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 200px&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        label&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            display&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; block&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            position&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; relative&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            display&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; inline-block&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2 img&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            display&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; block&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2 .left-top,
        .rd-box2 .right-top,
        .rd-box2 .left-bottom,
        .rd-box2 .right-bottom&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            position&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; absolute&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            width&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 10px&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            height&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 10px&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            z-index&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 1&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2 .left-top&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            top&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            left&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            background&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; radial-gradient(20px at right bottom,transparent 50%,#F4F4F4 50%)&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2 .right-top&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            top&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            right&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            background&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; radial-gradient(20px at left bottom,transparent 50%,#F4F4F4 50%)&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2 .left-bottom&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            bottom&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            left&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            background&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; radial-gradient(20px at right top,transparent 50%,#F4F4F4 50%)&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;&lt;span&gt;
        .rd-box2 .right-bottom&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
            bottom&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            right&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; 0&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;
            background&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;span&gt; radial-gradient(20px at left top,transparent 50%,#F4F4F4 50%)&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;
        &lt;span&gt;}&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;style&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;script &lt;/span&gt;&lt;span&gt;src&lt;/span&gt;&lt;span&gt;=&quot;https://cdn.bootcss.com/jquery/3.3.1/jquery.js&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;script&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;script&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;图片自适应填充，并居中显示。&lt;/span&gt;
        &lt;span&gt;function&lt;/span&gt;&lt;span&gt; centerThisImg(el, maxWidth, maxHeight){
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt;&lt;span&gt; $img &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; $(el),
                img &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; $img[&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;];
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt;&lt;span&gt; imgHeight &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; img.naturalHeight,
                imgWidth &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; img.naturalWidth,
                finalWidth,
                finalHeight,
                tsffix &lt;/span&gt;&lt;span&gt;=&lt;/span&gt; &lt;span&gt;''&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt;&lt;span&gt; rm &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; maxWidth &lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt; maxHeight,
                r &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; imgWidth &lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt; imgHeight;

            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt;(r &lt;/span&gt;&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt; rm){
                finalWidth &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; maxWidth;
                finalHeight &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; maxWidth &lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt; r;
                tsffix &lt;/span&gt;&lt;span&gt;=&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;translateY(-&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;+&lt;/span&gt;&lt;span&gt; (finalHeight &lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt; maxHeight) &lt;/span&gt;&lt;span&gt;/&lt;/span&gt; &lt;span&gt;2&lt;/span&gt; &lt;span&gt;+&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;px)&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
            } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
                finalHeight &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; maxHeight;
                finalWidth &lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt; maxHeight &lt;/span&gt;&lt;span&gt;*&lt;/span&gt;&lt;span&gt; r;
                tsffix &lt;/span&gt;&lt;span&gt;=&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;translateX(-&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;+&lt;/span&gt;&lt;span&gt; (finalWidth &lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt; maxWidth) &lt;/span&gt;&lt;span&gt;/&lt;/span&gt; &lt;span&gt;2&lt;/span&gt; &lt;span&gt;+&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;px)&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
            }
            $img.css({width: finalWidth, height: finalHeight, transform: tsffix});
        }
    &lt;/span&gt;&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;script&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;head&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;body&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;label&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;正方形居中显示并且圆角：&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;label&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;rd-box2&quot;&lt;/span&gt;&lt;span&gt; style&lt;/span&gt;&lt;span&gt;=&quot;width:200px;height:200px;overflow:hidden;&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;i &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;left-top&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;i&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;i &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;right-top&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;i&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;i &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;left-bottom&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;i&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;i &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;right-bottom&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;i&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;img &lt;/span&gt;&lt;span&gt;src&lt;/span&gt;&lt;span&gt;=&quot;mao.png&quot;&lt;/span&gt;&lt;span&gt; onload&lt;/span&gt;&lt;span&gt;=&quot;centerThisImg(this, 200, 200)&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;body&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;html&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;效果图如下：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/555379/201811/555379-20181125152850698-978293274.png&quot; alt=&quot;&quot; width=&quot;350px;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;总结：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;其实，如果图片能够继承父元素的圆角效果，那么就不需要这么麻烦，但是现实是图片元素四个角会超出父元素（设了圆角）。&lt;/p&gt;
&lt;p&gt;我查阅了资料，有人说这种行为是浏览器默认特性，就是这样效果（&lt;a href=&quot;https://stackoverflow.com/questions/8582176/should-border-radius-clip-the-content&quot; target=&quot;_blank&quot;&gt;https://stackoverflow.com/questions/8582176/should-border-radius-clip-the-content&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;我实际的测试也是这样，不过，就不深究了。&lt;/p&gt;

&lt;p&gt;本文为原创文章，转载请保留原出处，方便溯源，如有错误地方，谢谢指正。&lt;/p&gt;
&lt;p&gt;本文地址 ：&lt;a href=&quot;http://www.cnblogs.com/lovesong/p/10015829.html&quot;&gt;http://www.cnblogs.com/lovesong/p/10015829.html&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 25 Nov 2018 07:41:00 +0000</pubDate>
<dc:creator>海角在眼前</dc:creator>
<og:description>1、图片圆角显示 例如（非常简单）： HTML： CSS： 如果图片只为圆角，这种方式确实没问题，但如果还要加上居中的效果，这种方式就有问题，下面会说明。 2、图片居中显示（铺满父容器且不变形） 效果</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/lovesong/p/10015829.html</dc:identifier>
</item>
<item>
<title>程序员如何处理好时区问题 - owenandhisfriends</title>
<link>http://www.cnblogs.com/owenandhisfriends/p/10015572.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/owenandhisfriends/p/10015572.html</guid>
<description>&lt;p&gt;写国际化的程序，经常会遇到两种问题：字符编码、时间问题。今天我们就聊聊程序中如何处理时间问题。&lt;/p&gt;
&lt;p&gt;首先，要了解一些基本的概念，只有对概念有清晰的掌握，才能明白解决方法。&lt;/p&gt;
&lt;h2&gt;基本概念&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;GMT时间&lt;/strong&gt;：格林尼治标准时间（英语：Greenwich Mean Time，GMT）是指位于英国伦敦郊区的皇家格林尼治天文台当地的平太阳时，因为本初子午线被定义为通过那里的经线。&lt;/p&gt;
&lt;p&gt;由于地球每天的自转是有些不规则的，而且正在缓慢减速，因此格林尼治平时基于天文观测本身的缺陷，已经被原子钟报时的协调世界时（UTC）所取代。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UTC时间&lt;/strong&gt;：协调世界时（英语：Coordinated Universal Time，法语：Temps Universel Coordonné，简称UTC）是最主要的世界时间标准，其以原子时秒长为基础，在时刻上尽量接近于格林尼治标准时间。&lt;/p&gt;
&lt;p&gt;对于大多数用途来说，UTC时间被认为能与GMT时间互换，但GMT时间已不再被科学界所确定。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UNIX时间戳&lt;/strong&gt;：Unix time又叫POSIX time或UNIX Epoch time，是从UTC时间1970年1月1日起到现在的秒数，不考虑闰秒，一天有86400秒。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;时区&lt;/strong&gt;：时区是地球上的区域使用同一个时间定义。世界各个国家位于地球不同位置上，因此不同国家特别是东西跨度大的国家日出、日落时间必定有所偏差。这些偏差就是所谓的时差。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;闰秒&lt;/strong&gt;：闰秒是在协调世界时（UTC）中增加或减少一秒，使它与平太阳时贴近所做调整。在UTC时间中，有时会出现一分钟有59秒或61秒。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;夏令时&lt;/strong&gt;:美国原本于每年4月的第一个星期日凌晨2时起至10月的最后一个星期日凌晨2时实施夏时制；但经美国国会2005年通过的能源法案，自2007年起延长夏时制，开始日期从每年4月的第一个星期日，提前到3月的第二个星期日，结束日期从每年10月的最后一个星期日，延后到11月的第一个星期日。美国夏时制实行与否，完全由各州各郡自己决定。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;时间格式的标准&lt;/strong&gt;:参考ISO_8601日期格式标准 https://zh.wikipedia.org/wiki/ISO_8601。例如：2004-05-03T17:30:08+08:00 在时间前面加上大些字母T，要标明偏移的时区时间。&lt;/p&gt;
&lt;h2&gt;概念解读&lt;/h2&gt;
&lt;p&gt;通过上面的概念介绍了解到，GMT就是0时区的时间，以前是标准，但现在国际上已经用UTC取代他了。在写程序时，可以认为UTC和GMT是等价的。为了严谨只需要关心UTC时间。&lt;/p&gt;
&lt;p&gt;UNIX时间戳是程序中最常用的，他的特点是和UTC时间的1970年1月1日到现在的秒数，&lt;strong&gt;和时区无关，无论在地球上的那个角落，同一时刻，UNIX时间戳都是一样的&lt;/strong&gt;。是一个通用的时间偏移度量，计算每个时区当地时间时，都可以用时间戳推算出来。&lt;/p&gt;
&lt;p&gt;不同时区的时间，都用UTC时间的偏移来计算。例如北京是东八区，比UTC时间快8个小时，所以计算北京时间，就在UTC时间的基础上加8个小时实现。&lt;/p&gt;
&lt;p&gt;我们在调用系统函数展示时间时，底层是根据UNIX时间戳转换为UTC时间，再加上偏移的小时数，就得出了程序要用的当地时间。&lt;/p&gt;
&lt;p&gt;UNIX时间戳可以映射到每个时区的当地时间，如果程序涉及到两个时区的时间转换，最好的方法是存储UNIX时间戳，在使用的时候再做转换。&lt;/p&gt;
&lt;p&gt;在各种语言的函数库中，都已经定义了时间时区转换的函数。在使用时，还有一点要注意「时区偏移（time offset）」和「时区地区（time zone）」是两个不同的概念。&lt;/p&gt;
&lt;p&gt;偏移是一个数学上的值，直接能计算出时间。时区地区，会根据当地的法律规则，来得出最终的时间，混入了人为的规则。&lt;/p&gt;
&lt;p&gt;例如：&lt;br/&gt;在夏令时时，北京和纽约时差是12个小时，但是当夏令时结束时，北京和纽约的时差是11个小时。如果一直用固定的时间偏移，就会计算出错。如果用指定的地区当参数，就会根据当地规则返回正确时间。&lt;/p&gt;
&lt;p&gt;具体例子见代码：&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-php&quot;&gt;&amp;lt;?php                                                                              

date_default_timezone_set('Asia/Shanghai');                                        
$d=strtotime(&quot;2018-11-04 13:00:00&quot;);                                               
echo &quot;Beijing &quot; . date(&quot;Y-m-d h:i:sa&quot;, $d) . &quot;\n&quot;;                                 

date_default_timezone_set('America/New_York');                                     
echo &quot;NewYork &quot; . date(&quot;Y-m-d h:i:sa&quot;, $d) . &quot;\n&quot;;                                 

echo &quot;\n&quot;;                                                                         

date_default_timezone_set('Asia/Shanghai');                                        
$d=strtotime(&quot;2018-11-04 14:00:00&quot;);                                               
echo &quot;Beijing &quot; . date(&quot;Y-m-d h:i:sa&quot;, $d) . &quot;\n&quot;;                                 

date_default_timezone_set('America/New_York');                                     
echo &quot;NewYork &quot; . date(&quot;Y-m-d h:i:sa&quot;, $d) . &quot;\n&quot;;                                 

echo &quot;\n&quot;;                                                                                                                                          

date_default_timezone_set('Asia/Shanghai');                                        
$d=strtotime(&quot;2018-11-04 15:00:00&quot;);                                               
echo &quot;Beijing &quot; . date(&quot;Y-m-d h:i:sa&quot;, $d) . &quot;\n&quot;;                                 

date_default_timezone_set('America/New_York');                                     
echo &quot;NewYork &quot; . date(&quot;Y-m-d h:i:sa&quot;, $d) . &quot;\n&quot;;                                 

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;输出结果&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Beijing 2018-11-04 01:00:00pm   //没结束夏令时时，时差12个小时
NewYork 2018-11-04 01:00:00am

Beijing 2018-11-04 02:00:00pm   //夏令时切换，时差为11个小时
NewYork 2018-11-04 01:00:00am

Beijing 2018-11-04 03:00:00pm
NewYork 2018-11-04 02:00:00am

&lt;/code&gt;
&lt;/pre&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;涉及到多个时区的转换，统一使用unix时间戳存储或交互，或者使用带有时区信息的字符串。&lt;/li&gt;
&lt;li&gt;尽量在上层的代码层面修改时区配置，不要修改系统或软件的配置，防止其他程序因为修改受到影响。&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;本质&lt;/strong&gt;：时区概念是上层人为转换的概念，程序的逻辑不要依赖于他，要有个统一的时刻值概念来衡量真实的时间（例如UNIX时间戳），然后在上层做转换。&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;p&gt;https://zh.wikipedia.org/wiki/%E6%A0%BC%E6%9E%97%E5%B0%BC%E6%B2%BB%E6%A8%99%E6%BA%96%E6%99%82%E9%96%93&lt;/p&gt;
&lt;p&gt;https://en.wikipedia.org/wiki/Unix_time&lt;/p&gt;
&lt;p&gt;https://zh.wikipedia.org/wiki/%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6&lt;/p&gt;
&lt;p&gt;https://zh.wikipedia.org/wiki/%E6%97%B6%E5%8C%BA&lt;/p&gt;
&lt;p&gt;https://www.cnblogs.com/zihanxing/articles/6224263.html&lt;/p&gt;
&lt;hr/&gt;

&lt;div&gt;&lt;img src=&quot;http://www.owenzhang.net/blog/wp-content/uploads/2018/08/qrcode.png&quot; alt=&quot;欢迎收听公众号&quot; align=&quot;middle&quot;/&gt;&lt;/div&gt;
</description>
<pubDate>Sun, 25 Nov 2018 06:35:00 +0000</pubDate>
<dc:creator>owenandhisfriends</dc:creator>
<og:description>写国际化的程序，经常会遇到两种问题：字符编码、时间问题。今天我们就聊聊程序中如何处理时间问题。 首先，要了解一些基本的概念，只有对概念有清晰的掌握，才能明白解决方法。 基本概念 GMT时间：格林尼治标</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/owenandhisfriends/p/10015572.html</dc:identifier>
</item>
<item>
<title>Python学习手册之函数式编程 - 清洁工老板</title>
<link>http://www.cnblogs.com/dustman/p/10010690.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dustman/p/10010690.html</guid>
<description>&lt;p&gt;&amp;#13;
                                    &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;modal&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;sr-only&quot;&gt;Close&lt;/span&gt;&lt;/button&gt;&amp;#13;
                                    &lt;h4 class=&quot;modal-title&quot;&gt;&amp;#13;
                                        请完成人机识别验证&amp;#13;
                                    &lt;/h4&gt;&amp;#13;
                                &lt;/p&gt;
                                &lt;div class=&quot;modal-body&quot; readability=&quot;33&quot;&gt;
                                    
                                    &lt;p&gt;&amp;#13;
                                        &lt;span id=&quot;geetestLoading&quot;&gt; 验证码组件加载中,请稍后...&lt;/span&gt;&amp;#13;
                                    &lt;/p&gt;
                                &lt;/div&gt;
                            </description>
<pubDate>Sun, 25 Nov 2018 06:14:00 +0000</pubDate>
<dc:creator>清洁工老板</dc:creator>
<dc:format>text/html</dc:format>
<dc:identifier>https://passport.cnblogs.com/user/signin?ReturnUrl=https%3A%2F%2Fwww.cnblogs.com%2Fdustman%2Fp%2F10010690.html&amp;AspxAutoDetectCookieSupport=1</dc:identifier>
</item>
<item>
<title>Jenkins+Git+Gitlab+Ansible实现持续集成自动化部署动态网站（二）--技术流ken - 技术流ken</title>
<link>http://www.cnblogs.com/kenken2018/p/10009514.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/kenken2018/p/10009514.html</guid>
<description>
&lt;h2&gt;项目前言&lt;/h2&gt;

&lt;p&gt;在上一篇博客《&lt;a id=&quot;post_title_link_10007959&quot; href=&quot;https://www.cnblogs.com/kenken2018/p/10007959.html&quot;&gt;Jenkins+Git+Gitlab+Ansible实现持续化集成一键部署静态网站（一）--技术流ken&lt;/a&gt;》中已经详细讲解了如何使用这四个工具来持续集成自动化部署一个静态的网站。&lt;/p&gt;
&lt;p&gt;如果大家可以熟练掌握以上内容，势必会在工作中减轻不小的工作量。&lt;/p&gt;
&lt;p&gt;本篇博客将再次使用这四个工具结合freestyle和pipeline来完成动态网站的部署。&lt;/p&gt;
&lt;p&gt;为了拓宽知识点，本篇博客将使用jenkins的两种常用方法来进行部署，如果你对pipeline还不熟悉，请参考我之前的博客《&lt;a id=&quot;post_title_link_10009279&quot; href=&quot;https://www.cnblogs.com/kenken2018/p/10009279.html&quot;&gt;Jenkins凭证及任务演示-pipeline（二）--技术流ken&lt;/a&gt;》。&lt;/p&gt;
&lt;p&gt;虽说freestyle也可完成相同的操作，而且操作简单，但是freestyle只是适合服务器量很少的场景50-100台左右。如果你管理了百台、千台服务器势必会用到pipeline进行批量化操作。&lt;/p&gt;
&lt;p&gt;所以pipeline来还是应该深入去研究一下的，虽说确实有困难，但是因为它的格式相对固定单一，也不是可望而不可及。多学多练多总结。&lt;/p&gt;
&lt;p&gt;有关持续集成自动化部署系列差不多写了有十篇左右了。本篇博客将是这一系列的最后一篇，接下来会更新docker及k8s系列。敬请期待。&lt;/p&gt;

&lt;h2&gt;项目需求&lt;/h2&gt;

&lt;p&gt;需求一.、使用gitlab创建项目&lt;/p&gt;
&lt;p&gt;需求二、 使用ansible的roles实现一键化部署wordpress&lt;/p&gt;
&lt;p&gt;               每次部署需要备份之前的网站数据&lt;/p&gt;
&lt;p&gt;               使用roles&lt;/p&gt;
&lt;p&gt;               使用templates&lt;/p&gt;
&lt;p&gt;               脚本对网站监控检测          &lt;/p&gt;
&lt;p&gt;需求三、 完成之后项目上传至gitlab&lt;/p&gt;
&lt;p&gt;需求四、使用jenkins实现项目的持续集成&lt;/p&gt;

&lt;h2&gt;项目环境准备&lt;/h2&gt;

&lt;p&gt;centos7&lt;/p&gt;
&lt;p&gt;Gitlab服务器： 10.220.5.137&lt;/p&gt;
&lt;p&gt;Ansible服务器： 10.220.5.139&lt;/p&gt;
&lt;p&gt;wordpress服务器1： 10.220.5.138&lt;/p&gt;
&lt;p&gt;防火墙以及selinux关闭状态&lt;/p&gt;

&lt;h2&gt;Gitlab创建项目&lt;/h2&gt;

&lt;p&gt;有关项目的创建我这里就不再赘述，大家可以参考我之前的博客《&lt;a id=&quot;post_title_link_9988906&quot; href=&quot;https://www.cnblogs.com/kenken2018/p/9988906.html&quot;&gt;Gitlab在linux/windows中免密使用（二）--技术流ken&lt;/a&gt;》&lt;/p&gt;
&lt;p&gt;我就直接拿我之前创建好的项目进行演示&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123195722741-2010959553.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;Git下载远程仓库内容&lt;/h2&gt;

&lt;p&gt; 在ansible服务器10.220.5.139上面操作&lt;/p&gt;
&lt;p&gt;第一步：创建目录并clone远程仓库内容&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
[root@ken ~&lt;span&gt;]# mkdir t
[root@ken &lt;/span&gt;~&lt;span&gt;]# cd t
[root@ken t]# git clone http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;10.220.5.137/webg1/wordpress.git&lt;/span&gt;
Cloning into &lt;span&gt;'&lt;/span&gt;&lt;span&gt;wordpress&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;...
Username &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;http://10.220.5.137&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: root
Password &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;http://root@10.220.5.137&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;: 
remote: Counting objects: &lt;/span&gt;&lt;span&gt;1062&lt;/span&gt;&lt;span&gt;, done.
remote: Compressing objects: &lt;/span&gt;&lt;span&gt;100&lt;/span&gt;% (&lt;span&gt;969&lt;/span&gt;/&lt;span&gt;969&lt;/span&gt;&lt;span&gt;), done.
remote: Total &lt;/span&gt;&lt;span&gt;1062&lt;/span&gt; (delta &lt;span&gt;68&lt;/span&gt;), reused &lt;span&gt;1042&lt;/span&gt; (delta &lt;span&gt;68&lt;/span&gt;&lt;span&gt;)
Receiving objects: &lt;/span&gt;&lt;span&gt;100&lt;/span&gt;% (&lt;span&gt;1062&lt;/span&gt;/&lt;span&gt;1062&lt;/span&gt;), &lt;span&gt;4.15&lt;/span&gt; MiB | &lt;span&gt;0&lt;/span&gt; bytes/&lt;span&gt;s, done.
Resolving deltas: &lt;/span&gt;&lt;span&gt;100&lt;/span&gt;% (&lt;span&gt;68&lt;/span&gt;/&lt;span&gt;68&lt;/span&gt;&lt;span&gt;), done.
[root@ken t]# ls
wordpress&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Ansible剧本的编写&lt;/h2&gt;

&lt;p&gt;第一步：创建相关目录&lt;/p&gt;
&lt;p&gt;在ansible服务器端操作&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@ken ~]# mkdir /project/roles/wordpress/{vars,tasks,files,templates} -pv
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第二步：编写templates模版&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
  [root@ken ~]# cp /etc/httpd/conf/httpd.conf /project/roles/wordpress/templates/httpd.conf.j2
  [root@ken ~]# grep -v -E '^#|^$| +#' /project/roles/wordpress/templates/httpd.conf.j2
  ServerRoot &quot;/etc/httpd&quot;
  Listen {{ port }}    #定义成变量
  Include conf.modules.d/*.conf
  User {{ user }}       #定义成变量
  Group apache
  ServerAdmin root@localhost
  ServerName {{ ansible_eth0.ipv4.address }}  #引用内置变量
  DocumentRoot {{ root }}               #定义成变量
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;第三步：编辑hosts配置文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@ken project]# vim /etc/ansible/hosts
[devser]
10.220.5.139
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第四步：编写测试文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@ken project]# vim roles/wordpress/files/index.php
&amp;lt;?php
phpinfo();
?&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第五步：编写网站健康监测脚本&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
[root@ken project]# cd roles/wordpress/files/
[root@ken files]# ls
[root@ken files]# vim check.sh 
[root@ken files]# cat check.sh 
#!/bin/bash
URL=$1
PORT=$2
curl -I http://$1:$2/index.php | grep &quot;200 OK&quot; &amp;amp;&amp;gt;/dev/null
if [ $? -eq 0 ];then
    echo &quot;$1 status is ok&quot;
else
    echo &quot;$1 status is not ok&quot;
fi
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;第六步：编写tasks下的文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
[root@ken wordpress]# cat tasks/main.yml
######## 安装 httpd php mysql ###############
- name: install httpd
  yum: name=httpd state=present
- name: install mysql
  yum: name=mariadb-server state=present
- name: install php
  shell: yum install php php-mysql -y
######## 配置httpd #########################
- name: make configrantion file
  template: src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf
- name: install test page
  copy: src=index.php dest={{ root }}
######## 启动服务 ####################
- name: start httpd
  service: name=httpd state=restarted
- name: start mysql
  service: name=mariadb state=restarted
######### 检查部署结果是否正常 ##########
- name: make health check
  shell: sh roles/wordpress/files/check.sh {{ ansible_eth0.ipv4.address }} {{ port }}
  delegate_to: localhost
  register: health_status
- debug: msg=&quot;{{ health_status.stdout }}&quot;
########## 从gitlab拉取代码 #################
- name: backup old files
  shell: mv {{ root }} {{ backup_to }}
- name: close ssl authtication
  shell: git config --global http.sslVerify false
- name: git clone wordpress from gitlab
  git: &quot;repo=http://{{ gitlab_user }}:{{ gitlab_pass }}@10.220.5.137/webg1/wordpress.git dest={{ root }} version=master&quot;
&lt;/pre&gt;
&lt;div class=&quot;cnblogs_code_toolbar&quot;&gt;&lt;span class=&quot;cnblogs_code_copy&quot;&gt;&lt;a title=&quot;复制代码&quot;&gt;&lt;img src=&quot;https://common.cnblogs.com/images/copycode.gif&quot; alt=&quot;复制代码&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;第七步：编写vars下的文件&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@ken ~] # cat /project/roles/wordpress/vars/main.yml
port： 82
user： apache
root： /var/www
gitlab_user： root
gitlab_pass： 12345678
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第八步：编辑剧本&lt;/p&gt;
&lt;p&gt;剧本一定要和roles在同一个目录之中&lt;/p&gt;
&lt;p&gt;执行剧本的时候也要在roles同级目录下执行&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@ken ~]# vim /project/wordpress.yaml
- hosts: all
  vars:
     backup_to: &quot;{{ root }}_{{ ansible_date_time.epoch }}&quot;
  roles:
   - wordpress
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第九步：一键部署wordpress&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@ken ~]# cd /project/
[root@ken project]# ansible-playbook -i inventory/dev dev.yaml
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第十步：查看执行结果&lt;/p&gt;
&lt;p&gt;可以发现没有报错&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@ken project]# ansible-playbook -i inventory/&lt;span&gt;den dev.yaml 
 [WARNING]: Found variable &lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; reserved name: port


PLAY [all] &lt;/span&gt;***********************************************************************&lt;span&gt;

TASK [Gathering Facts] &lt;/span&gt;***********************************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : install httpd] &lt;/span&gt;*************************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : install mysql] &lt;/span&gt;*************************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : install php] &lt;/span&gt;***************************************************&lt;span&gt;
 [WARNING]: Consider &lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; the yum module rather than running yum.  If you need
to use command because yum &lt;/span&gt;&lt;span&gt;is&lt;/span&gt; insufficient you can add warn=False to &lt;span&gt;this&lt;/span&gt;&lt;span&gt; command
task or &lt;/span&gt;&lt;span&gt;set&lt;/span&gt; command_warnings=False &lt;span&gt;in&lt;/span&gt; ansible.cfg to &lt;span&gt;get&lt;/span&gt; rid of &lt;span&gt;this&lt;/span&gt;&lt;span&gt; message.

changed: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : make configrantion file] &lt;/span&gt;***************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : install test page] &lt;/span&gt;*********************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : start httpd] &lt;/span&gt;***************************************************&lt;span&gt;
changed: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : start mysql] &lt;/span&gt;***************************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : make health check] &lt;/span&gt;*********************************************&lt;span&gt;
changed: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt; -&amp;gt;&lt;span&gt; localhost]

TASK [wordpress : debug] &lt;/span&gt;*********************************************************&lt;span&gt;
ok: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;] =&amp;gt;&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;msg&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;10.220.5.138 status is ok&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}

TASK [wordpress : backup old files] &lt;/span&gt;**********************************************&lt;span&gt;
changed: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : close ssl authtication] &lt;/span&gt;****************************************&lt;span&gt;
changed: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

TASK [wordpress : git clone wordpress &lt;/span&gt;&lt;span&gt;from&lt;/span&gt; gitlab] *******************************&lt;span&gt;
changed: [&lt;/span&gt;&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;&lt;span&gt;]

PLAY RECAP &lt;/span&gt;***********************************************************************
&lt;span&gt;10.220&lt;/span&gt;.&lt;span&gt;5.138&lt;/span&gt;               : ok=&lt;span&gt;13&lt;/span&gt;   changed=&lt;span&gt;6&lt;/span&gt;    unreachable=&lt;span&gt;0&lt;/span&gt;    failed=&lt;span&gt;0&lt;/span&gt;   
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;数据上传至Gitlab&lt;/h2&gt;

&lt;p&gt;第一步：上传所以数据至远程gitlab&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;[root@ken project]# cd ..
[root@ken wordpress]# ls
da  project  wordpress
[root@ken wordpress]# ls &lt;/span&gt;-&lt;span&gt;a
.  ..  da  .git  project  wordpress
[root@ken wordpress]# git add .
[root@ken wordpress]# git commit &lt;/span&gt;-m &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;v3&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
[master e533bc1] v3
 &lt;/span&gt;&lt;span&gt;2&lt;/span&gt; files changed, &lt;span&gt;3&lt;/span&gt; insertions(+&lt;span&gt;)
 create mode &lt;/span&gt;&lt;span&gt;100644&lt;/span&gt; project/&lt;span&gt;dev.retry
 create mode &lt;/span&gt;&lt;span&gt;100644&lt;/span&gt; project/inventory/&lt;span&gt;den
[root@ken wordpress]# git push&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第二步：web端查看&lt;/p&gt;
&lt;p&gt;可以看到现在已经有了我们刚才已经上传的v3版本了&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123201802723-203899966.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h2&gt;Jenkins端实现持续集成部署--freestyle&lt;/h2&gt;

&lt;p&gt;第一步：创建一个freestyle的任务&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123201932251-160161522.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;第二步：填写gitlab仓库信息&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123202113752-1896602480.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;第三步：构建shell&lt;/p&gt;
&lt;p&gt;填写如下信息并保存&lt;/p&gt;
&lt;p&gt;这里之所以要先cd到工作目录下的project是因为要找到dev.yaml剧本&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123202658914-755658816.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;p&gt;第四步：开始构建&lt;/p&gt;
&lt;p&gt;可以发现已经部署完成&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123202634263-1275577263.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;h2&gt;Jenkins端实现持续集成部署--pipeline&lt;/h2&gt;

&lt;p&gt;第一步：创建一个流水线即pipeline任务&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123202919916-219373001.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;第二步：编写pipeline&lt;/p&gt;
&lt;p&gt; 如果你是复制的下面的代码请务必更改你的git路径以及指定你的凭证ID&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
#!&lt;span&gt;groovy

pipeline {
 agent {node {label &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;master&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;}}

 environment {
  PATH&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
 }

 parameters {
  choice(
   choices: &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dev\nrprod&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
   description: &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Choose deploy environment&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
   name: &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;deploy_env&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
  )
  &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; (name: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;branch&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, defaultValue: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;master&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, description: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Fill in your ansible repo branch&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
 }

 stages {
  stage (&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Pull deploy code&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;) {
   steps{
    sh &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;git config --global http.sslVerify false&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    dir (&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;${env.WORKSPACE}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;){
     git branch: &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;master&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, credentialsId: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;527d840a-ad47-4a16-bfa1-c6eab88a3563&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, url: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;http://10.220.5.137/webg1/wordpress.git&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
    }
   }

  }

  stage (&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Anisble deployment&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;) {
   steps {
    dir(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;${env.WORKSPACE}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;){
     echo &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;[INFO] Start deployment&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
     sh &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;
&lt;/span&gt;     &lt;span&gt;set&lt;/span&gt; +&lt;span&gt;x
     ansible&lt;/span&gt;-playbook -i inventory/$env ./dev.yaml -e branch=$branch -e env=&lt;span&gt;$deploy_env
     &lt;/span&gt;&lt;span&gt;set&lt;/span&gt; -&lt;span&gt;x
     &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;
&lt;/span&gt;     echo &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;[INFO] Deployment finished...&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
    }
   }
  }

 }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第三步：查看执行结果&lt;/p&gt;
&lt;p&gt;发现执行成功&lt;/p&gt;
&lt;p&gt;以后程序员更改代码之后就可以自己测试上线了&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123210234771-1376596442.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;第四步：数据库授权&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
[root@ken ~]# mysql -uroot -&lt;span&gt;p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id &lt;/span&gt;&lt;span&gt;is&lt;/span&gt; &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
Server version: &lt;/span&gt;&lt;span&gt;5.5&lt;/span&gt;.&lt;span&gt;56&lt;/span&gt;-&lt;span&gt;MariaDB MariaDB Server

Copyright (c) &lt;/span&gt;&lt;span&gt;2000&lt;/span&gt;, &lt;span&gt;2017&lt;/span&gt;&lt;span&gt;, Oracle, MariaDB Corporation Ab and others.

Type &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;help;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; or &lt;span&gt;'&lt;/span&gt;&lt;span&gt;\h&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;for&lt;/span&gt; help. Type &lt;span&gt;'&lt;/span&gt;&lt;span&gt;\c&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt; to clear the current input statement.

MariaDB [(none)]&lt;/span&gt;&amp;gt;&lt;span&gt; create database wordpress;
Query OK, &lt;/span&gt;&lt;span&gt;1&lt;/span&gt; row affected (&lt;span&gt;0.03&lt;/span&gt;&lt;span&gt; sec)

MariaDB [(none)]&lt;/span&gt;&amp;gt; grant all on *.* to ken@&lt;span&gt;'&lt;/span&gt;&lt;span&gt;localhost&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; identified by &lt;span&gt;'&lt;/span&gt;&lt;span&gt;123&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;
Query OK, &lt;/span&gt;&lt;span&gt;0&lt;/span&gt; rows affected (&lt;span&gt;0.02&lt;/span&gt;&lt;span&gt; sec)

MariaDB [(none)]&lt;/span&gt;&amp;gt;&lt;span&gt; exit
Bye&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;第五步：填写上面数据库配置的信息&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123211328091-279529037.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;第六步：配置成功页面&lt;/p&gt;
&lt;p&gt;注意访问的时候IP地址之后需要加上：82端口号，因为我们上面的剧本中指定了变量port为82号端口&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://img2018.cnblogs.com/blog/1499615/201811/1499615-20181123211747101-335182314.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

</description>
<pubDate>Sun, 25 Nov 2018 06:03:00 +0000</pubDate>
<dc:creator>技术流ken</dc:creator>
<og:description>项目前言 在上一篇博客《Jenkins+Git+Gitlab+Ansible实现持续化集成一键部署静态网站（一）--技术流ken》中已经详细讲解了如何使用这四个工具来持续集成自动化部署一个静态的网站。</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/kenken2018/p/10009514.html</dc:identifier>
</item>
<item>
<title>Python 游戏之旅（Pygame） - 东小东</title>
<link>http://www.cnblogs.com/dongxiaodong/p/10015451.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dongxiaodong/p/10015451.html</guid>
<description>&lt;p&gt;Pygame是跨平台Python模块，专为电子游戏设计，包含图像、声音。建立在SDL基础上，允许实时电子游戏研发而无需被低级语言（如机器语言和汇编语言）束缚。基于这样一个设想，所有需要的游戏功能和理念都（主要是图像方面）都完全简化为游戏逻辑本身，所有的资源结构都可以由高级语言提供。&lt;/p&gt;

&lt;p&gt;Pygame的编程其实可以理解为循环加事件实现。&lt;/p&gt;

&lt;p&gt;安装：&lt;/p&gt;
&lt;p&gt;pip3 install pygame&lt;/p&gt;

&lt;p&gt;测试：(可忽略)&lt;/p&gt;
&lt;p&gt;python -m pygame.examples.aliens&lt;/p&gt;

&lt;p&gt;画一个厉害的画玩玩：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1485202/201811/1485202-20181125134242172-1644719920.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;生成一个最简窗口：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;import&lt;/span&gt; pygame  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 导入pygame库&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;from&lt;/span&gt; sys &lt;span&gt;import&lt;/span&gt; exit  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 导入sys库中的exit函数&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt; 
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 初始化pygame&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;pygame.init()
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;创建一个窗口，参数（（宽度，高度））&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; screen = pygame.display.set_mode((700,450&lt;span&gt;))
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 设置窗口标题&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt; pygame.display.set_caption(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;东小东游戏窗口&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; 
&lt;span&gt;12&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;  载入背景图&lt;/span&gt;
&lt;span&gt;13&lt;/span&gt; background = pygame.image.load(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;imgx/wa.jpg&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; 
&lt;span&gt;15&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 事件循环&lt;/span&gt;
&lt;span&gt;16&lt;/span&gt; &lt;span&gt;while&lt;/span&gt;&lt;span&gt; True:
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制背景&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;    screen.blit(background, (0, 0))
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; 
&lt;span&gt;20&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 更新屏幕&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    pygame.display.update()
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; 
&lt;span&gt;23&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 所有事件的监听，处理&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; event &lt;span&gt;in&lt;/span&gt;&lt;span&gt; pygame.event.get():
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 游戏退出事件&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt;          &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt; pygame.QUIT:
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;             &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 退出程序&lt;/span&gt;
&lt;span&gt;28&lt;/span&gt;             exit()
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;画画实现：&lt;/p&gt;
&lt;p&gt;实现文字显示、事件监听、画大部分图形，其中显示文字时需要中文字体库支持，可直接将对应的字体拷贝到目录下，方便程序的移植，而不要固定写Windows字体库的路径，所以相对路径是最好的解决方法。&lt;/p&gt;
&lt;p&gt;Windows文字库所在位置：C:\Windows\Fonts&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;167&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;import&lt;/span&gt; pygame  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 导入pygame库&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;from&lt;/span&gt; sys &lt;span&gt;import&lt;/span&gt; exit  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 导入sys库中的exit函数&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;from&lt;/span&gt; math &lt;span&gt;import&lt;/span&gt;&lt;span&gt; pi
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; pygame.freetype
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 初始化pygame&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;pygame.init()
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;创建一个窗口，参数（（宽度，高度））&lt;/span&gt;
&lt;span&gt; 9&lt;/span&gt; screen = pygame.display.set_mode((700,450&lt;span&gt;))
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;设置窗口标题&lt;/span&gt;
&lt;span&gt;11&lt;/span&gt; pygame.display.set_caption(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;东小东游戏窗口&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;颜色对象,参数（R,G,B,Alphal)&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; co1=pygame.Color(255,255,20,10&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; co2=pygame.Color(255,0,0,255&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; co3=pygame.Color(0,255,0,255&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; cotextbg=pygame.Color(0,255,0,200&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; cotext=pygame.Color(255,255,255,255&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 填充背景色&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt; &lt;span&gt;screen.fill(co1)
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; 
&lt;span&gt;24&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;显示文字方法1，需要一直刷新&lt;/span&gt;
&lt;span&gt;25&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;绘制文字,参数（字体，默认大小）&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;ftext111=pygame.font.SysFont(&quot;arial&quot;, 16)&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;参数：（文字，是否取消锯齿，前景色，背景色）&lt;/span&gt;
&lt;span&gt;28&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;textviewx111=ftext111.render(&quot;wwww&quot;,True,(100,100,50),(0,255,255,50))&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt; 
&lt;span&gt;30&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;绘制文字222,不能使用中文路径，参数（字体，默认大小），返回矩形对象&lt;/span&gt;
&lt;span&gt;31&lt;/span&gt; ftext222=pygame.freetype.Font(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;fontx/fontext.ttf&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,20&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;方法2&lt;/span&gt;
&lt;span&gt;33&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;参数（窗口，左上角位置，文字，前景，背景，旋转角度[0,359],大小），返回矩形对象&lt;/span&gt;
&lt;span&gt;34&lt;/span&gt; textrect222=ftext222.render_to(screen,(620,420),&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;东小东&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,fgcolor=cotext,bgcolor=cotextbg,rotation=0,size=20&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;方法3，需要一直刷新，返回viwe和矩形对象&lt;/span&gt;
&lt;span&gt;36&lt;/span&gt; texview333,texrect333=ftext222.render(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;东小东2&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,fgcolor=cotext,bgcolor=cotextbg,rotation=20,size=50&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; 
&lt;span&gt;38&lt;/span&gt; 
&lt;span&gt;39&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;------ 以下形状都会返回矩形对象  --------&lt;/span&gt;
&lt;span&gt;40&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制矩形，参数（窗口，颜色，（左上角x,左上角y,w,h),宽度），宽度为0 则填充&lt;/span&gt;
&lt;span&gt;41&lt;/span&gt; rectx = pygame.draw.rect(screen, (255,255,255), (330, 289, 30, 20&lt;span&gt;), 0)
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; rectx = pygame.draw.rect(screen, (255,255,255), (380, 289, 30, 20&lt;span&gt;), 0)
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; rectx = pygame.draw.rect(screen, co2, (270, 270, 200, 50), 5&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制圆形，参数（窗口，颜色，圆形坐标（x,y),半径，宽度）&lt;/span&gt;
&lt;span&gt;45&lt;/span&gt; circlex = pygame.draw.circle(screen, co2, (250, 200), 50&lt;span&gt;, 0)
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt; circlex = pygame.draw.circle(screen, co2, (450, 180), 50, 1&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; 
&lt;span&gt;48&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制直线,参数（窗口，颜色，起点坐标（x,y),结束点坐标，宽度）&lt;/span&gt;
&lt;span&gt;49&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;linex = pygame.draw.line(screen, co2, (20, 20), (100, 30), 1)&lt;/span&gt;
&lt;span&gt;50&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 无锯齿线，斜线去掉锯齿&lt;/span&gt;
&lt;span&gt;51&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;aalinex = pygame.draw.aaline(screen, co2, (30, 30), (100, 50), 1)&lt;/span&gt;
&lt;span&gt;52&lt;/span&gt; 
&lt;span&gt;53&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 椭圆，使用外切矩形画，参数（窗口，颜色，矩形的（左上角x,左上角y,w,h),宽度&lt;/span&gt;
&lt;span&gt;54&lt;/span&gt; ell = pygame.draw.ellipse(screen, co2, (100, 40, 500, 350), 1&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; 
&lt;span&gt;56&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制多线，第一的结束点必然会连接第二的起始点...&lt;/span&gt;
&lt;span&gt;57&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 列表参数为：第一条直线起始点，第一条直线结束点，第二条.....&lt;/span&gt;
&lt;span&gt;58&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;listline = [(10, 100), (10, 200), (20, 100), (20, 300)]&lt;/span&gt;
&lt;span&gt;59&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 参数false表示结束点是否要连接最开始的起始点&lt;/span&gt;
&lt;span&gt;60&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;linexss = pygame.draw.lines(screen, co2, False, listline, 2)&lt;/span&gt;
&lt;span&gt;61&lt;/span&gt; 
&lt;span&gt;62&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制弧线&lt;/span&gt;
&lt;span&gt;63&lt;/span&gt; alrectx = pygame.draw.arc(screen, co3, (344, 244, 60, 20), 0 * pi, 1 * pi, 3&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt; 
&lt;span&gt;65&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 事件循环&lt;/span&gt;
&lt;span&gt;66&lt;/span&gt; &lt;span&gt;while&lt;/span&gt;&lt;span&gt; True:
&lt;/span&gt;&lt;span&gt;67&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;显示文字方法1&lt;/span&gt;
&lt;span&gt;68&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;screen.blit(textviewx111,(20,20))&lt;/span&gt;
&lt;span&gt;69&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;显示文字方法3&lt;/span&gt;
&lt;span&gt;70&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;screen.blit(texview333,(200,200))&lt;/span&gt;
&lt;span&gt;71&lt;/span&gt; 
&lt;span&gt;72&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 更新屏幕&lt;/span&gt;
&lt;span&gt;73&lt;/span&gt; &lt;span&gt;    pygame.display.update()
&lt;/span&gt;&lt;span&gt;74&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 所有事件的监听，处理&lt;/span&gt;
&lt;span&gt;75&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; event &lt;span&gt;in&lt;/span&gt;&lt;span&gt; pygame.event.get():
&lt;/span&gt;&lt;span&gt;76&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 游戏退出事件&lt;/span&gt;
&lt;span&gt;77&lt;/span&gt;          &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt; pygame.QUIT:
&lt;/span&gt;&lt;span&gt;78&lt;/span&gt;             &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 退出程序&lt;/span&gt;
&lt;span&gt;79&lt;/span&gt;             exit()
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;壁球小游戏基本实现及Pygame的其他内容补充：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1485202/201811/1485202-20181125134609623-834573682.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;69&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  1&lt;/span&gt; &lt;span&gt;import&lt;/span&gt; pygame  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 导入pygame库&lt;/span&gt;
&lt;span&gt;  2&lt;/span&gt; &lt;span&gt;from&lt;/span&gt; sys &lt;span&gt;import&lt;/span&gt; exit  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 导入sys库中的exit函数&lt;/span&gt;
&lt;span&gt;  3&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 初始化pygame&lt;/span&gt;
&lt;span&gt;  4&lt;/span&gt; &lt;span&gt;pygame.init()
&lt;/span&gt;&lt;span&gt;  5&lt;/span&gt; 
&lt;span&gt;  6&lt;/span&gt; 
&lt;span&gt;  7&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;定义窗体的宽高&lt;/span&gt;
&lt;span&gt;  8&lt;/span&gt; winWidth=700
&lt;span&gt;  9&lt;/span&gt; winHeight=450
&lt;span&gt; 10&lt;/span&gt; 
&lt;span&gt; 11&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;定义图片每次移动的x,y轴像素&lt;/span&gt;
&lt;span&gt; 12&lt;/span&gt; ballX=1
&lt;span&gt; 13&lt;/span&gt; ballY=1
&lt;span&gt; 14&lt;/span&gt; 
&lt;span&gt; 15&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;刷新最大帧速率,while循环的速度&lt;/span&gt;
&lt;span&gt; 16&lt;/span&gt; fpsx=19
&lt;span&gt; 17&lt;/span&gt; 
&lt;span&gt; 18&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;初始化帧速率对象&lt;/span&gt;
&lt;span&gt; 19&lt;/span&gt; timefpsx=&lt;span&gt;pygame.time.Clock()
&lt;/span&gt;&lt;span&gt; 20&lt;/span&gt; 
&lt;span&gt; 21&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;全屏显示需调用函数&lt;/span&gt;
&lt;span&gt; 22&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;获取到电脑屏幕的大小并赋值给窗口大小&lt;/span&gt;
&lt;span&gt; 23&lt;/span&gt; &lt;span&gt;def&lt;/span&gt;&lt;span&gt; setfull():
&lt;/span&gt;&lt;span&gt; 24&lt;/span&gt;     &lt;span&gt;global&lt;/span&gt;&lt;span&gt; winHeight,winWidth
&lt;/span&gt;&lt;span&gt; 25&lt;/span&gt;     winRoot=&lt;span&gt;pygame.display.Info()
&lt;/span&gt;&lt;span&gt; 26&lt;/span&gt;     winWidth=&lt;span&gt;winRoot.current_w
&lt;/span&gt;&lt;span&gt; 27&lt;/span&gt;     winHeight=&lt;span&gt;winRoot.current_h
&lt;/span&gt;&lt;span&gt; 28&lt;/span&gt; 
&lt;span&gt; 29&lt;/span&gt; 
&lt;span&gt; 30&lt;/span&gt; 
&lt;span&gt; 31&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;创建一个窗口，参数（（宽度，高度），显示模式）&lt;/span&gt;
&lt;span&gt; 32&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;显示模式&lt;/span&gt;
&lt;span&gt; 33&lt;/span&gt; 
&lt;span&gt; 34&lt;/span&gt; mod=pygame.RESIZABLE &lt;span&gt;#&lt;/span&gt;&lt;span&gt;屏幕大小可调，需监听pygame.VIDEORESIZE事件&lt;/span&gt;
&lt;span&gt; 35&lt;/span&gt; 
&lt;span&gt; 36&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;mod=pygame.NOFRAME #无边框&lt;/span&gt;
&lt;span&gt; 37&lt;/span&gt; 
&lt;span&gt; 38&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;mod=pygame.FULLSCREEN #全屏,需打开下面setfull函数&lt;/span&gt;
&lt;span&gt; 39&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;setfull()&lt;/span&gt;
&lt;span&gt; 40&lt;/span&gt; 
&lt;span&gt; 41&lt;/span&gt; screen =&lt;span&gt; pygame.display.set_mode((winWidth,winHeight),mod)
&lt;/span&gt;&lt;span&gt; 42&lt;/span&gt; 
&lt;span&gt; 43&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 设置窗口标题及标题内容&lt;/span&gt;
&lt;span&gt; 44&lt;/span&gt; pygame.display.set_caption(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;东小东游戏窗口--壁球&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 45&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;设置标题图片&lt;/span&gt;
&lt;span&gt; 46&lt;/span&gt; titleiconx=pygame.image.load(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;imgx/yzm.jpg&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 47&lt;/span&gt; &lt;span&gt;pygame.display.set_icon(titleiconx)
&lt;/span&gt;&lt;span&gt; 48&lt;/span&gt; 
&lt;span&gt; 49&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;  载入背景图&lt;/span&gt;
&lt;span&gt; 50&lt;/span&gt; backgroundx = pygame.image.load(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;imgx/wa.jpg&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 51&lt;/span&gt; 
&lt;span&gt; 52&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;载入需要移动的图片&lt;/span&gt;
&lt;span&gt; 53&lt;/span&gt; ballimgx=pygame.image.load(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;imgx/ball.png&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 54&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt;生成与对象外切的矩形,生成的矩形对象可以获取到x,y,宽高的信息&lt;/span&gt;
&lt;span&gt; 55&lt;/span&gt; ballrectx=&lt;span&gt;ballimgx.get_rect()
&lt;/span&gt;&lt;span&gt; 56&lt;/span&gt; 
&lt;span&gt; 57&lt;/span&gt; 
&lt;span&gt; 58&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 事件循环&lt;/span&gt;
&lt;span&gt; 59&lt;/span&gt; &lt;span&gt;while&lt;/span&gt;&lt;span&gt; True:
&lt;/span&gt;&lt;span&gt; 60&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;设置帧速率&lt;/span&gt;
&lt;span&gt; 61&lt;/span&gt; &lt;span&gt;    timefpsx.tick(fpsx)
&lt;/span&gt;&lt;span&gt; 62&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 绘制背景&lt;/span&gt;
&lt;span&gt; 63&lt;/span&gt; &lt;span&gt;    screen.blit(backgroundx, (0, 0))
&lt;/span&gt;&lt;span&gt; 64&lt;/span&gt; 
&lt;span&gt; 65&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;判断窗口是否被显示，如果最小化则为false&lt;/span&gt;
&lt;span&gt; 66&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt;&lt;span&gt; pygame.display.get_active():
&lt;/span&gt;&lt;span&gt; 67&lt;/span&gt;        &lt;span&gt;#&lt;/span&gt;&lt;span&gt;移动图片,参数（x轴每次移动像素，y轴每次移动像素）&lt;/span&gt;
&lt;span&gt; 68&lt;/span&gt;        ballrectx=&lt;span&gt;ballrectx.move(ballX,ballY)
&lt;/span&gt;&lt;span&gt; 69&lt;/span&gt; 
&lt;span&gt; 70&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;判断图片是否移动到边缘,达到边缘时将移动的X或Y方向取反&lt;/span&gt;
&lt;span&gt; 71&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; ballrectx.left&amp;lt;0 &lt;span&gt;or&lt;/span&gt; ballrectx.right&amp;gt;&lt;span&gt;winWidth:
&lt;/span&gt;&lt;span&gt; 72&lt;/span&gt;         ballX=-&lt;span&gt;ballX
&lt;/span&gt;&lt;span&gt; 73&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; ballrectx.top&amp;lt;0 &lt;span&gt;or&lt;/span&gt; ballrectx.bottom&amp;gt;&lt;span&gt;winHeight:
&lt;/span&gt;&lt;span&gt; 74&lt;/span&gt;         ballY=-&lt;span&gt;ballY
&lt;/span&gt;&lt;span&gt; 75&lt;/span&gt; 
&lt;span&gt; 76&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt;绘制移动的图片&lt;/span&gt;
&lt;span&gt; 77&lt;/span&gt; &lt;span&gt;    screen.blit(ballimgx,ballrectx)
&lt;/span&gt;&lt;span&gt; 78&lt;/span&gt; 
&lt;span&gt; 79&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 更新屏幕&lt;/span&gt;
&lt;span&gt; 80&lt;/span&gt; &lt;span&gt;    pygame.display.update()
&lt;/span&gt;&lt;span&gt; 81&lt;/span&gt; 
&lt;span&gt; 82&lt;/span&gt; 
&lt;span&gt; 83&lt;/span&gt;     &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 所有事件的监听（事件队列只能缓存128个事件），处理&lt;/span&gt;
&lt;span&gt; 84&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; event &lt;span&gt;in&lt;/span&gt;&lt;span&gt; pygame.event.get():
&lt;/span&gt;&lt;span&gt; 85&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 游戏退出事件&lt;/span&gt;
&lt;span&gt; 86&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt; pygame.QUIT:
&lt;/span&gt;&lt;span&gt; 87&lt;/span&gt;             &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 退出程序&lt;/span&gt;
&lt;span&gt; 88&lt;/span&gt; &lt;span&gt;            exit()
&lt;/span&gt;&lt;span&gt; 89&lt;/span&gt; 
&lt;span&gt; 90&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;鼠标事件&lt;/span&gt;
&lt;span&gt; 91&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;鼠标按下事件&lt;/span&gt;
&lt;span&gt; 92&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt; pygame.MOUSEBUTTONDOWN:
&lt;/span&gt;&lt;span&gt; 93&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;鼠标按下,坐标为：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,event.pos,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,鼠标按下键为：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,event.button)
&lt;/span&gt;&lt;span&gt; 94&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;鼠标抬起事件&lt;/span&gt;
&lt;span&gt; 95&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt; pygame.MOUSEBUTTONUP:
&lt;/span&gt;&lt;span&gt; 96&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;鼠标抬起&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 97&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;鼠标移动&lt;/span&gt;
&lt;span&gt; 98&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt;pygame.MOUSEMOTION:
&lt;/span&gt;&lt;span&gt; 99&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;鼠标移动中......当前坐标：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,event.pos,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;相对位置:&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,event.rel,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;鼠标三键状态:&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,event.buttons)
&lt;/span&gt;&lt;span&gt;100&lt;/span&gt; 
&lt;span&gt;101&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;键盘按键事件，字母只会输出小写的编码&lt;/span&gt;
&lt;span&gt;102&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;键盘按下按键事件&lt;/span&gt;
&lt;span&gt;103&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt;pygame.KEYDOWN:
&lt;/span&gt;&lt;span&gt;104&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;键盘按下键为：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,event.key,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;按键按下的模式标志为：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,event.mod)
&lt;/span&gt;&lt;span&gt;105&lt;/span&gt;             &lt;span&gt;#&lt;/span&gt;&lt;span&gt;如果按下ESC键则退出程序&lt;/span&gt;
&lt;span&gt;106&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; event.key==27&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;107&lt;/span&gt; &lt;span&gt;                exit()
&lt;/span&gt;&lt;span&gt;108&lt;/span&gt;             &lt;span&gt;#&lt;/span&gt;&lt;span&gt;游戏处理：上（273）、下（274）、左（276）、右（275）&lt;/span&gt;
&lt;span&gt;109&lt;/span&gt;             &lt;span&gt;#&lt;/span&gt;&lt;span&gt;实现按下哪个方向按键即向哪个方向移动&lt;/span&gt;
&lt;span&gt;110&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; event.key == 273&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;111&lt;/span&gt;                 ballY =-1*&lt;span&gt;abs(ballY)
&lt;/span&gt;&lt;span&gt;112&lt;/span&gt;             &lt;span&gt;elif&lt;/span&gt; event.key == 274&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;113&lt;/span&gt;                 ballY=&lt;span&gt;abs(ballY)
&lt;/span&gt;&lt;span&gt;114&lt;/span&gt;             &lt;span&gt;elif&lt;/span&gt; event.key ==276&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;115&lt;/span&gt;                 ballX=-1*&lt;span&gt;abs(ballY)
&lt;/span&gt;&lt;span&gt;116&lt;/span&gt;             &lt;span&gt;elif&lt;/span&gt;  event.key ==275&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;117&lt;/span&gt;                 ballX=&lt;span&gt;abs(ballX)
&lt;/span&gt;&lt;span&gt;118&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; event.key == 32:&lt;span&gt;#&lt;/span&gt;&lt;span&gt;空格键，使无边框&lt;/span&gt;
&lt;span&gt;119&lt;/span&gt;                 screen =&lt;span&gt; pygame.display.set_mode((winWidth, winHeight),pygame.NOFRAME)
&lt;/span&gt;&lt;span&gt;120&lt;/span&gt; 
&lt;span&gt;121&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt; pygame.KEYUP:
&lt;/span&gt;&lt;span&gt;122&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;键盘按键抬起：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,event.key)
&lt;/span&gt;&lt;span&gt;123&lt;/span&gt; 
&lt;span&gt;124&lt;/span&gt; 
&lt;span&gt;125&lt;/span&gt; 
&lt;span&gt;126&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; event.type ==&lt;span&gt;pygame.VIDEORESIZE:
&lt;/span&gt;&lt;span&gt;127&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;屏幕大小有改变：&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,event.size)
&lt;/span&gt;&lt;span&gt;128&lt;/span&gt;             winWidth=&lt;span&gt;event.size[0]
&lt;/span&gt;&lt;span&gt;129&lt;/span&gt;             winHeight=event.size[1&lt;span&gt;]
&lt;/span&gt;&lt;span&gt;130&lt;/span&gt;             screen = pygame.display.set_mode((winWidth, winHeight), mod)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;自定义事件处理：&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;可绑定标准事件，但传递参数不一定需要标准，可在标准事件捕获到自定义事件：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; eventx=pygame.event.Event(pygame.KEYDOWN,{&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ww&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:33&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;pygame.event.post(eventx)
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; 
&lt;span&gt;4&lt;/span&gt; &lt;span&gt;#&lt;/span&gt;&lt;span&gt; 所有事件的监听，处理&lt;/span&gt;
&lt;span&gt;5&lt;/span&gt; &lt;span&gt;for&lt;/span&gt; event &lt;span&gt;in&lt;/span&gt;&lt;span&gt; pygame.event.get():
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;      &lt;span&gt;if&lt;/span&gt; event.type ==pygame.KEYDOWN:&lt;span&gt;#&lt;/span&gt;&lt;span&gt;键盘按键事件&lt;/span&gt;
&lt;span&gt;7&lt;/span&gt;          &lt;span&gt;print&lt;/span&gt;(event.ww) &lt;span&gt;#&lt;/span&gt;&lt;span&gt;输出33&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;




&lt;hr/&gt;&lt;p&gt;Pygame官网：&lt;a href=&quot;https://www.pygame.org/docs/&quot;&gt;https://www.pygame.org/docs/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;参考：嵩天教授的Python游戏开发教程（pygame）&lt;/p&gt;

</description>
<pubDate>Sun, 25 Nov 2018 05:49:00 +0000</pubDate>
<dc:creator>东小东</dc:creator>
<og:description>Pygame是跨平台Python模块，专为电子游戏设计，包含图像、声音。建立在SDL基础上，允许实时电子游戏研发而无需被低级语言（如机器语言和汇编语言）束缚。基于这样一个设想，所有需要的游戏功能和理念</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/dongxiaodong/p/10015451.html</dc:identifier>
</item>
<item>
<title>从零开始认识并操纵Mybatis - Autom_liu</title>
<link>http://www.cnblogs.com/autom/p/10015421.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/autom/p/10015421.html</guid>
<description>&lt;p class=&quot;toc&quot;&gt;目录&lt;/p&gt;
&lt;p&gt;@(认识并操纵Mybatis)&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;声明：从零开始，并不代表你对java Mybatis一点都不懂的程度哈，本实例只是过一个概貌，详细内容会分多篇文章拆解&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;用户模块的管理，用户表的维护：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;添加用户&lt;/li&gt;
&lt;li&gt;修改用户信息&lt;/li&gt;
&lt;li&gt;删除用户&lt;/li&gt;
&lt;li&gt;查询用户
&lt;ol&gt;&lt;li&gt;id查询单个&lt;/li&gt;
&lt;li&gt;用户名模糊查询&lt;/li&gt;
&lt;li&gt;查询所有&lt;/li&gt;
&lt;li&gt;查询总数&lt;/li&gt;
&lt;li&gt;根据ids查询&lt;/li&gt;
&lt;li&gt;多条件查询&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;用户和订单关联管理&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;根据订单查询对应用户信息&lt;/li&gt;
&lt;li&gt;根据用户查询所有订单信息&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;只使用&lt;code&gt;Mybatis&lt;/code&gt;，不集成其他框架。Mybatis版本为^3.4&lt;/p&gt;
&lt;p&gt;开发工具使用&lt;code&gt;eclipse&lt;/code&gt; 使用的是纯 java Project&lt;/p&gt;
&lt;p&gt;整个流程的详细项目代码可以踩我的github结合观光：&lt;a href=&quot;https://github.com/Autom-liu/MybatisLearn&quot; class=&quot;uri&quot;&gt;https://github.com/Autom-liu/MybatisLearn&lt;/a&gt; 每一个步骤都分得很清晰哦，可以clone下来再研究&lt;/p&gt;

&lt;h2 id=&quot;是什么&quot;&gt;是什么&lt;/h2&gt;
&lt;p&gt;MyBatis是一个优秀的持久层框架，不算完整的ORM框架&lt;/p&gt;
&lt;h2 id=&quot;历史&quot;&gt;历史&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;MyBatis 本是apache的一个开源项目iBatis,&lt;/li&gt;
&lt;li&gt;2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。&lt;/li&gt;
&lt;li&gt;2013年11月迁移到Github。&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;传统jdbc存在的问题&quot;&gt;传统JDBC存在的问题&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;数据库连接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库连接池可解决此问题。
&lt;ul&gt;&lt;li&gt;Mybatis 在配置文件中配置了数据连接池，使用连接池管理数据库链接。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Sql语句写在代码中造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。
&lt;ul&gt;&lt;li&gt;Mybatis 将Sql语句配置在配置文件中与java代码分离。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;向sql语句传参数麻烦，因为sql语句的where条件不一定，可能多也可能少，占位符需要和参数一一对应。
&lt;ul&gt;&lt;li&gt;Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;对结果集解析麻烦，sql变化导致解析代码变化，且解析前需要遍历，如果能将数据库记录封装成pojo对象解析比较方便。
&lt;ul&gt;&lt;li&gt;Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;与完整的orm框架hibernate的区别&quot;&gt;与完整的ORM框架Hibernate的区别&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;Mybatis不完全是一个ORM框架，因为MyBatis需要程序员自己编写Sql语句。mybatis可以通过XML或注解方式灵活配置要运行的sql语句，并将java对象和sql语句映射生成最终执行的sql，最后将sql执行的结果再映射生成java对象。&lt;/li&gt;
&lt;li&gt;Mybatis学习门槛低，简单易学，程序员直接编写原生态sql，可严格控制sql执行性能，灵活度高，非常适合对关系数据模型要求不高的软件开发，例如互联网软件、企业运营类软件等，因为这类软件需求变化频繁，一但需求变化要求成果输出迅速。但是灵活的前提是mybatis无法做到数据库无关性，如果需要实现支持多种数据库的软件则需要自定义多套sql映射文件，工作量大。&lt;/li&gt;
&lt;li&gt;Hibernate对象/关系映射能力强，数据库无关性好，对于关系模型要求高的软件（例如需求固定的定制化软件）如果用hibernate开发可以节省很多代码，提高效率。但是Hibernate的学习门槛高，要精通门槛更高，而且怎么设计O/R映射，在性能和对象模型之间如何权衡，以及怎样用好Hibernate需要具有很强的经验和能力才行。&lt;/li&gt;
&lt;li&gt;总之，按照用户的需求在有限的资源环境下只要能做出维护性、扩展性良好的软件架构都是好架构，所以框架只有适合才是最好。&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;&lt;strong&gt;简单来说，Mybatis为什么流行，Hibernate为什么落幕，终归在于移动互联网的世界趋势，迭代更新快，要求变化杂而多。不可能再像以往那样，形成完整稳定的需求再开发的阶段了....越贴近底层原生越有价值，越是封装包装限制也越大&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;mybatis架构&quot;&gt;Mybatis架构&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;http://note.youdao.com/yws/res/21920/WEBRESOURCEd6a257f28b1a675b6ae934a964677009&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;下载和导包&quot;&gt;下载和导包&lt;/h2&gt;
&lt;p&gt;下载链接：&lt;a href=&quot;https://github.com/mybatis/mybatis-3/releases&quot; class=&quot;uri&quot;&gt;https://github.com/mybatis/mybatis-3/releases&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;目录结构：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://note.youdao.com/yws/res/21924/WEBRESOURCEdb6b08d6f74e33d8c27a514680de36ea&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;导包：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Mybatis核心包&lt;/li&gt;
&lt;li&gt;Mybatis依赖包&lt;/li&gt;
&lt;li&gt;数据库驱动包 注：这里使用的是老版本的5.1的包，新版本有很大改动！&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;准备数据库和java-bean&quot;&gt;准备数据库和Java Bean&lt;/h2&gt;
&lt;p&gt;两张表： 用户表 + 订单表 基本创建即可，无其他关联&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://note.youdao.com/yws/res/21938/WEBRESOURCE3b4667266e09d758260ae360b68dfa1a&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://note.youdao.com/yws/res/21940/WEBRESOURCEc161a7a1dc6430432577942404943285&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;准备javaBean 就不多说了，要注意的一点就是，javaBean最好实现&lt;br/&gt;&lt;code&gt;Serializable&lt;/code&gt;序列化接口持久化，还有一点就是命名规范吧，不同人说法不同，有些是直接干脆和数据库字段名一样，而这里不那么一致，使用编程语言中统一的驼峰命名法，而不是数据库中的短划线分割。&lt;/p&gt;
&lt;p&gt;要相信的是，任何一个框架总会帮我们解决这个映射问题的！&lt;/p&gt;
&lt;h2 id=&quot;配置mybatis&quot;&gt;配置Mybatis&lt;/h2&gt;
&lt;p&gt;在官方给出的文档当中给出了我们这样的配置：&lt;/p&gt;
&lt;p&gt;官方的文件名是： mybatis-config.xml 当然这并不是定死的。&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;!DOCTYPE configuration
PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&amp;gt;
&amp;lt;configuration&amp;gt;
&amp;lt;environments default=&quot;development&quot;&amp;gt;
&amp;lt;environment id=&quot;development&quot;&amp;gt;
&amp;lt;transactionManager type=&quot;JDBC&quot;/&amp;gt;
&amp;lt;dataSource type=&quot;POOLED&quot;&amp;gt;
&amp;lt;property name=&quot;driver&quot; value=&quot;${driver}&quot;/&amp;gt;
&amp;lt;property name=&quot;url&quot; value=&quot;${url}&quot;/&amp;gt;
&amp;lt;property name=&quot;username&quot; value=&quot;${username}&quot;/&amp;gt;
&amp;lt;property name=&quot;password&quot; value=&quot;${password}&quot;/&amp;gt;
&amp;lt;/dataSource&amp;gt;
&amp;lt;/environment&amp;gt;
&amp;lt;/environments&amp;gt;
&amp;lt;mappers&amp;gt;
&amp;lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&amp;gt;
&amp;lt;/mappers&amp;gt;
&amp;lt;/configuration&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这个是主配置文件，也就是架构当中的最顶层，基本上参照这个配置copy，稍作修改即可，就不再导入约束啥的了。&lt;/p&gt;
&lt;p&gt;比如在本次配置里，创建的是src/sqlMap.xml，文件名不是固定的，后边程序会指定&lt;/p&gt;
&lt;p&gt;还有一点就是：不用太在意每个配置项的含义，大概看得懂就行，因为后期往往需要整合spring，这些配置全部不用了，作为入门程序而已，给大家观光一下&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;!DOCTYPE configuration
    PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&amp;gt;
&amp;lt;configuration&amp;gt;
    &amp;lt;environments default=&quot;development&quot;&amp;gt;
        &amp;lt;environment id=&quot;development&quot;&amp;gt;
            &amp;lt;transactionManager type=&quot;JDBC&quot;/&amp;gt;
            &amp;lt;dataSource type=&quot;POOLED&quot;&amp;gt;
                &amp;lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&amp;gt;
                &amp;lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/test?characterEncoding=utf-8&quot;/&amp;gt;
                &amp;lt;property name=&quot;username&quot; value=&quot;root&quot;/&amp;gt;
                &amp;lt;property name=&quot;password&quot; value=&quot;****&quot;/&amp;gt;
            &amp;lt;/dataSource&amp;gt;
        &amp;lt;/environment&amp;gt;
    &amp;lt;/environments&amp;gt;
    &amp;lt;mappers&amp;gt;
        &amp;lt;mapper resource=&quot;sqlMap/User.xml&quot;/&amp;gt;
    &amp;lt;/mappers&amp;gt;
&amp;lt;/configuration&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;编写sql映射文件&quot;&gt;编写sql映射文件&lt;/h2&gt;
&lt;p&gt;这里可以看到Mapper标签，是引入其他映射文件，这个文件就是架构当中的第二层，多个mapper的组成，每个mapper都是若干个sql语句&lt;/p&gt;
&lt;p&gt;到这里就需要考虑实现业务的sql语句应该如何书写了，这里先只贴出增和查的业务，剩下都以举例完成&lt;/p&gt;
&lt;p&gt;sqlMap/User.xml&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;mapper namespace=&quot;user&quot;&amp;gt;
    &amp;lt;select id=&quot;findUser&quot; resultType=&quot;edu.scnu.bean.User&quot; parameterType=&quot;Integer&quot;&amp;gt;
        select * from mb_user where id = #{id}
    &amp;lt;/select&amp;gt;
    &amp;lt;select id=&quot;getByUsername&quot; resultType=&quot;edu.scnu.bean.User&quot; parameterType=&quot;String&quot;&amp;gt;
        select * from mb_user where username like &quot;%&quot;#{username}&quot;%&quot;
    &amp;lt;/select&amp;gt;
    &amp;lt;insert id=&quot;save&quot; parameterType=&quot;edu.scnu.bean.User&quot;&amp;gt;
        insert into mb_user (username,birthday,sex,address) values (#{username}, #{birthday}, #{sex}, #{address})
    &amp;lt;/insert&amp;gt;
&amp;lt;/mapper&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;namespace 是命名空间，这个真正的妙用后面体现出来，这里暂时只需要知道用于区分同名作用域即可&lt;/p&gt;
&lt;p&gt;id 可以认为是该条sql语句的标识符&lt;/p&gt;
&lt;p&gt;parameterType 传递进来的参数类型，可以看到基本数据类型可以省略，而其他的就要完整类名了&lt;/p&gt;
&lt;p&gt;resultType 返回值类型，同上一样&lt;/p&gt;
&lt;p&gt;select 标签用于书写select查询语句&lt;/p&gt;
&lt;p&gt;insert 标签用于书写insert插入语句 update delete一样&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;尝试了一下 select 书写insert好像也可以，但不推荐&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;关于模糊查询的补充&quot;&gt;关于模糊查询的补充&lt;/h3&gt;
&lt;p&gt;在Mybatis中使用 &lt;code&gt;#{}&lt;/code&gt; 作为占位符，占位符的作用在于会在标识符取得结果后前后加单引号。&lt;/p&gt;
&lt;p&gt;如果直接使用：&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;select * from mb_user where username like &quot;%#{username}%&quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;就不对了，因为假如username=admin 结果变为：&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;select * from mb_user where username like &quot;%'admin'%&quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;就语法错误或没有结果&lt;/p&gt;
&lt;p&gt;可以使用 &lt;code&gt;${}&lt;/code&gt; 这种字符串拼接的方式&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;select * from mb_user where username like &quot;%${username}%&quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;不过这样只是没有了占位符参数的效果了而已。&lt;/p&gt;
&lt;h2 id=&quot;书写dao类&quot;&gt;书写Dao类&lt;/h2&gt;
&lt;p&gt;接下来就到来书写真正的Dao类了，这里还是按照规范实现接口&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public interface UserDao {
    void save(User user);
    void update(User user);
    void delete(Integer id);
    User find(Integer id);
//  List&amp;lt;User&amp;gt; getAll();
//  Integer getCount();
    List&amp;lt;User&amp;gt; getByUsername(String username);
//  List&amp;lt;User&amp;gt; getByCond(User user);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;看下实现类：&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class UserDaoImpl implements UserDao {

    private SqlSessionFactory sqlSessionFactory;

    // 没有spring帮助下，就需要外部手动注入！
    public UserDaoImpl(SqlSessionFactory sqlSessionFactory) {
        this.sqlSessionFactory = sqlSessionFactory;
    }

    @Override
    public void save(User user) {
        SqlSession session = sqlSessionFactory.openSession();
        session.insert(&quot;user.save&quot;, user);
        session.commit();
    }

    @Override
    public User find(Integer id) {
        SqlSession session = sqlSessionFactory.openSession();
        return session.selectOne(&quot;user.findUser&quot;, id);
    }

    @Override
    public List&amp;lt;User&amp;gt; getByUsername(String username) {
        SqlSession session = sqlSessionFactory.openSession();
        return session.selectList(&quot;user.getByUsername&quot;, username);
    }

}&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;测试类&quot;&gt;测试类&lt;/h2&gt;
&lt;p&gt;最后即可编写测试了&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class MybatisTest {
    
    private SqlSessionFactory sqlSessionFactory;
    private UserDao userDao;
    
    @Before
    public void before() throws Exception{
        String resource = &quot;sqlMap.xml&quot;;
        InputStream inputStream = Resources.getResourceAsStream(resource);
        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        userDao = new UserDaoImpl(sqlSessionFactory);
    }
    
    @Test
    public void testFind() {
        userDao.find(1);
    }
    
    @Test
    public void testGetByUsername() {
        userDao.getByUsername(&quot;王&quot;);
    }
    
    @Test
    public void testSave() {
        userDao.save(new User(&quot;未知用户&quot;, &quot;2&quot;, new Date(), &quot;中国&quot;));
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;返回id-的save&quot;&gt;返回id 的save&lt;/h2&gt;
&lt;p&gt;现在对实现增加用户新增需求，就是在新增用户的同时根据该用户ID查询该订单信息&lt;/p&gt;
&lt;p&gt;这时候我们首先要获取新增用户后的id，但是新增用户是数据库给我们返回的是受影响条数，如何快速获得最新插入数据的id呢&lt;/p&gt;
&lt;p&gt;sql语法提供了 &lt;code&gt;select LAST_INSERT_ID()&lt;/code&gt;供我们获取最新插入数据的ID，我们可以将该sql嵌入到sql配置文件中去&lt;/p&gt;
&lt;p&gt;这里简单讲解配置语法：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;selectKey 标签实现主键返回&lt;/li&gt;
&lt;li&gt;keyColumn:主键对应的表中的哪一列&lt;/li&gt;
&lt;li&gt;keyProperty：主键对应的pojo（Bean）中的哪一个属性&lt;/li&gt;
&lt;li&gt;order：设置在执行insert语句前执行查询id的sql，还是在执行insert语句之后执行查询id的sql&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;使用主键自增策略的id：&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;!-- 生成主键的顺序Mysql是之后，oracle是之前 --&amp;gt;
&amp;lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;Integer&quot; order=&quot;AFTER&quot;&amp;gt;
    select LAST_INSERT_ID()
&amp;lt;/selectKey&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;使用uuid的String&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;selectKey keyColumn=&quot;id&quot; keyProperty=&quot;id&quot; order=&quot;BEFORE&quot; resultType=&quot;string&quot;&amp;gt;
    select LAST_INSERT_ID()
&amp;lt;/selectKey&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这里可以修改上述插入SQL语法配置：&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;insert id=&quot;save&quot; parameterType=&quot;edu.scnu.bean.User&quot;&amp;gt;
    &amp;lt;!-- 生成主键的顺序Mysql是之后，oracle是之前 --&amp;gt;
    &amp;lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;Integer&quot; order=&quot;AFTER&quot;&amp;gt;
        select LAST_INSERT_ID()
    &amp;lt;/selectKey&amp;gt;
    insert into mb_user (username,birthday,sex,address) values (#{username}, #{birthday}, #{sex}, #{address})
&amp;lt;/insert&amp;gt;&lt;/code&gt;
&lt;/pre&gt;

&lt;ul&gt;&lt;li&gt;Dao方法体存在重复代码：通过SqlSessionFactory创建SqlSession，调用SqlSession的数据库操作方法&lt;/li&gt;
&lt;li&gt;调用sqlSession的数据库操作方法需要指定statement的id，这里存在硬编码，不得于开发维护。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;上述问题主要关键还是在于同类型的枯燥性重复性代码，只有少数参数传递部分要变动，其它基本都是同样的套路，因此可不可以有个办法一些重复性工作呢？Mybatis贴心为我们服务了这一点，它省去的不仅仅是一两条语句，它把整个实现类都为我们省去了。来看看它是怎么工作的吧！&lt;/p&gt;

&lt;p&gt;Mapper接口开发方法只需要程序员编写Mapper接口（相当于Dao接口），由Mybatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法。&lt;/p&gt;
&lt;p&gt;Mapper接口开发需要遵循以下规范：&lt;br/&gt;1、 Mapper.xml文件中的namespace与mapper接口的类路径相同。&lt;br/&gt;2、 Mapper接口方法名和Mapper.xml中定义的每个statement的id相同&lt;br/&gt;3、 Mapper接口方法的输入参数类型和mapper.xml中定义的每个sql 的parameterType的类型相同&lt;br/&gt;4、 Mapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同&lt;/p&gt;
&lt;p&gt;也就是说，我们要完成的只是接口，实现类框架帮我们搞定了...&lt;/p&gt;
&lt;p&gt;那么首先来修改优化一下配置文件&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;!-- 使用动态代理开发DAO，1. namespace必须和Mapper接口类路径一致 --&amp;gt;
&amp;lt;mapper namespace=&quot;edu.scnu.dao.UserDao&quot;&amp;gt;
    &amp;lt;!-- 根据用户id查询用户 --&amp;gt;
    &amp;lt;!-- 2. id必须和Mapper接口方法名一致 --&amp;gt;
    &amp;lt;!-- 3. parameterType必须和接口方法参数类型一致 --&amp;gt;
    &amp;lt;!-- 4. resultType必须和接口方法返回值类型一致 --&amp;gt;
    &amp;lt;select id=&quot;find&quot; resultType=&quot;edu.scnu.bean.User&quot; parameterType=&quot;Integer&quot;&amp;gt;
        select * from mb_user where id = #{id}
    &amp;lt;/select&amp;gt;
    &amp;lt;select id=&quot;getByUsername&quot; resultType=&quot;edu.scnu.bean.User&quot; parameterType=&quot;String&quot;&amp;gt;
        select * from mb_user where username like &quot;%&quot;#{username}&quot;%&quot;
    &amp;lt;/select&amp;gt;
    &amp;lt;insert id=&quot;save&quot; parameterType=&quot;edu.scnu.bean.User&quot;&amp;gt;
        &amp;lt;!-- 生成主键的顺序Mysql是之后，oracle是之前 --&amp;gt;
        &amp;lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;Integer&quot; order=&quot;AFTER&quot;&amp;gt;
            select LAST_INSERT_ID()
        &amp;lt;/selectKey&amp;gt;
        insert into mb_user (username,birthday,sex,address) values (#{username}, #{birthday}, #{sex}, #{address})
    &amp;lt;/insert&amp;gt;
&amp;lt;/mapper&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;接下来如果把实现类删除了，我们发现测试类实例化就报错了，这时候我们需要通过session的getMapper方法获得Mybatis帮我们创建好的实现类&lt;/p&gt;
&lt;p&gt;测试类：&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Before
public void before() throws Exception{
    String resource = &quot;sqlMapConfig.xml&quot;;
    InputStream inputStream = Resources.getResourceAsStream(resource);
    sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
    SqlSession session = sqlSessionFactory.openSession();
    userDao = session.getMapper(UserDao.class);
}&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;到目前为止，我们书写了两个配置文件，这两个配置文件开始出现不仅繁杂不好维护的问题，还有挺多不规范的地方：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;数据库连接参数不应该直接在xml配置当中，应该提取出来：&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;使用property属性&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;!-- 是用resource属性加载外部配置文件 --&amp;gt;
&amp;lt;properties resource=&quot;db.properties&quot;&amp;gt;
    &amp;lt;!-- 在properties内部用property定义属性 --&amp;gt;
    &amp;lt;!-- 如果外部配置文件有该属性，则内部定义属性被外部属性覆盖 --&amp;gt;
    &amp;lt;property name=&quot;jdbc.password&quot; value=&quot;root&quot; /&amp;gt;
&amp;lt;/properties&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dataSource type=&quot;POOLED&quot;&amp;gt;
    &amp;lt;property name=&quot;driver&quot; value=&quot;${jdbc.driver}&quot;/&amp;gt;
    &amp;lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&amp;gt;
    &amp;lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&amp;gt;
    &amp;lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&amp;gt;
&amp;lt;/dataSource&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;类名过长重复&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;使用typeAliases属性自定义别名&lt;/p&gt;
&lt;p&gt;mybatis已经为我们提供了很多基本数据类型以及包装类的别名，同样，我们也可以自己自定义类名别名&lt;/p&gt;
&lt;p&gt;支持单个别名的定义&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;typeAliases&amp;gt;
    &amp;lt;!-- 单个别名定义 --&amp;gt;
&amp;lt;typeAlias alias=&quot;user&quot; type=&quot;edu.scnu.bean.User&quot; /&amp;gt;
&amp;lt;/typeAliases&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;还有批量定义，这里选用批量定义的方式&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;typeAliases&amp;gt;
    &amp;lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（大小写不敏感） --&amp;gt;
    &amp;lt;package name=&quot;edu.scnu.bean&quot; /&amp;gt;
&amp;lt;/typeAliases&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这样后续的所有ResultType 和 parameterType只需要直接写User或user即可&lt;/p&gt;
&lt;p&gt;诡异的是，也是需要注意的是顺序问题&lt;/p&gt;
&lt;p&gt;typeAliases 必须紧跟 property 后&lt;/p&gt;

&lt;h2 id=&quot;resource&quot;&gt;resource&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;使用相对于类路径的资源（现在的使用方式）
&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;class&quot;&gt;class&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;使用mapper接口类路径
&lt;ul&gt;&lt;li&gt;如：&lt;/li&gt;
&lt;li&gt;注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;section&quot;/&gt;
&lt;ul&gt;&lt;li&gt;注册指定包下的所有mapper接口
&lt;ul&gt;&lt;li&gt;如：&lt;/li&gt;
&lt;li&gt;注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。&lt;/li&gt;
&lt;li&gt;用于批量引入&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;接下来我们来完善其他业务功能，这里为了演示以下各类几种输入和输出类型的情况，我们增加一个实体类型包装实体&lt;/p&gt;
&lt;p&gt;输入类型：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;基本类型&lt;/li&gt;
&lt;li&gt;实体类型&lt;/li&gt;
&lt;li&gt;实体类型包装类&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;说白了传递引用类型，会自动把所有引用属性转化为map对象，这点和struts的OGNL表达式类似&lt;/p&gt;
&lt;p&gt;输出类型：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;基本类型&lt;/li&gt;
&lt;li&gt;实体&lt;/li&gt;
&lt;li&gt;实体列表
&lt;ul&gt;&lt;li&gt;只需要传递泛型类型（集合元素的类型即可）&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;然后来完善我们其他功能&lt;/p&gt;
&lt;p&gt;parameterType为实体包装类的情况&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;update id=&quot;update&quot; parameterType=&quot;UserWrapper&quot;&amp;gt;
    update mb_user set username=#{user.username}, birthday=#{user.birthday}, sex=#{user.sex}, address=#{user.address} where id=#{user.id}
&amp;lt;/update&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;resultType为基本类型的情况&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;getCount&quot; resultType=&quot;int&quot;&amp;gt;
    select count(*) from mb_user
&amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;使用where标签和if标签&quot;&gt;使用where标签和if标签&lt;/h2&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;getByCond&quot; parameterType=&quot;User&quot; resultType=&quot;User&quot;&amp;gt;
    select * from mb_user
    &amp;lt;where&amp;gt;
        &amp;lt;if test=&quot;sex != null and sex != ''&quot;&amp;gt;
            and sex = #{sex}
        &amp;lt;/if&amp;gt;
        &amp;lt;if test=&quot;username != null and username != ''&quot;&amp;gt;
            and username = #{username}
        &amp;lt;/if&amp;gt;
        &amp;lt;if test=&quot;address != null and address != ''&quot;&amp;gt;
            and address = #{address}
        &amp;lt;/if&amp;gt;
    &amp;lt;/where&amp;gt;
&amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;使用sql片段简化&quot;&gt;使用sql片段简化&lt;/h2&gt;
&lt;h2 id=&quot;sql标签声明-include引入&quot;&gt;sql标签声明 include引入&lt;/h2&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;sql id=&quot;selectSql&quot;&amp;gt;
    select * from ub_user
&amp;lt;/sql&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;find&quot; resultType=&quot;User&quot; parameterType=&quot;Integer&quot;&amp;gt;
    &amp;lt;include refid=&quot;selectSql&quot; /&amp;gt; where id = #{id}
&amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;使用foreach标签实现多id查询&quot;&gt;使用foreach标签实现多id查询&lt;/h2&gt;
&lt;p&gt;原理&lt;/p&gt;
&lt;p&gt;select * from mb_user where id in (1,2,3);&lt;/p&gt;
&lt;p&gt;以java数组传递参数&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;getByIds&quot; parameterType=&quot;Integer&quot; resultType=&quot;User&quot;&amp;gt;
    &amp;lt;include refid=&quot;selectSql&quot; /&amp;gt;
    &amp;lt;where&amp;gt;
        &amp;lt;foreach collection=&quot;array&quot; item =&quot;id&quot; separator=&quot;,&quot; open=&quot;id in (&quot; close=&quot;)&quot;&amp;gt;
            #{id}
        &amp;lt;/foreach&amp;gt;
    &amp;lt;/where&amp;gt;
&amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;以list集合传递参数&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;getByIds&quot; parameterType=&quot;Integer&quot; resultType=&quot;User&quot;&amp;gt;
    &amp;lt;include refid=&quot;selectSql&quot; /&amp;gt;
    &amp;lt;where&amp;gt;
        &amp;lt;foreach collection=&quot;list&quot; item =&quot;id&quot; separator=&quot;,&quot; open=&quot;id in (&quot; close=&quot;)&quot;&amp;gt;
            #{id}
        &amp;lt;/foreach&amp;gt;
    &amp;lt;/where&amp;gt;
&amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;之前我们说到，订单Dao类是以驼峰命名的，而数据库字段是下划线命名的&lt;/p&gt;
&lt;p&gt;在之前同名的情况都可以自动映射，那么针对这种不同名的情况又如何呢？&lt;/p&gt;
&lt;p&gt;我们先简单完成以下订单的其中一个业务&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public interface OrdersDao {
    List&amp;lt;Orders&amp;gt; getAll();
}&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;一对一&quot;&gt;一对一&lt;/h2&gt;
&lt;h3 id=&quot;方式一使用新建实体类继承关系&quot;&gt;方式一、使用新建实体类继承关系&lt;/h3&gt;
&lt;p&gt;新建一个OrdersUser 的javaBean类&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class OrdersUser extends Orders {
    private String username;
    private String address;
    // ...
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;配置OrdersUser.xml&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;mapper namespace=&quot;edu.scnu.dao.OrdersUserDao&quot;&amp;gt;
    &amp;lt;select id=&quot;queryAll&quot; resultType=&quot;OrdersUser&quot;&amp;gt;
        SELECT
            o.id,
            o.user_id
            userId,
            o.number,
            o.createtime,
            o.note,
            u.username,
            u.address
        FROM
            `order` o
        LEFT JOIN `user` u ON o.user_id = u.id

    &amp;lt;/select&amp;gt;

&amp;lt;/mapper&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;方式二直接多对一关系映射&quot;&gt;方式二、直接多对一关系映射&lt;/h3&gt;
&lt;p&gt;直接在Orders实体类下增加User字段，并在配置文件里作如下映射：&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;resultMap type=&quot;Orders&quot; id=&quot;orderResultMap&quot;&amp;gt;
    &amp;lt;!-- 定义主键 ,非常重要。如果是多个字段,则定义多个id --&amp;gt;
    &amp;lt;id property=&quot;id&quot; column=&quot;id&quot;&amp;gt;&amp;lt;/id&amp;gt;
    &amp;lt;result property=&quot;userId&quot; column=&quot;user_id&quot;/&amp;gt;
    &amp;lt;!-- 关联，属性全写上 --&amp;gt;
    &amp;lt;result property=&quot;number&quot; column=&quot;number&quot; /&amp;gt;
    &amp;lt;result property=&quot;createtime&quot; column=&quot;createtime&quot; /&amp;gt;
    &amp;lt;result property=&quot;note&quot; column=&quot;note&quot; /&amp;gt;
    
    
    &amp;lt;association property=&quot;user&quot; javaType=&quot;User&quot;&amp;gt;
        &amp;lt;!-- id:声明主键，表示user_id是关联查询对象的唯一标识--&amp;gt;
        &amp;lt;id property=&quot;id&quot; column=&quot;user_id&quot; /&amp;gt;
        &amp;lt;result property=&quot;username&quot; column=&quot;username&quot; /&amp;gt;
        &amp;lt;result property=&quot;address&quot; column=&quot;address&quot; /&amp;gt;
    &amp;lt;/association&amp;gt;
&amp;lt;/resultMap&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;一对多关系&quot;&gt;一对多关系&lt;/h2&gt;
&lt;p&gt;一对多关系只能使用resultMap的collection映射&lt;/p&gt;
&lt;p&gt;同样在User Bean类中添加List&amp;lt;Orders&amp;gt;字段&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;private List&amp;lt;Orders&amp;gt; orders;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;resultMap type=&quot;User&quot; id=&quot;UserOrdersResultMap&quot;&amp;gt;
    &amp;lt;id property=&quot;id&quot; column=&quot;id&quot; /&amp;gt;
    &amp;lt;result property=&quot;username&quot; column=&quot;username&quot;/&amp;gt;
    &amp;lt;result property=&quot;address&quot; column=&quot;address&quot;/&amp;gt;
    &amp;lt;collection property=&quot;orders&quot; javaType=&quot;List&quot; ofType=&quot;Orders&quot;&amp;gt;
        &amp;lt;result property=&quot;id&quot; column=&quot;oid&quot;/&amp;gt;
        &amp;lt;result property=&quot;createtime&quot; column=&quot;createtime&quot;/&amp;gt;
        &amp;lt;result property=&quot;number&quot; column=&quot;number&quot;/&amp;gt;
    &amp;lt;/collection&amp;gt;
&amp;lt;/resultMap&amp;gt;
&amp;lt;select id=&quot;getWithOrders&quot; resultMap=&quot;UserOrdersResultMap&quot;&amp;gt;
    SELECT
        u.id,
        u.username,
        u.address,
        o.id oid,
        o.number,
        o.createtime
    FROM
        `mb_user` u
    LEFT JOIN `mb_orders` o ON u.id = o.user_id
&amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;好了，到这里已经介绍了单独使用Mybatis操纵的所有功能，整个流程到这里就算完成了，整个流程的详细项目代码可以踩我的github结合观光：&lt;a href=&quot;https://github.com/Autom-liu/MybatisLearn&quot; class=&quot;uri&quot;&gt;https://github.com/Autom-liu/MybatisLearn&lt;/a&gt; ，整个流程涉及到诸多知识细节需要慢慢琢磨，这里只给大家展示整个概貌，具体细节会在后续的文章中慢慢解释，还会给大家展示Mybatis和Spring整合后的精彩内容哦，期待大家的支持和star~~~&lt;/p&gt;
</description>
<pubDate>Sun, 25 Nov 2018 05:38:00 +0000</pubDate>
<dc:creator>Autom_liu</dc:creator>
<og:description>@</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/autom/p/10015421.html</dc:identifier>
</item>
<item>
<title>【ABP框架系列学习】模块系统(4)之示例开发 - 大龄Giser</title>
<link>http://www.cnblogs.com/OlderGiser/p/10015246.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/OlderGiser/p/10015246.html</guid>
<description>&lt;p&gt;上一篇博文主要介绍了ABP模块及插件的相关知识，本章节主要开发一个插件示例来学习如何创建一个插件，并在应用程序中使用。这个命名为&lt;code&gt;&lt;strong&gt;FirstABPPlugin&lt;/strong&gt;的插件主要在指定的时间段内删除审计日志。&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;(1).新建项目，选择【类库(.NET Core)】&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;20&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://img-blog.csdnimg.cn/20181125105337593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;942&quot; height=&quot;656&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20181125105337593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20181125105337593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;942&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;656&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(2).添加引用Abp、Abp.ZeroCore&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;19&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://img-blog.csdnimg.cn/20181125105555141.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;935&quot; height=&quot;537&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20181125105555141.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20181125105555141.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;935&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;537&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(3).创建&lt;strong&gt;FirstABPPluginModule&lt;/strong&gt;类，继承AbpModule类和声明依赖于&lt;strong&gt;AbpZeroCoreModule&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;(4).添加DeleteOldAuditLogsWorker类&lt;/p&gt;

&lt;p&gt;(5).最终结构如下&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;23&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://img-blog.csdnimg.cn/20181125113943738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;472&quot; height=&quot;535&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20181125113943738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20181125113943738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5bmNoZWU=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;472&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;535&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(6).生成项目，在bin/Debug/netcoreapp2.1目录下生成FirstABPPlugin.dll&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;25&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://img-blog.csdnimg.cn/20181125120317798.png&quot; alt=&quot;&quot; width=&quot;692&quot; height=&quot;168&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20181125120317798.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20181125120317798.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;692&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;168&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;(1).启动ABP项目模版生成的程序，把刚生成的FirstABPPlugin.dll拷贝到wwwroot/Plugins目录下&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;30&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://img-blog.csdnimg.cn/20181125121956563.png&quot; alt=&quot;&quot; width=&quot;808&quot; height=&quot;179&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20181125121956563.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20181125121956563.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;808&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;179&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(2).在Mvc项目的Startup.cs类中，添加如下代码：&lt;/p&gt;

&lt;p&gt;(3)运行程序，查看Logs.txt日志记录&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;32&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://img-blog.csdnimg.cn/20181125123005172.png&quot; alt=&quot;&quot; width=&quot;1188&quot; height=&quot;98&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20181125123005172.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20181125123005172.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;1188&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;98&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 25 Nov 2018 04:33:00 +0000</pubDate>
<dc:creator>大龄Giser</dc:creator>
<og:description>0.引言 上一篇博文主要介绍了ABP模块及插件的相关知识，本章节主要开发一个插件示例来学习如何创建一个插件，并在应用程序中使用。这个命名为FirstABPPlugin的插件主要在指定的时间段内删除审计</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/OlderGiser/p/10015246.html</dc:identifier>
</item>
<item>
<title>js基础梳理-究竟什么是执行上下文栈（执行栈），执行上下文(可执行代码）？ - 炼心</title>
<link>http://www.cnblogs.com/hezhi/p/10014996.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hezhi/p/10014996.html</guid>
<description>&lt;p&gt;日常在群里讨论一些概念性的问题，比如变量提升，作用域和闭包相关问题的时候，经常会听一些大佬们给别人解释的时候说执行上下文，调用上下文巴拉巴拉，总有点似懂非懂，不明觉厉的感觉。今天，就对这两个概念梳理一下，加深对js基础核心的理解。&lt;/p&gt;
&lt;h2 id=&quot;执行上下文execution-context与可执行代码execution-code&quot;&gt;1. 执行上下文(execution context)与可执行代码（execution code）&lt;/h2&gt;
&lt;h4 id=&quot;首先说一下可执行代码的类型有哪些&quot;&gt;1.1 首先说一下，可执行代码的类型有哪些：&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;全局代码&lt;/strong&gt;：例如加载外部的js文件或者本地标签内的代码。全局代码不包括 function 体内的代码&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;函数代码&lt;/strong&gt;：function体内的代码&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;eval代码&lt;/strong&gt;：eval()函数计算某个字符串，并执行其中的js代码。比如eval(&quot;alert('hello world')&quot;)。虽然很强大，但实际用得很少，不讨论。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;当js引擎遇到这三种类型的代码的时候，都会进行一些准备工作，这些准备工作，专业的说法就叫执行上下文。或者说js引擎遇到这三种类型的代码的时候，就会进入到一个执行上下文。&lt;/p&gt;
&lt;p&gt;简而言之，执行上下文是评估和执行javascript代码的环境的抽象概念。每当javascript代码在运行的时候，它都是在执行上下文中运行。执行上下文可以理解为当前代码的执行环境，它会形成一个&lt;strong&gt;作用域&lt;/strong&gt;（╭(╯^╰)╮，作用域就作用域嘛，说得这么拗口，非要搞个什么执行上下文的概念）。&lt;/p&gt;
&lt;h4 id=&quot;那么js引擎在遇到可执行代码的时候它究竟会做哪些准备工作呢&quot;&gt;1.2 那么js引擎在遇到可执行代码的时候，它究竟会做哪些准备工作呢？&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;全局执行上下文&lt;/strong&gt;：创建一个全局的window对象（浏览器的情况下），并且设置 this 的值等于这个全局对象。一个程序中只会有一个全局执行上下文。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;函数执行上下文&lt;/strong&gt;：每当一个函数被调用时，都会为该函数创建一个新的上下文。每个函数都有自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序执行一系列步骤。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;eval函数执行上下文&lt;/strong&gt;：略&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;其实没必要刻意去区分可执行代码与执行上下文。个人理解，当别人跟你聊一些概念性的东西，聊到可执行代码，可执行上下文，执行环境的时候，其实他们可能是想说作用域，只不过表述方式不同罢了。&lt;/p&gt;
&lt;h2 id=&quot;执行上下文栈execution-context-stack-ecs&quot;&gt;2. 执行上下文栈（Execution context stack, ECS）&lt;/h2&gt;
&lt;p&gt;在一个javascript程序中，必定会产生多个执行上下文，javascript引擎会以栈的方式来处理它们，也就是执行上下文栈（很多文章可能会称它为执行栈，执行上下文堆栈，函数调用栈，其实都是差不多的意思）。&lt;/p&gt;
&lt;p&gt;关于栈的概念和特性在上一篇博客：&lt;a href=&quot;https://www.cnblogs.com/hezhi/p/9977402.html&quot;&gt;js基础梳理-内存空间&lt;/a&gt;已有介绍。&lt;/p&gt;
&lt;p&gt;为了模拟执行上下文栈的行为，可以把它定义为一个数组：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ECStack = [];&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;现在 javascript遇到下面这段代码了&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;let a = 'hello world';

function first () {
    console.log('进入 first 函数执行上下文');
    second();
    console.log('再次进入 first 函数执行上下文');
}

function second () {
    console.log('进入 second 函数执行上下文');
}

first();

console.log('进入 全局执行上下文（Global Execution Context）')&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;当上述代码在浏览器加载时，Javascipt引擎创建了一个全局执行上下文并把它压入了执行上下文栈，用 globalContext表示它，并且只有当整个应用程序结束的时候（浏览器关闭），ECStack才会被清空，所以程序结束之前，ECStack最底部永远有个 globalContext:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ECStack = [
    globalContext
];&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;当执行到一个函数的时候，就会创建一个执行上下文，并且压入执行上下文栈，当函数执行完毕的时候，就会将函数的执行上下文从栈中弹出。知道了这样的工作原理，就可以分析出 ECStack的变化过程：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// 伪代码

// first()
ECStack.push(&amp;lt;first&amp;gt; functionContext);

// first中调用了second,继续创建second的执行上下文
ECStack.push(&amp;lt;second&amp;gt; functionContext);

// second执行完毕
ECStack.pop();

// first执行完毕
ECStack.pop();

// javascript接着执行下面的代码，但是ECStack底层永远有个globalContext;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://ws1.sinaimg.cn/large/c294c6e6gy1fxk4es0g97j20rs04xjrc.jpg&quot; alt=&quot;image&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;注意：函数中，遇到return能终止可执行代码的执行，因此会直接将当前上下文弹出栈。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;例如，看以下这个闭包例子：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;function f1(){
    var n=999;
    function f2(){
        alert(n);
    }
    return f2;
}
var result=f1();
result(); // 999&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;因为f1中的函数f2在f1的可执行代码中，并没有被调用执行，因此执行f1时，f2不会创建新的上下文，而直到result执行时，才创建了一个新的。具体演变过程如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// 伪代码：
// 全局上下文入栈：
ECStack = [
    globalContext
];

// f1 EC入栈：
ECStack.push(&amp;lt;f1&amp;gt; functionContext);
// f1 EC出栈：
ECStack.pop();
// result EC入栈：
ECStack.push(&amp;lt;result&amp;gt; functionContext);
// result EC出栈：
ECStack.pop();&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;执行上下文的生命周期&quot;&gt;3.执行上下文的生命周期&lt;/h2&gt;
&lt;h4 id=&quot;创建阶段&quot;&gt;3.1 创建阶段&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;生成变量对象（Variable object, VO）&lt;/li&gt;
&lt;li&gt;建立作用域链（Scope chain）&lt;/li&gt;
&lt;li&gt;确定this指向&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;执行阶段&quot;&gt;3.2 执行阶段&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;变量赋值&lt;/li&gt;
&lt;li&gt;函数引用&lt;/li&gt;
&lt;li&gt;执行其他代码&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;在接下来的文章中将梳理创建阶段的这三个步骤。&lt;/p&gt;
</description>
<pubDate>Sun, 25 Nov 2018 03:45:00 +0000</pubDate>
<dc:creator>炼心</dc:creator>
<og:description>日常在群里讨论一些概念性的问题，比如变量提升，作用域和闭包相关问题的时候，经常会听一些大佬们给别人解释的时候说执行上下文，调用上下文巴拉巴拉，总有点似懂非懂，不明觉厉的感觉。今天，就对这两个概念梳理一</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/hezhi/p/10014996.html</dc:identifier>
</item>
<item>
<title>二叔看ML第一：梯度下降 - 会长</title>
<link>http://www.cnblogs.com/zzy0471/p/gradient_descent.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zzy0471/p/gradient_descent.html</guid>
<description>&lt;hr/&gt;&lt;h2 id=&quot;原理&quot;&gt;原理&lt;/h2&gt;
&lt;p&gt;梯度下降是一个很常见的通过迭代求解函数极值的方法，当函数非常复杂，通过求导寻找极值很困难时可以通过梯度下降法求解。梯度下降法流程如下：&lt;br/&gt;&lt;img src=&quot;http://static.zybuluo.com/zzy0471/f0fmxmvkv2fno9bo0diq7p29/image.png&quot; alt=&quot;image.png-10.8kB&quot;/&gt;&lt;br/&gt;上图中，用大写字母表示向量，用小写字母表示标量。&lt;/p&gt;
&lt;p&gt;假设某人想入坑，他站在某点，他每移动一小步，都朝着他所在点的梯度的负方向移动，这样能保证他尽快入坑，因为某个点的梯度方向是最陡峭的方向，如下图所示，此图画的不太能表达这个观点，但是懒得盗图了，意会吧：&lt;br/&gt;&lt;img src=&quot;http://static.zybuluo.com/zzy0471/qonbcxq5yurz230cnfsbomuk/image.png&quot; alt=&quot;54&quot;/&gt;&lt;/p&gt;
&lt;p&gt;以下举两个例子，两个例子中的被求函数都很简单，其实直接求导算极值更好，此处仅用来说明梯度下降法的步骤。&lt;/p&gt;
&lt;h2 id=&quot;实践一求y-x2---4x-1的最小值&quot;&gt;实践一：求&lt;span class=&quot;math inline&quot;&gt;\(y = x^2 - 4x + 1\)&lt;/span&gt;的最小值&lt;/h2&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;# -*- coding: utf-8 -*-

import numpy as np
import matplotlib.pyplot as plt

def descent(p, original_x = 50, steplength = 0.01):
    ''' gradient descent, return min y '''

    deriv = p.deriv(m = 1) # 多项式p的导函数
    Y = [] # 保存每次迭代后的y值，方便绘图
    count = 0 # 迭代次数
    x = original_x # 设置x初始值
    d = deriv(x) # x位置的导数
    threshold = 0.001 # 阈值，当梯度小于此值时停止迭代

    while np.abs(d) &amp;gt; threshold:
        x = x - d * steplength
        y = p(x)

        Y.append(y)
        count += 1
        d = deriv(x)

    plt.plot(np.arange(1, count + 1), Y)
    plt.show()
    return y

if __name__ == &quot;__main__&quot;:
    p = np.poly1d([2, -4, 1])
    min_y = descent(p)
    print(min_y)  &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;把迭代数和对应的函数值绘制出来以查看迭代效果：&lt;br/&gt;&lt;img src=&quot;http://static.zybuluo.com/zzy0471/26qmr701qs7cti2r4m7n4t39/image.png&quot; alt=&quot;image.png-15.1kB&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;实践二求z-x2-y2-5的最小值&quot;&gt;实践二：求&lt;span class=&quot;math inline&quot;&gt;\(z = x^2 + y^2 + 5\)&lt;/span&gt;的最小值&lt;/h2&gt;
&lt;p&gt;以下代码中，把一组x和y当成一个向量处理，即&lt;span class=&quot;math inline&quot;&gt;\(z = X^TX + 5\)&lt;/span&gt;，其中&lt;span class=&quot;math inline&quot;&gt;\(X=[x\ y]^T\)&lt;/span&gt;&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;import numpy as np
import matplotlib.pyplot as plt

def deriv(xy):
    dxy = 2 * xy
    return dxy

def descent(xy, steplength = 0.01):
    ''' gradient descent, return min y '''

    d = deriv(xy) # x^2 + y^2 + 5的梯度
    Y = [] # 保存每次迭代后的y值，方便绘图
    count = 0 # 迭代次数
    threshold = 0.001 # 阈值，当梯度的模小于此值时停止迭代

    while np.linalg.norm(d) &amp;gt; threshold:
        xy = xy - d * steplength
        y = np.dot(xy, xy) + 5

        Y.append(y)
        count += 1 
        d = deriv(xy)

    plt.plot(np.arange(1, count + 1), Y)
    plt.show()
    return Y[-1]

if __name__ == &quot;__main__&quot;:
    y = descent(np.array([50, 50]))
    print(y)  &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;把迭代数和对应的函数值绘制出来以查看迭代效果：&lt;br/&gt;&lt;img src=&quot;http://static.zybuluo.com/zzy0471/8h2n7m12cdpvo8jstz6g1th8/image.png&quot; alt=&quot;image.png-15.7kB&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;问答时间&quot;&gt;问答时间&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Q&lt;/strong&gt;：无法收敛到某个足够小的函数值，最后报错： overflow ...&lt;br/&gt;&lt;strong&gt;A&lt;/strong&gt;：步长设置太大，步子大了，容易跨过最低点，导致函数值在最低点上下震荡或发散，如图：&lt;br/&gt;&lt;img src=&quot;http://static.zybuluo.com/zzy0471/q88mwwgmhvsbwpiu5zt3gp0o/image.png&quot; alt=&quot;收敛情况&quot;/&gt;&lt;br/&gt;可以人为设置迭代次数（而不是通过阈值控制是否继续迭代），然后观察函数值是否收敛：&lt;br/&gt;&lt;img src=&quot;http://static.zybuluo.com/zzy0471/oxv69idat3xz9eiogz4gn2rc/image.png&quot; alt=&quot;步长的选择&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q&lt;/strong&gt;：如何选择合适的步长&lt;br/&gt;&lt;strong&gt;A&lt;/strong&gt;：步长太大会导致函数值不收敛，步长太小又浪费性能，可以通过绘制如上面的迭代次数和函数值关系图，刚才结果后调整步长，尽量选择满足需求的最大步长。达爷在他的网课中给出的建议是：按照这样的序列试验步长：..., 0.001, 0.003, 0.01, 0.03, 0.1, 0.3, 1, ...。通过算法自动预测步长十分复杂，非二叔所能为。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q&lt;/strong&gt;：何时停止迭代？&lt;br/&gt;&lt;strong&gt;A&lt;/strong&gt;：可设定一个阈值，当梯度的模长小于这个阈值时停止迭代（当函数接近极值时，梯度接近0）。也可以人为通过刚才迭代次数和函数值图像设定迭代次数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q&lt;/strong&gt;：是否还有其他迭代法？&lt;br/&gt;&lt;strong&gt;A&lt;/strong&gt;：还有牛顿法和拟牛顿法，和梯度下降法的区别是牛顿法不是沿着梯度负方向下降的，而是另一套算法得出的方向，下降速度更快。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q&lt;/strong&gt;：迭代法是否一定会找到函数值域内的最小值？&lt;br/&gt;&lt;strong&gt;A&lt;/strong&gt;：不是，如果函数不是一个凸函数，那么迭代法可能会找到一个局部最小值或鞍点值。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q&lt;/strong&gt;：函数最大值怎么找&lt;br/&gt;&lt;strong&gt;A&lt;/strong&gt;：给函数取个负号然后找最小值，或者沿着梯度方向前进而不是负梯度方向前进&lt;/p&gt;
</description>
<pubDate>Sun, 25 Nov 2018 03:28:00 +0000</pubDate>
<dc:creator>会长</dc:creator>
<og:description>熟悉梯度下降法</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/zzy0471/p/gradient_descent.html</dc:identifier>
</item>
<item>
<title>没有执行过rm -rf /*的开发不是好运维 - 李国宝</title>
<link>http://www.cnblogs.com/liguobao/p/10014899.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/liguobao/p/10014899.html</guid>
<description>&lt;h2 id=&quot;起因&quot;&gt;起因&lt;/h2&gt;
&lt;p&gt;突然收到用户反馈说网站在手机端打开是白屏, 很奇怪的问题.&lt;/p&gt;
&lt;p&gt;在电脑端试了下,确实也是白屏,HTML加载进来了,好像有个核心JS加载失败.&lt;/p&gt;
&lt;p&gt;看到一个错误是: We're sorry but house doesn't work properly without JavaScript enabled. Please enable it to continue.&lt;/p&gt;
&lt;p&gt;还有一个http请求的错误是: ERR_INCOMPLETE_CHUNKED_ENCODING&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ws1.sinaimg.cn/large/64d1e863gy1fxk2pfnj1tj22lc10igrm.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;于是尝试了一下的解决方案:&lt;/p&gt;
&lt;ul readability=&quot;3.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;无脑重启看看能不能解决问题?重启了一下对应Docker容器,无果&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;可能是现在版本引入的Bug?回滚代码重新build,无果.&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;nginx的问题? 重启nginx,无果.&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;查看nginx日志,没什么有用的东西,无果.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;灵机一闪,不会是磁盘空间满了吧.&lt;/p&gt;
&lt;p&gt;df -h 看了一眼,99.99%的磁盘使用率.&lt;/p&gt;
&lt;p&gt;某个Docker容器的磁盘空间用掉了34G.&lt;/p&gt;
&lt;p&gt;看一眼Docker容器,直觉告诉我应该是Elasticsearch服务...&lt;/p&gt;
&lt;p&gt;不算太重要的服务,先停了清理空间再说.&lt;/p&gt;
&lt;p&gt;删掉了容器删了data文件,重启nginx,一切都正常Work了.&lt;/p&gt;
&lt;p&gt;问题解决!!!&lt;/p&gt;
&lt;p&gt;不过Elasticsearch总要重新回复回来嘛,看了下腾讯云云硬盘盘价格,也不是很贵嘛.&lt;/p&gt;
&lt;p&gt;单独给Elasticsearch 起个数据盘吧.&lt;/p&gt;
&lt;h2 id=&quot;作死开始&quot;&gt;作死开始&lt;/h2&gt;
&lt;p&gt;首先根据腾讯云的指示,挂在了数据盘到服务器上面.&lt;/p&gt;
&lt;p&gt;然后给数据盘分区,接着mount到对应的路径.&lt;/p&gt;
&lt;p&gt;嗯,好像有个警告.&lt;/p&gt;
&lt;p&gt;难道不是这个磁盘么?换另外一个看看.&lt;/p&gt;
&lt;p&gt;执行另外一个mount.&lt;/p&gt;
&lt;p&gt;全程命令如下:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ws1.sinaimg.cn/large/64d1e863gy1fxk3f86li1j220613mkho.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;进入对应目录清空一下云盘数据吧.(PS:脑子有病才做这个,刚刚初始化的云盘哪有东西.)&lt;/p&gt;
&lt;p&gt;ls 看一下,咋这么多奇奇怪怪的文件,难道是原来Elasticsearch docker 容器留下来的.&lt;/p&gt;
&lt;p&gt;先删了再说.&lt;/p&gt;
&lt;p&gt;执行 rm -rf ./*&lt;/p&gt;
&lt;p&gt;咦,怎么有文件busy无法删除.&lt;/p&gt;
&lt;p&gt;额,咋ls都没有了.&lt;/p&gt;
&lt;p&gt;哈?cat 也没有了.&lt;/p&gt;
&lt;p&gt;噗,copy也炸了.&lt;/p&gt;
&lt;p&gt;cd 还在.&lt;/p&gt;
&lt;p&gt;哇卡,这可咋办了.&lt;/p&gt;
&lt;h2 id=&quot;先复盘一下做了什么事情&quot;&gt;先复盘一下做了什么事情&lt;/h2&gt;
&lt;ul readability=&quot;2.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;初始化磁盘的时候没有格式化,但是mount失败&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;mount失败后没有检查原因,直接尝试把另一个磁盘mount进去&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;mount系统盘到指定文件夹后并没有检查内容,直接rm -rf ./*&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;rm -rf ./* 此时已经基本没救了&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;拯救尝试&quot;&gt;拯救尝试&lt;/h2&gt;
&lt;p&gt;还在跑的服务基本是活着的，所以暂时来说API和Web网站都是好的。&lt;/p&gt;
&lt;p&gt;服务器上面跑的基本都是Docker容器, Docker镜像都在阿里云上面存着，基本不怕丢失的问题。&lt;/p&gt;
&lt;p&gt;不过应用配置文件/服务器证书之类的东西都在上面，这个估计要折腾一下了。&lt;/p&gt;
&lt;p&gt;cd 还能用，ls没了，cat也没了。&lt;/p&gt;
&lt;p&gt;尝试cat xxx.conf也没用了,难道只能一点点翻配置文件么.&lt;/p&gt;
&lt;p&gt;群里的朋友提了一句，看看你的云盘有没有备份之类的.&lt;/p&gt;
&lt;p&gt;咦,好像两个星期前找腾讯云技术支持的时候做过一次系统镜像.&lt;/p&gt;
&lt;p&gt;是不是可以直接拿回来直接用?&lt;/p&gt;
&lt;p&gt;看了下具体的镜像版本和备注信息,看起来那时候上面的内容和现在的估计没太多变化.&lt;/p&gt;
&lt;p&gt;直接重装之后更新一下各个服务的镜像到最新版本应该就好了.&lt;/p&gt;
&lt;h2 id=&quot;放弃拯救直接使用备份的系统镜像重装&quot;&gt;放弃拯救,直接使用备份的系统镜像重装&lt;/h2&gt;
&lt;p&gt;Work...&lt;/p&gt;
&lt;p&gt;系统备份镜像拯救世界!!!&lt;/p&gt;
&lt;h2 id=&quot;后续操作-总结&quot;&gt;后续操作 + 总结&lt;/h2&gt;
&lt;ul readability=&quot;2&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;数据盘和系统盘分开,不要让程序的数据导致系统不可用&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;在费用允许的情况下设置磁盘快照策略,我这边最极端的情况下也应该能回滚到一个星期前的版本&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;下次大影响操作前先手动备份系统镜像,救命稻草一般的存在.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
<pubDate>Sun, 25 Nov 2018 03:18:00 +0000</pubDate>
<dc:creator>李国宝</dc:creator>
<og:description>没有执行过rm rf / 的开发不是好运维 起因 突然收到用户反馈说网站在手机端打开是白屏, 很奇怪的问题. 在电脑端试了下,确实也是白屏,HTML加载进来了,好像有个核心JS加载失败. 看到一个错误</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/liguobao/p/10014899.html</dc:identifier>
</item>
</channel>
</rss>