<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>解决弹出蒙层滑动穿透问题-vue - 布尔-</title>
<link>http://www.cnblogs.com/buerjj/p/7876057.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/buerjj/p/7876057.html</guid>
<description>&lt;p&gt;　　最近开发过程中遇到一些小问题(似乎问题总是那么多)，但一直没什么时间去优化与解决。程序员不能被业务绑架，有时间还是花点在代码上😀，开始这次的vue尝试吧。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【遇到的问题】&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;&lt;span&gt;在一个可滑动列表页弹出一个全屏蒙层，蒙层固定，中间一块显示消息框，当用手滑动蒙层空白处时，滑动事件会穿透到底部列表页，导致列表页的滑动。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【要实现的目标】&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;　　1. 滑动蒙层空白处不让滑动事件穿透。　　 2. 当蒙层消息框文字多时，要让文字可上下滑动。&lt;/p&gt;
&lt;p&gt;　　没图不说话，要实现的效果其实如下：&lt;/p&gt;
&lt;p&gt;　　&lt;img src=&quot;http://images2017.cnblogs.com/blog/928234/201711/928234-20171122225030008-1517077567.gif&quot; alt=&quot;&quot; width=&quot;163&quot; height=&quot;290&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【实现思路】&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;&lt;span&gt;&lt;span&gt;1. vue提供的 &lt;strong&gt;@touchmove.prevent &lt;/strong&gt;可以用来阻止滑动，但是这个方法会对其内的子div的滑动事件也禁止掉了，这样会导致中间文字无法滑动。如果没有中间滑动需求，用 &lt;strong&gt;@touchmove.prevent &lt;/strong&gt;实现是一个很好的方法。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;　　2. 蒙层设为fixed悬浮在最上，底部列表设置overflow-y: hidden；这样可以列表内容就不可以滑了，但实际过程中没有效果，于是想到继续往列表父div向上追溯，对body设置相关样式，这样就控制住了底部列表滑动问题。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;　　3. 蒙层空白处点击事件与中间文字点击事件处理，防止事件冒泡带来其他bug。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;【相关实现代码】&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;&lt;span&gt;1. html代码都是比较简单，列表页for循环实现；蒙层用一个变量控制其显示和隐藏。但这里有几个注意点: a. 给上面列表的div动态绑定了 &lt;/span&gt;noScroll class，它的作用是当消息蒙层显示时切换到相关的css样式； b. 弹出的全屏蒙层，加有点击事件是为了点空白处让蒙层消失，但这里对显示的每行文字还加了@click.stop=&quot;messageTitleClick(num)&quot;这个方法，为什么加它呢——是因为蒙层空白处的点击方法对整个蒙层都生效，在文字上加上这个方法可以屏蔽掉蒙层点击方法的影响，即使这个方法里什么也不做它也是有作用的，另外这个方法上加了stop是为了防止它的点击事件穿透到后面的div&lt;span&gt;。代码如下:&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
　　 &amp;lt;!-- 列表 --&amp;gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;:class&lt;/span&gt;&lt;span&gt;=&quot;{noScroll: isShowPopup}&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;em id=&quot;__mceDel&quot;&gt;      &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;item&quot;&lt;/span&gt;&lt;span&gt; v-for&lt;/span&gt;&lt;span&gt;=&quot;num in 50&quot;&lt;/span&gt;&lt;span&gt; @click&lt;/span&gt;&lt;span&gt;=&quot;itemClick(num)&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;style&lt;/span&gt;&lt;span&gt;=&quot;width:100%&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;点击item{{num}}&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
      &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;

　　 &amp;lt;!-- 蒙层 --&amp;gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;v-if&lt;/span&gt;&lt;span&gt;=&quot;isShowPopup&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;popup&quot;&lt;/span&gt;&lt;span&gt; @click&lt;/span&gt;&lt;span&gt;=&quot;popUpEmptyClick()&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
      &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;message&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;p &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;message-title&quot;&lt;/span&gt;&lt;span&gt; v-for&lt;/span&gt;&lt;span&gt;=&quot;num in 30&quot;&lt;/span&gt;&lt;span&gt; @click.stop&lt;/span&gt;&lt;span&gt;=&quot;messageTitleClick(num)&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;span&gt;
          消息提示 {{num}}
        &lt;/span&gt;&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;p&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
      &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;/em&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　2. 给整个列表动态绑定的css如下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
/* 当前蒙层显示时生效 */&lt;span&gt;
.noScroll &lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;
  overflow-y: hidden;
&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　3. 给列表整个div动态绑定 .noScroll 后，底部列表照样可以滑动，所以考虑继续向上追溯。利用watch监听蒙层是否显示，当显示时，设置body相应样式；但蒙层消失时，body样式恢复。但是在vue里怎么操作body里，虽然vue是数据驱动的，不提倡直接操作Dom。但此刻我也是没什么好办法了，就直接操作Dom了，好想说黑猫白猫😀。如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  watch: {
    isShowPopup(newVal, oldVal) {
      &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (newVal == &lt;span&gt;true&lt;/span&gt;&lt;span&gt;) {
        document.body.style.cssText &lt;/span&gt;= &quot;overflow-y: hidden&quot;&lt;span&gt;;
      } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
        document.body.style.cssText &lt;/span&gt;= &quot;overflow-y: auto&quot;&lt;span&gt;;
      }
    }
  }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;【Demo地址】&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　手动将路由切到 /three 就是此页示例&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;a href=&quot;https://github.com/LiJinShi/wechat_back_vue&quot; target=&quot;_blank&quot;&gt;https://github.com/LiJinShi/wechat_back_vue&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;　　&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Wed, 22 Nov 2017 15:30:00 +0000</pubDate>
<dc:creator>布尔-</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/buerjj/p/7876057.html</dc:identifier>
</item>
<item>
<title>Nginx+Tomcat+Redis实现持久会话 - Aubin</title>
<link>http://www.cnblogs.com/aubin/p/7881837.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/aubin/p/7881837.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026632/201711/1026632-20171122230329508-476656948.jpg&quot;/&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;&lt;li&gt;使用开源web应用solo blog进行项目演示。前端使用Nginx作为负载均衡器，后端Tomcat连接Redis实现session存储。Redis的特点就是可以将session持久化。样才能真正实现后台多个Tomcat负载平衡，用户请求能够发往任何一个tomcat主机。&lt;/li&gt;
&lt;li&gt;keeplived、zabbix与ansible暂不在本文章的范围当中,会在之后的文章逐一进行讲解&lt;/li&gt;
&lt;/ul&gt;&lt;/blockquote&gt;

&lt;p&gt;部署环境&lt;br/&gt;CentOS7&lt;br/&gt;Nginx1.10.2&lt;br/&gt;Tomcat7.0&lt;br/&gt;Redis3.2.3&lt;br/&gt;Mariadb 5.5.44&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026632/201711/1026632-20171122230344352-1220040719.png&quot;/&gt;&lt;/p&gt;

&lt;ul readability=&quot;3&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;安装前准备&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ntpdate 172.18.0.1
iptables -F&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装Nginx&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;yum install nginx&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;修改配置文件&lt;br/&gt;upstream tomcatservers：创建后端服务器组，要在http内部追加&lt;br/&gt;location：匹配URL，在server内部追加&lt;br/&gt;注：省略号为其他默认的参数，如果没有特殊需要按默认即可&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;vim /etc/nginx/nginx.conf
http {
...
upstream tomcatservers {
    server 172.18.68.21:8080;
    server 172.18.68.22:8080;
    }
...
server {
...
    location / {
        proxy_pass http://tomcatservers;
     }
...
}
}
systemctl start nginx&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;检查端口&lt;br/&gt;启动服务器要检查80端口是否正常监听&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ss -ntl&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;两台Tomcat服务器的配置完全一样。以下步骤在两台主机重复操作即可&lt;/p&gt;
&lt;ul readability=&quot;14.5&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;安装前准备&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ntpdate 172.18.0.1
iptables -F&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装Tomcat&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;yum install Tomcat&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;部署solo&lt;br/&gt;.war包复制到webapps目录下后重启tomcat，tomcat会自动解压其文件&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;cp solo-2.4.1.war  /usr/share/tomcat/webapps/
systemctl restart tomcat&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;4&quot;&gt;
&lt;p&gt;配置solo&lt;br/&gt;serverhost为前端负载均衡的域名或者IP，如果部署完毕后出现静态资源无法加载的情况，多数是这里出了问题。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;cd /usr/share/tomcat/webapps/solo-2.4/WEB-INF/classes
vim latke.properties
  #### Server ####
  # 配置协议
  serverScheme=http
  # 配置客户端访问站点时的域名或IP，也就是前端Nginx的域名
  serverHost=www.shuaiguoxia.com
  # 使用的端口
  serverPort=80&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;6&quot;&gt;
&lt;p&gt;配置solo连接MySQL&lt;br/&gt;H2 runtime的部分是solo默认使用的，把他手动注释掉后把MySQL runtime部分注释取消。&lt;br/&gt;设定MySQL的用户名密码，然后把172.18.68.41改为MySQL(主)的IP地址。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#### H2 runtime ####
#runtimeDatabase=H2
#jdbc.username=root
#jdbc.password=
#jdbc.driver=org.h2.Driver
#jdbc.URL=jdbc:h2:~/solo_h2/db
#jdbc.pool=h2
#
#### MySQL runtime ####
runtimeDatabase=MYSQL
jdbc.username=root                     # 用户名
jdbc.password=123456                   # 密码
jdbc.driver=com.mysql.jdbc.Driver
jdbc.URL=jdbc:mysql://172.18.68.41:3306/solo?useUnicode=yes&amp;amp;characterEncoding=utf8
jdbc.pool=druid&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;-1.5&quot;&gt;
&lt;p&gt;配置Tomcat连接Reids&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;Tomcat连接Reids需要3个软件包：&lt;br/&gt;commons-pool2-2.2.jar&lt;br/&gt;jedis-2.5.2.jar&lt;br/&gt;tomcat-redis-session-manager-2.0.0.jar&lt;br/&gt;下载地址https://github.com/izerui/tomcat-redis-session-manager&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;将所需要的jar包复制到 /usr/share/tomcat/lib/&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;cp commons-pool2-2.2.jar /usr/share/tomcat/lib/
cp jedis-2.5.2.jar
cp tomcat-redis-session-manager-2.0.0.jar&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;修改contest.xml文件,再文件中加入以下两行。&lt;br/&gt;IP为RedisIP地址，端口为Redis监听的端口&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;vim /etc/tomcat/context.xml
#
 &amp;lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&amp;gt;
  &amp;lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;  
   host=&quot;172.18.68.31&quot;  
   port=&quot;6379&quot;  
   database=&quot;0&quot;  
   maxInactiveInterval=&quot;60&quot; /&amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;重启Tomcat&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;systemctl restart tomcat&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redis服务器一共两台，一主一从。仅仅配置文件不同，其他过程全部相同。&lt;/p&gt;
&lt;ul readability=&quot;5.5&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;安装前准备&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ntpdate 172.18.0.1
iptables -F&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装Redis&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;yum install Redis&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;Redis主节点的配置&lt;br/&gt;主节点仅配置IP、监听的端口、与连接密码&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;vim /etc/redis.conf
bind 0.0.0.0                            # 监听所有IP
port 6379                               # 设定监听的端口
requirepass 123456                      # 设定连接的密码&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;Redis从节点配置&lt;br/&gt;从节点设置为只读&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;bind 0.0.0.0                            # 监听所有IP
slaveof 172.18.68.31 6379               # 设定主节点的IP+端口
masterauth 123456                       # 主节点的连接密码
slave-read-only yes                     # 从节点为只读&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;确认主从配置成功&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;shell &amp;gt; redis-cli -h 172.18.68.32        # 连接从服务器redis
127.0.0.1:6379&amp;gt; INFO replication         # 查看主从复制状态信息
# Replication
role:slave
master_host:172.18.68.31                 # 主节点IP
master_port:6379                         # 主节点的端口
master_link_status:up                    # up为主从同步正常
master_last_io_seconds_ago:9
master_sync_in_progress:0
slave_repl_offset:1420
slave_priority:100
slave_read_only:1
connected_slaves:0
master_repl_offset:0
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MySQL服务器一共两台，一主一从。仅仅配置文件不同，其他过程全部相同。&lt;/p&gt;
&lt;ul readability=&quot;22.5&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;安装前准备&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ntpdate 172.18.0.1
iptables -F&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;安装Mariadb&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;yum install Mariadb
#
#
#运行初始化脚本对MySQL进行
cd /usr/local/mysql/bin
mysql_secure_installation          #MySql初始化脚本，以下为每一项的翻译
  先回车
  是否设置root密码
  输入密码
  确认密码
  是否设置匿名用户
  是否允许root远程登录
  删除test数据库
  现在是否生效&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;10&quot;&gt;
&lt;p&gt;MySQL主服务器的配置&lt;br/&gt;主从同步就必须要开启二进制日志，修改配置文件一共有两点。&lt;br/&gt;1.server-id必须不能冲突&lt;br/&gt;2.在主服务器创建授权用户，让用户有复制权限。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;shell &amp;gt; vim /etc/my.cnf
server-id=1                                         #节点ID
log-bin=mysql-bin                                   #指定二进制日志前缀
relay-log=mysql-relay-bin                           #指定relaylog日志前缀
replicate-wild-ignore-table=mysql.%                 #排除要复制的表
replicate-wild-ignore-table=test.%
replicate-wild-ignore-table=information_schema.%&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;在主服务器行创建授权用户，让从服务器有权限复制主服务器数据。授权用户应该匹配最小权限法则，允许连接的IP地址越精确越好。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Musql &amp;gt; grant replication slave on *.* to 
 'slave_user'@'10.0.0.67' identified by '123456';&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;19&quot;&gt;
&lt;p&gt;MySQL从服务器的配置&lt;br/&gt;MySQL的主从配置也仅仅是server-id不同&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;shell &amp;gt; vim /etc/my.cnf
server-id=2                                         #节点ID
log-bin=mysql-bin                                   #指定二进制日志前缀
relay-log=mysql-relay-bin                           #指定relaylog日志前缀
replicate-wild-ignore-table=mysql.%                 #排除要复制的表
replicate-wild-ignore-table=test.%
replicate-wild-ignore-table=information_schema.%&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;在从服务器连mysql命令行配置,配置主节点的IP、用户名密码。最重要的是master_log_file、master_log_pos，这两项是在主节点上查询后的结果，要与主节点查询结果相同。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;# 在MySQL主服务器中查询结果
MariaDB [(none)]&amp;gt; show master status\G;
*************************** 1. row ***************************
        File: master-log.000003
        Position: 18893845
        Binlog_Do_DB: 
        Binlog_Ignore_DB: &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;配置MySQL从服务器&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;MySQL &amp;gt; change master to 
master_host='10.0.0.66',
master_user='slave_user',
master_password='123456',
master_log_file='mysql-bin.000001',
master_log_pos=106;`&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;6&quot;&gt;
&lt;p&gt;查看主动同步情况&lt;br/&gt;在从服务器中查看主从同步情况。最后两行的yes标志着主从同步成功。还可以通过查询表、库甚至数据的方式查询验证主从同步情况。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;MariaDB [(none)]&amp;gt; show slave status\G;
*************************** 1. row ***************************
           Slave_IO_State: Waiting for master to send event
              Master_Host: 172.18.68.41
              Master_User: slave-user
              Master_Port: 3306
            Connect_Retry: 60
          Master_Log_File: master-log.000002
      Read_Master_Log_Pos: 245
           Relay_Log_File: mysql-relay-bin.000002
            Relay_Log_Pos: 530
    Relay_Master_Log_File: master-log.000002
         Slave_IO_Running: Yes
        Slave_SQL_Running: Yes&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通过浏览器访问172.18.68.11/solo-2.4就能访问部署的solo博客，初次进入会让你注册一个用户密码，就是管理员账号密码。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026632/201711/1026632-20171122230421836-1259415855.png&quot;/&gt;&lt;br/&gt;至此不管Nginx怎样调度，Tomcat都能将客户端的session保存在Redis中。可以通过windwos的Redis管理软件查看到在Redis主从两个数据库都有了session信息。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026632/201711/1026632-20171122230429977-1577526576.png&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 22 Nov 2017 15:11:00 +0000</pubDate>
<dc:creator>Aubin</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/aubin/p/7881837.html</dc:identifier>
</item>
<item>
<title>Hibernate持久化对象的三种状态深入理解 - 宇的季节</title>
<link>http://www.cnblogs.com/chenkeyu/p/7881728.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/chenkeyu/p/7881728.html</guid>
<description>&lt;h2&gt;关于OID&lt;/h2&gt;
&lt;p&gt;　　hibernate&lt;span&gt;缓存是一个map，他会根据&lt;/span&gt;&lt;span&gt;OID&lt;/span&gt;&lt;span&gt;作为缓存对象的key&lt;/span&gt;&lt;span&gt;，我们的映射文件中&lt;/span&gt;&lt;span&gt;&amp;lt;id&amp;gt;&lt;/span&gt;&lt;span&gt;标签指定的属性值会作为&lt;/span&gt;&lt;span&gt;OID&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;持久化对象的三种状态&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span&gt;为了方便理解，&lt;/span&gt;Hibernate&lt;span&gt;为持久化对象定义了三个状态：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;瞬时态：&lt;/strong&gt;没有持久化标识&lt;/span&gt;OID&lt;span&gt;，没有被纳入&lt;/span&gt;&lt;span&gt;Session&lt;/span&gt;&lt;span&gt;对象的管理&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;持久态：&lt;/strong&gt;有持久化标识&lt;/span&gt;OID&lt;span&gt;，已经被纳入&lt;/span&gt;&lt;span&gt;Session&lt;/span&gt;&lt;span&gt;对象的管理&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;托管态：&lt;/strong&gt;有持久化标识&lt;/span&gt;OID&lt;span&gt;，但没有被&lt;/span&gt;&lt;span&gt;Session&lt;/span&gt;&lt;span&gt;对象管理&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;用一个小示例来演示：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1003414/201711/1003414-20171122222639977-1857207022.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;&lt;strong&gt;持久态的一个常见误解&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;需要注意的是，被纳入&lt;/span&gt;session&lt;span&gt;对象的管理的持久态对象，仅仅是放入了&lt;/span&gt;&lt;span&gt;session&lt;/span&gt;&lt;span&gt;的一级缓存，却不一定会同步到数据库。（&lt;/span&gt;&lt;span&gt;&lt;span&gt;session&lt;/span&gt;&lt;span&gt;中有一个&lt;/span&gt;PersistenceContext对象，本质就是一个map集合，一级缓存的数据就存在这里&lt;/span&gt;），如下图所示。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1003414/201711/1003414-20171122222648477-1766225771.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;user被赋予了id&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1003414/201711/1003414-20171122222653774-1275761310.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;由上图可知，当执行到save()操作时，user已经被放到session中管理，并且已经拥有了id值，此时user是持久态的，但是现在数据库里并没有user的数据，因为还没有提交事务，&lt;strong&gt;所以持久态的对象并不一定就存在于数据库中。&lt;/strong&gt;&lt;/p&gt;

&lt;h2&gt;关于持久态对象自动更新的能力&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;　　当在一个&lt;/span&gt;session&lt;span&gt;中，对一个持久态的对象进行修改后，即使不执行&lt;/span&gt;&lt;span&gt;update()&lt;/span&gt;&lt;span&gt;方法，在事务提交时，也会会自动将修改后的数据同步到数据库。实现原理如下图：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1003414/201711/1003414-20171122224345946-794616130.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　这种机制实现的原理就是，&lt;/span&gt;session&lt;span&gt;除了一级缓存区域，还有一个快照区域，当持久态对象第一次被放入一级缓存时，同时会在快照区域放一个这个对象的副本。如果接下来对对象进行了修改操作，一级缓存的数据会同时修改，但快照区域的对象不变。在事务提交时，会对这两个区域中的对象进行对比，如果相同，说明没有修改，直接提交。如果不同，会对改变的几个属性进行更新操作。&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 22 Nov 2017 14:45:00 +0000</pubDate>
<dc:creator>宇的季节</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/chenkeyu/p/7881728.html</dc:identifier>
</item>
<item>
<title>bootstrap导航栏.nav与.navbar区别 - 吾本人间一叶茶</title>
<link>http://www.cnblogs.com/Zhang-jin/p/7881694.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Zhang-jin/p/7881694.html</guid>
<description>&lt;p&gt;刚刚看了bootstrap的导航栏，发现有点弄混了，现在来整理一下；&lt;/p&gt;
&lt;p&gt;一、简单的ul,li组成的导航：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ul &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav nav-pills justify-content-center bg-dark nav-dark&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;2&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;3&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;ul&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;//解析：.nav .nav-item .nav-link表示ul li是导航——.nav-pills表示胶囊状导航——.bg-dark/.nav-dark表示黑底白字——.justify-content-center表示导航栏在浏览器上居中显示&lt;/p&gt;
&lt;p&gt;在浏览器上显示为：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122221109274-1171101726.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;缩小浏览器窗口显示为：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122221224493-523166165.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;二、导航栏——&amp;lt;nav&amp;gt;标签中class=&quot;navbar navbar-expand-sm&quot;——&amp;lt;ul&amp;gt;中class=&quot;navbar-nav&quot;——&amp;lt;li&amp;gt;中class=&quot;nav-item&quot;&lt;/p&gt;
&lt;p&gt;代码为：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;nav &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar navbar-expand-sm bg-dark navbar-dark&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ul &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-nav&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item active&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;    
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;ul&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;nav&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;正常窗口显示为：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122221757227-583974182.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;缩小窗口小于576px时：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122221848493-1539330308.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;三、折叠导航栏&lt;/p&gt;
&lt;p&gt;当窗口小于576px的时候，不仅仅是简单的编程垂直导航；显示为一个button按钮，导航链接隐藏，点击button显示；&lt;/p&gt;
&lt;p&gt; 代码为：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;nav &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar navbar-expand-sm bg-dark navbar-dark fixed-top&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;navbar-brand&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;img &lt;/span&gt;&lt;span&gt;src&lt;/span&gt;&lt;span&gt;=&quot;&quot;&lt;/span&gt;&lt;span&gt; alt&lt;/span&gt;&lt;span&gt;=&quot;logo&quot;&lt;/span&gt;&lt;span&gt; style&lt;/span&gt;&lt;span&gt;=&quot;width:70px;height:30px;&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;button &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-toggler&quot;&lt;/span&gt;&lt;span&gt; type&lt;/span&gt;&lt;span&gt;=&quot;button&quot;&lt;/span&gt;&lt;span&gt; data-toggle&lt;/span&gt;&lt;span&gt;=&quot;collapse&quot;&lt;/span&gt;&lt;span&gt; data-target&lt;/span&gt;&lt;span&gt;=&quot;#collapsible&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;span &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-toggler-icon&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;span&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;button&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;collapse navbar-collapse&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;collapsible&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ul &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-nav&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item active&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;    
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;ul&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;nav&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;//注意：.navbar-brand是品牌logo；&lt;/p&gt;
&lt;p&gt;窗口大于576的时候，显示为：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122222147211-1799739991.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;窗口小于576的时候，显示为：&lt;/p&gt;
&lt;p&gt;　&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122222219368-1100576069.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1026545/201711/1026545-20171122222255571-203317945.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;四、导航栏加上form表单表示搜索框：【？？？？？】&lt;/p&gt;
&lt;p&gt;代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;nav &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar navbar-expand-sm bg-dark navbar-dark fixed-top&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;navbar-brand&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;img &lt;/span&gt;&lt;span&gt;src&lt;/span&gt;&lt;span&gt;=&quot;&quot;&lt;/span&gt;&lt;span&gt; alt&lt;/span&gt;&lt;span&gt;=&quot;logo&quot;&lt;/span&gt;&lt;span&gt; style&lt;/span&gt;&lt;span&gt;=&quot;width:70px;height:30px;&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;button &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-toggler&quot;&lt;/span&gt;&lt;span&gt; type&lt;/span&gt;&lt;span&gt;=&quot;button&quot;&lt;/span&gt;&lt;span&gt; data-toggle&lt;/span&gt;&lt;span&gt;=&quot;collapse&quot;&lt;/span&gt;&lt;span&gt; data-target&lt;/span&gt;&lt;span&gt;=&quot;#collapsible&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;span &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-toggler-icon&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;span&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;button&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;collapse navbar-collapse&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;collapsible&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ul &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;navbar-nav&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item active&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;li &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;nav-item&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;a &lt;/span&gt;&lt;span&gt;href&lt;/span&gt;&lt;span&gt;=&quot;#&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;nav-link&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;link1&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;li&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;    
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;ul&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;form &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;form-inline&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;input-group&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; &amp;lt;input type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;Search&quot;/&amp;gt; &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;span &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;input-group-addon&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;@&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;span&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;list&lt;/span&gt;&lt;span&gt;=&quot;dl&quot;&lt;/span&gt;&lt;span&gt; type&lt;/span&gt;&lt;span&gt;=&quot;text&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;form-control&quot;&lt;/span&gt;&lt;span&gt; placeholder&lt;/span&gt;&lt;span&gt;=&quot;Search&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;datalist &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;dl&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;option &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;IE&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;option&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;option &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;Firefox&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;option&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;option &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;chrome&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;option&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;option &lt;/span&gt;&lt;span&gt;value&lt;/span&gt;&lt;span&gt;=&quot;safari&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;option&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;datalist&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;button &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;btn btn-success&quot;&lt;/span&gt;&lt;span&gt; type&lt;/span&gt;&lt;span&gt;=&quot;submit&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;search&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;button&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;form&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;nav&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;如图所示，如何使得导航栏中的form表单右对齐，移到最右边？？？？？&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

</description>
<pubDate>Wed, 22 Nov 2017 14:36:00 +0000</pubDate>
<dc:creator>吾本人间一叶茶</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Zhang-jin/p/7881694.html</dc:identifier>
</item>
<item>
<title>JAVA提高十四：HashSet深入分析 - pony1223</title>
<link>http://www.cnblogs.com/pony1223/p/7877443.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/pony1223/p/7877443.html</guid>
<description>&lt;p&gt;&lt;span&gt;前面我们介绍了HashMap,Hashtable,那么还有一个hash家族，那就是HashSet;在讲解HashSet前，大家先要知道的是HashSet是单值集合的接口，即是Collection下面的，而HashMap是Map下面的，但是它和HashMap又是有关系的，所以在使用的时候大家需求要注意，重点还是要对下面的图需要熟悉，好了，我们开始分析。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/401339/201711/401339-20171122073918415-1044917651.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;一、HashSet 定义&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;翻看源码，HashSet的定义如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; HashSet&amp;lt;E&amp;gt;
    &lt;span&gt;extends&lt;/span&gt; AbstractSet&amp;lt;E&amp;gt;
    &lt;span&gt;implements&lt;/span&gt; Set&amp;lt;E&amp;gt;, Cloneable, java.io.Serializable
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;HashSet 是一个&lt;strong&gt;没有重复元素的集合&lt;/strong&gt;。HashSet继承AbstractSet类，实现Set、Cloneable、Serializable接口。其中AbstractSet提供 Set 接口的骨干实现，从而最大限度地减少了实现此接口所需的工作。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;它是由HashMap实现的，&lt;strong&gt;不保证元素的顺序&lt;/strong&gt;，而且&lt;strong&gt;HashSet允许使用 null 元素&lt;/strong&gt;。&lt;/span&gt;&lt;br/&gt;&lt;span&gt;HashSet是&lt;strong&gt;非同步的&lt;/strong&gt;。如果多个线程同时访问一个哈希 set，而其中至少一个线程修改了该 set，那么它必须 保持外部同步。这通常是通过对自然封装该 set 的对象执行同步操作来完成的。如果不存在这样的对象，则应该使用 Collections.synchronizedSet 方法来“包装” set。最好在创建时完成这一操作，以防止对该 set 进行意外的不同步访问：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
Set s = Collections.synchronizedSet(&lt;span&gt;new&lt;/span&gt; HashSet(...));
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;HashSet通过iterator()返回的&lt;strong&gt;迭代器是fail-fast的。&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;HashSet和Map之间的关系：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/401339/201711/401339-20171122074600790-1870407794.png&quot; alt=&quot;&quot;/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;它是通过HashMap实现的。HashSet中含有一个&quot;HashMap类型的成员变量&quot;map，HashSet的操作函数，实际上都是通过map实现的。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt; 二、构造方法&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
         * 默认构造函数 
         * 初始化一个空的HashMap，并使用默认初始容量为16和加载因子0.75。 
         &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
        &lt;span&gt;public&lt;/span&gt;&lt;span&gt; HashSet() {  
            map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;&lt;span&gt;();  
        }  
          
        &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
         * 构造一个包含指定 collection 中的元素的新 set。 
         &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
        &lt;span&gt;public&lt;/span&gt; HashSet(Collection&amp;lt;? &lt;span&gt;extends&lt;/span&gt; E&amp;gt;&lt;span&gt; c) {  
            map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;(Math.max((&lt;span&gt;int&lt;/span&gt;) (c.size()/.75f) + 1, 16&lt;span&gt;));  
            addAll(c);  
        }  
          
        &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
         * 构造一个新的空 set，其底层 HashMap 实例具有指定的初始容量和指定的加载因子 
         &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
        &lt;span&gt;public&lt;/span&gt; HashSet(&lt;span&gt;int&lt;/span&gt; initialCapacity, &lt;span&gt;float&lt;/span&gt;&lt;span&gt; loadFactor) {  
            map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;&lt;span&gt;(initialCapacity, loadFactor);  
        }  
             
        &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
         * 构造一个新的空 set，其底层 HashMap 实例具有指定的初始容量和默认的加载因子（0.75）。 
         &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
        &lt;span&gt;public&lt;/span&gt; HashSet(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; initialCapacity) {  
           map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;&lt;span&gt;(initialCapacity);  
        }  
             
        &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
         * 在API中我没有看到这个构造函数，今天看源码才发现（原来访问权限为包权限，不对外公开的） 
         * 以指定的initialCapacity和loadFactor构造一个新的空链接哈希集合。 
         * dummy 为标识 该构造函数主要作用是对LinkedHashSet起到一个支持作用 
         &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;  
        HashSet(&lt;/span&gt;&lt;span&gt;int&lt;/span&gt; initialCapacity, &lt;span&gt;float&lt;/span&gt; loadFactor, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; dummy) {  
           map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;&amp;gt;&lt;span&gt;(initialCapacity, loadFactor);  
        }  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; &lt;span&gt;从构造函数中可以看出HashSet所有的构造都是构造出一个新的HashMap，其中最后一个构造函数，为包访问权限是不对外公开，仅仅只在使用LinkedHashSet时才会发生作用。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;HashSet的主要API&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;boolean&lt;/span&gt;&lt;span&gt;         add(E object)
&lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt;            clear()
Object          clone()
&lt;/span&gt;&lt;span&gt;boolean&lt;/span&gt;&lt;span&gt;         contains(Object object)
&lt;/span&gt;&lt;span&gt;boolean&lt;/span&gt;&lt;span&gt;         isEmpty()
Iterator&lt;/span&gt;&amp;lt;E&amp;gt;&lt;span&gt;     iterator()
&lt;/span&gt;&lt;span&gt;boolean&lt;/span&gt;&lt;span&gt;         remove(Object object)
&lt;/span&gt;&lt;span&gt;int&lt;/span&gt;             size()
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;三、源码分析&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;对于 HashSet 而言，它是基于 HashMap 实现的，HashSet 底层使用 HashMap 来保存所有元素，因此 HashSet 的实现比较简单，相关 HashSet 的操作，基本上都是直接调用底层 HashMap 的相关方法来完成，我们应该为保存到 HashSet 中的对象覆盖 hashCode() 和 equals()&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;add 方法&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;

 * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; e 将添加到此set中的元素。
 * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 如果此set尚未包含指定元素，则返回true。
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; add(E e) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; map.put(e, PRESENT)==&lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;如果此 set 中尚未包含指定元素，则添加指定元素。更确切地讲，如果此 set 没有包含满足(e==null ? e2==null : e.equals(e2)) 的元素 e2，则向此 set 添加指定的元素 e。如果此 set 已包含该元素，则该调用不更改 set 并返回 false。但底层实际将将该元素作为 key 放入 HashMap。思考一下为什么？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;由于 HashMap 的 put() 方法添加 key-value 对时，当新放入 HashMap 的 Entry 中 key 与集合中原有 Entry 的 key 相同（hashCode()返回值相等，通过 equals 比较也返回 true），新添加的 Entry 的 value 会将覆盖原来 Entry 的 value（HashSet 中的 value 都是&lt;code&gt;PRESENT&lt;/code&gt;），但 key 不会有任何改变，因此如果向 HashSet 中添加一个已经存在的元素时，新添加的集合元素将不会被放入 HashMap中，原来的元素也不会有任何改变，这也就满足了 Set 中元素不重复的特性。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;该方法如果添加的是在 HashSet 中不存在的，则返回 true；如果添加的元素已经存在，返回 false。其原因在于我们之前提到的关于 HashMap 的 put 方法。该方法在添加 key 不重复的键值对的时候，会返回 null。如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt;&lt;span&gt; V put(K key, V value) {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (key == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; putForNullKey(value);
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; hash =&lt;span&gt; hash(key.hashCode());
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; i =&lt;span&gt; indexFor(hash, table.length);
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (Entry&amp;lt;K,V&amp;gt; e = table[i]; e != &lt;span&gt;null&lt;/span&gt;; e =&lt;span&gt; e.next) {
            Object k;
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (e.hash == hash &amp;amp;&amp;amp; ((k = e.key) == key ||&lt;span&gt; key.equals(k))) {
                V oldValue &lt;/span&gt;=&lt;span&gt; e.value;
                e.value &lt;/span&gt;=&lt;span&gt; value;
                e.recordAccess(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; oldValue;
            }
        }

        modCount&lt;/span&gt;++&lt;span&gt;;
        addEntry(hash, key, value, i);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;其余方法&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; HashSet&amp;lt;E&amp;gt;  
   &lt;span&gt;extends&lt;/span&gt; AbstractSet&amp;lt;E&amp;gt;  
   &lt;span&gt;implements&lt;/span&gt; Set&amp;lt;E&amp;gt;&lt;span&gt;, Cloneable, java.io.Serializable  
&lt;/span&gt;4&lt;span&gt;{  
   &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;long&lt;/span&gt; serialVersionUID = -5024744406713321676L&lt;span&gt;;  
 
   &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 底层使用HashMap来保存HashSet中所有元素。  &lt;/span&gt;
   &lt;span&gt;private&lt;/span&gt; &lt;span&gt;transient&lt;/span&gt; HashMap&amp;lt;E,Object&amp;gt;&lt;span&gt; map;  
     
   &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 定义一个虚拟的Object对象作为HashMap的value，将此对象定义为static final。  &lt;/span&gt;
   &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Object PRESENT = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Object();  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 默认的无参构造器，构造一个空的HashSet。 
    *  
    * 实际底层会初始化一个空的HashMap，并使用默认初始容量为16和加载因子0.75。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt;&lt;span&gt; HashSet() {  
   map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;E,Object&amp;gt;&lt;span&gt;();  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 构造一个包含指定collection中的元素的新set。 
    * 
    * 实际底层使用默认的加载因子0.75和足以包含指定 
    * collection中所有元素的初始容量来创建一个HashMap。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; c 其中的元素将存放在此set中的collection。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; HashSet(Collection&amp;lt;? &lt;span&gt;extends&lt;/span&gt; E&amp;gt;&lt;span&gt; c) {  
   map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;E,Object&amp;gt;(Math.max((&lt;span&gt;int&lt;/span&gt;) (c.size()/.75f) + 1, 16&lt;span&gt;));  
   addAll(c);  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 以指定的initialCapacity和loadFactor构造一个空的HashSet。 
    * 
    * 实际底层以相应的参数构造一个空的HashMap。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; initialCapacity 初始容量。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; loadFactor 加载因子。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; HashSet(&lt;span&gt;int&lt;/span&gt; initialCapacity, &lt;span&gt;float&lt;/span&gt;&lt;span&gt; loadFactor) {  
   map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;E,Object&amp;gt;&lt;span&gt;(initialCapacity, loadFactor);  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 以指定的initialCapacity构造一个空的HashSet。 
    * 
    * 实际底层以相应的参数及加载因子loadFactor为0.75构造一个空的HashMap。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; initialCapacity 初始容量。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; HashSet(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; initialCapacity) {  
   map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;E,Object&amp;gt;&lt;span&gt;(initialCapacity);  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 以指定的initialCapacity和loadFactor构造一个新的空链接哈希集合。 
    * 此构造函数为包访问权限，不对外公开，实际只是是对LinkedHashSet的支持。 
    * 
    * 实际底层会以指定的参数构造一个空LinkedHashMap实例来实现。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; initialCapacity 初始容量。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; loadFactor 加载因子。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; dummy 标记。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;  
   HashSet(&lt;/span&gt;&lt;span&gt;int&lt;/span&gt; initialCapacity, &lt;span&gt;float&lt;/span&gt; loadFactor, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; dummy) {  
   map &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;E,Object&amp;gt;&lt;span&gt;(initialCapacity, loadFactor);  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 返回对此set中元素进行迭代的迭代器。返回元素的顺序并不是特定的。 
    *  
    * 底层实际调用底层HashMap的keySet来返回所有的key。 
    * 可见HashSet中的元素，只是存放在了底层HashMap的key上， 
    * value使用一个static final的Object对象标识。 
    * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 对此set中元素进行迭代的Iterator。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; Iterator&amp;lt;E&amp;gt;&lt;span&gt; iterator() {  
   &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; map.keySet().iterator();  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 返回此set中的元素的数量（set的容量）。 
    * 
    * 底层实际调用HashMap的size()方法返回Entry的数量，就得到该Set中元素的个数。 
    * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 此set中的元素的数量（set的容量）。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; size() {  
   &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; map.size();  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 如果此set不包含任何元素，则返回true。 
    * 
    * 底层实际调用HashMap的isEmpty()判断该HashSet是否为空。 
    * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 如果此set不包含任何元素，则返回true。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; isEmpty() {  
   &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; map.isEmpty();  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 如果此set包含指定元素，则返回true。 
    * 更确切地讲，当且仅当此set包含一个满足(o==null ? e==null : o.equals(e)) 
    * 的e元素时，返回true。 
    * 
    * 底层实际调用HashMap的containsKey判断是否包含指定key。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; o 在此set中的存在已得到测试的元素。 
    * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 如果此set包含指定元素，则返回true。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; contains(Object o) {  
   &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; map.containsKey(o);  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 如果此set中尚未包含指定元素，则添加指定元素。 
    * 更确切地讲，如果此 set 没有包含满足(e==null ? e2==null : e.equals(e2)) 
    * 的元素e2，则向此set 添加指定的元素e。 
    * 如果此set已包含该元素，则该调用不更改set并返回false。 
    * 
    * 底层实际将将该元素作为key放入HashMap。 
    * 由于HashMap的put()方法添加key-value对时，当新放入HashMap的Entry中key 
    * 与集合中原有Entry的key相同（hashCode()返回值相等，通过equals比较也返回true）， 
    * 新添加的Entry的value会将覆盖原来Entry的value，但key不会有任何改变， 
    * 因此如果向HashSet中添加一个已经存在的元素时，新添加的集合元素将不会被放入HashMap中， 
    * 原来的元素也不会有任何改变，这也就满足了Set中元素不重复的特性。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; e 将添加到此set中的元素。 
    * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 如果此set尚未包含指定元素，则返回true。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; add(E e) {  
   &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; map.put(e, PRESENT)==&lt;span&gt;null&lt;/span&gt;&lt;span&gt;;  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 如果指定元素存在于此set中，则将其移除。 
    * 更确切地讲，如果此set包含一个满足(o==null ? e==null : o.equals(e))的元素e， 
    * 则将其移除。如果此set已包含该元素，则返回true 
    * （或者：如果此set因调用而发生更改，则返回true）。（一旦调用返回，则此set不再包含该元素）。 
    * 
    * 底层实际调用HashMap的remove方法删除指定Entry。 
    * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; o 如果存在于此set中则需要将其移除的对象。 
    * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; 如果set包含指定元素，则返回true。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; remove(Object o) {  
   &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; map.remove(o)==&lt;span&gt;PRESENT;  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 从此set中移除所有元素。此调用返回后，该set将为空。 
    * 
    * 底层实际调用HashMap的clear方法清空Entry中所有元素。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; clear() {  
   map.clear();  
   }  
 
   &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt; 
    * 返回此HashSet实例的浅表副本：并没有复制这些元素本身。 
    * 
    * 底层实际调用HashMap的clone()方法，获取HashMap的浅表副本，并设置到  HashSet中。 
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;  
   &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Object clone() {  
       &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {  
           HashSet&lt;/span&gt;&amp;lt;E&amp;gt; newSet = (HashSet&amp;lt;E&amp;gt;) &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.clone();  
           newSet.map &lt;/span&gt;= (HashMap&amp;lt;E, Object&amp;gt;&lt;span&gt;) map.clone();  
           &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; newSet;  
       } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (CloneNotSupportedException e) {  
           &lt;/span&gt;&lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; InternalError();  
       }  
   }  
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;由于HashSet底层使用了HashMap实现，使其的实现过程变得非常简单，如果你对HashMap比较了解，那么HashSet简直是小菜一碟。有两个方法对HashMap和HashSet而言是非常重要的，请注意正确重写其 equals 和 hashCode 方法，以保证放入的对象的唯一性。这两个方法是比较重要的，希望大家在以后的开发过程中需要注意一下。&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 22 Nov 2017 14:33:00 +0000</pubDate>
<dc:creator>pony1223</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/pony1223/p/7877443.html</dc:identifier>
</item>
<item>
<title>Celery 源码解析七：Worker 之间的交互 - 行者酱油君</title>
<link>http://www.cnblogs.com/makor/p/implement-of-gossip-and-mingle.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/makor/p/implement-of-gossip-and-mingle.html</guid>
<description>&lt;p&gt;前面对于 Celery 的分布式处理已经做了一些介绍，例如第五章的 &lt;strong&gt;远程控制&lt;/strong&gt; 和第六章的 &lt;strong&gt;Event机制&lt;/strong&gt;，但是，我认为这些分布式都比较简单，并没有体现出多实例之间的协同作用，所以，今天就来点更加复杂的，对于多实例直接的交互更多，这就是 Gossip 和 Mingle。&lt;/p&gt;
&lt;h3 id=&quot;toc_0&quot;&gt;Mingle&lt;/h3&gt;
&lt;p&gt;在 Celery 的介绍中，Mingle 主要用在启动或者重启的时候，它会和其他的 worker 交互，从而进行同步。同步的数据有：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;其他 worker 的 clock&lt;/li&gt;
&lt;li&gt;其他 worker 已经处理掉的 tasks&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;这其实也就是它的所有功能的，所以你可以猜测功能应该很简单吧？不妨一起来看看，最开始还是回忆一下第一篇文章中的 Bootstep，所以我们可以毫无压力得找出源码所在的文件：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309555-1940117358.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;这里从注释中可以很简单得看出 &lt;strong&gt;Mingle&lt;/strong&gt; 的作用，然后初始化也是比较简单，关键还是 &lt;strong&gt;Line 37&lt;/strong&gt; 的 &lt;code&gt;start&lt;/code&gt;，需要我们关注 &lt;code&gt;sync&lt;/code&gt; 做了什么，为什么上来二话不说就 &lt;code&gt;sync&lt;/code&gt;？其实上来就 &lt;code&gt;sync&lt;/code&gt; 很好理解，毕竟 &lt;strong&gt;Mingle&lt;/strong&gt; 的作用就是进行 sync 嘛，所以我们要关注的是如何实现的：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309618-146938566.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;这里原来的代码有点冗余，我给忽略掉了，直接上精简后的代码，所以你可以很清晰得看到代码的逻辑是这样的：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;Mingle 向每一个 Worker 发送问候：hello&lt;/li&gt;
&lt;li&gt;每个 Worker 都向 Mingle 回复自己的信息（clock 和 tasks）&lt;/li&gt;
&lt;li&gt;Mingle 更新自己的信息&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;这些逻辑我们从精简后的代码可以简单看出来，所以就不细说了，但是有一点需要展开讲讲，那就是 &lt;strong&gt;Line 47&lt;/strong&gt; 中的 &lt;code&gt;inspect.hello&lt;/code&gt;，这应该是 &lt;strong&gt;第五篇&lt;/strong&gt; 的内容，但是，之前只是介绍了一下如何注册，并没有对这些命令一一解析，所以这里用到了，我们就不妨看看里面的内容。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309461-179627009.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;ok，这里我们可以看到在 &lt;strong&gt;Line 319、320&lt;/strong&gt; 就返回了两个东西，分别是：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;revoked：当前 worker 记录的已被完成的 tasks&lt;/li&gt;
&lt;li&gt;clock：当前 worker 的 clock&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;然后就返回到刚起来的 worker 了，收到这个消息的 worker 就根据这两个信息刷新自己的状态，然后继续运行，&lt;strong&gt;Mingle&lt;/strong&gt; 也就完成了自己的任务了。&lt;/p&gt;
&lt;h3 id=&quot;toc_1&quot;&gt;Gossip&lt;/h3&gt;
&lt;p&gt;和 Mingle 不同，Gossip 却是消费 Event 的，本来按道理应该放在 &lt;strong&gt;第六篇&lt;/strong&gt; 中介绍，但是由于篇幅原因，所以一起放在这里来说了，不多赘述，我们直接看 &lt;strong&gt;Bootstep&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309805-1434739953.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;由于 &lt;strong&gt;Gossip&lt;/strong&gt; 的初始化内容太多，所以我也不全都展开了，挑了些重点（还是很多），但是目前我们可以忽略大部分的内容，最先需要关注的是 &lt;strong&gt;Line 24&lt;/strong&gt;，如果你够细心的话你会发现这个 &lt;strong&gt;Bootstep&lt;/strong&gt; 和其他不一样，因为它继承的是 &lt;strong&gt;ConsumerStep&lt;/strong&gt;，这是会注册一个 Consumer 的！&lt;/p&gt;
&lt;p&gt;然后我们没啥好看了，所以按照套路还是看看 &lt;code&gt;start&lt;/code&gt; 呗，然而它调用的也是父类的 &lt;code&gt;start&lt;/code&gt;，所以，没办法咯，直接跟过去：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309321-1847857459.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;诺，是这样吧，是增加了 &lt;strong&gt;Consumer&lt;/strong&gt;，这样的话，我们就必须看看这个 Consumer 是什么了，能够消费什么样的数据：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309665-498894875.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;好，这样就清晰了，所有关于 &lt;code&gt;worker.#&lt;/code&gt; 的 Event 都被这里消费了，这里算是看完了。&lt;/p&gt;
&lt;p&gt;那现在的问题变成了这些 Event 都是从哪里过来的，我们有必要对源头进行一下追踪，但是，怎么追踪呢？回想一下 &lt;strong&gt;第六篇&lt;/strong&gt; 中讲 Event 的消息传递的那里，再和这里一对比，事情就很清楚了。&lt;/p&gt;
&lt;p&gt;你以为 &lt;strong&gt;Gossip&lt;/strong&gt; 就这么结束了么？嘿嘿，那你就被 Celery 给蒙骗了，悄悄告诉你，Celery 在 Gossip 中埋伏了一个厉害的功能，但是没有对外宣称，那就是 &lt;strong&gt;Leader 选举！&lt;/strong&gt;，不信？我带你去看看：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309805-1359988202.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;这是选举的入口，先不解析代码，我们先来看看有谁调用了它：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220309836-345112279.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;p&gt;ok，可以发现这有个 control 命令用到了它，这里有注释，我们可以看到参数分别代表的意思：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;id：唯一的标识，用于识别一次选举&lt;/li&gt;
&lt;li&gt;topic：本次选举的 topic，其实是标识 action 的类型&lt;/li&gt;
&lt;li&gt;action：本次选举的目的，选中的 leader 负责处理这个 action&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;那么这样我们就清楚了，首先，有一个 action 需要执行，但是，那么多的 worker，交给谁执行呢？这就需要进行 &lt;strong&gt;选举&lt;/strong&gt;，那么选举的方式是怎么进行的呢，我先用一张图来描述一下这个过程：&lt;/p&gt;
&lt;ol readability=&quot;3.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;control 表示需要进行一个选举，然后一个 worker 的 gossip 就发送了一个 Event：&lt;strong&gt;worker-elect&lt;/strong&gt;，然后所有的 Worker 都能接收到：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220310086-1698982033.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;每个 Worker 接收到之后，就对这个选举进行响应，将自己的&lt;strong&gt;选号（clock）&lt;/strong&gt;送过去，这样，每个 Worker 在发送选号的同时，也接收到别人的选号，因为收发的路线太多，我就找一个 Worker 来表示收，但是其他 Worker 也是有收的，只是我没有标出来：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220310477-1037357062.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;当一个 Worker 收到所有 Worker 的 ACK 之后，那么它就会对所有的 Worker 的 &lt;strong&gt;选号&lt;/strong&gt; 进行排序，选出其中 &lt;strong&gt;最大的选号&lt;/strong&gt; 作为本次选举的 &lt;strong&gt;Leader&lt;/strong&gt;，如果 &lt;strong&gt;Leader&lt;/strong&gt; 是自己那么就处理这个 Action，如果不是自己，那么忽略，应该被选中的 &lt;strong&gt;Leader&lt;/strong&gt; 也在执行这个过程，所以不需要别人担心。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220310696-1575940912.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;这就是实际执行的示意图，对应到代码就分别是：&lt;/p&gt;
&lt;ol readability=&quot;-1&quot;&gt;&lt;li&gt;第一步中的 Control 要求选举和发送选举 Event 我们前面已经看过了&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;Worker 收到选举 Event 之后，发出自己的参选声明：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220310133-1110427233.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;每个 Wroker 对别人回应的参选信息进行选举：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/469840/201711/469840-20171122220310133-1128846763.jpg&quot; alt=&quot;&quot;/&gt;￼&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ok，整个流程就是这样的了，那么问题来了，万一有一个 Worker 收不到 replies 或者发出的 reply 不小心丢了会怎么样？是不是整个选举过程就进行不下去了？我好像没有看到 Celery 有在这方面做一些努力。&lt;/p&gt;
</description>
<pubDate>Wed, 22 Nov 2017 14:03:00 +0000</pubDate>
<dc:creator>行者酱油君</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/makor/p/implement-of-gossip-and-mingle.html</dc:identifier>
</item>
<item>
<title>FTP&amp;samba 服务简单部署 - 惨绿少年</title>
<link>http://www.cnblogs.com/clsn/p/7694610.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/clsn/p/7694610.html</guid>
<description>&lt;p&gt;&lt;span&gt;在&lt;/span&gt;Linux&lt;span&gt;下，我们应用最广泛的&lt;/span&gt;FTP&lt;span&gt;服务程序是&lt;/span&gt; vsftpd (&lt;strong&gt;&lt;span&gt;Very Secure FTP Daemon&lt;/span&gt;&lt;/strong&gt;),&lt;span&gt;从名字我们也可以看出，其提供了非常安全的&lt;/span&gt;FTP&lt;span&gt;服务。&lt;/span&gt;vsftpd &lt;span&gt;是一个&lt;/span&gt; UNIX &lt;span&gt;类操作系统上运行的服务器的名字，它可以运行在诸如&lt;/span&gt; Linux, BSD, Solaris, HP-UX &lt;span&gt;以及&lt;/span&gt; IRIX &lt;span&gt;上面。它支持很多其他的&lt;/span&gt; FTP &lt;span&gt;服务器不支持的特征。例如：&lt;/span&gt;&lt;/p&gt;
&lt;div readability=&quot;8&quot;&gt;
&lt;p&gt;① &lt;span&gt;非常高的安全性需求　　②带宽限制　　③创建虚拟用户的可能性　　④高速　　&lt;/span&gt;...&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;span&gt;可以说&lt;/span&gt; vsftpd &lt;span&gt;给我们提供了一个快速的、稳定的且相当安全的&lt;/span&gt;FTP&lt;span&gt;服务&lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;1.1 &lt;span&gt;服务端配置&lt;/span&gt;&lt;/h2&gt;
&lt;h3&gt;1.1.1 &lt;span&gt;第一个里程碑：&lt;/span&gt; &lt;span&gt;检查是否有这个软件，（没有则安装软件）&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@test ~]# rpm -qa vsftpd
&lt;/pre&gt;&lt;/div&gt;
&lt;div readability=&quot;7&quot;&gt;
&lt;p&gt;&lt;span&gt;在&lt;/span&gt;CentOS&lt;span&gt;下默认没有安装&lt;/span&gt; vsftpd &lt;span&gt;这个&lt;/span&gt;FTP&lt;span&gt;程序&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;span&gt;我们通过&lt;/span&gt; yum install vsfptd &lt;span&gt;来进行安装&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt; vsftpd
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;说明&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;服务的启动配置文件&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
/etc/rc.d/init.d/vsftpd
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;安装完之后在&lt;/span&gt;&lt;span&gt;/etc/vsftpd/&lt;/span&gt;&lt;span&gt;路径下会存在三个配置文件&lt;/span&gt;&lt;/p&gt;
&lt;div readability=&quot;19&quot;&gt;
&lt;p&gt;&lt;span&gt;/etc/vsftpd/vsftpd.conf &lt;/span&gt;  &lt;span&gt;主配置文件&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;/etc/vsftpd/ftpusers    &lt;/span&gt;   &lt;span&gt;指定&lt;/span&gt;&lt;span&gt;哪些用户不能访问&lt;/span&gt;&lt;span&gt;FTP&lt;/span&gt;&lt;span&gt;服务器&lt;/span&gt;,&lt;span&gt;这里的用户包括&lt;/span&gt;root&lt;span&gt;在内的用户。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;/etc/vsftpd/user_list     &lt;/span&gt; &lt;span&gt;指定的用户是否可以访问&lt;/span&gt;ftp&lt;span&gt;服务器。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;通过&lt;/span&gt;vsftpd.conf&lt;span&gt;文件中的&lt;/span&gt;userlist_deny&lt;span&gt;的配置来决定配置中的用户是否可以访问，&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;userlist_enable=YES&lt;/span&gt; &lt;span&gt;，&lt;/span&gt;&lt;span&gt;userlist_deny=YES&lt;/span&gt; &lt;span&gt;，&lt;/span&gt;&lt;span&gt;userlist_file=/etc/vsftpd/user_list&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这三个配置允许文件中的用户访问&lt;/span&gt;FTP&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h3&gt;1.1.2 &lt;span&gt;第二个里程碑：&lt;/span&gt; &lt;span&gt;编写配置文件&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;   &lt;strong&gt;&lt;span&gt;ftp&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;服务有默认的配置文件&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;，将原配置文件备份，重新编写配置文件&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@test &lt;span&gt;ftp&lt;/span&gt;]# &lt;span&gt;mv&lt;/span&gt;  /etc/vsftpd/vsftpd.conf  /etc/vsftpd/&lt;span&gt;vsftpd.conf.bak

[root@test &lt;/span&gt;~]# &lt;span&gt;cat&lt;/span&gt; /etc/vsftpd/&lt;span&gt;vsftpd.conf
#&lt;/span&gt;&lt;span&gt;20171014&lt;/span&gt;&lt;span&gt;
#HZS

anonymous_enable&lt;/span&gt;=&lt;span&gt;NO
local_enable&lt;/span&gt;=&lt;span&gt;YES
write_enable&lt;/span&gt;=&lt;span&gt;YES
local_umask&lt;/span&gt;=&lt;span&gt;022&lt;/span&gt;&lt;span&gt;
dirmessage_enable&lt;/span&gt;=&lt;span&gt;YES
xferlog_enable&lt;/span&gt;=&lt;span&gt;YES
connect_from_port_20&lt;/span&gt;=&lt;span&gt;YES
xferlog_std_format&lt;/span&gt;=&lt;span&gt;YES
listen&lt;/span&gt;=&lt;span&gt;YES

pam_service_name&lt;/span&gt;=&lt;span&gt;vsftpd
userlist_enable&lt;/span&gt;=&lt;span&gt;YES
tcp_wrappers&lt;/span&gt;=YES
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;默认配置文件说明：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;table border=&quot;1&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;&lt;tbody readability=&quot;11&quot;&gt;&lt;tr&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;参数&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;说明&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;anonymous_enable=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot;&gt;
&lt;p&gt;&lt;span&gt;允许匿名用户&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;local_enable=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;允许使用本地用户账号登陆&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;write_enable=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot;&gt;
&lt;p&gt;&lt;span&gt;允许&lt;/span&gt;ftp&lt;span&gt;用户写数据&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;connect_from_port_20=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;通过&lt;/span&gt;20&lt;span&gt;端口传输数据&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;6&quot;&gt;&lt;td width=&quot;302&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;#anon_mkdir_write_enable=YES &lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;是否允许匿名账户在&lt;/span&gt;FTP&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;服务器中创建目录&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;xferlog_enable=YES &lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;启用上传和下载日志功能&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;6&quot;&gt;&lt;td width=&quot;302&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;#ascii_download_enable=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;是否允许使用&lt;/span&gt;ASCII&lt;span&gt;格式来上传和下载文件&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4.5&quot;&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;pam_service_name=vsftpd&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;6&quot;&gt;
&lt;p&gt;/&lt;span&gt;设置&lt;/span&gt;PAM&lt;span&gt;认证服务的配置文件名称&lt;/span&gt;,&lt;span&gt;该文件存放在&lt;/span&gt;/etc/pam.d/&lt;span&gt;目录下&lt;/span&gt;.&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4.5&quot;&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;userlist_enable=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;6&quot;&gt;
&lt;p&gt;&lt;span&gt;用户列表中的用户是否允许登录&lt;/span&gt;FTP&lt;span&gt;服务器&lt;/span&gt;,&lt;span&gt;默认是不允许&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;302&quot;&gt;
&lt;p&gt;tcp_wrappers=YES&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;395&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;/&lt;span&gt;使用&lt;/span&gt;tcp_wrqppers&lt;span&gt;作为主机访问控制方式&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;其他的配置参数说明：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div readability=&quot;52&quot;&gt;
&lt;p&gt;ftpd_banner=welcome to ftp service &lt;span&gt;：设置连接服务器后的欢迎信息&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;idle_session_timeout=60 &lt;span&gt;：限制远程的客户机连接后，所建立的控制连接，在多长时间没有做任何的操作就会中断&lt;/span&gt;(&lt;span&gt;秒&lt;/span&gt;)&lt;/p&gt;
&lt;p&gt;data_connection_timeout=120 &lt;span&gt;：设置客户机在进行数据传输时&lt;/span&gt;,&lt;span&gt;设置空闲的数据中断时间&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;accept_timeout=60 &lt;span&gt;设置在多长时间后自动建立连接&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;connect_timeout=60 &lt;span&gt;设置数据连接的最大激活时间，多长时间断开，为别人所使用&lt;/span&gt;;&lt;/p&gt;
&lt;p&gt;max_clients=200 &lt;span&gt;指明服务器总的客户并发连接数为&lt;/span&gt;200&lt;/p&gt;
&lt;p&gt;max_per_ip=3 &lt;span&gt;指明每个客户机的最大连接数为&lt;/span&gt;3&lt;/p&gt;
&lt;p&gt;local_max_rate=50000(50kbytes/sec)  &lt;span&gt;本地用户最大传输速率限制&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;anon_max_rate=30000&lt;span&gt;匿名用户的最大传输速率限制&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;pasv_min_port=&lt;span&gt;端口&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;pasv-max-prot=&lt;span&gt;端口号&lt;/span&gt; &lt;span&gt;定义最大与最小端口，为&lt;/span&gt;0&lt;span&gt;表示任意端口&lt;/span&gt;;&lt;span&gt;为客户端连接指明端口&lt;/span&gt;;&lt;/p&gt;
&lt;p&gt;listen_address=IP&lt;span&gt;地址&lt;/span&gt; &lt;span&gt;设置&lt;/span&gt;ftp&lt;span&gt;服务来监听的地址，客户端可以用哪个地址来连接&lt;/span&gt;;&lt;/p&gt;
&lt;p&gt;listen_port=&lt;span&gt;端口号&lt;/span&gt; &lt;span&gt;设置&lt;/span&gt;FTP&lt;span&gt;工作的端口号，默认的为&lt;/span&gt;21&lt;/p&gt;
&lt;p&gt;local_root=path &lt;span&gt;无论哪个用户都能登录的用户，定义登录帐号的主目录&lt;/span&gt;, &lt;span&gt;若没有指定，则每一个用户则进入到个人用户主目录&lt;/span&gt;;&lt;/p&gt;
&lt;p&gt;chroot_local_user=yes/no &lt;span&gt;是否锁定本地系统帐号用户主目录&lt;/span&gt;(&lt;span&gt;所有&lt;/span&gt;);&lt;span&gt;锁定后，用户只能访问用户的主目录&lt;/span&gt;/home/user;&lt;/p&gt;
&lt;p&gt;chroot_list_enable=yes/no &lt;span&gt;启用不锁定用户在主目录的名单&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;chroot_list_file=/etc/vsftpd/chroot_list&lt;span&gt;指定列表文件&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;userlist_enable=YES/NO &lt;span&gt;是否加载用户列表文件&lt;/span&gt;;&lt;/p&gt;
&lt;p&gt;userlist_deny=YES &lt;span&gt;表示上面所加载的用户允许登录&lt;/span&gt;;&lt;/p&gt;
&lt;p&gt;userlist_file=/etc/vsftpd/user_list &lt;span&gt;指定列表文件&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;注意：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;  &lt;/span&gt;&lt;/strong&gt; &lt;strong&gt;&lt;span&gt;在这里要禁止匿名登陆&lt;/span&gt;anonymous_enable=NO&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;1.1.3 &lt;span&gt;第三个里程碑：创建用于&lt;/span&gt;FTP&lt;span&gt;连接用户，设置密码&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test ~]# useradd ftpuser -s /sbin/nologin  -&lt;span&gt;M
[root@test &lt;/span&gt;~]# &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ftpuser&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; |&lt;span&gt;passwd&lt;/span&gt; --&lt;span&gt;stdin ftpuser
Changing password &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; user ftpuser.
&lt;/span&gt;&lt;span&gt;passwd&lt;/span&gt;: all authentication tokens updated successfully
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;1.1.4 &lt;span&gt;第四个里程碑：&lt;/span&gt; &lt;span&gt;创建&lt;/span&gt;ftp&lt;span&gt;共享目录，将目录所有者属于&lt;/span&gt;ftpuser&lt;span&gt;，将&lt;/span&gt; ftpuser&lt;span&gt;用户家目录修改为共享目录。&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;mkdir&lt;/span&gt; /&lt;span&gt;ftpshare
[root@test &lt;/span&gt;~]# &lt;span&gt;chown&lt;/span&gt; ftpuser.ftpuser /&lt;span&gt;ftpshare
[root@test &lt;/span&gt;~]# usermod ftpuser -d /ftpshare
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;检查配置是否正确：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test ~]# ll /ftpshare/ -&lt;span&gt;d
drwxr&lt;/span&gt;-xr-x &lt;span&gt;2&lt;/span&gt; ftpuser ftpuser &lt;span&gt;4096&lt;/span&gt; Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;48&lt;/span&gt; /ftpshare/&lt;span&gt;

[root@test &lt;/span&gt;~]# &lt;span&gt;tail&lt;/span&gt; -&lt;span&gt;1&lt;/span&gt; /etc/&lt;span&gt;passwd&lt;/span&gt;&lt;span&gt;
ftpuser:x:&lt;/span&gt;&lt;span&gt;501&lt;/span&gt;:&lt;span&gt;501&lt;/span&gt;::/ftpshare:/sbin/nologin
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;1.1.5 &lt;span&gt;第五个里程碑：&lt;/span&gt; &lt;span&gt;启动&lt;/span&gt;vsftpd &lt;span&gt;服务，并设置开机自启动&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test ~]# /etc/init.d/&lt;span&gt;vsftpd start
Starting vsftpd &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; vsftpd:                                [  OK  ]

[root@test bin]# chkconfig  vsftpd on
[root@test bin]# chkconfig &lt;/span&gt;|&lt;span&gt;grep&lt;/span&gt;&lt;span&gt; vsftpd
vsftpd         &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;:off  &lt;span&gt;1&lt;/span&gt;:off  &lt;span&gt;2&lt;/span&gt;:on   &lt;span&gt;3&lt;/span&gt;:on   &lt;span&gt;4&lt;/span&gt;:on   &lt;span&gt;5&lt;/span&gt;:on   &lt;span&gt;6&lt;/span&gt;:off
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;1.2 &lt;span&gt;客户端链接测试&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;第一步：打开&lt;/span&gt;windows&lt;span&gt;上资源管理器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;在地址栏中是输入服务器地址，注意&lt;/span&gt;ftp&lt;span&gt;格式&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
&lt;span&gt;ftp&lt;/span&gt;:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;10.0.0.250&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;确定，输入用户名，和密码进行登陆。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122214841758-485348051.png&quot; alt=&quot;&quot;/&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122214851727-108817146.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;1.2.1 &lt;span&gt;下载文件测试&lt;/span&gt;&lt;/h3&gt;
&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122214908274-1929026701.png&quot; alt=&quot;&quot;/&gt; &lt;/p&gt;
&lt;h3&gt;1.2.2 &lt;span&gt;上传文件测试&lt;/span&gt;&lt;/h3&gt;
&lt;p align=&quot;center&quot;&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122214923899-676077979.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;1.2.3 &lt;span&gt;服务端检查&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;[root@test ftpshare]# ll
total &lt;/span&gt;&lt;span&gt;7072&lt;/span&gt;
-rw-r--r-- &lt;span&gt;1&lt;/span&gt; ftpuser ftpuser &lt;span&gt;7234678&lt;/span&gt; Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;11&lt;/span&gt;:&lt;span&gt;13&lt;/span&gt; cwRsync.&lt;span&gt;zip&lt;/span&gt;
-rw-r--r-- &lt;span&gt;1&lt;/span&gt; root    root         &lt;span&gt;60&lt;/span&gt; Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;11&lt;/span&gt;:&lt;span&gt;05&lt;/span&gt; 访问正常.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;1.3 linux&lt;span&gt;系统挂载&lt;/span&gt;ftp&lt;span&gt;测试&lt;/span&gt;&lt;/h2&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;mount&lt;/span&gt; -t nfs -o rw &lt;span&gt;10.0&lt;/span&gt;.&lt;span&gt;0.250&lt;/span&gt;:/ftpshare/ /opt/&lt;span&gt;
[root@test &lt;/span&gt;~]# &lt;span&gt;df&lt;/span&gt; -&lt;span&gt;h
Filesystem            Size  Used Avail Use&lt;/span&gt;%&lt;span&gt; Mounted on
&lt;/span&gt;/dev/sda3              19G  &lt;span&gt;1&lt;/span&gt;.7G   17G  &lt;span&gt;10&lt;/span&gt;% /&lt;span&gt;
tmpfs                 238M     &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;  238M   &lt;span&gt;0&lt;/span&gt;% /dev/&lt;span&gt;shm
&lt;/span&gt;/dev/sda1             190M   40M  141M  &lt;span&gt;22&lt;/span&gt;% /&lt;span&gt;boot
&lt;/span&gt;&lt;span&gt;10.0&lt;/span&gt;.&lt;span&gt;0.250&lt;/span&gt;:/ftpshare/ 19G  &lt;span&gt;1&lt;/span&gt;.7G   17G  &lt;span&gt;10&lt;/span&gt;% /opt
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;2.1 samba&lt;span&gt;服务简介&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;Samba&lt;span&gt;是一个能让&lt;/span&gt;Linux&lt;span&gt;系统应用&lt;/span&gt;Microsoft&lt;span&gt;网络通讯协议的软件，而&lt;/span&gt;SMB&lt;span&gt;是&lt;/span&gt;S&lt;strong&gt;&lt;span&gt;erver Message Block&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;的缩写，即为&lt;strong&gt;&lt;span&gt;服务器消息块&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;，&lt;/span&gt;SMB&lt;span&gt;主要是作为&lt;/span&gt;Microsoft&lt;span&gt;的网络通讯协议，后来&lt;/span&gt;Samba&lt;span&gt;将&lt;/span&gt;SMB&lt;span&gt;通信协议应用到了&lt;/span&gt;Linux&lt;span&gt;系统上，就形成了现在的&lt;/span&gt;Samba&lt;span&gt;软件。后来微软又把&lt;/span&gt; SMB &lt;span&gt;改名为&lt;/span&gt; CIFS&lt;span&gt;（&lt;/span&gt;Common Internet File System&lt;span&gt;），即公共&lt;/span&gt; Internet &lt;span&gt;文件系统，并且加入了许多新的功能，这样一来，使得&lt;/span&gt;Samba&lt;span&gt;具有了更强大的功能。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;Samba&lt;span&gt;最大的功能就是&lt;span&gt;可以用于&lt;/span&gt;&lt;/span&gt;&lt;span&gt;Linux&lt;/span&gt;&lt;span&gt;与&lt;/span&gt;&lt;span&gt;windows&lt;/span&gt;&lt;span&gt;系统直接的文件共享和打印共享&lt;/span&gt;&lt;span&gt;，&lt;/span&gt;Samba&lt;span&gt;既可以用于&lt;/span&gt;windows&lt;span&gt;与&lt;/span&gt;Linux&lt;span&gt;之间的文件共享，也可以用于&lt;/span&gt;Linux&lt;span&gt;与&lt;/span&gt;Linux&lt;span&gt;之间的资源共享，由于&lt;/span&gt;NFS(&lt;span&gt;网络文件系统）可以很好的完成&lt;/span&gt;Linux&lt;span&gt;与&lt;/span&gt;Linux&lt;span&gt;之间的数据共享，因而&lt;/span&gt; Samba&lt;span&gt;较多的用在了&lt;/span&gt;Linux&lt;span&gt;与&lt;/span&gt;windows&lt;span&gt;之间的数据共享上面。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;SMB&lt;span&gt;是&lt;span&gt;基于客户机&lt;/span&gt;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;服务器型的协议&lt;/span&gt;&lt;span&gt;，因而一台&lt;/span&gt;Samba&lt;span&gt;服务器既可以充当文件共享服务器，也可以充当一个&lt;/span&gt;Samba&lt;span&gt;的客户端，例如，一台在&lt;/span&gt;Linux &lt;span&gt;下已经架设好的&lt;/span&gt;Samba&lt;span&gt;服务器，&lt;/span&gt;windows&lt;span&gt;客户端就可以通过&lt;/span&gt;SMB&lt;span&gt;协议共享&lt;/span&gt;Samba&lt;span&gt;服务器上的资源文件，同时，&lt;/span&gt;Samba&lt;span&gt;服务器也可以访问网络中&lt;/span&gt; &lt;span&gt;其它&lt;/span&gt;windows&lt;span&gt;系统或者&lt;/span&gt;Linux&lt;span&gt;系统共享出来的文件。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Samba&lt;span&gt;在&lt;/span&gt;windows&lt;span&gt;下使用的是&lt;/span&gt;NetBIOS&lt;span&gt;协议，如果你要使用&lt;/span&gt;Linux&lt;span&gt;下共享出来的文件，&lt;span&gt;请确认你的&lt;/span&gt;&lt;/span&gt;&lt;span&gt;windows&lt;/span&gt;&lt;span&gt;系统下是否安装了&lt;/span&gt;&lt;span&gt;NetBIOS&lt;/span&gt;&lt;span&gt;协议&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;span&gt;组成&lt;/span&gt;&lt;/span&gt;&lt;span&gt;Samba&lt;/span&gt;&lt;span&gt;运行的有两个服务，一个是&lt;/span&gt;&lt;span&gt;SMB&lt;/span&gt;&lt;span&gt;，另一个是&lt;/span&gt;&lt;span&gt;NMB&lt;/span&gt;&lt;span&gt;；&lt;/span&gt;&lt;span&gt;SMB&lt;/span&gt;&lt;span&gt;是&lt;/span&gt;&lt;span&gt;Samba&lt;/span&gt; &lt;span&gt;的核心启动服务，&lt;/span&gt;&lt;span&gt;主要负责建立&lt;/span&gt; Linux Samba&lt;span&gt;服务器与&lt;/span&gt;Samba&lt;span&gt;客户机之间的对话，&lt;/span&gt; &lt;span&gt;验证用户身份并提供对文件和打印系统的访问，只有&lt;/span&gt;SMB&lt;span&gt;服务启动，才能实现文件的共享，监听&lt;/span&gt;&lt;strong&gt;&lt;span&gt;139&lt;/span&gt;&lt;/strong&gt; &lt;span&gt;TCP&lt;/span&gt;&lt;span&gt;端口&lt;/span&gt;&lt;span&gt;；而&lt;/span&gt;&lt;span&gt;NMB&lt;/span&gt;&lt;span&gt;服务是负责解析用的&lt;/span&gt;&lt;span&gt;，类似与&lt;/span&gt;DNS&lt;span&gt;实现的功能，&lt;/span&gt;NMB&lt;span&gt;可以把&lt;/span&gt;Linux&lt;span&gt;系统共享的工作组名称与其&lt;/span&gt;IP&lt;span&gt;对应起来，如果&lt;/span&gt;NMB&lt;span&gt;服务没有启动，就只能通过&lt;/span&gt;IP&lt;span&gt;来访问共享文件，监听&lt;/span&gt;137&lt;span&gt;和&lt;/span&gt;138 UDP&lt;span&gt;端口。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　例如，某台&lt;/span&gt;Samba&lt;span&gt;服务器的&lt;/span&gt;IP&lt;span&gt;地址为&lt;/span&gt;10.0.0.163&lt;span&gt;，对应的工作组名称为&lt;/span&gt;davidsamba&lt;span&gt;，那么在&lt;/span&gt;Windows&lt;span&gt;的&lt;/span&gt;IE&lt;span&gt;浏览器输入下面两条指令都可以访问共享文件。其实这就是&lt;/span&gt;Windows&lt;span&gt;下查看&lt;/span&gt;Linux Samba&lt;span&gt;服务器共享文件的方法。&lt;/span&gt;&lt;/p&gt;
&lt;div readability=&quot;9&quot;&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;\\10.0.0.163\&lt;span&gt;共享目录名称&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;\\davidsamba\&lt;span&gt;共享目录名称&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;span&gt;　　&lt;/span&gt;Samba&lt;span&gt;服务器可实现如下功能：&lt;/span&gt;WINS&lt;span&gt;和&lt;/span&gt;DNS&lt;span&gt;服务；&lt;/span&gt; &lt;span&gt;网络浏览服务；&lt;/span&gt; Linux&lt;span&gt;和&lt;/span&gt;Windows&lt;span&gt;域之间的认证和授权；&lt;/span&gt; UNICODE&lt;span&gt;字符集和域名映射；满足&lt;/span&gt;CIFS&lt;span&gt;协议的&lt;/span&gt;UNIX&lt;span&gt;共享等。&lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;2.2 samba&lt;span&gt;服务端部署&lt;/span&gt;&lt;/h2&gt;
&lt;h3&gt;2.2.1 &lt;span&gt;第一个里程碑：&lt;/span&gt; &lt;span&gt;检查软件是否安装（安装&lt;/span&gt;samba&lt;span&gt;软件）&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@test ~]# rpm -qa samba
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;安装&lt;/span&gt;samba&lt;span&gt;服务&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt;  samba -&lt;span&gt;y
Dependency Installed:
  libtalloc.x86_64 &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;:&lt;span&gt;2.1&lt;/span&gt;.&lt;span&gt;5&lt;/span&gt;-&lt;span&gt;1&lt;/span&gt;&lt;span&gt;.el6_7                                               
  libtdb.x86_64 &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;:&lt;span&gt;1.3&lt;/span&gt;.&lt;span&gt;8&lt;/span&gt;-&lt;span&gt;3&lt;/span&gt;.el6_8.&lt;span&gt;2&lt;/span&gt;&lt;span&gt;                                                
  libtevent.x86_64 &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;:&lt;span&gt;0.9&lt;/span&gt;.&lt;span&gt;26&lt;/span&gt;-&lt;span&gt;2&lt;/span&gt;&lt;span&gt;.el6_7                                              
  samba&lt;/span&gt;-common.x86_64 &lt;span&gt;0&lt;/span&gt;:&lt;span&gt;3.6&lt;/span&gt;.&lt;span&gt;23&lt;/span&gt;-&lt;span&gt;45&lt;/span&gt;&lt;span&gt;.el6_9                                          
  samba&lt;/span&gt;-winbind.x86_64 &lt;span&gt;0&lt;/span&gt;:&lt;span&gt;3.6&lt;/span&gt;.&lt;span&gt;23&lt;/span&gt;-&lt;span&gt;45&lt;/span&gt;&lt;span&gt;.el6_9                                         
  samba&lt;/span&gt;-winbind-clients.x86_64 &lt;span&gt;0&lt;/span&gt;:&lt;span&gt;3.6&lt;/span&gt;.&lt;span&gt;23&lt;/span&gt;-&lt;span&gt;45&lt;/span&gt;.el6_9      
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2.2.2 &lt;span&gt;第二个里程碑：&lt;/span&gt; &lt;span&gt;编写配置文件&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;samba&lt;span&gt;服务默认配置文件位置为&lt;/span&gt;&lt;strong&gt;&lt;span&gt;/etc/samba/smb.conf&lt;/span&gt;&lt;/strong&gt; &lt;span&gt;备份该文件，重新写配置文件&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;mv&lt;/span&gt;  /etc/samba/smb.conf /etc/samba/smb.conf.bak
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;配置文件内容：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@test ~]# vim /etc/samba/&lt;span&gt;smb.conf

[global]
workgroup &lt;/span&gt;=&lt;span&gt; WORKGROUP
netbios name &lt;/span&gt;=&lt;span&gt; Test_samba
server &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; =&lt;span&gt; Linux Samba Server TestServer
security &lt;/span&gt;=&lt;span&gt; share

[test]
path &lt;/span&gt;= /&lt;span&gt;share_samba
writeable &lt;/span&gt;=&lt;span&gt; yes
browseable &lt;/span&gt;=&lt;span&gt; yes
guest ok &lt;/span&gt;=&lt;span&gt; yes
&lt;/span&gt;~                                                                                
&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/etc/samba/smb.conf&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &lt;span&gt;11L&lt;/span&gt;, 189C written
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;配置文件参数说明：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;table border=&quot;1&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;&lt;tbody readability=&quot;11&quot;&gt;&lt;tr&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;参数&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;说明&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;[global]&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;这段是全局配置，是必段写的。&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;workgroup&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;就是&lt;/span&gt;Windows&lt;span&gt;中显示的工作组&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;netbios name&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;就是在&lt;/span&gt;Windows&lt;span&gt;中显示出来的计算机名&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;server string&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;就是&lt;/span&gt;Samba&lt;span&gt;服务器说明，可以自己来定义；这个不是什么重要的&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;5&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;security&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;7&quot;&gt;
&lt;p&gt;&lt;span&gt;这是验证和登录方式，这里我们用了&lt;/span&gt;share&lt;/p&gt;
&lt;p&gt;&lt;span&gt;用&lt;/span&gt;share&lt;span&gt;，就是不用设置用户和密码了&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;[test]&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;这个在&lt;/span&gt;Windows&lt;span&gt;中显示出来是共享的目录&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;path&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;可以设置要共享的目录放在哪里&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;writeable&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;是否可写，这里我设置为可写&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4.5&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;browseable&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;6&quot;&gt;
&lt;p&gt;&lt;span&gt;是否可以浏览，可以；可以浏览意味着，我们在工作组下能看到共享文件夹。如果您不想显示出来，那就设置为&lt;/span&gt; browseable=no&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td width=&quot;198&quot;&gt;
&lt;p&gt;guest ok&lt;/p&gt;
&lt;/td&gt;
&lt;td width=&quot;499&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;span&gt;匿名用户以&lt;/span&gt;guest&lt;span&gt;身份是登录&lt;/span&gt;&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;h3&gt;2.2.3 &lt;span&gt;第三个里程碑：&lt;/span&gt; &lt;span&gt;创建共享目录，修改权限&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;mkdir&lt;/span&gt; -p /&lt;span&gt;share_samba
[root@test &lt;/span&gt;~]# &lt;span&gt;id&lt;/span&gt;&lt;span&gt; nobody
uid&lt;/span&gt;=&lt;span&gt;99&lt;/span&gt;(nobody) gid=&lt;span&gt;99&lt;/span&gt;(nobody) &lt;span&gt;groups&lt;/span&gt;=&lt;span&gt;99&lt;/span&gt;&lt;span&gt;(nobody)

[root@test &lt;/span&gt;~]# &lt;span&gt;chown&lt;/span&gt; nobody.nobody /share_samba -R
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;说明：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;   &lt;span&gt;关于授权&lt;/span&gt;nobody&lt;span&gt;，我们先用&lt;/span&gt;id&lt;span&gt;命令查看了&lt;/span&gt;nobody&lt;span&gt;用户的信息，发现他的用户组也是&lt;/span&gt;nobody&lt;span&gt;，我们要以这个为准。有些系统&lt;/span&gt;nobody&lt;span&gt;用户组并非是&lt;/span&gt;nobody &lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;2.2.4 &lt;span&gt;第四个里程碑：&lt;/span&gt; &lt;span&gt;启动&lt;/span&gt;smb&lt;span&gt;和&lt;/span&gt;nmb&lt;span&gt;服务，加入开机启动&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test ~]# /etc/init.d/&lt;span&gt;smb start
Starting SMB services:                                     [  OK  ]

[root@test &lt;/span&gt;~&lt;span&gt;]# chkconfig smb on
[root@test &lt;/span&gt;~]# chkconfig |&lt;span&gt;grep&lt;/span&gt;&lt;span&gt; smb
smb            &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;:off  &lt;span&gt;1&lt;/span&gt;:off  &lt;span&gt;2&lt;/span&gt;:on   &lt;span&gt;3&lt;/span&gt;:on   &lt;span&gt;4&lt;/span&gt;:on   &lt;span&gt;5&lt;/span&gt;:on   &lt;span&gt;6&lt;/span&gt;:off
&lt;/pre&gt;&lt;/div&gt;
&lt;div readability=&quot;7&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;说明：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;    &lt;span&gt;由于未涉及域名解析，所以不启动&lt;/span&gt;nmb&lt;span&gt;服务也可以访问&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;2.3 windows&lt;span&gt;客户端测试&lt;/span&gt;&lt;/h2&gt;
&lt;h3&gt;2.3.1 windows&lt;span&gt;上添加网络位置（&lt;/span&gt;samba&lt;span&gt;共享的文件夹）&lt;/span&gt;&lt;/h3&gt;
&lt;div readability=&quot;7&quot;&gt;
&lt;p&gt;    &lt;span&gt;打开资源管理器，右键单击，选择“添加网络位置”&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122215214618-487143535.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div readability=&quot;11&quot;&gt;
&lt;p&gt;&lt;span&gt;输入&lt;/span&gt; samba&lt;span&gt;服务器的地址&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;格式：&lt;/span&gt; \\&lt;em&gt;samba&lt;/em&gt;&lt;em&gt;&lt;span&gt;服务器地址&lt;/span&gt;&lt;/em&gt;\&lt;em&gt;&lt;span&gt;共享目录名称&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;说明&lt;/span&gt;&lt;span&gt;:&lt;/span&gt;&lt;/strong&gt;&lt;em&gt;&lt;span&gt;共享目录名称&lt;/span&gt;&lt;/em&gt; &lt;span&gt;为设置的局部变量名，我设置的为&lt;/span&gt;[test]&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122215230696-675263253.png&quot; alt=&quot;&quot;/&gt; &lt;/p&gt;
&lt;div readability=&quot;7&quot;&gt;
&lt;p&gt;    &lt;span&gt;点击下一步，设置显示的名称【可以选择默认】&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122215301711-1449562885.png&quot; alt=&quot;&quot;/&gt; &lt;/p&gt;
&lt;div readability=&quot;7&quot;&gt;
&lt;p&gt;    &lt;span&gt;至此&lt;/span&gt;samba&lt;span&gt;共享的文件夹在&lt;/span&gt;winndows&lt;span&gt;上添加上了&lt;/span&gt; &lt;span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p align=&quot;center&quot;&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122215312883-1274433294.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;2.3.2 &lt;span&gt;对共享文件夹进行测试&lt;/span&gt;&lt;/h3&gt;
&lt;div&gt;
&lt;p&gt;&lt;span&gt;上传测试&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt; &lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122215325290-75123493.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@test share_samba]# &lt;span&gt;pwd&lt;/span&gt;
/&lt;span&gt;share_samba
[root@test share_samba]# tree
├── test.&lt;/span&gt;&lt;span&gt;zip&lt;/span&gt;&lt;span&gt;
└── samba sever.txt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;下载文件测试&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1190037/201711/1190037-20171122215402711-584078708.png&quot; alt=&quot;&quot;/&gt; &lt;/p&gt;
&lt;h2&gt;2.4 &lt;span&gt;在&lt;/span&gt;cento 6.9&lt;span&gt;上测试说明&lt;/span&gt;samba&lt;span&gt;共享&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;安装&lt;/span&gt;samba&lt;span&gt;客户端&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@test &lt;span&gt;ftp&lt;/span&gt;]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt; samba-client
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@test ~]# smbclient &lt;span&gt;//&lt;/span&gt;&lt;span&gt;172.16.1.250/test&lt;/span&gt;
WARNING: The security=&lt;span&gt;share option is deprecated
Enter root&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s password:&lt;/span&gt;
Domain=[WORKGROUP] OS=[Unix] Server=[Samba &lt;span&gt;3.6&lt;/span&gt;.&lt;span&gt;23&lt;/span&gt;-&lt;span&gt;45&lt;/span&gt;&lt;span&gt;.el6_9]
Server not using user level security and no password supplied.
smb: \&lt;/span&gt;&amp;gt; &lt;span&gt;ls&lt;/span&gt;&lt;span&gt;
  .                                   D        &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;  Sat Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;14&lt;/span&gt;:&lt;span&gt;38&lt;/span&gt;:&lt;span&gt;47&lt;/span&gt; &lt;span&gt;2017&lt;/span&gt;&lt;span&gt;
  ..                                 DR        &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;  Sat Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;13&lt;/span&gt;:&lt;span&gt;49&lt;/span&gt;:&lt;span&gt;02&lt;/span&gt; &lt;span&gt;2017&lt;/span&gt;&lt;span&gt;
  samba sever.txt                     A       &lt;/span&gt;&lt;span&gt;60&lt;/span&gt;  Sat Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;03&lt;/span&gt;:&lt;span&gt;05&lt;/span&gt;:&lt;span&gt;00&lt;/span&gt; &lt;span&gt;2017&lt;/span&gt;&lt;span&gt;
  redhat&lt;/span&gt;-release                              &lt;span&gt;27&lt;/span&gt;  Sat Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;14&lt;/span&gt;:&lt;span&gt;49&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt; &lt;span&gt;2017&lt;/span&gt;&lt;span&gt;
  test.&lt;/span&gt;&lt;span&gt;zip&lt;/span&gt;                            A  &lt;span&gt;7234678&lt;/span&gt;  Sat Oct &lt;span&gt;14&lt;/span&gt; &lt;span&gt;11&lt;/span&gt;:&lt;span&gt;08&lt;/span&gt;:&lt;span&gt;50&lt;/span&gt; &lt;span&gt;2017&lt;/span&gt;
 
    &lt;span&gt;38152&lt;/span&gt; blocks of size &lt;span&gt;524288&lt;/span&gt;. &lt;span&gt;32854&lt;/span&gt; blocks available
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;挂载方式&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
[root@test ~]# &lt;span&gt;mount&lt;/span&gt;.tmpfs &lt;span&gt;//&lt;/span&gt;&lt;span&gt;10.0.0.250/test/ /mnt/&lt;/span&gt;
[root@test ~]# &lt;span&gt;df&lt;/span&gt; -&lt;span&gt;h
Filesystem          Size  Used Avail Use&lt;/span&gt;%&lt;span&gt; Mounted on
&lt;/span&gt;/dev/sda3            19G  &lt;span&gt;1&lt;/span&gt;.7G   17G  &lt;span&gt;10&lt;/span&gt;% /&lt;span&gt;
tmpfs               238M     &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;  238M   &lt;span&gt;0&lt;/span&gt;% /dev/&lt;span&gt;shm
&lt;/span&gt;/dev/sda1           190M   40M  141M  &lt;span&gt;22&lt;/span&gt;% /&lt;span&gt;boot
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;10.0.0.250/test/  238M     0  238M   0% /mnt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;2.5 &lt;span&gt;至此&lt;/span&gt;samba&lt;span&gt;服务配置完成。&lt;/span&gt;&lt;/h2&gt;

</description>
<pubDate>Wed, 22 Nov 2017 13:56:00 +0000</pubDate>
<dc:creator>惨绿少年</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/clsn/p/7694610.html</dc:identifier>
</item>
<item>
<title>我从.net转到java的心得和体会 - 朝向远方</title>
<link>http://www.cnblogs.com/LipeiNet/p/7880962.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/LipeiNet/p/7880962.html</guid>
<description>&lt;p&gt;  前言：由于有不少人咨询过我如果从.net转java,有什么技巧吗,我现在就分享我从.net转java的历程,这里不涉及两门语言的比较,记录的都是我个人的观点。&lt;/p&gt;
&lt;h2&gt;一：从.net转java的初衷&lt;/h2&gt;
&lt;p&gt;   我是2013年11月正式开始使用.net这门语言工作一直到2016年3月份截止,前后近2年半的时间,从最开始的套站到用TDD来自己搭架构。说实话我很喜欢.net语言的,编辑器智能,语言很优雅也大家可以从我的博客中看到很多关于.net，但是在2016的一个转折点让我思考是不是应该转java了,因为当时2个同事相继离职,分别去了美团和小米(他们都是前端),谁不想去大企业发展呢，我也想,可是我看遍了网上的招聘,除了汽车之家、去哪儿基本没有知名度高的企业招聘,我又去看看java的真是太多大企业招聘,阿里、百度、美团、网易、爱奇艺等都有,所以那个时候真的想转行,所以在私下就会看了一点java的书籍。&lt;/p&gt;
&lt;h2&gt;二：选择&lt;/h2&gt;
&lt;p&gt;   有一天在一个EA(enterprise architect)群聊天,他说要招人,我就和他嫌扯几句,因为我会用EA画流程图、活动图、序列图等,所以他觉得非常合适他说他们却一个这样的人,希望我可以去他们那工作,最后在细聊的过程中发现他们是java,他问我你用什么语言我说.net,他迟疑了一下说,没关系语言不分家,就这样就被录用了,不过我自己整整纠结了2个星期到底要不要去,一个是并不是去做java而是先去画图说什么需求分析师,二个是虽然薪水比我原来薪水多了几千,但是五险一金缴纳比较多,而且老东家也提出加薪了,所以一直犹豫,最终我做出了选择,如果我继续去.net那我只能找一家好的企业待下去,可是外界比我现有公司好的已经不多,所以我必须去尝试,就这样踏上了java的道路。&lt;/p&gt;
&lt;h2&gt;三：新的开始&lt;/h2&gt;
&lt;p&gt;刚刚开始去公司就是白天画图,各种图,也没让我从事java,我只能夜晚私下的学习,我记得当时我就想像.net那样搞个sqlhelper帮助类,然后能完成增删改查,整整搞了2个夜晚才搞定,我大学室友是搞java的,然后喊他给我指导他说谁还写这个现在都是Hibernate或者mybatis,我说你能不能搞定,他写了很久查了半天资料才搞定,我就说这要是.net我给你20分钟就搞定,你这是什么玩意.就这样我算是完成了第一步,会用库了,然后我就在网上查怎么初学者怎么学习java,有本书介绍的比较多《SERVLET／JSP深入详解  基于TOMCAT的WEB开发 孙鑫著》不是打广告,就这样按照书一步步的来,然后把所学就写在博客中来加强自己的理解,就这样我按照这样写终于完成了一个小的网页,真的好有成就感,感觉就像回到了刚刚接触.net那会,然后继续接着学习又开始了另一本书籍《30天学通Java_Web项目案例开发》然后按照这个例子开始写项目,而且在这基础上加上单元测试,就这样慢慢的准备期待哪天可以进行实战,机会又来了,公司由于规模不大，离职率也高所以就让我去开发,在这期间认识一个人感觉基础非常扎实,人也特别好,然后他带着就这样一步步开发,也越来越熟悉,在后来公司领导决定让我使用新的开发工具(idea)，刚开始还不是很适应，但是用着用着发现这个可以媲美vs了，觉得异常好用。在私下我依然没有忘记去学习,继续了第三本书籍《SPRING in action》,就这样度过了刚刚开始不适应java那段路程,然后公司让我独立开发,承担并发量比较高的项目（优惠券相关）然后在网上学习了一些如何提升性能的方式然后还在GitHub上开源了我写的项目大家可以参考(&lt;a href=&quot;https://github.com/lipeiNet/peiyu-mem&quot; target=&quot;_blank&quot;&gt;https://github.com/lipeiNet/peiyu-mem&lt;/a&gt;)。再后来带我的那个哥们跳槽了去了jd,那整块业务就全部交给我了,当时知识已经够处理这段业务。再后来公司的CTO和架构师相继离职,而且听消息说公司老板打算从滴滴挖人并且用php开发,然后我知道自己是时候准备下一份工作了,然后就开始看java基础知识,包括源码等主要的书籍是《thinking in java》,到2017年3月份我觉得时机成熟了时候找新的企业去完成自己当初定下的目标,后来真的完成了自己的目前去了一家大企业,关于面试大家看这篇文章&lt;a href=&quot;http://www.cnblogs.com/LipeiNet/p/6668034.html&quot; target=&quot;_blank&quot;&gt;面试&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;四：总结&lt;/h2&gt;
&lt;p&gt;1、关于.net转java 一般有2中渠道风险稍微小点,第一就是内部转岗,和自己领导搞好关系,然后在和java部领导搞好关系,就算是平跳也是非常不错,我有一个同学这么做的,还不错。另一个就是先私信努力学习,做一些项目，然后没事就可以看一下招聘动态，说不定有意想不到的收获。&lt;/p&gt;
&lt;p&gt;2、把以前用.net实现的项目用java实现,遇到问题去查询,然后在去看书效果会好很多,如果都好了不妨去看看java的源码,主要看集合那块。最后就可以出去试试水,看看面试官面试什么那么你就多看看这方面的知识(因为他们问的一般用的都是比较多的)&lt;/p&gt;
&lt;p&gt;3、这里只是写出我自己的经历,有时候选择真的挺重要的。&lt;/p&gt;

</description>
<pubDate>Wed, 22 Nov 2017 13:02:00 +0000</pubDate>
<dc:creator>朝向远方</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/LipeiNet/p/7880962.html</dc:identifier>
</item>
<item>
<title>prometheus client_golang使用 - gaorong404</title>
<link>http://www.cnblogs.com/gaorong/p/7881203.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/gaorong/p/7881203.html</guid>
<description>&lt;h2 id=&quot;序言&quot;&gt;序言&lt;/h2&gt;
&lt;p&gt;Prometheus是一个开源的监控系统，拥有许多Advanced Feature，他会定期用HTTP协议来pull所监控系统状态进行数据收集，在加上timestamp等数据组织成time series data，用metric name和label来标识不同的的time series,用户可以将数据用可视化工具显示出来，并设置报警阈值进行报警。&lt;br/&gt;本文将介绍Primetheus client的使用，基于golang语言，golang client 是当pro收集所监控的系统的数据时，用于响应pro的请求，按照一定的格式给pro返回数据，说白了就是一个http server， 源码参见&lt;a href=&quot;https://github.com/prometheus/client_golang&quot;&gt;github&lt;/a&gt;,相关的文档参见&lt;a href=&quot;https://godoc.org/github.com/prometheus/client_golang/prometheus#NewRegistry&quot;&gt;GoDoc&lt;/a&gt;,读者可以直接阅读文档进行开发，本文只是帮助理解。&lt;/p&gt;
&lt;h2 id=&quot;基础&quot;&gt;基础&lt;/h2&gt;
&lt;p&gt;要想学习pro golang client，需要有一个进行测试的环境，笔者建议使用prometheus的docker环境，部署迅速，对于系统没有影响，安装方式参见&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/installation/#using-docker&quot;&gt;Using Docker&lt;/a&gt;，需要在本地准备好Pro的配置文件prometheus.yml，然后以volme的方式映射进docker，配置文件中的内容如下：&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;global:
  scrape_interval:     15s # By default, scrape targets every 15 seconds.

  # Attach these labels to any time series or alerts when communicating with
  # external systems (federation, remote storage, Alertmanager).
  external_labels:
    monitor: 'codelab-monitor'

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=&amp;lt;job_name&amp;gt;` to any timeseries scraped from this config.
- job_name: &quot;go-test&quot;
  scrape_interval: 60s
  scrape_timeout: 60s
  metrics_path: &quot;/metrics&quot;

  static_configs:
  - targets: [&quot;localhost:8888&quot;]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;可以看到配置文件中指定了一个job_name，所要监控的任务即视为一个job, scrape_interval和scrape_timeout是pro进行数据采集的时间间隔和频率，matrics_path指定了访问数据的http路径，target是目标的ip:port,这里使用的是同一台主机上的8888端口。此处只是基本的配置，更多信息参见&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/configuration/&quot;&gt;官网&lt;/a&gt;。&lt;br/&gt;配置好之后就可以启动pro服务了：&lt;br/&gt;&lt;code&gt;docker run --network=host -p 9090:9090 -v /home/gaorong/project/prometheus_test/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus&lt;/code&gt;&lt;br/&gt;此处网络通信采用的是host模式，所以docker中的pro可以直接通过localhost来指定同一台主机上所监控的程序。prob暴露9090端口进行界面显示或其他操作，需要对docker中9090端口进行映射。启动之后可以访问web页面&lt;code&gt;http://localhost:9090/graph&lt;/code&gt;,在status下拉菜单中可以看到配置文件和目标的状态，此时目标状态为DOWN，因为我们所需要监控的服务还没有启动起来，那就赶紧步入正文，用pro golang client来实现程序吧。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/1111516/201711/1111516-20171122204719383-1805383205.png&quot; alt=&quot;ls&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;四种数据类型&quot;&gt;四种数据类型&lt;/h2&gt;
&lt;p&gt;pro将所有数据保存为timeseries data，用metric name和label区分，labeal是在metric name上的更细维度的划分，其中的每一个实例是由一个float64和timestamp组成，只不过timestamp是隐式加上去的，有时候不会显示出来，如下面所示(数据来源于pro暴露的监控数据，访问http://localhost:9090/metrics 可得），其中go_gc_duration_seconds是metrics name,quantile=&quot;0.5&quot;是key-value pair的label，而后面的值是float64 value。&lt;br/&gt;pro为了方便client library的使用提供了四种数据类型： Counter, Gauge, Histogram, Summary, 简单理解就是Counter对数据只增不减，Gauage可增可减，Histogram,Summary提供跟多的统计信息。下面的实例中注释部分&lt;code&gt;# TYPE go_gc_duration_seconds summary&lt;/code&gt; 标识出这是一个summary对象。&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;# HELP go_gc_duration_seconds A summary of the GC invocation durations.
# TYPE go_gc_duration_seconds summary
go_gc_duration_seconds{quantile=&quot;0.5&quot;} 0.000107458
go_gc_duration_seconds{quantile=&quot;0.75&quot;} 0.000200112
go_gc_duration_seconds{quantile=&quot;1&quot;} 0.000299278
go_gc_duration_seconds_sum 0.002341738
go_gc_duration_seconds_count 18
# HELP go_goroutines Number of goroutines that currently exist.
# TYPE go_goroutines gauge
go_goroutines 107&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a href=&quot;https://godoc.org/github.com/prometheus/client_golang/prometheus#hdr-A_Basic_Example&quot;&gt;A Basic Example&lt;/a&gt; 演示了使用这些数据类型的方法（注意将其中8080端口改为本文的8888）&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;18&quot;&gt;
&lt;pre class=&quot;sourceCode go&quot;&gt;
&lt;code class=&quot;sourceCode go&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;kw&quot;&gt;import&lt;/span&gt; (
    &lt;span class=&quot;st&quot;&gt;&quot;log&quot;&lt;/span&gt;
    &lt;span class=&quot;st&quot;&gt;&quot;net/http&quot;&lt;/span&gt;

    &lt;span class=&quot;st&quot;&gt;&quot;github.com/prometheus/client_golang/prometheus&quot;&lt;/span&gt;
    &lt;span class=&quot;st&quot;&gt;&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;&lt;/span&gt;
)

&lt;span class=&quot;kw&quot;&gt;var&lt;/span&gt; (
    cpuTemp = prometheus.NewGauge(prometheus.GaugeOpts{
        Name: &lt;span class=&quot;st&quot;&gt;&quot;cpu_temperature_celsius&quot;&lt;/span&gt;,
        Help: &lt;span class=&quot;st&quot;&gt;&quot;Current temperature of the CPU.&quot;&lt;/span&gt;,
    })
    hdFailures = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: &lt;span class=&quot;st&quot;&gt;&quot;hd_errors_total&quot;&lt;/span&gt;,
            Help: &lt;span class=&quot;st&quot;&gt;&quot;Number of hard-disk errors.&quot;&lt;/span&gt;,
        },
        []&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;{&lt;span class=&quot;st&quot;&gt;&quot;device&quot;&lt;/span&gt;},
    )
)

&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; init() {
    &lt;span class=&quot;co&quot;&gt;// Metrics have to be registered to be exposed:&lt;/span&gt;
    prometheus.MustRegister(cpuTemp)
    prometheus.MustRegister(hdFailures)
}

&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; main() {
    cpuTemp.Set(&lt;span class=&quot;dv&quot;&gt;65&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;.3&lt;/span&gt;)
    hdFailures.With(prometheus.Labels{&lt;span class=&quot;st&quot;&gt;&quot;device&quot;&lt;/span&gt;:&lt;span class=&quot;st&quot;&gt;&quot;/dev/sda&quot;&lt;/span&gt;}).Inc()

    &lt;span class=&quot;co&quot;&gt;// The Handler function provides a default handler to expose metrics&lt;/span&gt;
    &lt;span class=&quot;co&quot;&gt;// via an HTTP server. &quot;/metrics&quot; is the usual endpoint for that.&lt;/span&gt;
    http.Handle(&lt;span class=&quot;st&quot;&gt;&quot;/metrics&quot;&lt;/span&gt;, promhttp.Handler())
    log.Fatal(http.ListenAndServe(&lt;span class=&quot;st&quot;&gt;&quot;:8888&quot;&lt;/span&gt;, &lt;span class=&quot;ot&quot;&gt;nil&lt;/span&gt;))
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中创建了一个gauge和CounterVec对象，并分别指定了metric name和help信息，其中CounterVec是用来管理相同metric下不同label的一组Counter，同理存在GaugeVec，可以看到上面代码中声明了一个lable的key为“device”，使用的时候也需要指定一个lable: &lt;code&gt;hdFailures.With(prometheus.Labels{&quot;device&quot;:&quot;/dev/sda&quot;}).Inc()&lt;/code&gt;。&lt;br/&gt;变量定义后进行注册，最后再开启一个http服务的8888端口就完成了整个程序，pro采集数据是通过定期请求该服务http端口来实现的。&lt;br/&gt;启动程序之后可以在web浏览器里输入http://localhost:8888/metrics 就可以得到client暴露的数据，其中有片段显示为：&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;# HELP cpu_temperature_celsius Current temperature of the CPU.
# TYPE cpu_temperature_celsius gauge
cpu_temperature_celsius 65.3

# HELP hd_errors_total Number of hard-disk errors.
# TYPE hd_errors_total counter
hd_errors_total{device=&quot;/dev/sda&quot;} 1&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;上图就是示例程序所暴露出来的数据，并且可以看到counterVec是有label的,而单纯的gauage对象却不用lable标识，这就是基本数据类型和对应Vec版本的差别。此时再查看http://localhost:9090/graph 就会发现服务状态已经变为UP了。&lt;br/&gt;上面的例子只是一个简单的demo,因为在prometheus.yml配置文件中我们指定采集服务器信息的时间间隔为60s，每隔60s pro会通过http请求一次自己暴露的数据，而在代码中我们只设置了一次gauge变量cupTemp的值，如果在60s的采样间隔里将该值设置多次，前面的值就会被覆盖，只有pro采集数据那一刻的值能被看到，并且如果不再改变这个值，pro就始终能看到这个恒定的变量，除非用户显式通过Delete函数删除这个变量。&lt;br/&gt;使用Counter,Gauage等这些结构比较简单，但是如果不再使用这些变量需要我们手动删除，在某些情况下，我们无法知道自己曾经定义过哪些变量，这样的话，这些变量就会一直保存在pro中，这时候就需要我们自定义collector来实现了。&lt;/p&gt;
&lt;h2 id=&quot;自定义collector&quot;&gt;自定义Collector&lt;/h2&gt;
&lt;p&gt;go client Colletor只会在每次响应pro请求的时候才收集数据，并且需要每次显式传递变量的值，否则就不会再维持该变量，在pro也将看不到这个变量，Collector是一个接口，所有收集metrics数据的对象都需要实现这个接口，Counter和Gauage等不例外，它内部提供了两个函数，Collector用于收集用户数据，将收集好的数据传递给传入参数Channel就可，Descirbe函数用于描述这个Collector。当收集系统数据代价较大时，就可以自定义Collector收集的方式，优化流程，并且在某些情况下如果已经有了一个成熟的metrics，就不需要使用Counter,Gauage等这些数据结构，直接在Collector内部实现一个代理的功能即可，一些高阶的用法都可以通过自定义Collector实现。&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; readability=&quot;46&quot;&gt;
&lt;pre class=&quot;sourceCode go&quot;&gt;
&lt;code class=&quot;sourceCode go&quot;&gt;&lt;span class=&quot;kw&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;kw&quot;&gt;import&lt;/span&gt; (
    &lt;span class=&quot;st&quot;&gt;&quot;github.com/prometheus/client_golang/prometheus&quot;&lt;/span&gt;
    &lt;span class=&quot;st&quot;&gt;&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;&lt;/span&gt;
    &lt;span class=&quot;st&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
)

&lt;span class=&quot;kw&quot;&gt;type&lt;/span&gt; ClusterManager &lt;span class=&quot;kw&quot;&gt;struct&lt;/span&gt; {
    Zone         &lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;
    OOMCountDesc *prometheus.Desc
    RAMUsageDesc *prometheus.Desc
    &lt;span class=&quot;co&quot;&gt;// ... many more fields&lt;/span&gt;
}

&lt;span class=&quot;co&quot;&gt;// Simulate prepare the data&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; (c *ClusterManager) ReallyExpensiveAssessmentOfTheSystemState() (
    oomCountByHost &lt;span class=&quot;kw&quot;&gt;map&lt;/span&gt;[&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;]&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt;, ramUsageByHost &lt;span class=&quot;kw&quot;&gt;map&lt;/span&gt;[&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;]&lt;span class=&quot;dt&quot;&gt;float64&lt;/span&gt;,
) {
    &lt;span class=&quot;co&quot;&gt;// Just example fake data.&lt;/span&gt;
    oomCountByHost = &lt;span class=&quot;kw&quot;&gt;map&lt;/span&gt;[&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;]&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt;{
        &lt;span class=&quot;st&quot;&gt;&quot;foo.example.org&quot;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;42&lt;/span&gt;,
        &lt;span class=&quot;st&quot;&gt;&quot;bar.example.org&quot;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;2001&lt;/span&gt;,
    }
    ramUsageByHost = &lt;span class=&quot;kw&quot;&gt;map&lt;/span&gt;[&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;]&lt;span class=&quot;dt&quot;&gt;float64&lt;/span&gt;{
        &lt;span class=&quot;st&quot;&gt;&quot;foo.example.org&quot;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;.023e23&lt;/span&gt;,
        &lt;span class=&quot;st&quot;&gt;&quot;bar.example.org&quot;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;.14&lt;/span&gt;,
    }
    &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt;
}

&lt;span class=&quot;co&quot;&gt;// Describe simply sends the two Descs in the struct to the channel.&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; (c *ClusterManager) Describe(ch &lt;span class=&quot;kw&quot;&gt;chan&lt;/span&gt;&amp;lt;- *prometheus.Desc) {
    ch &amp;lt;- c.OOMCountDesc
    ch &amp;lt;- c.RAMUsageDesc
}

&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; (c *ClusterManager) Collect(ch &lt;span class=&quot;kw&quot;&gt;chan&lt;/span&gt;&amp;lt;- prometheus.Metric) {
    oomCountByHost, ramUsageByHost := c.ReallyExpensiveAssessmentOfTheSystemState()
    &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; host, oomCount := &lt;span class=&quot;kw&quot;&gt;range&lt;/span&gt; oomCountByHost {
        ch &amp;lt;- prometheus.MustNewConstMetric(
            c.OOMCountDesc,
            prometheus.CounterValue,
            &lt;span class=&quot;dt&quot;&gt;float64&lt;/span&gt;(oomCount),
            host,
        )
    }
    &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; host, ramUsage := &lt;span class=&quot;kw&quot;&gt;range&lt;/span&gt; ramUsageByHost {
        ch &amp;lt;- prometheus.MustNewConstMetric(
            c.RAMUsageDesc,
            prometheus.GaugeValue,
            ramUsage,
            host,
        )
    }
}

&lt;span class=&quot;co&quot;&gt;// NewClusterManager creates the two Descs OOMCountDesc and RAMUsageDesc. Note&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;// that the zone is set as a ConstLabel. (It's different in each instance of the&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;// ClusterManager, but constant over the lifetime of an instance.) Then there is&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;// a variable label &quot;host&quot;, since we want to partition the collected metrics by&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;// host. Since all Descs created in this way are consistent across instances,&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;// with a guaranteed distinction by the &quot;zone&quot; label, we can register different&lt;/span&gt;
&lt;span class=&quot;co&quot;&gt;// ClusterManager instances with the same registry.&lt;/span&gt;
&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; NewClusterManager(zone &lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;) *ClusterManager {
    &lt;span class=&quot;kw&quot;&gt;return&lt;/span&gt; &amp;amp;ClusterManager{
        Zone: zone,
        OOMCountDesc: prometheus.NewDesc(
            &lt;span class=&quot;st&quot;&gt;&quot;clustermanager_oom_crashes_total&quot;&lt;/span&gt;,
            &lt;span class=&quot;st&quot;&gt;&quot;Number of OOM crashes.&quot;&lt;/span&gt;,
            []&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;{&lt;span class=&quot;st&quot;&gt;&quot;host&quot;&lt;/span&gt;},
            prometheus.Labels{&lt;span class=&quot;st&quot;&gt;&quot;zone&quot;&lt;/span&gt;: zone},
        ),
        RAMUsageDesc: prometheus.NewDesc(
            &lt;span class=&quot;st&quot;&gt;&quot;clustermanager_ram_usage_bytes&quot;&lt;/span&gt;,
            &lt;span class=&quot;st&quot;&gt;&quot;RAM usage as reported to the cluster manager.&quot;&lt;/span&gt;,
            []&lt;span class=&quot;dt&quot;&gt;string&lt;/span&gt;{&lt;span class=&quot;st&quot;&gt;&quot;host&quot;&lt;/span&gt;},
            prometheus.Labels{&lt;span class=&quot;st&quot;&gt;&quot;zone&quot;&lt;/span&gt;: zone},
        ),
    }
}

&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; main() {
    workerDB := NewClusterManager(&lt;span class=&quot;st&quot;&gt;&quot;db&quot;&lt;/span&gt;)
    workerCA := NewClusterManager(&lt;span class=&quot;st&quot;&gt;&quot;ca&quot;&lt;/span&gt;)

    &lt;span class=&quot;co&quot;&gt;// Since we are dealing with custom Collector implementations, it might&lt;/span&gt;
    &lt;span class=&quot;co&quot;&gt;// be a good idea to try it out with a pedantic registry.&lt;/span&gt;
    reg := prometheus.NewPedanticRegistry()
    reg.MustRegister(workerDB)
    reg.MustRegister(workerCA)

    http.Handle(&lt;span class=&quot;st&quot;&gt;&quot;/metrics&quot;&lt;/span&gt;, promhttp.HandlerFor(reg, promhttp.HandlerOpts{}))
    http.ListenAndServe(&lt;span class=&quot;st&quot;&gt;&quot;:8888&quot;&lt;/span&gt;, &lt;span class=&quot;ot&quot;&gt;nil&lt;/span&gt;)
}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;此时就可以去&lt;code&gt;http://localhost:8888/metrics&lt;/code&gt; 看到传递过去的数据了。示例中定义了两个matrics, host和zone分别是其label。 其实pro client内部提供了几个Collecto供我们使用，我们可以参考他的实现，在源码包中可以找到go_collector.go, process_collecor.go, expvar_collector这三个文件的Collecor实现。&lt;/p&gt;
</description>
<pubDate>Wed, 22 Nov 2017 12:48:00 +0000</pubDate>
<dc:creator>gaorong404</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/gaorong/p/7881203.html</dc:identifier>
</item>
<item>
<title>《阿里巴巴Java工作手册》学习笔记 - 熊二哥</title>
<link>http://www.cnblogs.com/wanliwang01/p/JavaStandard.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/wanliwang01/p/JavaStandard.html</guid>
<description>&lt;p&gt;最近浏览了一下阿里巴巴的Java开发手册，感觉内容确实非常的赞，发现了不少自己在编程中的误区，因此决定通过成文牢固掌握，文中将选取个人认为比较重要的部分进行描述与分析。&lt;strong&gt;”愿站在巨人的肩膀上，码出高效，码出质量“&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;手册中内容很多，包括编码规约、工程结构、MySQL数据库、异常日志、安全规约、单元测试等6大部分。其中&lt;strong&gt;工程结构&lt;/strong&gt;部分在整体上对项目进行了把控，&lt;strong&gt;编码规约和MySQL设计规约&lt;/strong&gt;中有非常多的&lt;strong&gt;“最佳实践”&lt;/strong&gt;，个人认为是最为有价值的部分。次重点安全规约很符合互联网场景的需要，异常日志和单元测试部分相对来说内容和价值相对小一点。&lt;br/&gt;下图是个人对手册的简单汇总（&lt;strong&gt;将图片拖到浏览器新开页面，之后放大可以清晰很多&lt;/strong&gt;），其中&lt;strong&gt;红星表示重点，黄色表示次重点&lt;/strong&gt;。此外，其中的集合处理、并发处理、MySQL规约和工程结构有一定理解难度，会专门放到重难点增强一节进行详细分析。当然这只是个人的浅见，完整部分请见最下方的参考资料，目前阿里公司已推出这套规约的IDE插件，大家可以试试。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/636325/201711/636325-20171122203040930-831459611.png&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;工程结构&quot;&gt;工程结构&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/636325/201711/636325-20171122203058008-120525299.png&quot;/&gt;&lt;br/&gt;Open Interface：提供RPC或Restful风格的接口，并通过框架进行网关安全控制、流量控制等。&lt;br/&gt; 终端显示层：前端模板渲染并执行显示的层。&lt;br/&gt;Web Layer： 主要是对访问控制进行转发， 各类基本参数校验， 或者不复用的业务简单处理等。&lt;br/&gt;Service Layer：业务逻辑服务层。&lt;br/&gt;&lt;strong&gt;Manager Layer&lt;/strong&gt;：这一层比较有意思，既包含了常见的外部接口的Agent功能，也包含了对DAO接口的简单封装用于复用，还可以在改成构建对于DAO的缓存。&lt;br/&gt;DAO Layer：与底层 MySQL、Hbase等进行数据交互，通常基于各类DAL框架。&lt;br/&gt;ExternalInterface： 包括其它部门 RPC 开放接口， 基础平台， 其它公司的 HTTP 接口。&lt;br/&gt;Tip: 实际项目中完全可以&lt;strong&gt;遵循该模式构建包的层次&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 id=&quot;集合处理&quot;&gt;集合处理&lt;/h2&gt;
&lt;p&gt;集合操作一直是一个关键点，常见的小技巧包括通过Set元素唯一的特性，可以快速对一个集合进行去重操作，JD8中通过steam流对集合操作做了不错的增强。合理利用好集合的有序性 (sort) 和稳定性 (order) ，避免集合的无序性 (unsort) 和&lt;br/&gt;不稳定性 (unorder) 带来的负面影响，ArrayList是order&amp;amp;unsort；HashMap是unorder&amp;amp;unsort；TreeSet 是order&amp;amp;sort。&lt;br/&gt;TIp: 不同类型Map集合K/V能不能存储null值的情况如下表所示&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/636325/201711/636325-20171122203110711-198121861.png&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;并发处理&quot;&gt;并发处理&lt;/h2&gt;
&lt;p&gt;合理的通过并发控制来高效利用系统资源是工程师永远的追求，该手册的不少要求很好的认识到自己在该方面的不足。&lt;br/&gt;&lt;strong&gt;线程池的创建&lt;/strong&gt;&lt;br/&gt;过去一半都通过Executors 去创建线程池，实际上这是不合理的，比如FixedThreadPool的阻塞队列大小Integer.MAX_VALUE，很容易造成大量请求的堆积，造成OOM。而ScheduledThreadPool允许线程的数量为Integer.MAX_VALUE，更加容易出现OOM。因此&lt;strong&gt;必须使用ThreadPoolExecutor创建线程池&lt;/strong&gt;，明确的制定线程池的参数，详情请见&lt;a href=&quot;http://www.cnblogs.com/wanliwang01/p/Java_ThreadPool.html&quot;&gt;深入理解Java线程池一文&lt;/a&gt;。&lt;br/&gt;&lt;strong&gt;使用锁的原则&lt;/strong&gt;&lt;br/&gt;1.高并发时，同步调用应该去考量锁的性能损耗。能用无锁数据结构，就不要用锁 ； 能锁区块，就不要锁整个方法体 ； 能用对象锁，就不要用类锁。&lt;br/&gt;2.对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造成死锁。&lt;br/&gt;3.并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。如果&lt;strong&gt;每次访问冲突概率小于 20%，推荐使用乐观锁，否则使用悲观锁&lt;/strong&gt;。乐观锁的&lt;strong&gt;重试次数不得小于 3 次&lt;/strong&gt;。&lt;br/&gt;&lt;strong&gt;CountDownLatch&lt;/strong&gt;&lt;br/&gt;使用 CountDownLatch 进行异步转同步操作，每个线程退出前必须调用 countDown方法，线程执行代码注意 catch 异常，确保 countDown 方法被执行到，避免主线程无法执行至 await 方法，直到超时才返回结果。需要注意子线程抛出异常堆栈，不能在主线程的try-catch块中捕获到。&lt;br/&gt;&lt;strong&gt;ThreadLocalRandom&lt;/strong&gt;&lt;br/&gt;避免 Random 实例被多线程使用，虽然共享该实例是线程安全的，但会因竞争同一seed 导致的性能下降，推荐使用ThreadLocalRandom。&lt;br/&gt;&lt;strong&gt;Volatile&lt;/strong&gt;&lt;br/&gt;volatile 解决多线程内存不可见问题。对于&lt;strong&gt;一写多读&lt;/strong&gt;，是可以解决变量同步问题，但是如果&lt;strong&gt;多写&lt;/strong&gt;，同样无法解决线程安全问题。在完成饱汉的单例模式时，可以使用Volatile关键字实现延迟初始化。&lt;br/&gt;&lt;strong&gt;LongAdder&lt;/strong&gt;&lt;br/&gt;对于count++操作，可以使用&lt;code&gt;AtomicInteger count = new AtomicInteger();&lt;/code&gt;，JDK8中推荐使用LongAdder，通过减少乐观锁的重试次数提高性能。&lt;br/&gt;&lt;strong&gt;HashMap&lt;/strong&gt;&lt;br/&gt;HashMap 在容量不够进行 resize 时由于高并发可能出现死链，导致 CPU 飙升，在开发过程中可以使用其它数据结构或加锁来规避此风险。&lt;br/&gt;&lt;strong&gt;ThreadLocal&lt;/strong&gt;&lt;br/&gt;ThreadLocal 对象建议使用 static修饰。这个变量是针对一个线程内所有操作共享的。&lt;/p&gt;
&lt;h2 id=&quot;mysql规约&quot;&gt;MYSQL规约&lt;/h2&gt;
&lt;p&gt;数据库方面的优化一直困扰着我，书上的一下几个原则给予个人在数据库优化方面不少启示。&lt;br/&gt;&lt;strong&gt;索引长度&lt;/strong&gt;&lt;br/&gt;过去一直没有注意过索引还有长度这个概念，现在才知道在varchar等类型字段上建立索引时，可以指定索引长度，达到一定区分度即可，一般对于&lt;strong&gt;字符串类型数据，长度为 20 的索引，区分度会高达 90%以上&lt;/strong&gt;，可以使用&lt;code&gt;count(distinct left( 列名, 索引长度 )) / count( * )&lt;/code&gt;的区分度来确定。&lt;br/&gt;&lt;img src=&quot;http://images2017.cnblogs.com/blog/636325/201711/636325-20171122203125743-990742855.png&quot;/&gt;&lt;br/&gt;此外页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。索引文件具有B-Tree的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索引。&lt;br/&gt;&lt;strong&gt;order by&lt;/strong&gt;&lt;br/&gt;在有order by的场景，请注意利用索引的有序性。例如where a =? and b =? order by c的索引为a _ b _ c&lt;br/&gt;&lt;strong&gt;覆盖索引&lt;/strong&gt;&lt;br/&gt;利用覆盖索引可以减少原表查询，通过索引页(目录)即可查到所需信息。通常来说，能够建立索引的种类包括主键索引、唯一索引、普通索引，而覆盖索引是查询的一种效果，可以通过&lt;strong&gt;explain查看到extra 列会出现using index&lt;/strong&gt; 。&lt;br/&gt;&lt;strong&gt;分页查询&lt;/strong&gt;&lt;br/&gt;MySQL并不是跳过offset行，而是取 offset + N 行，之后放弃offset行，返回所需N行，当数据量大时，推荐如下方式进行优化。先快速定位需要获取的 id 段，然后再关联：&lt;br/&gt;&lt;code&gt;SELECT a.* FROM 表 1 a, (select id from 表 1 where 条件 LIMIT 100000,20 ) b where a.id=b.id&lt;/code&gt;&lt;br/&gt;&lt;strong&gt;SQL 性能优化的目标&lt;/strong&gt;&lt;br/&gt;至少要达到 range 级别， 要求是 ref 级别， 如果可以是 consts最好。&lt;br/&gt;&lt;strong&gt;consts&lt;/strong&gt; 单表中最多只有一个匹配行（主键或者唯一索引），在优化阶段即可读取到数据。&lt;br/&gt;&lt;strong&gt;ref&lt;/strong&gt; 指的是使用普通的索引 （normal index） 。&lt;br/&gt;&lt;strong&gt;range&lt;/strong&gt; 对索引进行范围检索。&lt;br/&gt;tip： type = index，索引物理文件全扫描，速度非常慢，这个 index 级别比较 range 还低，与全表扫描是小巫见大巫。&lt;br/&gt;&lt;strong&gt;组合索引&lt;/strong&gt;&lt;br/&gt;区分度最高的在最左边，对于&lt;code&gt;where a =? and b =?&lt;/code&gt;来说，a 列的值越唯一越好。此外，存在非等号和等号混合判断条件时， 在建索引时， 请把等号条件的列前置。&lt;br/&gt;&lt;strong&gt;隐式转换&lt;/strong&gt;&lt;br/&gt;防止因字段类型不同造成的隐式转换，导致索引失效，当数据查询超时，也需要把此作为很重要的考虑部分。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参考资料&lt;/strong&gt;&lt;br/&gt;&lt;a href=&quot;https://files.cnblogs.com/files/wanliwang01/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E7%BB%88%E6%9E%81%E7%89%88v1.3.0.pdf&quot;&gt;阿里巴巴Java开发手册&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://github.com/alibaba/p3c&quot;&gt;阿里规约github&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 22 Nov 2017 12:32:00 +0000</pubDate>
<dc:creator>熊二哥</dc:creator>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/wanliwang01/p/JavaStandard.html</dc:identifier>
</item>
</channel>
</rss>